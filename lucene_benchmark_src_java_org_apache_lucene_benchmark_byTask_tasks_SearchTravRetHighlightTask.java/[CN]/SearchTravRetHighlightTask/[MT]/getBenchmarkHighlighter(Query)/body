{
  highlighter=new Highlighter(new SimpleHTMLFormatter(),new QueryScorer(q));
  highlighter.setMaxDocCharsToAnalyze(maxDocCharsToAnalyze);
  return new BenchmarkHighlighter(){
    @Override public int doHighlight(    IndexReader reader,    int doc,    String field,    StoredDocument document,    Analyzer analyzer,    String text) throws Exception {
      final int maxStartOffset=highlighter.getMaxDocCharsToAnalyze() - 1;
      TokenStream ts=TokenSources.getTokenStream(field,reader.getTermVectors(doc),text,analyzer,maxStartOffset);
      TextFragment[] frag=highlighter.getBestTextFragments(ts,text,mergeContiguous,maxFrags);
      return frag != null ? frag.length : 0;
    }
  }
;
}
