{
  fieldInfos=new FieldInfos.Builder();
  DocHelper.setupDoc(testDoc);
  for (  IndexableField field : testDoc) {
    fieldInfos.addOrUpdate(field.name(),field.fieldType());
  }
  dir=newDirectory();
  IndexWriterConfig conf=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setMergePolicy(newLogMergePolicy());
  ((LogMergePolicy)conf.getMergePolicy()).setUseCompoundFile(false);
  IndexWriter writer=new IndexWriter(dir,conf);
  writer.addDocument(testDoc);
  writer.close();
  FaultyIndexInput.doFail=false;
}
