{
  File indexDir=_TestUtil.getTempDir("testfieldswriterexceptions");
  try {
    Directory dir=new FaultyFSDirectory(indexDir);
    IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setOpenMode(OpenMode.CREATE);
    IndexWriter writer=new IndexWriter(dir,iwc);
    for (int i=0; i < 2; i++)     writer.addDocument(testDoc);
    writer.forceMerge(1);
    writer.close();
    IndexReader reader=DirectoryReader.open(dir);
    FaultyIndexInput.doFail=true;
    boolean exc=false;
    for (int i=0; i < 2; i++) {
      try {
        reader.document(i);
      }
 catch (      IOException ioe) {
        exc=true;
      }
      try {
        reader.document(i);
      }
 catch (      IOException ioe) {
        exc=true;
      }
    }
    assertTrue(exc);
    reader.close();
    dir.close();
  }
  finally {
    _TestUtil.rmDir(indexDir);
  }
}
