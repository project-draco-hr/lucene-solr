{
  final NamedList resOuter=new SimpleOrderedMap();
  final String[] fields=params.getParams(FacetParams.FACET_RANGE);
  if (null == fields || 0 == fields.length)   return resOuter;
  final IndexSchema schema=searcher.getSchema();
  for (  String f : fields) {
    parseParams(FacetParams.FACET_RANGE,f);
    f=facetValue;
    final SchemaField sf=schema.getField(f);
    final FieldType ft=sf.getType();
    RangeEndpointCalculator calc=null;
    if (ft instanceof TrieField) {
      final TrieField trie=(TrieField)ft;
switch (trie.getType()) {
case FLOAT:
        calc=new FloatRangeEndpointCalculator(sf);
      break;
case DOUBLE:
    calc=new DoubleRangeEndpointCalculator(sf);
  break;
case INTEGER:
calc=new IntegerRangeEndpointCalculator(sf);
break;
case LONG:
calc=new LongRangeEndpointCalculator(sf);
break;
default :
throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to range facet on tried field of unexpected type:" + f);
}
}
 else if (ft instanceof DateField) {
calc=new DateRangeEndpointCalculator(sf,NOW);
}
 else if (ft instanceof SortableIntField) {
calc=new IntegerRangeEndpointCalculator(sf);
}
 else if (ft instanceof SortableLongField) {
calc=new LongRangeEndpointCalculator(sf);
}
 else if (ft instanceof SortableFloatField) {
calc=new FloatRangeEndpointCalculator(sf);
}
 else if (ft instanceof SortableDoubleField) {
calc=new DoubleRangeEndpointCalculator(sf);
}
 else {
throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to range facet on field:" + sf);
}
resOuter.add(key,getFacetRangeCounts(sf,calc));
}
return resOuter;
}
