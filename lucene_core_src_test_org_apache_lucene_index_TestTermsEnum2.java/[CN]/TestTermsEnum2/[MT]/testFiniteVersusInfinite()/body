{
  for (int i=0; i < numIterations; i++) {
    String reg=AutomatonTestUtil.randomRegexp(random());
    LightAutomaton automaton=BasicOperations.determinize(new RegExp(reg,RegExp.NONE).toLightAutomaton());
    final List<BytesRef> matchedTerms=new ArrayList<>();
    for (    BytesRef t : terms) {
      if (BasicOperations.run(automaton,t.utf8ToString())) {
        matchedTerms.add(t);
      }
    }
    LightAutomaton alternate=BasicAutomata.makeStringUnionLight(matchedTerms);
    AutomatonQuery a1=new AutomatonQuery(new Term("field",""),automaton);
    AutomatonQuery a2=new AutomatonQuery(new Term("field",""),alternate);
    ScoreDoc[] origHits=searcher.search(a1,25).scoreDocs;
    ScoreDoc[] newHits=searcher.search(a2,25).scoreDocs;
    CheckHits.checkEqual(a1,origHits,newHits);
  }
}
