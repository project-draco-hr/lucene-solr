{
  if (!reader.hasDeletions()) {
    return;
  }
  DocIdSetIterator it=set.iterator();
  int doc=it.nextDoc();
  for (  AtomicReaderContext context : reader.leaves()) {
    AtomicReader r=context.reader();
    final int maxDoc=r.maxDoc() + context.docBase;
    if (doc >= maxDoc) {
      continue;
    }
    if (!r.hasDeletions()) {
      while ((doc=it.nextDoc()) < maxDoc) {
      }
      continue;
    }
    Bits liveDocs=r.getLiveDocs();
    do {
      if (!liveDocs.get(doc - context.docBase)) {
        set.clear(doc);
      }
    }
 while ((doc=it.nextDoc()) < maxDoc);
  }
}
