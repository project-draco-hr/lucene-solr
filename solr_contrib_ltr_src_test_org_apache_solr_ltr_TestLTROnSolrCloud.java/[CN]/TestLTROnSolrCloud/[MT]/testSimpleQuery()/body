{
  SolrQuery query=new SolrQuery("{!func}sub(8,field(popularity))");
  query.setRequestHandler("/query");
  query.setFields("*,score");
  query.setParam("rows","8");
  QueryResponse queryResponse=solrCluster.getSolrClient().query(COLLECTION,query);
  assertEquals(8,queryResponse.getResults().getNumFound());
  assertEquals("1",queryResponse.getResults().get(0).get("id").toString());
  assertEquals("2",queryResponse.getResults().get(1).get("id").toString());
  assertEquals("3",queryResponse.getResults().get(2).get("id").toString());
  assertEquals("4",queryResponse.getResults().get(3).get("id").toString());
  query.setFields("*,score,features:[fv]");
  query.add("rq","{!ltr model=powpularityS-model reRankDocs=8}");
  queryResponse=solrCluster.getSolrClient().query(COLLECTION,query);
  assertEquals(8,queryResponse.getResults().getNumFound());
  assertEquals("8",queryResponse.getResults().get(0).get("id").toString());
  assertEquals("powpularityS:64.0;c3:2.0",queryResponse.getResults().get(0).get("features").toString());
  assertEquals("7",queryResponse.getResults().get(1).get("id").toString());
  assertEquals("powpularityS:49.0;c3:2.0",queryResponse.getResults().get(1).get("features").toString());
  assertEquals("6",queryResponse.getResults().get(2).get("id").toString());
  assertEquals("powpularityS:36.0;c3:2.0",queryResponse.getResults().get(2).get("features").toString());
  assertEquals("5",queryResponse.getResults().get(3).get("id").toString());
  assertEquals("powpularityS:25.0;c3:2.0",queryResponse.getResults().get(3).get("features").toString());
}
