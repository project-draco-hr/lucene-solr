{
  if (!rb.doStats || rb.stage != ResponseBuilder.STAGE_GET_FIELDS)   return;
  Map<String,StatsValues> allStatsValues=rb._statsInfo.getAggregateStatsValues();
  NamedList<NamedList<Object>> stats=new SimpleOrderedMap<>();
  NamedList<Object> stats_fields=new SimpleOrderedMap<>();
  stats.add("stats_fields",stats_fields);
  for (  Map.Entry<String,StatsValues> entry : allStatsValues.entrySet()) {
    String key=entry.getKey();
    NamedList stv=entry.getValue().getStatsValues();
    if ((Long)stv.get("count") != 0) {
      stats_fields.add(key,stv);
    }
 else {
      stats_fields.add(key,null);
    }
  }
  rb.rsp.add("stats",stats);
  rb._statsInfo=null;
}
