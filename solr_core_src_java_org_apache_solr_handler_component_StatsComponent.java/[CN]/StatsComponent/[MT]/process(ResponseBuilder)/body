{
  if (!rb.doStats)   return;
  boolean isShard=rb.req.getParams().getBool(ShardParams.IS_SHARD,false);
  NamedList<Object> out=new SimpleOrderedMap<>();
  NamedList<Object> stats_fields=new SimpleOrderedMap<>();
  for (  StatsField statsField : rb._statsInfo.getStatsFields()) {
    DocSet docs=statsField.computeBaseDocSet();
    NamedList<?> stv=statsField.computeLocalStatsValues(docs).getStatsValues();
    if (isShard == true || (Long)stv.get("count") > 0) {
      stats_fields.add(statsField.getOutputKey(),stv);
    }
 else {
      stats_fields.add(statsField.getOutputKey(),null);
    }
  }
  out.add("stats_fields",stats_fields);
  rb.rsp.add("stats",out);
}
