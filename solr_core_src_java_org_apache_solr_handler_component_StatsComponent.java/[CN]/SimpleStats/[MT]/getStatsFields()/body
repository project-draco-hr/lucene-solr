{
  NamedList<Object> res=new SimpleOrderedMap<Object>();
  String[] statsFs=params.getParams(StatsParams.STATS_FIELD);
  boolean isShard=params.getBool(ShardParams.IS_SHARD,false);
  if (null != statsFs) {
    final IndexSchema schema=searcher.getSchema();
    for (    String f : statsFs) {
      String[] facets=params.getFieldParams(f,StatsParams.STATS_FACET);
      if (facets == null) {
        facets=new String[0];
      }
      SchemaField sf=schema.getField(f);
      FieldType ft=sf.getType();
      NamedList<?> stv;
      if (sf.multiValued() || ft.multiValuedFieldCache()) {
        UnInvertedField uif=UnInvertedField.getUnInvertedField(f,searcher);
        stv=uif.getStats(searcher,docs,facets).getStatsValues();
      }
 else {
        stv=getFieldCacheStats(f,facets);
      }
      if (isShard == true || (Long)stv.get("count") > 0) {
        res.add(f,stv);
      }
 else {
        res.add(f,null);
      }
    }
  }
  return res;
}
