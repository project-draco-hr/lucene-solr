{
  NamedList<Object> res=new SimpleOrderedMap<>();
  String[] statsFs=params.getParams(StatsParams.STATS_FIELD);
  boolean isShard=params.getBool(ShardParams.IS_SHARD,false);
  if (null != statsFs) {
    final IndexSchema schema=searcher.getSchema();
    for (    String f : statsFs) {
      boolean calcDistinct=params.getFieldBool(f,StatsParams.STATS_CALC_DISTINCT,false);
      parseParams(f);
      String[] facets=params.getFieldParams(key,StatsParams.STATS_FACET);
      if (facets == null) {
        facets=new String[0];
      }
      SchemaField sf=schema.getField(statsField);
      FieldType ft=sf.getType();
      NamedList<?> stv;
      if (sf.multiValued() || ft.multiValuedFieldCache()) {
        UnInvertedField uif=UnInvertedField.getUnInvertedField(statsField,searcher);
        stv=uif.getStats(searcher,docs,calcDistinct,facets).getStatsValues();
      }
 else {
        stv=getFieldCacheStats(statsField,calcDistinct,facets);
      }
      if (isShard == true || (Long)stv.get("count") > 0) {
        res.add(key,stv);
      }
 else {
        res.add(key,null);
      }
    }
  }
  return res;
}
