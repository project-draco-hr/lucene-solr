{
  FieldType ft=searcher.getSchema().getFieldType(fieldName);
  FieldCache.DocTermsIndex si=null;
  try {
    si=FieldCache.DEFAULT.getTermsIndex(searcher.getIndexReader(),fieldName);
  }
 catch (  IOException e) {
    throw new RuntimeException("failed to open field cache for: " + fieldName,e);
  }
  FieldFacetStats all=new FieldFacetStats("all",si,ft,0);
  StatsValues allstats=new StatsValues();
  if (all.nTerms <= 0 || docs.size() <= 0)   return allstats.getStatsValues();
  int i=0;
  final FieldFacetStats[] finfo=new FieldFacetStats[facet.length];
  for (  String f : facet) {
    ft=searcher.getSchema().getFieldType(f);
    try {
      si=FieldCache.DEFAULT.getTermsIndex(searcher.getIndexReader(),f);
    }
 catch (    IOException e) {
      throw new RuntimeException("failed to open field cache for: " + f,e);
    }
    finfo[i++]=new FieldFacetStats(f,si,ft,0);
  }
  final CharsRef spare=new CharsRef();
  final BytesRef tempBR=new BytesRef();
  DocIterator iter=docs.iterator();
  while (iter.hasNext()) {
    int docID=iter.nextDoc();
    BytesRef raw=all.getTermText(docID,tempBR);
    Double v=null;
    if (raw != null) {
      v=Double.parseDouble(all.ft.indexedToReadable(raw,spare).toString());
      allstats.accumulate(v);
    }
 else {
      allstats.missing++;
    }
    for (    FieldFacetStats f : finfo) {
      f.facet(docID,v);
    }
  }
  if (finfo.length > 0) {
    allstats.facets=new HashMap<String,Map<String,StatsValues>>();
    for (    FieldFacetStats f : finfo) {
      allstats.facets.put(f.name,f.facetStatsValues);
    }
  }
  return allstats.getStatsValues();
}
