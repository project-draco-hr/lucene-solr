{
  try (InputStream stream=Files.newInputStream(file)){
    Document doc=new Document();
    Field pathField=new StringField("path",file.toString(),Field.Store.YES);
    doc.add(pathField);
    doc.add(new DimensionalLongField("modified",lastModified));
    doc.add(new TextField("contents",new BufferedReader(new InputStreamReader(stream,StandardCharsets.UTF_8))));
    if (writer.getConfig().getOpenMode() == OpenMode.CREATE) {
      System.out.println("adding " + file);
      writer.addDocument(doc);
    }
 else {
      System.out.println("updating " + file);
      writer.updateDocument(new Term("path",file.toString()),doc);
    }
  }
 }
