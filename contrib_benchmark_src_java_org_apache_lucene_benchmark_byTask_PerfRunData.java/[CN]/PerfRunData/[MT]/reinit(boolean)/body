{
  if (indexWriter != null) {
    indexWriter.close();
    indexWriter=null;
  }
  if (indexReader != null) {
    indexReader.close();
    indexReader=null;
  }
  if (directory != null) {
    directory.close();
  }
  if ("FSDirectory".equals(config.get("directory","RAMDirectory"))) {
    File workDir=new File("work");
    File indexDir=new File(workDir,"index");
    if (eraseIndex && indexDir.exists()) {
      FileUtils.fullyDelete(indexDir);
    }
    indexDir.mkdirs();
    directory=FSDirectory.getDirectory(indexDir,eraseIndex);
  }
 else {
    directory=new RAMDirectory();
  }
  resetInputs();
  System.runFinalization();
  System.gc();
}
