{
  String minShouldMatch=parseMinShouldMatch(req.getSchema(),solrParams);
  Query dis=up.parse(userQuery);
  Query query=dis;
  if (dis instanceof BooleanQuery) {
    BooleanQuery t=new BooleanQuery();
    SolrPluginUtils.flattenBooleanQuery(t,(BooleanQuery)dis);
    SolrPluginUtils.setMinShouldMatch(t,minShouldMatch);
    query=t;
  }
  return query;
}
