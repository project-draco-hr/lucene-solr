{
  while (true) {
    int ev=parser.nextEvent();
    if (ev == JSONParser.EOF)     return;
    if (ev == JSONParser.OBJECT_START) {
      assertEvent(ev,JSONParser.OBJECT_START);
      AddUpdateCommand cmd=new AddUpdateCommand(req);
      cmd.commitWithin=commitWithin;
      cmd.overwrite=overwrite;
      cmd.solrDoc=parseDoc(ev);
      processor.processAdd(cmd);
    }
 else     if (ev == JSONParser.ARRAY_START) {
      handleAdds();
    }
 else {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unexpected event :" + ev);
    }
  }
}
