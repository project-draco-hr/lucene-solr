{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  Field f=newTextField("field","a b c d",Field.Store.NO);
  doc.add(f);
  w.addDocument(doc);
  f.setStringValue("b d");
  w.addDocument(doc);
  f.setStringValue("a d");
  w.addDocument(doc);
  w.commit();
  DirectoryReader reader=w.getReader();
  final IndexSearcher searcher=new IndexSearcher(reader);
  BooleanQuery.Builder qBuilder=new BooleanQuery.Builder();
  BooleanQuery q=qBuilder.build();
  q.setBoost(random().nextFloat());
  qBuilder.add(new TermQuery(new Term("field","a")),Occur.FILTER);
  assertSameScoresWithoutFilters(searcher,qBuilder.build());
  qBuilder.add(new TermQuery(new Term("field","b")),Occur.FILTER);
  q=qBuilder.build();
  q.setBoost(random().nextFloat());
  assertSameScoresWithoutFilters(searcher,q);
  qBuilder.add(new TermQuery(new Term("field","c")),Occur.SHOULD);
  q=qBuilder.build();
  q.setBoost(random().nextFloat());
  assertSameScoresWithoutFilters(searcher,q);
  qBuilder=new BooleanQuery.Builder();
  qBuilder.add(new TermQuery(new Term("field","a")),Occur.FILTER);
  qBuilder.add(new TermQuery(new Term("field","e")),Occur.SHOULD);
  q=qBuilder.build();
  q.setBoost(random().nextFloat());
  assertSameScoresWithoutFilters(searcher,q);
  qBuilder=new BooleanQuery.Builder();
  qBuilder.add(new TermQuery(new Term("field","a")),Occur.FILTER);
  qBuilder.add(new TermQuery(new Term("field","d")),Occur.MUST);
  q=qBuilder.build();
  q.setBoost(random().nextFloat());
  assertSameScoresWithoutFilters(searcher,q);
  qBuilder=new BooleanQuery.Builder();
  qBuilder.add(new TermQuery(new Term("field","b")),Occur.FILTER);
  qBuilder.add(new TermQuery(new Term("field","a")),Occur.SHOULD);
  qBuilder.add(new TermQuery(new Term("field","d")),Occur.SHOULD);
  qBuilder.setMinimumNumberShouldMatch(1);
  q=qBuilder.build();
  q.setBoost(random().nextFloat());
  assertSameScoresWithoutFilters(searcher,q);
  reader.close();
  w.close();
  dir.close();
}
