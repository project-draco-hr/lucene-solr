{
  try {
    final int fieldCount=fields.size();
    final long dirStart=out.getFilePointer();
    out.writeInt(fieldCount);
    for (int i=0; i < fieldCount; i++) {
      TermsWriter field=(TermsWriter)fields.get(i);
      out.writeInt(field.fieldInfo.number);
      out.writeLong(field.numTerms);
      out.writeLong(field.termsStartPointer);
    }
    out.seek(CodecUtil.headerLength(CODEC_NAME));
    out.writeLong(dirStart);
  }
  finally {
    try {
      out.close();
    }
  finally {
      try {
        postingsWriter.close();
      }
  finally {
        indexWriter.close();
      }
    }
  }
}
