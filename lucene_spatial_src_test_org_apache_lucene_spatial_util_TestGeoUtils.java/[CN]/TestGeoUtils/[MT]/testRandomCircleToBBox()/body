{
  int iters=atLeast(1000);
  for (int iter=0; iter < iters; iter++) {
    boolean useSmallRanges=random().nextBoolean();
    double radiusMeters;
    double centerLat=randomLat(useSmallRanges);
    double centerLon=randomLon(useSmallRanges);
    if (useSmallRanges) {
      radiusMeters=random().nextDouble() * 444000;
    }
 else {
      radiusMeters=random().nextDouble() * 50000000;
    }
    GeoRect bbox=GeoUtils.circleToBBox(centerLon,centerLat,radiusMeters);
    int numPointsToTry=1000;
    for (int i=0; i < numPointsToTry; i++) {
      double lat;
      double lon;
      if (random().nextBoolean()) {
        lat=randomLat(useSmallRanges);
        lon=randomLon(useSmallRanges);
      }
 else {
        lat=GeoUtils.normalizeLat(randomRangeMaybeSlightlyOutside(bbox.minLat,bbox.maxLat));
        if (bbox.crossesDateline()) {
          if (random().nextBoolean()) {
            lon=GeoUtils.normalizeLon(randomRangeMaybeSlightlyOutside(bbox.maxLon,-180));
          }
 else {
            lon=GeoUtils.normalizeLon(randomRangeMaybeSlightlyOutside(0,bbox.minLon));
          }
        }
 else {
          lon=GeoUtils.normalizeLon(randomRangeMaybeSlightlyOutside(bbox.minLon,bbox.maxLon));
        }
      }
      double distanceMeters=SloppyMath.haversinMeters(centerLat,centerLon,lat,lon);
      boolean haversinSays=distanceMeters <= radiusMeters;
      boolean bboxSays;
      if (bbox.crossesDateline()) {
        if (lat >= bbox.minLat && lat <= bbox.maxLat) {
          bboxSays=lon <= bbox.maxLon || lon >= bbox.minLon;
        }
 else {
          bboxSays=false;
        }
      }
 else {
        bboxSays=lat >= bbox.minLat && lat <= bbox.maxLat && lon >= bbox.minLon && lon <= bbox.maxLon;
      }
      if (haversinSays) {
        if (bboxSays == false) {
          System.out.println("small=" + useSmallRanges + " centerLat="+ centerLat+ " cetnerLon="+ centerLon+ " radiusMeters="+ radiusMeters);
          System.out.println("  bbox: lat=" + bbox.minLat + " to "+ bbox.maxLat+ " lon="+ bbox.minLon+ " to "+ bbox.maxLon);
          System.out.println("  point: lat=" + lat + " lon="+ lon);
          System.out.println("  haversin: " + distanceMeters);
          fail("point was within the distance according to haversin, but the bbox doesn't contain it");
        }
      }
 else {
      }
    }
  }
}
