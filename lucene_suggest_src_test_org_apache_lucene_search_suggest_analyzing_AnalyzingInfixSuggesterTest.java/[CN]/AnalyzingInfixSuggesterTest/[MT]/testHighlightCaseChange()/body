{
  TermFreqPayload keys[]=new TermFreqPayload[]{new TermFreqPayload("a Penny saved is a penny earned",10,new BytesRef("foobaz"))};
  File tempDir=_TestUtil.getTempDir("AnalyzingInfixSuggesterTest");
  Analyzer a=new MockAnalyzer(random(),MockTokenizer.WHITESPACE,true);
  AnalyzingInfixSuggester suggester=new AnalyzingInfixSuggester(TEST_VERSION_CURRENT,tempDir,a,a,3);
  suggester.build(new TermFreqPayloadArrayIterator(keys));
  List<LookupResult> results=suggester.lookup(_TestUtil.stringToCharSequence("penn",random()),10,true,true);
  assertEquals(1,results.size());
  assertEquals("a <b>Penny</b> saved is a <b>penn</b>y earned",results.get(0).key);
  suggester.close();
  suggester=new AnalyzingInfixSuggester(TEST_VERSION_CURRENT,tempDir,a,a,3){
    @Override protected void addPrefixMatch(    StringBuilder sb,    String surface,    String analyzed,    String prefixToken){
      prefixToken=prefixToken.toLowerCase(Locale.ROOT);
      String surfaceLower=surface.toLowerCase(Locale.ROOT);
      sb.append("<b>");
      if (surfaceLower.startsWith(prefixToken)) {
        sb.append(surface.substring(0,prefixToken.length()));
        sb.append("</b>");
        sb.append(surface.substring(prefixToken.length()));
      }
 else {
        sb.append(surface);
        sb.append("</b>");
      }
    }
  }
;
  suggester.build(new TermFreqPayloadArrayIterator(keys));
  results=suggester.lookup(_TestUtil.stringToCharSequence("penn",random()),10,true,true);
  assertEquals(1,results.size());
  assertEquals("a <b>Penn</b>y saved is a <b>penn</b>y earned",results.get(0).key);
  suggester.close();
}
