{
  PayloadTermQuery query=new PayloadTermQuery(new Term(PayloadHelper.MULTI_FIELD,"seventy"),new MaxPayloadFunction(),false);
  IndexReader reader=IndexReader.open(directory);
  IndexSearcher theSearcher=new IndexSearcher(reader);
  theSearcher.setSimilarityProvider(new DefaultSimilarityProvider(){
    @Override public Similarity get(    String field){
      return new FullSimilarity();
    }
  }
);
  TopDocs hits=searcher.search(query,null,100);
  assertTrue("hits is null and it shouldn't be",hits != null);
  assertTrue("hits Size: " + hits.totalHits + " is not: "+ 100,hits.totalHits == 100);
  assertTrue(hits.getMaxScore() + " does not equal: " + 4.0,hits.getMaxScore() == 4.0);
  int numTens=0;
  for (int i=0; i < hits.scoreDocs.length; i++) {
    ScoreDoc doc=hits.scoreDocs[i];
    if (doc.doc % 10 == 0) {
      numTens++;
      assertTrue(doc.score + " does not equal: " + 4.0,doc.score == 4.0);
    }
 else {
      assertTrue(doc.score + " does not equal: " + 2,doc.score == 2);
    }
  }
  assertTrue(numTens + " does not equal: " + 10,numTens == 10);
  CheckHits.checkExplanations(query,"field",searcher,true);
  Spans spans=MultiSpansWrapper.wrap(searcher.getTopReaderContext(),query);
  assertTrue("spans is null and it shouldn't be",spans != null);
  int count=0;
  while (spans.next()) {
    count++;
  }
  reader.close();
}
