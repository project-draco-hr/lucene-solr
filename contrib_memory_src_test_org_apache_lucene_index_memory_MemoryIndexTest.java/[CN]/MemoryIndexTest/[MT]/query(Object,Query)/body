{
  Searcher searcher=null;
  try {
    if (index instanceof Directory)     searcher=new IndexSearcher((Directory)index,true);
 else     searcher=((MemoryIndex)index).createSearcher();
    final float[] scores=new float[1];
    searcher.search(query,new Collector(){
      private Scorer scorer;
      public void collect(      int doc) throws IOException {
        scores[0]=scorer.score();
      }
      public void setScorer(      Scorer scorer) throws IOException {
        this.scorer=scorer;
      }
      public boolean acceptsDocsOutOfOrder(){
        return true;
      }
      public void setNextReader(      IndexReader reader,      int docBase){
      }
    }
);
    float score=scores[0];
    return score;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
 finally {
    try {
      if (searcher != null)       searcher.close();
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
}
