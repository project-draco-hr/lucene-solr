{
  info("SimplePostTool version " + VERSION_OF_THIS_TOOL);
  if (0 < args.length && ("-help".equals(args[0]) || "--help".equals(args[0]) || "-h".equals(args[0]))) {
    usage();
    return;
  }
  OutputStream out=null;
  final String type=System.getProperty("type");
  final String params=System.getProperty("params","");
  URL u=null;
  try {
    u=new URL(System.getProperty("url",SimplePostTool.appendParam(DEFAULT_POST_URL,params)));
  }
 catch (  MalformedURLException e) {
    fatal("System Property 'url' is not a valid URL: " + u);
  }
  final SimplePostTool t=new SimplePostTool(u);
  if (isOn(System.getProperty("auto",DEFAULT_AUTO))) {
    t.setAuto(true);
  }
  if (isOn(System.getProperty("recursive",DEFAULT_RECURSIVE))) {
    t.setRecursive(true);
  }
  final String mode=System.getProperty("data",DEFAULT_DATA_MODE);
  if (!DATA_MODES.contains(mode)) {
    fatal("System Property 'data' is not valid for this tool: " + mode);
  }
  if (isOn(System.getProperty("out",DEFAULT_OUT))) {
    out=System.out;
  }
  t.setFileTypes(System.getProperty("filetypes",DEFAULT_FILE_TYPES));
  int numFilesPosted=0;
  try {
    if (DATA_MODE_FILES.equals(mode)) {
      if (0 < args.length) {
        if (!args[0].equals("-")) {
          info("Posting files to base url " + u + (!t.auto ? " using content-type " + (type == null ? DEFAULT_CONTENT_TYPE : type) : "")+ "..");
          if (t.auto)           info("Entering auto mode. File endings considered are " + t.getFileTypes());
          if (t.recursive)           info("Entering recursive mode");
          numFilesPosted=t.postFiles(args,0,out,type);
          info(numFilesPosted + " files indexed.");
        }
      }
 else {
        usageShort();
        return;
      }
    }
 else     if (DATA_MODE_ARGS.equals(mode)) {
      if (0 < args.length) {
        info("POSTing args to " + u + "..");
        for (        String a : args) {
          t.postData(SimplePostTool.stringToStream(a),null,out,type);
        }
      }
 else {
        usageShort();
        return;
      }
    }
 else     if (DATA_MODE_STDIN.equals(mode)) {
      info("POSTing stdin to " + u + "..");
      t.postData(System.in,null,out,type);
    }
    if (isOn(System.getProperty("commit",DEFAULT_COMMIT))) {
      info("COMMITting Solr index changes to " + u + "..");
      t.commit();
    }
    if (isOn(System.getProperty("optimize",DEFAULT_OPTIMIZE))) {
      info("Performing an OPTIMIZE to " + u + "..");
      t.optimize();
    }
  }
 catch (  RuntimeException e) {
    e.printStackTrace();
    fatal("RuntimeException " + e);
  }
}
