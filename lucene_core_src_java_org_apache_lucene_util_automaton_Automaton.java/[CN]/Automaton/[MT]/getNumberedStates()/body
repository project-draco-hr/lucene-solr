{
  if (numberedStates == null) {
    expandSingleton();
    final Set<State> visited=new HashSet<State>();
    final LinkedList<State> worklist=new LinkedList<State>();
    numberedStates=new State[4];
    int upto=0;
    worklist.add(initial);
    visited.add(initial);
    initial.number=upto;
    numberedStates[upto]=initial;
    upto++;
    while (worklist.size() > 0) {
      State s=worklist.removeFirst();
      for (int i=0; i < s.numTransitions; i++) {
        final Transition t=s.transitionsArray[i];
        if (!visited.contains(t.to)) {
          visited.add(t.to);
          worklist.add(t.to);
          t.to.number=upto;
          if (upto == numberedStates.length) {
            final State[] newArray=new State[ArrayUtil.oversize(1 + upto,RamUsageEstimator.NUM_BYTES_OBJECT_REF)];
            System.arraycopy(numberedStates,0,newArray,0,upto);
            numberedStates=newArray;
          }
          numberedStates[upto]=t.to;
          upto++;
        }
      }
    }
    if (numberedStates.length != upto) {
      final State[] newArray=new State[upto];
      System.arraycopy(numberedStates,0,newArray,0,upto);
      numberedStates=newArray;
    }
  }
  return numberedStates;
}
