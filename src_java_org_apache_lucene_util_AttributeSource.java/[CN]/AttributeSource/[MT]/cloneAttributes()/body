{
  AttributeSource clone=new AttributeSource(this.factory);
  if (hasAttributes()) {
    if (currentState == null) {
      computeCurrentState();
    }
    for (State state=currentState; state != null; state=state.next) {
      clone.attributeImpls.put(state.attribute.getClass(),state.attribute.clone());
    }
  }
  Iterator attIt=this.attributes.entrySet().iterator();
  while (attIt.hasNext()) {
    Entry entry=(Entry)attIt.next();
    clone.attributes.put(entry.getKey(),clone.attributeImpls.get(entry.getValue().getClass()));
  }
  return clone;
}
