{
  LOG.info("New index installed. Updating index properties... index=" + tmpIdxDirName);
  Properties p=new Properties();
  Directory dir=null;
  try {
    dir=solrCore.getDirectoryFactory().get(solrCore.getDataDir(),solrCore.getSolrConfig().indexConfig.lockType);
    if (dir.fileExists("index.properties")) {
      final IndexInput input=dir.openInput("index.properties",IOContext.DEFAULT);
      final InputStream is=new PropertiesInputStream(input);
      try {
        p.load(is);
      }
 catch (      Exception e) {
        LOG.error("Unable to load index.properties",e);
      }
 finally {
        IOUtils.closeQuietly(is);
      }
    }
    try {
      dir.deleteFile("index.properties");
    }
 catch (    IOException e) {
    }
    final IndexOutput out=dir.createOutput("index.properties",IOContext.DEFAULT);
    p.put("index",tmpIdxDirName);
    OutputStream os=null;
    try {
      os=new PropertiesOutputStream(out);
      p.store(os,"index properties");
      dir.sync(Collections.singleton(INDEX_PEROPERTIES));
    }
 catch (    Exception e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unable to write index.properties",e);
    }
 finally {
      IOUtils.closeQuietly(os);
    }
    return true;
  }
 catch (  IOException e1) {
    throw new RuntimeException(e1);
  }
 finally {
    if (dir != null) {
      try {
        solrCore.getDirectoryFactory().release(dir);
      }
 catch (      IOException e) {
        SolrException.log(LOG,"",e);
      }
    }
  }
}
