{
  LOG.info("New index installed. Updating index properties... index=" + tmpIdxDirName);
  Properties p=new Properties();
  Directory dir=null;
  try {
    dir=solrCore.getDirectoryFactory().get(solrCore.getDataDir(),DirContext.META_DATA,solrCore.getSolrConfig().indexConfig.lockType);
    if (slowFileExists(dir,SnapPuller.INDEX_PROPERTIES)) {
      final IndexInput input=dir.openInput(SnapPuller.INDEX_PROPERTIES,DirectoryFactory.IOCONTEXT_NO_CACHE);
      final InputStream is=new PropertiesInputStream(input);
      try {
        p.load(new InputStreamReader(is,CHARSET_UTF_8));
      }
 catch (      Exception e) {
        LOG.error("Unable to load " + SnapPuller.INDEX_PROPERTIES,e);
      }
 finally {
        IOUtils.closeQuietly(is);
      }
    }
    try {
      dir.deleteFile(SnapPuller.INDEX_PROPERTIES);
    }
 catch (    IOException e) {
    }
    final IndexOutput out=dir.createOutput(SnapPuller.INDEX_PROPERTIES,DirectoryFactory.IOCONTEXT_NO_CACHE);
    p.put("index",tmpIdxDirName);
    Writer os=null;
    try {
      os=new OutputStreamWriter(new PropertiesOutputStream(out),CHARSET_UTF_8);
      p.store(os,SnapPuller.INDEX_PROPERTIES);
      dir.sync(Collections.singleton(INDEX_PROPERTIES));
    }
 catch (    Exception e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unable to write " + SnapPuller.INDEX_PROPERTIES,e);
    }
 finally {
      IOUtils.closeQuietly(os);
    }
    return true;
  }
 catch (  IOException e1) {
    throw new RuntimeException(e1);
  }
 finally {
    if (dir != null) {
      try {
        solrCore.getDirectoryFactory().release(dir);
      }
 catch (      IOException e) {
        SolrException.log(LOG,"",e);
      }
    }
  }
}
