{
  LOG.info("New index installed. Updating index properties... index=" + tmpIdxDirName);
  Properties p=new Properties();
  Directory dir=null;
  try {
    dir=solrCore.getDirectoryFactory().get(solrCore.getDataDir(),null);
    if (dir.fileExists("index.properties")) {
      final IndexInput input=dir.openInput("index.properties",IOContext.DEFAULT);
      final InputStream is=new InputStream(){
        @Override public int read() throws IOException {
          byte next;
          try {
            next=input.readByte();
          }
 catch (          EOFException e) {
            return -1;
          }
          return next;
        }
        @Override public void close() throws IOException {
          super.close();
          input.close();
        }
      }
;
      try {
        p.load(is);
      }
 catch (      Exception e) {
        LOG.error("Unable to load index.properties",e);
      }
 finally {
        IOUtils.closeQuietly(is);
      }
    }
    try {
      dir.deleteFile("index.properties");
    }
 catch (    IOException e) {
    }
    final IndexOutput out=dir.createOutput("index.properties",IOContext.DEFAULT);
    p.put("index",tmpIdxDirName);
    OutputStream os=null;
    try {
      os=new OutputStream(){
        @Override public void write(        int b) throws IOException {
          out.writeByte((byte)b);
        }
        @Override public void close() throws IOException {
          super.close();
          out.close();
        }
      }
;
      p.store(os,"index properties");
    }
 catch (    Exception e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unable to write index.properties",e);
    }
 finally {
      IOUtils.closeQuietly(os);
    }
    return true;
  }
 catch (  IOException e1) {
    throw new RuntimeException(e1);
  }
 finally {
    if (dir != null) {
      try {
        solrCore.getDirectoryFactory().release(dir);
      }
 catch (      IOException e) {
        SolrException.log(LOG,"",e);
      }
    }
  }
}
