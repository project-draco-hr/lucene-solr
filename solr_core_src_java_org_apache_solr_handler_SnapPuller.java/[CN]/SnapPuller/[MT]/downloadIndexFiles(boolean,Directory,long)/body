{
  String indexDir=solrCore.getIndexDir();
  Directory dir=solrCore.getDirectoryFactory().get(indexDir,DirContext.DEFAULT,solrCore.getSolrConfig().indexConfig.lockType);
  try {
    for (    Map<String,Object> file : filesToDownload) {
      if (!dir.fileExists((String)file.get(NAME)) || downloadCompleteIndex) {
        dirFileFetcher=new DirectoryFileFetcher(tmpIndexDir,file,(String)file.get(NAME),false,latestGeneration);
        currentFile=file;
        dirFileFetcher.fetchFile();
        filesDownloaded.add(new HashMap<String,Object>(file));
      }
 else {
        LOG.info("Skipping download for " + file.get(NAME));
      }
    }
  }
  finally {
    solrCore.getDirectoryFactory().release(dir);
  }
}
