{
  File indexFileInTmpDir=new File(tmpIdxDir,fname);
  File indexFileInIndex=new File(indexDir,fname);
  boolean success=indexFileInTmpDir.renameTo(indexFileInIndex);
  if (!success) {
    try {
      LOG.error("Unable to move index file from: " + indexFileInTmpDir + " to: "+ indexFileInIndex+ " Trying to do a copy");
      FileUtils.copyFile(indexFileInTmpDir,indexFileInIndex);
      success=true;
    }
 catch (    FileNotFoundException e) {
      if (!indexDir.exists()) {
        File parent=indexDir.getParentFile();
        String[] children=null;
        if (parent != null) {
          children=parent.list();
        }
        LOG.error("The index directory does not exist: " + indexDir.getAbsolutePath() + " dirs found: "+ (children == null ? "none could be found" : Arrays.asList(children)));
      }
      LOG.error("Unable to copy index file from: " + indexFileInTmpDir + " to: "+ indexFileInIndex,e);
    }
catch (    IOException e) {
      LOG.error("Unable to copy index file from: " + indexFileInTmpDir + " to: "+ indexFileInIndex,e);
    }
  }
  if (!success) {
    for (    String f : copiedfiles) {
      File indexFile=new File(indexDir,f);
      if (indexFile.exists())       indexFile.delete();
    }
    delTree(tmpIdxDir);
    return false;
  }
  return true;
}
