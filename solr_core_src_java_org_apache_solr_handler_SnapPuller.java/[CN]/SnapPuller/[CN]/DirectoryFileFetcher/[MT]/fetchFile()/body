{
  try {
    while (true) {
      final FastInputStream is=getStream();
      int result;
      try {
        result=fetchPackets(is);
        if (result == 0 || result == NO_CONTENT) {
          return;
        }
      }
  finally {
        IOUtils.closeQuietly(is);
      }
    }
  }
  finally {
    cleanup();
    fsyncService.submit(new Runnable(){
      @Override public void run(){
        try {
          copy2Dir.sync(Collections.singleton(saveAs));
        }
 catch (        IOException e) {
          fsyncException=e;
        }
      }
    }
);
  }
}
