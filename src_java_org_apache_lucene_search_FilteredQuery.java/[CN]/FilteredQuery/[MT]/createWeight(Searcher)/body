{
  final Weight weight=query.createWeight(searcher);
  final Similarity similarity=query.getSimilarity(searcher);
  return new Weight(){
    public float getValue(){
      return weight.getValue();
    }
    public float sumOfSquaredWeights() throws IOException {
      return weight.sumOfSquaredWeights();
    }
    public void normalize(    float v){
      weight.normalize(v);
    }
    public Explanation explain(    IndexReader ir,    int i) throws IOException {
      return weight.explain(ir,i);
    }
    public Query getQuery(){
      return FilteredQuery.this;
    }
    public Scorer scorer(    IndexReader indexReader) throws IOException {
      final Scorer scorer=weight.scorer(indexReader);
      final BitSet bitset=filter.bits(indexReader);
      return new Scorer(similarity){
        public boolean next() throws IOException {
          do {
            if (!scorer.next()) {
              return false;
            }
          }
 while (!bitset.get(scorer.doc()));
          return true;
        }
        public int doc(){
          return scorer.doc();
        }
        public boolean skipTo(        int i) throws IOException {
          if (!scorer.skipTo(i)) {
            return false;
          }
          while (!bitset.get(scorer.doc())) {
            int nextFiltered=bitset.nextSetBit(scorer.doc() + 1);
            if (nextFiltered == -1) {
              return false;
            }
 else             if (!scorer.skipTo(nextFiltered)) {
              return false;
            }
          }
          return true;
        }
        public float score() throws IOException {
          return scorer.score();
        }
        public Explanation explain(        int i) throws IOException {
          Explanation exp=scorer.explain(i);
          if (bitset.get(i))           exp.setDescription("allowed by filter: " + exp.getDescription());
 else           exp.setDescription("removed by filter: " + exp.getDescription());
          return exp;
        }
      }
;
    }
  }
;
}
