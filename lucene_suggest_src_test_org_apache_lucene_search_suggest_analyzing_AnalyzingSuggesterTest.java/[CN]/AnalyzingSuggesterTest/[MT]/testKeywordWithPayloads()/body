{
  Iterable<TermFreqPayload> keys=shuffle(new TermFreqPayload("foo",50,new BytesRef("hello")),new TermFreqPayload("bar",10,new BytesRef("goodbye")),new TermFreqPayload("barbar",12,new BytesRef("thank you")),new TermFreqPayload("bar",9,new BytesRef("should be deduplicated")),new TermFreqPayload("bar",8,new BytesRef("should also be deduplicated")),new TermFreqPayload("barbara",6,new BytesRef("for all the fish")));
  AnalyzingSuggester suggester=new AnalyzingSuggester(new MockAnalyzer(random(),MockTokenizer.KEYWORD,false));
  suggester.build(new TermFreqPayloadArrayIterator(keys));
  for (int i=0; i < 2; i++) {
    List<LookupResult> results=suggester.lookup(_TestUtil.stringToCharSequence("f",random()),false,2);
    assertEquals(1,results.size());
    assertEquals("foo",results.get(0).key.toString());
    assertEquals(50,results.get(0).value,0.01F);
    assertEquals(new BytesRef("hello"),results.get(0).payload);
    results=suggester.lookup(_TestUtil.stringToCharSequence("bar",random()),false,1);
    assertEquals(1,results.size());
    assertEquals("bar",results.get(0).key.toString());
    assertEquals(10,results.get(0).value,0.01F);
    assertEquals(new BytesRef("goodbye"),results.get(0).payload);
    results=suggester.lookup(_TestUtil.stringToCharSequence("b",random()),false,2);
    assertEquals(2,results.size());
    assertEquals("barbar",results.get(0).key.toString());
    assertEquals(12,results.get(0).value,0.01F);
    assertEquals(new BytesRef("thank you"),results.get(0).payload);
    assertEquals("bar",results.get(1).key.toString());
    assertEquals(10,results.get(1).value,0.01F);
    assertEquals(new BytesRef("goodbye"),results.get(1).payload);
    results=suggester.lookup(_TestUtil.stringToCharSequence("ba",random()),false,3);
    assertEquals(3,results.size());
    assertEquals("barbar",results.get(0).key.toString());
    assertEquals(12,results.get(0).value,0.01F);
    assertEquals(new BytesRef("thank you"),results.get(0).payload);
    assertEquals("bar",results.get(1).key.toString());
    assertEquals(10,results.get(1).value,0.01F);
    assertEquals(new BytesRef("goodbye"),results.get(1).payload);
    assertEquals("barbara",results.get(2).key.toString());
    assertEquals(6,results.get(2).value,0.01F);
    assertEquals(new BytesRef("for all the fish"),results.get(2).payload);
  }
}
