{
  Map<Term,TermContext> termContexts=new HashMap<>();
  TreeSet<Term> terms=new TreeSet<>();
  final IndexSearcher searcher=new IndexSearcher(context);
  searcher.setQueryCache(null);
  searcher.createNormalizedWeight(query,false).extractTerms(terms);
  for (  Term term : terms) {
    termContexts.put(term,TermContext.build(context,term));
  }
  for (  LeafReaderContext leafReaderContext : context.leaves()) {
    final Spans spans=query.getSpans(leafReaderContext,leafReaderContext.reader().getLiveDocs(),termContexts);
    if (spans != null) {
      while (spans.nextDoc() != Spans.NO_MORE_DOCS) {
        while (spans.nextStartPosition() != Spans.NO_MORE_POSITIONS) {
          if (spans.isPayloadAvailable()) {
            Collection<byte[]> payload=spans.getPayload();
            for (            byte[] bytes : payload) {
              payloads.add(bytes);
            }
          }
        }
      }
    }
  }
}
