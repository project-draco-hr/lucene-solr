{
  SolrParams params=rb.req.getParams();
  if (!params.getBool(COMPONENT_NAME,false) || !params.getBool(ClusteringParams.USE_SEARCH_RESULTS,false)) {
    return;
  }
  sreq.params.remove(COMPONENT_NAME);
  if ((sreq.purpose & ShardRequest.PURPOSE_GET_FIELDS) != 0) {
    String fl=sreq.params.get(CommonParams.FL,"*");
    if (fl.indexOf('*') >= 0)     return;
    Set<String> fields=getSearchClusteringEngine(rb).getFieldsToLoad(rb.req);
    if (fields == null || fields.size() == 0)     return;
    StringBuilder sb=new StringBuilder();
    String[] flparams=fl.split("[,\\s]+");
    Set<String> flParamSet=new HashSet<String>(flparams.length);
    for (    String flparam : flparams) {
      flParamSet.add(flparam);
    }
    for (    String aFieldToLoad : fields) {
      if (!flParamSet.contains(aFieldToLoad)) {
        sb.append(',').append(aFieldToLoad);
      }
    }
    if (sb.length() > 0) {
      sreq.params.set(CommonParams.FL,fl + sb.toString());
    }
  }
}
