{
  String id="myID";
  Field f=new Field(FIELD_ID,id,Field.Store.YES,Field.Index.UN_TOKENIZED);
  Document doc=new Document();
  doc.add(f);
  Term delTerm=new Term(FIELD_ID,id);
  IndexDocument iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.INSERT);
  this.indexer.writer.addDocument(doc);
  this.indexer.closeWriter();
  IndexSearcher s=new IndexSearcher(this.dir);
  Hits h=s.search(new TermQuery(delTerm));
  assertEquals(1,h.length());
  s.close();
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.DELETE);
  this.indexer.deleteDocument(iDoc);
  assertEquals(0,this.indexer.docsAdded.get());
  assertEquals(1,this.indexer.docsDeleted.get());
  assertEquals(0,this.indexer.docsUpdated.get());
  this.indexer.commit(false);
  s=new IndexSearcher(this.dir);
  h=s.search(new TermQuery(delTerm));
  assertEquals(0,h.length());
  s.close();
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.INSERT);
  this.indexer.addDocument(iDoc);
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.DELETE);
  this.indexer.deleteDocument(iDoc);
  this.indexer.commit(false);
  s=new IndexSearcher(this.dir);
  h=s.search(new TermQuery(delTerm));
  assertEquals(0,h.length());
  s.close();
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.INSERT);
  this.indexer.addDocument(iDoc);
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.UPDATE);
  this.indexer.updateDocument(iDoc);
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.DELETE);
  this.indexer.deleteDocument(iDoc);
  this.indexer.commit(false);
  s=new IndexSearcher(this.dir);
  h=s.search(new TermQuery(delTerm));
  assertEquals(0,h.length());
  s.close();
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.UPDATE);
  try {
    this.indexer.deleteDocument(iDoc);
    fail("document has not delete action ");
  }
 catch (  GdataIndexerException e) {
  }
}
