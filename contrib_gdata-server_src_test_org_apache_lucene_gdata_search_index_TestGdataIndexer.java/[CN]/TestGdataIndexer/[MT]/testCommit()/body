{
  String id="myID";
  Field f=new Field(FIELD_ID,id,Field.Store.YES,Field.Index.UN_TOKENIZED);
  Document doc=new Document();
  doc.add(f);
  Term delTerm=new Term(FIELD_ID,id);
  IndexDocument iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.INSERT);
  this.indexer.addDocument(iDoc);
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.UPDATE);
  this.indexer.updateDocument(iDoc);
  this.indexer.updateDocument(iDoc);
  iDoc=new IndexDocumentStub(doc,delTerm,IndexAction.DELETE);
  this.indexer.deleteDocument(iDoc);
  IndexEventListenerStub evListener=new IndexEventListenerStub();
  this.indexer.registerIndexEventListener(evListener);
  assertEquals(1,this.indexer.docsAdded.get());
  assertEquals(1,this.indexer.docsDeleted.get());
  assertEquals(2,this.indexer.docsUpdated.get());
  assertEquals(0,evListener.getCalledCount());
  this.indexer.commit(true);
  this.indexer.commit(false);
  assertEquals(1,evListener.getCalledCount());
  assertEquals(0,this.indexer.docsAdded.get());
  assertEquals(0,this.indexer.docsDeleted.get());
  assertEquals(0,this.indexer.docsUpdated.get());
  IndexSearcher s=new IndexSearcher(this.dir);
  Hits h=s.search(new TermQuery(delTerm));
  assertEquals(0,h.length());
  s.close();
}
