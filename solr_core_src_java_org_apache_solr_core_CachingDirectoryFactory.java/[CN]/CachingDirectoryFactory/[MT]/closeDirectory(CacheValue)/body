{
  List<CloseListener> listeners=closeListeners.remove(cacheValue.directory);
  if (listeners != null) {
    for (    CloseListener listener : listeners) {
      try {
        listener.preClose();
      }
 catch (      Throwable t) {
        SolrException.log(log,"Error executing preClose for directory",t);
      }
    }
  }
  cacheValue.closeDirectoryCalled=true;
  if (cacheValue.deleteOnClose) {
    Collection<CacheValue> values=byPathCache.values();
    Collection<CacheValue> cacheValues=new ArrayList<CacheValue>();
    cacheValues.addAll(values);
    cacheValues.remove(cacheValue);
    for (    CacheValue otherCacheValue : cacheValues) {
      if (otherCacheValue.path.startsWith(cacheValue.path) && !otherCacheValue.closeDirectoryCalled) {
        otherCacheValue.removeEntries.addAll(cacheValue.removeEntries);
        otherCacheValue.closeEntries.addAll(cacheValue.closeEntries);
        cacheValue.closeEntries.clear();
        break;
      }
    }
  }
  for (  CacheValue val : cacheValue.removeEntries) {
    try {
      log.info("Removing directory: " + val.path);
      removeDirectory(val);
    }
 catch (    Throwable t) {
      SolrException.log(log,"Error removing directory",t);
    }
  }
  for (  CacheValue val : cacheValue.closeEntries) {
    try {
      log.info("Closing directory: " + val.path);
      val.directory.close();
    }
 catch (    Throwable t) {
      SolrException.log(log,"Error closing directory",t);
    }
  }
  if (listeners != null) {
    for (    CloseListener listener : listeners) {
      try {
        listener.postClose();
      }
 catch (      Throwable t) {
        SolrException.log(log,"Error executing postClose for directory",t);
      }
    }
  }
}
