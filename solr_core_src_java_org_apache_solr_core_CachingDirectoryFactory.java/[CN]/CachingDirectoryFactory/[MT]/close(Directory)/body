{
synchronized (this) {
    CacheValue cacheValue=byDirectoryCache.get(directory);
    if (cacheValue == null) {
      throw new IllegalArgumentException("Unknown directory: " + directory + " "+ byDirectoryCache);
    }
    log.debug("Releasing directory: " + cacheValue.path);
    cacheValue.refCnt--;
    if (cacheValue.refCnt == 0 && cacheValue.doneWithDir) {
      closeDirectory(cacheValue);
      byDirectoryCache.remove(directory);
      if (!cacheValue.latestForPath) {
        byPathCache.remove(cacheValue.path);
        cacheValue.latestForPath=true;
      }
    }
  }
}
