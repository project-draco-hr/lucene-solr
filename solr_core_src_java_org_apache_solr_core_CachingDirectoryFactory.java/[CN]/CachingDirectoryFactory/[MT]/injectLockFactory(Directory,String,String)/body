{
  if (null == rawLockType) {
    log.warn("No lockType configured for " + dir + " assuming 'simple'");
    rawLockType="simple";
  }
  final String lockType=rawLockType.toLowerCase(Locale.ENGLISH).trim();
  if ("simple".equals(lockType)) {
    dir.setLockFactory(new SimpleFSLockFactory(lockPath));
  }
 else   if ("native".equals(lockType)) {
    dir.setLockFactory(new NativeFSLockFactory(lockPath));
  }
 else   if ("single".equals(lockType)) {
    if (!(dir.getLockFactory() instanceof SingleInstanceLockFactory))     dir.setLockFactory(new SingleInstanceLockFactory());
  }
 else   if ("none".equals(lockType)) {
    log.error("CONFIGURATION WARNING: locks are disabled on " + dir);
    dir.setLockFactory(NoLockFactory.getNoLockFactory());
  }
 else {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unrecognized lockType: " + rawLockType);
  }
  return dir;
}
