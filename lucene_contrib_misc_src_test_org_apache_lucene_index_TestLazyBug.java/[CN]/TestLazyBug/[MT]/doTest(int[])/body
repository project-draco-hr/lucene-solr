{
  IndexReader reader=IndexReader.open(directory,true);
  for (int i=0; i < docs.length; i++) {
    final FieldSelectorVisitor visitor=new FieldSelectorVisitor(SELECTOR);
    reader.document(docs[i],visitor);
    Document d=visitor.getDocument();
    d.get(MAGIC_FIELD);
    List<IndexableField> fields=d.getFields();
    for (Iterator<IndexableField> fi=fields.iterator(); fi.hasNext(); ) {
      IndexableField f=null;
      try {
        f=fi.next();
        String fname=f.name();
        String fval=f.stringValue();
        assertNotNull(docs[i] + " FIELD: " + fname,fval);
        String[] vals=fval.split("#");
        if (!dataset.contains(vals[0]) || !dataset.contains(vals[1])) {
          fail("FIELD:" + fname + ",VAL:"+ fval);
        }
      }
 catch (      Exception e) {
        throw new Exception(docs[i] + " WTF: " + f.name(),e);
      }
    }
  }
  reader.close();
}
