{
  if (rb.isDebug() && rb.stage == ResponseBuilder.STAGE_GET_FIELDS) {
    NamedList info=null;
    NamedList explain=new SimpleOrderedMap();
    Object[] arr=new Object[rb.resultIds.size() * 2];
    for (    ShardRequest sreq : rb.finished) {
      if ((sreq.purpose & ShardRequest.PURPOSE_GET_DEBUG) == 0)       continue;
      for (      ShardResponse srsp : sreq.responses) {
        NamedList sdebug=(NamedList)srsp.rsp.getResponse().get("debug");
        info=(NamedList)merge(sdebug,info,excludeSet);
        NamedList sexplain=(NamedList)sdebug.get("explain");
        for (int i=0; i < sexplain.size(); i++) {
          String id=sexplain.getName(i);
          ShardDoc sdoc=rb.resultIds.get(id);
          int idx=sdoc.positionInResponse;
          arr[idx << 1]=id;
          arr[(idx << 1) + 1]=sexplain.getVal(i);
        }
      }
    }
    explain=HighlightComponent.removeNulls(new NamedList(Arrays.asList(arr)));
    int idx=info.indexOf("explain",0);
    if (idx >= 0) {
      info.setVal(idx,explain);
    }
 else {
      info.add("explain",explain);
    }
    rb.setDebugInfo(info);
    rb.rsp.add("debug",rb.getDebugInfo());
  }
}
