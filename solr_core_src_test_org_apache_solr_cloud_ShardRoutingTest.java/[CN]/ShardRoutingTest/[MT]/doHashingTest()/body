{
  assertEquals(4,cloudClient.getZkStateReader().getClusterState().getCollection(DEFAULT_COLLECTION).getSlices().size());
  String shardKeys=ShardParams.SHARD_KEYS;
  String bucket1="shard1";
  String bucket2="shard2";
  String bucket3="shard3";
  String bucket4="shard4";
  doAddDoc("b!doc1");
  doAddDoc("c!doc2");
  doAddDoc("d!doc3");
  doAddDoc("e!doc4");
  doRTG("b!doc1");
  doRTG("c!doc2");
  doRTG("d!doc3");
  doRTG("e!doc4");
  doRTG("b!doc1,c!doc2");
  doRTG("d!doc3,e!doc4");
  commit();
  doQuery("b!doc1,c!doc2,d!doc3,e!doc4","q","*:*");
  doQuery("b!doc1,c!doc2,d!doc3,e!doc4","q","*:*","shards","shard1,shard2,shard3,shard4");
  doQuery("b!doc1,c!doc2,d!doc3,e!doc4","q","*:*",shardKeys,"b!,c!,d!,e!");
  doQuery("b!doc1","q","*:*",shardKeys,"b!");
  doQuery("b!doc1","q","*:*","shards",bucket1);
  doQuery("c!doc2","q","*:*",shardKeys,"c!");
  doQuery("d!doc3","q","*:*",shardKeys,"d!");
  doQuery("e!doc4","q","*:*",shardKeys,"e!");
  doQuery("b!doc1,c!doc2","q","*:*",shardKeys,"b!,c!");
  doQuery("b!doc1,e!doc4","q","*:*",shardKeys,"b!,e!");
  doQuery("b!doc1,c!doc2","q","*:*",shardKeys,"b,c");
  doQuery("b!doc1,c!doc2","q","*:*",shardKeys,"b/1!");
  doQuery("d!doc3,e!doc4","q","*:*",shardKeys,"d/1!");
  doQuery("b!doc1,c!doc2","q","*:*",shardKeys,"b!,c!");
  doQuery("b!doc1,c!doc2,d!doc3,e!doc4","q","*:*",shardKeys,"foo/0!");
  doDBQ("*:*",shardKeys,"b!");
  commit();
  doQuery("c!doc2,d!doc3,e!doc4","q","*:*");
  doAddDoc("b!doc1");
  doDBQ("*:*",shardKeys,"c!");
  commit();
  doQuery("b!doc1,d!doc3,e!doc4","q","*:*");
  doAddDoc("c!doc2");
  doDBQ("*:*",shardKeys,"c!");
  commit();
  doQuery("b!doc1,d!doc3,e!doc4","q","*:*");
  doAddDoc("c!doc2");
  doDBQ("*:*",shardKeys,"d!,e!");
  commit();
  doQuery("b!doc1,c!doc2","q","*:*");
  doAddDoc("d!doc3");
  doAddDoc("e!doc4");
}
