{
  Expression distance=JavascriptCompiler.compile("haversin(40.7143528,-74.0059731,latitude,longitude)");
  SimpleBindings bindings=new SimpleBindings();
  bindings.add(new SortField("latitude",SortField.Type.DOUBLE));
  bindings.add(new SortField("longitude",SortField.Type.DOUBLE));
  Sort sort=new Sort(distance.getSortField(bindings,false));
  TopFieldDocs td=searcher.search(new MatchAllDocsQuery(),null,3,sort);
  FieldDoc d=(FieldDoc)td.scoreDocs[0];
  assertEquals(0.4619D,(Double)d.fields[0],1E-4);
  d=(FieldDoc)td.scoreDocs[1];
  assertEquals(1.0546D,(Double)d.fields[0],1E-4);
  d=(FieldDoc)td.scoreDocs[2];
  assertEquals(5.2842D,(Double)d.fields[0],1E-4);
}
