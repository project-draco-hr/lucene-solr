{
  SqlParser parser=new SqlParser();
  Statement statement=parser.createStatement(sql);
  SQLVisitor sqlVistor=new SQLVisitor(new StringBuilder());
  sqlVistor.process(statement,new Integer(0));
  TupleStream sqlStream=null;
  if (sqlVistor.groupByQuery) {
    if (aggregationMode == AggregationMode.FACET) {
      sqlStream=doGroupByWithAggregatesFacets(sqlVistor);
    }
 else {
      sqlStream=doGroupByWithAggregates(sqlVistor,numWorkers,workerCollection,workerZkhost);
    }
  }
 else   if (sqlVistor.isDistinct) {
    if (aggregationMode == AggregationMode.FACET) {
      sqlStream=doSelectDistinctFacets(sqlVistor);
    }
 else {
      sqlStream=doSelectDistinct(sqlVistor,numWorkers,workerCollection,workerZkhost);
    }
  }
 else {
    sqlStream=doSelect(sqlVistor);
  }
  return sqlStream;
}
