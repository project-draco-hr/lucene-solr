{
  CoreContainer cc=init(SOLR_XML_LOTS_SYSVARS,"SystemVars1","SystemVars2");
  SolrXMLCoresLocator.NonPersistingLocator locator=(SolrXMLCoresLocator.NonPersistingLocator)cc.getCoresLocator();
  int coreCount=countOccurrences(locator.xml,"<core ");
  try {
    final CoreAdminHandler admin=new CoreAdminHandler(cc);
    SolrQueryResponse resp=new SolrQueryResponse();
    admin.handleRequestBody(req(CoreAdminParams.ACTION,CoreAdminParams.CoreAdminAction.SWAP.toString(),CoreAdminParams.CORE,from,CoreAdminParams.OTHER,to),resp);
    assertNull("Exception on swap",resp.getException());
    assertThat("Swapping cores should leave the same number of cores as before",countOccurrences(locator.xml,"<core "),is(coreCount));
    String[] persistList=getAllNodes();
    String[] expressions=new String[persistList.length];
    for (int idx=0; idx < persistList.length; ++idx) {
      String fromName="@name='" + from + "'";
      String toName="@name='" + to + "'";
      if (persistList[idx].contains(fromName)) {
        expressions[idx]=persistList[idx].replace(fromName,toName);
      }
 else {
        expressions[idx]=persistList[idx].replace(toName,fromName);
      }
    }
    TestHarness.validateXPath(SOLR_XML_LOTS_SYSVARS,expressions);
  }
  finally {
    cc.shutdown();
    if (solrHomeDirectory.exists()) {
      FileUtils.deleteDirectory(solrHomeDirectory);
    }
  }
}
