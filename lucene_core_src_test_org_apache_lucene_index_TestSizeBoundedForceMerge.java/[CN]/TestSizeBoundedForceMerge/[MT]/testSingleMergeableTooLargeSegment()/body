{
  Directory dir=new RAMDirectory();
  IndexWriterConfig conf=newWriterConfig();
  IndexWriter writer=new IndexWriter(dir,conf);
  addDocs(writer,5,true);
  writer.deleteDocuments(new Term("id","4"));
  writer.shutdown();
  conf=newWriterConfig();
  LogMergePolicy lmp=new LogDocMergePolicy();
  lmp.setMaxMergeDocs(2);
  conf.setMergePolicy(lmp);
  writer=new IndexWriter(dir,conf);
  writer.forceMerge(1);
  writer.shutdown();
  SegmentInfos sis=new SegmentInfos();
  sis.read(dir);
  assertEquals(1,sis.size());
  assertTrue(sis.info(0).hasDeletions());
}
