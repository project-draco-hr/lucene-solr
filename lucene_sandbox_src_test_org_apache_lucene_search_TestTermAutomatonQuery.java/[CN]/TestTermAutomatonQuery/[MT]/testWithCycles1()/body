{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  doc.add(newTextField("field","here comes here comes",Field.Store.NO));
  w.addDocument(doc);
  doc=new Document();
  doc.add(newTextField("field","comes here",Field.Store.NO));
  w.addDocument(doc);
  IndexReader r=w.getReader();
  IndexSearcher s=newSearcher(r);
  TermAutomatonQuery q=new TermAutomatonQuery("field");
  int init=q.createState();
  int s1=q.createState();
  q.addTransition(init,s1,"here");
  q.addTransition(s1,init,"comes");
  q.setAccept(init,true);
  q.finish();
  assertEquals(1,s.search(q,1).totalHits);
  w.close();
  r.close();
  dir.close();
}
