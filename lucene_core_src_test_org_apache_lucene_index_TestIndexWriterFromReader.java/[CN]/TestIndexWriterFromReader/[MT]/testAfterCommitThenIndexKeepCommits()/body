{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig();
  iwc.setIndexDeletionPolicy(new IndexDeletionPolicy(){
    @Override public void onInit(    List<? extends IndexCommit> commits){
    }
    @Override public void onCommit(    List<? extends IndexCommit> commits){
    }
  }
);
  IndexWriter w=new IndexWriter(dir,iwc);
  w.addDocument(new Document());
  w.commit();
  w.addDocument(new Document());
  DirectoryReader r=DirectoryReader.open(w);
  assertEquals(2,r.maxDoc());
  w.addDocument(new Document());
  DirectoryReader r2=DirectoryReader.open(w);
  assertEquals(3,r2.maxDoc());
  IOUtils.close(r2,w);
  iwc=newIndexWriterConfig();
  iwc.setIndexCommit(r.getIndexCommit());
  IndexWriter w2=new IndexWriter(dir,iwc);
  assertEquals(2,w2.maxDoc());
  IOUtils.close(r,w2,dir);
}
