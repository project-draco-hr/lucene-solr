{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig());
  w.addDocument(new Document());
  w.commit();
  DirectoryReader r=DirectoryReader.open(w,true);
  assertEquals(1,r.maxDoc());
  IndexCommit commit=r.getIndexCommit();
  r.close();
  w.close();
  IndexWriterConfig iwc=newIndexWriterConfig();
  iwc.setIndexCommit(commit);
  try {
    new IndexWriter(dir,iwc);
    fail("did not hit exception");
  }
 catch (  AlreadyClosedException ace) {
  }
  IOUtils.close(r,dir);
}
