{
  if (core == null && idx > 0) {
    coreUrl=getRemotCoreUrl(corename,origCorename);
    invalidStates=checkStateIsValid(queryParams.get(CloudSolrClient.STATE_VERSION));
    if (coreUrl != null && queryParams.get(DistributingUpdateProcessorFactory.DISTRIB_UPDATE_PARAM) == null) {
      path=path.substring(idx);
      if (invalidStates != null) {
        throw new SolrException(SolrException.ErrorCode.INVALID_STATE,new String(ZkStateReader.toJSON(invalidStates),org.apache.lucene.util.IOUtils.UTF_8));
      }
      action=REMOTEQUERY;
    }
 else {
      if (!retry) {
        ZkStateReader reader=cores.getZkController().getZkStateReader();
        reader.updateAliases();
        action=RETRY;
      }
    }
  }
}
