{
  if (pendingCommit != null) {
    try {
      message("commit: pendingCommit != null");
      pendingCommit.finishCommit(directory);
      message("commit: wrote segments file \"" + pendingCommit.getCurrentSegmentFileName() + "\"");
      lastCommitChangeCount=pendingCommitChangeCount;
      segmentInfos.updateGeneration(pendingCommit);
      setRollbackSegmentInfos(pendingCommit);
      deleter.checkpoint(pendingCommit,true);
    }
  finally {
      deleter.decRef(pendingCommit);
      pendingCommit=null;
      notifyAll();
    }
  }
 else   message("commit: pendingCommit == null; skip");
  message("commit: done");
}
