{
  ensureOpen();
  boolean doFlush=false;
  boolean success=false;
  try {
    doFlush=docWriter.addDocument(doc,analyzer);
    success=true;
  }
  finally {
    if (!success) {
      if (infoStream != null)       message("hit exception adding document");
synchronized (this) {
        final List files=docWriter.abortedFiles();
        if (files != null)         deleter.deleteNewFiles(files);
      }
    }
  }
  if (doFlush)   flush(true,false);
}
