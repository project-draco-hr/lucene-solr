{
  String mergedName=newSegmentName();
  int mergedDocCount=0;
  if (infoStream != null)   infoStream.print("merging segments");
  SegmentMerger merger=new SegmentMerger(directory,mergedName);
  Vector segmentsToDelete=new Vector();
  for (int i=minSegment; i < segmentInfos.size(); i++) {
    SegmentInfo si=segmentInfos.info(i);
    if (infoStream != null)     infoStream.print(" " + si.name + " ("+ si.docCount+ " docs)");
    SegmentReader reader=new SegmentReader(si);
    merger.add(reader);
    if (delete)     segmentsToDelete.addElement(reader);
    mergedDocCount+=si.docCount;
  }
  if (infoStream != null) {
    infoStream.println();
    infoStream.println(" into " + mergedName + " ("+ mergedDocCount+ " docs)");
  }
  merger.merge();
  segmentInfos.setSize(minSegment);
  segmentInfos.addElement(new SegmentInfo(mergedName,mergedDocCount,directory));
synchronized (directory) {
    segmentInfos.write(directory);
    deleteSegments(segmentsToDelete);
  }
}
