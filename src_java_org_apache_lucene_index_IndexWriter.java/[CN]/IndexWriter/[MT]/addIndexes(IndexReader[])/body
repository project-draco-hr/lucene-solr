{
  optimize();
  String mergedName=newSegmentName();
  SegmentMerger merger=new SegmentMerger(directory,mergedName,false);
  if (segmentInfos.size() == 1)   merger.add(new SegmentReader(segmentInfos.info(0)));
  for (int i=0; i < readers.length; i++)   merger.add(readers[i]);
  int docCount=merger.merge();
  segmentInfos.setSize(0);
  segmentInfos.addElement(new SegmentInfo(mergedName,docCount,directory));
synchronized (directory) {
    new Lock.With(directory.makeLock("commit.lock")){
      public Object doBody() throws IOException {
        segmentInfos.write(directory);
        return null;
      }
    }
.run();
  }
}
