{
  long lowerBound=0;
  long upperBound=minMergeDocs;
  while (upperBound * mergeFactor <= maxMergeDocs) {
    int minSegment=segmentInfos.size();
    int maxSegment=-1;
    while (--minSegment >= 0) {
      SegmentInfo si=segmentInfos.info(minSegment);
      if (maxSegment == -1 && si.docCount > lowerBound && si.docCount <= upperBound) {
        maxSegment=minSegment;
      }
 else       if (si.docCount > upperBound) {
        break;
      }
    }
    minSegment++;
    maxSegment++;
    int numSegments=maxSegment - minSegment;
    if (numSegments < mergeFactor) {
      break;
    }
 else {
      boolean exceedsUpperLimit=false;
      while (numSegments >= mergeFactor) {
        int docCount=mergeSegments(segmentInfos,minSegment,minSegment + mergeFactor);
        numSegments-=mergeFactor;
        if (docCount > upperBound) {
          minSegment++;
          exceedsUpperLimit=true;
        }
 else         if (docCount > 0) {
          numSegments++;
        }
      }
      if (!exceedsUpperLimit) {
        break;
      }
    }
    lowerBound=upperBound;
    upperBound*=mergeFactor;
  }
}
