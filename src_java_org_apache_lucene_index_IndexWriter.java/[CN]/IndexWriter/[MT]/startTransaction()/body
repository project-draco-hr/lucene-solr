{
  if (inTransaction) {
    throw new IOException("transaction is already in process");
  }
  rollbackSegmentInfos=(SegmentInfos)segmentInfos.clone();
  protectedSegments=new HashSet();
  for (int i=0; i < segmentInfos.size(); i++) {
    SegmentInfo si=(SegmentInfo)segmentInfos.elementAt(i);
    protectedSegments.add(si.name);
  }
  inTransaction=true;
}
