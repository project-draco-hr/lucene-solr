{
  flushRamSegments();
  while (segmentInfos.size() > 1 || (segmentInfos.size() == 1 && SegmentReader.hasDeletions(segmentInfos.info(0)))) {
    int minSegment=segmentInfos.size() - mergeFactor;
    mergeSegments(minSegment < 0 ? 0 : minSegment);
  }
}
