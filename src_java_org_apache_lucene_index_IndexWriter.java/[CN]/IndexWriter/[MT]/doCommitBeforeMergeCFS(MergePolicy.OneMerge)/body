{
  long freeableBytes=0;
  final int size=merge.segments.size();
  for (int i=0; i < size; i++) {
    final SegmentInfo info=merge.segments.info(i);
    Integer loc=(Integer)rollbackSegments.get(info);
    if (loc != null) {
      final SegmentInfo oldInfo=rollbackSegmentInfos.info(loc.intValue());
      if (oldInfo.getUseCompoundFile() != info.getUseCompoundFile())       freeableBytes+=info.sizeInBytes();
    }
  }
  long totalBytes=0;
  final int numSegments=segmentInfos.size();
  for (int i=0; i < numSegments; i++)   totalBytes+=segmentInfos.info(i).sizeInBytes();
  if (3 * freeableBytes > totalBytes)   return true;
 else   return false;
}
