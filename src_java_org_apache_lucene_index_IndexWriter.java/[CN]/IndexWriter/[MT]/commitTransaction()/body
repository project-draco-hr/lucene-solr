{
  if (commitPending) {
    boolean success=false;
    try {
      segmentInfos.write(directory);
      success=true;
    }
  finally {
      if (!success) {
        rollbackTransaction();
      }
    }
    deleter.commitPendingFiles();
    commitPending=false;
  }
  clearTransaction();
}
