{
  if (bufferedDeleteTerms.size() > 0) {
    if (infoStream != null)     infoStream.println("flush " + numBufferedDeleteTerms + " buffered deleted terms on "+ segmentInfos.size()+ " segments.");
    if (flushedNewSegment) {
      IndexReader reader=null;
      try {
        reader=SegmentReader.get(segmentInfos.info(segmentInfos.size() - 1),false);
        applyDeletesSelectively(bufferedDeleteTerms,reader);
      }
  finally {
        if (reader != null) {
          try {
            reader.doCommit();
          }
  finally {
            reader.doClose();
          }
        }
      }
    }
    int infosEnd=segmentInfos.size();
    if (flushedNewSegment) {
      infosEnd--;
    }
    for (int i=0; i < infosEnd; i++) {
      IndexReader reader=null;
      try {
        reader=SegmentReader.get(segmentInfos.info(i),false);
        applyDeletes(bufferedDeleteTerms,reader);
      }
  finally {
        if (reader != null) {
          try {
            reader.doCommit();
          }
  finally {
            reader.doClose();
          }
        }
      }
    }
    bufferedDeleteTerms.clear();
    numBufferedDeleteTerms=0;
  }
}
