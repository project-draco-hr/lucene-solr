{
  flushRamSegments();
  if (commitPending) {
    segmentInfos.write(directory);
    deleter.checkpoint(segmentInfos,true);
    commitPending=false;
    rollbackSegmentInfos=null;
  }
  ramDirectory.close();
  if (writeLock != null) {
    writeLock.release();
    writeLock=null;
  }
  if (closeDir)   directory.close();
}
