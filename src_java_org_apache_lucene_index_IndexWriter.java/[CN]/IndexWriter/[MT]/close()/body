{
  if (!closed) {
    flush(true,true);
    if (commitPending) {
      segmentInfos.write(directory);
      if (infoStream != null)       infoStream.println("close: wrote segments file \"" + segmentInfos.getCurrentSegmentFileName() + "\"");
      deleter.checkpoint(segmentInfos,true);
      commitPending=false;
      rollbackSegmentInfos=null;
    }
    if (writeLock != null) {
      writeLock.release();
      writeLock=null;
    }
    closed=true;
    docWriter=null;
    if (closeDir)     directory.close();
  }
}
