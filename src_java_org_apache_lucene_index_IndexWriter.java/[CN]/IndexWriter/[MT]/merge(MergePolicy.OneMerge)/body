{
  boolean success=false;
  try {
    try {
      try {
        mergeInit(merge);
        if (infoStream != null)         message("now merge\n  merge=" + merge.segString(directory) + "\n  merge="+ merge+ "\n  index="+ segString());
        mergeMiddle(merge);
        success=true;
      }
 catch (      MergePolicy.MergeAbortedException e) {
        merge.setException(e);
        addMergeException(merge);
        if (merge.isExternal)         throw e;
      }
    }
  finally {
synchronized (this) {
        try {
          mergeFinish(merge);
          if (!success) {
            if (infoStream != null)             message("hit exception during merge");
            addMergeException(merge);
            if (merge.info != null && !segmentInfos.contains(merge.info))             deleter.refresh(merge.info.name);
          }
          if (success && !merge.isAborted() && !closed&& !closing)           updatePendingMerges(merge.maxNumSegmentsOptimize,merge.optimize);
        }
  finally {
          runningMerges.remove(merge);
        }
      }
    }
  }
 catch (  OutOfMemoryError oom) {
    hitOOM=true;
    throw oom;
  }
}
