{
  ensureOpen();
  try {
    if (infoStream != null)     message("flush at addIndexesNoOptimize");
    flush(true,false,true);
    boolean success=false;
    startTransaction();
    try {
      int docCount=0;
      for (int i=0; i < dirs.length; i++) {
        if (directory == dirs[i]) {
          throw new IllegalArgumentException("Cannot add this index to itself");
        }
        SegmentInfos sis=new SegmentInfos();
        sis.read(dirs[i]);
        for (int j=0; j < sis.size(); j++) {
          SegmentInfo info=sis.info(j);
          docCount+=info.docCount;
          segmentInfos.addElement(info);
        }
      }
      docWriter.updateFlushedDocCount(docCount);
      maybeMerge();
      copyExternalSegments();
      success=true;
    }
  finally {
      if (success) {
        commitTransaction();
      }
 else {
        rollbackTransaction();
      }
    }
  }
 catch (  OutOfMemoryError oom) {
    hitOOM=true;
    throw oom;
  }
}
