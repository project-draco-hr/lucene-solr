{
  final int numSegments=segmentInfos.size();
  for (int i=0; i < numSegments; i++) {
    SegmentInfo info=segmentInfos.info(i);
    if (info.dir != directory) {
      MergePolicy.OneMerge merge=new MergePolicy.OneMerge(segmentInfos.range(i,1 + i),info.getUseCompoundFile());
      if (registerMerge(merge)) {
        pendingMerges.remove(merge);
        runningMerges.add(merge);
        merge(merge);
      }
 else       throw new MergePolicy.MergeException("segment \"" + info.name + " exists in external directory yet the MergeScheduler executed the merge in a separate thread",directory);
    }
  }
}
