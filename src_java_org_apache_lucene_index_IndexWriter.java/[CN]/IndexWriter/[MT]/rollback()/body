{
  ensureOpen();
  if (autoCommit)   throw new IllegalStateException("abort() can only be called when IndexWriter was opened with autoCommit=false");
  boolean doClose;
synchronized (this) {
    if (pendingCommit != null) {
      pendingCommit.rollbackCommit(directory);
      deleter.decRef(pendingCommit);
      pendingCommit=null;
      notifyAll();
    }
    if (!closing) {
      doClose=true;
      closing=true;
    }
 else     doClose=false;
  }
  if (doClose) {
    finishMerges(false);
    mergePolicy.close();
    mergeScheduler.close();
synchronized (this) {
      segmentInfos.clear();
      segmentInfos.addAll(rollbackSegmentInfos);
      docWriter.abort(null);
      deleter.checkpoint(segmentInfos,false);
      deleter.refresh();
    }
    lastCommitChangeCount=changeCount;
    closeInternal(false);
  }
 else   waitForClose();
}
