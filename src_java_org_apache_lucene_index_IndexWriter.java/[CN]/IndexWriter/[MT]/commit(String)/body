{
  ensureOpen();
  waitForCommit();
  try {
    if (infoStream != null)     message("commit: start");
    if (autoCommit || pendingCommit == null) {
      if (infoStream != null)       message("commit: now prepare");
      prepareCommit(commitUserData,true);
    }
 else     if (infoStream != null)     message("commit: already prepared");
    finishCommit();
  }
  finally {
    doneCommit();
  }
}
