{
  this.closeDir=closeDir;
  directory=d;
  analyzer=a;
  this.infoStream=defaultInfoStream;
  if (create) {
    directory.clearLock(IndexWriter.WRITE_LOCK_NAME);
  }
  Lock writeLock=directory.makeLock(IndexWriter.WRITE_LOCK_NAME);
  if (!writeLock.obtain(writeLockTimeout))   throw new LockObtainFailedException("Index locked for write: " + writeLock);
  this.writeLock=writeLock;
  try {
    if (create) {
      try {
        segmentInfos.read(directory);
        segmentInfos.clear();
      }
 catch (      IOException e) {
      }
      segmentInfos.write(directory);
    }
 else {
      segmentInfos.read(directory);
    }
    this.autoCommit=autoCommit;
    if (!autoCommit) {
      rollbackSegmentInfos=(SegmentInfos)segmentInfos.clone();
    }
    deleter=new IndexFileDeleter(directory,deletionPolicy == null ? new KeepOnlyLastCommitDeletionPolicy() : deletionPolicy,segmentInfos,infoStream);
  }
 catch (  IOException e) {
    this.writeLock.release();
    this.writeLock=null;
    throw e;
  }
}
