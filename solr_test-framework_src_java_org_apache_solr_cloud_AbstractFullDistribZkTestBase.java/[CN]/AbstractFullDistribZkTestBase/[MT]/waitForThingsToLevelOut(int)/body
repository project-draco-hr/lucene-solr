{
  log.info("Wait for recoveries to finish - wait " + waitForRecTimeSeconds + " for each attempt");
  int cnt=0;
  boolean retry=false;
  do {
    waitForRecoveriesToFinish(VERBOSE,waitForRecTimeSeconds);
    try {
      commit();
    }
 catch (    Throwable t) {
      t.printStackTrace();
    }
    updateMappingsFromZk(jettys,clients);
    Set<String> theShards=shardToJetty.keySet();
    String failMessage=null;
    for (    String shard : theShards) {
      failMessage=checkShardConsistency(shard,true,false);
    }
    if (failMessage != null) {
      log.info("shard inconsistency - waiting ...");
      retry=true;
    }
 else {
      retry=false;
    }
    cnt++;
    if (cnt > 30)     break;
    Thread.sleep(2000);
  }
 while (retry);
}
