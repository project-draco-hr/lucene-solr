{
  int cnt=30;
  while (!reader.getClusterState().hasCollection(collection)) {
    if (cnt == 0) {
      throw new RuntimeException("timeout waiting for collection in cluster state: collection=" + collection);
    }
    cnt--;
    Thread.sleep(500);
  }
  cnt=30;
  while (reader.getClusterState().getSlices(collection).size() < slices) {
    if (cnt == 0) {
      throw new RuntimeException("timeout waiting for collection shards to come up: collection=" + collection + ", slices.expected="+ slices+ " slices.actual= "+ reader.getClusterState().getSlices(collection).size()+ " slices : "+ reader.getClusterState().getSlices(collection));
    }
    cnt--;
    Thread.sleep(500);
  }
}
