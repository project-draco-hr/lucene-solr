{
  collection=DEFAULT_COLLECTION;
  int totalReplicas=getTotalReplicas(collection);
  int cnt=this.jettyIntCntr.incrementAndGet();
  File jettyDir=new File(TEMP_DIR,getClass().getName() + "-jetty" + cnt+ "-"+ System.currentTimeMillis());
  jettyDir.mkdirs();
  org.apache.commons.io.FileUtils.copyDirectory(new File(getSolrHome()),jettyDir);
  JettySolrRunner j=createJetty(jettyDir,testDir + "/jetty" + cnt,shard,"solrconfig.xml",null);
  jettys.add(j);
  SolrServer client=createNewSolrServer(j.getLocalPort());
  clients.add(client);
  int retries=60;
  while (--retries >= 0) {
    if (getTotalReplicas(collection) != totalReplicas) {
      break;
    }
    Thread.sleep(500);
  }
  if (retries <= 0) {
    fail("Timeout waiting for " + j + " to appear in clusterstate");
    printLayout();
  }
  updateMappingsFromZk(this.jettys,this.clients);
  return client;
}
