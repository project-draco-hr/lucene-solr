{
  System.setProperty("collection","control_collection");
  String numShards=System.getProperty(ZkStateReader.NUM_SHARDS_PROP);
  System.setProperty(ZkStateReader.NUM_SHARDS_PROP,"1");
  File controlJettyDir=createTempDir();
  setupJettySolrHome(controlJettyDir);
  controlJetty=createJetty(controlJettyDir,testDir + "/control/data");
  System.clearProperty("collection");
  if (numShards != null) {
    System.setProperty(ZkStateReader.NUM_SHARDS_PROP,numShards);
  }
 else {
    System.clearProperty(ZkStateReader.NUM_SHARDS_PROP);
  }
  controlClient=createNewSolrServer(controlJetty.getLocalPort());
  if (sliceCount <= 0) {
    controlClientCloud=createCloudClient("control_collection");
    controlClientCloud.connect();
    waitForCollection(controlClientCloud.getZkStateReader(),"control_collection",0);
    cloudClient=controlClientCloud;
    return;
  }
  initCloud();
  createJettys(numServers,checkCreatedVsState).size();
  int cnt=getTotalReplicas(DEFAULT_COLLECTION);
  if (cnt > 0) {
    waitForCollection(cloudClient.getZkStateReader(),DEFAULT_COLLECTION,sliceCount);
  }
}
