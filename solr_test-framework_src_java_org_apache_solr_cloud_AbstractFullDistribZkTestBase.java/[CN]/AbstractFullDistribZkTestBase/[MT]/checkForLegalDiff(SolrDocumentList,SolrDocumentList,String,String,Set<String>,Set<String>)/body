{
  boolean legal=true;
  Set<SolrDocument> setA=new HashSet<SolrDocument>();
  for (  SolrDocument sdoc : a) {
    setA.add(sdoc);
  }
  Set<SolrDocument> setB=new HashSet<SolrDocument>();
  for (  SolrDocument sdoc : b) {
    setB.add(sdoc);
  }
  Set<SolrDocument> onlyInA=new HashSet<SolrDocument>(setA);
  onlyInA.removeAll(setB);
  Set<SolrDocument> onlyInB=new HashSet<SolrDocument>(setB);
  onlyInB.removeAll(setA);
  if (onlyInA.size() > 0) {
    for (    SolrDocument doc : onlyInA) {
      if (!addFails.contains(doc.getFirstValue("id"))) {
        legal=false;
      }
 else {
        System.err.println("###### Only in " + aName + ": "+ onlyInA+ ", but this is expected because we found an add fail for "+ doc.getFirstValue("id"));
      }
    }
  }
  if (onlyInB.size() > 0) {
    for (    SolrDocument doc : onlyInB) {
      if (!deleteFails.contains(doc.getFirstValue("id"))) {
        legal=false;
      }
 else {
        System.err.println("###### Only in " + bName + ": "+ onlyInB+ ", but this is expected because we found a delete fail for "+ doc.getFirstValue("id"));
      }
    }
  }
  return legal;
}
