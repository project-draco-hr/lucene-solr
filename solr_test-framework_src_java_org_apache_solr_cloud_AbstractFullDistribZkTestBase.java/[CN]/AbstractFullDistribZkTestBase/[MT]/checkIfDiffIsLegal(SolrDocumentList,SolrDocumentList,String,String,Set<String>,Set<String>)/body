{
  boolean legal=true;
  Set<SolrDocument> setA=new HashSet<>();
  for (  SolrDocument sdoc : a) {
    setA.add(sdoc);
  }
  Set<SolrDocument> setB=new HashSet<>();
  for (  SolrDocument sdoc : b) {
    setB.add(sdoc);
  }
  Set<SolrDocument> onlyInA=new HashSet<>(setA);
  onlyInA.removeAll(setB);
  Set<SolrDocument> onlyInB=new HashSet<>(setB);
  onlyInB.removeAll(setA);
  for (  SolrDocument doc : onlyInA) {
    if (!addFails.contains(doc.getFirstValue("id"))) {
      legal=false;
    }
 else {
      System.err.println("###### Only in " + aName + ": "+ onlyInA+ ", but this is expected because we found an add fail for "+ doc.getFirstValue("id"));
    }
  }
  for (  SolrDocument doc : onlyInB) {
    if (!deleteFails.contains(doc.getFirstValue("id"))) {
      legal=false;
    }
 else {
      System.err.println("###### Only in " + bName + ": "+ onlyInB+ ", but this is expected because we found a delete fail for "+ doc.getFirstValue("id"));
    }
  }
  return legal;
}
