{
  SolrParams params=req.getParams();
  if (isHighlightingEnabled(params)) {
    SolrIndexSearcher searcher=req.getSearcher();
    int[] docIDs=toDocIDs(docs);
    String[] keys=getUniqueKeys(searcher,docIDs);
    String[] fieldNames=getHighlightFields(query,req,defaultFields);
    int numSnippets=params.getInt(HighlightParams.SNIPPETS,1);
    int maxPassages[]=new int[fieldNames.length];
    Arrays.fill(maxPassages,numSnippets);
    Map<String,String[]> snippets=highlighter.highlightFields(fieldNames,query,searcher,docIDs,maxPassages);
    return encodeSnippets(keys,fieldNames,snippets);
  }
 else {
    return null;
  }
}
