{
  SolrParams params=req.getParams();
  if (isHighlightingEnabled(params)) {
    SolrIndexSearcher searcher=req.getSearcher();
    TopDocs topDocs=toTopDocs(docs);
    String[] keys=getUniqueKeys(searcher,topDocs);
    String[] fieldNames=getHighlightFields(query,req,defaultFields);
    int numSnippets=params.getInt(HighlightParams.SNIPPETS,1);
    Map<String,String[]> snippets=highlighter.highlightFields(fieldNames,query,searcher,topDocs,numSnippets);
    return encodeSnippets(keys,fieldNames,snippets);
  }
 else {
    return null;
  }
}
