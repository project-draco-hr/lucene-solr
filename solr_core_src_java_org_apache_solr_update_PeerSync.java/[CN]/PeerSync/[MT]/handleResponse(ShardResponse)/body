{
  ShardRequest sreq=srsp.getShardRequest();
  if (srsp.getException() != null) {
    if (sreq.purpose == 1 && srsp.getException() instanceof SolrServerException) {
      Throwable solrException=((SolrServerException)srsp.getException()).getRootCause();
      if (solrException instanceof ConnectException || solrException instanceof NoHttpResponseException) {
        log.info(msg() + " couldn't connect to " + srsp.getShardAddress()+ ", counting as success");
        return true;
      }
    }
    log.warn(msg() + " exception talking to " + srsp.getShardAddress()+ ", counting as success");
    return false;
  }
  if (sreq.purpose == 1) {
    return handleVersions(srsp);
  }
 else {
    return handleUpdates(srsp);
  }
}
