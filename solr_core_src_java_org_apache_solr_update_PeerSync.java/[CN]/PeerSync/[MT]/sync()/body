{
  if (ulog == null) {
    return false;
  }
  for (  String replica : replicas) {
    requestVersions(replica);
  }
  recentUpdates=ulog.getRecentUpdates();
  try {
    ourUpdates=recentUpdates.getVersions(nUpdates);
  }
  finally {
    recentUpdates.close();
  }
  Collections.sort(ourUpdates,absComparator);
  if (ourUpdates.size() > 0) {
    ourLowThreshold=percentile(ourUpdates,0.8f);
    ourHighThreshold=percentile(ourUpdates,0.2f);
  }
 else {
    return false;
  }
  ourUpdateSet=new HashSet<Long>(ourUpdates);
  requestedUpdateSet=new HashSet<Long>(ourUpdates);
  for (; ; ) {
    ShardResponse srsp=shardHandler.takeCompletedOrError();
    if (srsp == null)     break;
    boolean success=handleResponse(srsp);
    if (!success) {
      shardHandler.cancelAll();
      return false;
    }
  }
  return true;
}
