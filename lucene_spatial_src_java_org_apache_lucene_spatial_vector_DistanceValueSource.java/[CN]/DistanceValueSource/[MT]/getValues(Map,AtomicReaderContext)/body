{
  AtomicReader reader=readerContext.reader();
  final double[] ptX=FieldCache.DEFAULT.getDoubles(reader,strategy.getFieldNameX(),true);
  final double[] ptY=FieldCache.DEFAULT.getDoubles(reader,strategy.getFieldNameY(),true);
  final Bits validX=FieldCache.DEFAULT.getDocsWithField(reader,strategy.getFieldNameX());
  final Bits validY=FieldCache.DEFAULT.getDocsWithField(reader,strategy.getFieldNameY());
  return new FunctionValues(){
    @Override public float floatVal(    int doc){
      return (float)doubleVal(doc);
    }
    @Override public double doubleVal(    int doc){
      if (validX.get(doc) && validY.get(doc)) {
        return calculator.distance(from,ptX[doc],ptY[doc]);
      }
      return 0;
    }
    @Override public String toString(    int doc){
      return description() + "=" + floatVal(doc);
    }
  }
;
}
