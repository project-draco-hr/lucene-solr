{
  try {
    FeatureStructure fsMock=(FeatureStructure)Class.forName(typeName).getConstructor(JCas.class).newInstance(cas);
    Type type=fsMock.getType();
    for (FSIterator<FeatureStructure> iterator=cas.getFSIndexRepository().getAllIndexedFS(type); iterator.hasNext(); ) {
      FeatureStructure fs=iterator.next();
      for (      String featureName : featureFieldsmapping.keySet()) {
        String fieldName=featureFieldsmapping.get(featureName);
        log.info(new StringBuffer("mapping ").append(typeName).append("@").append(featureName).append(" to ").append(fieldName).toString());
        String featureValue=null;
        if (fs instanceof Annotation && "coveredText".equals(featureName)) {
          featureValue=((Annotation)fs).getCoveredText();
        }
 else {
          featureValue=fs.getFeatureValueAsString(type.getFeatureByBaseName(featureName));
        }
        log.info(new StringBuffer("writing ").append(featureValue).append(" in ").append(fieldName).toString());
        document.addField(fieldName,featureValue,1.0f);
      }
    }
  }
 catch (  Exception e) {
    log.error(e.getLocalizedMessage());
  }
}
