{
  int length=s.length();
  StringBuffer buffer=new StringBuffer(length * 2);
  for (int i=0; i < length; i++) {
    int j=s.charAt(i);
    if (j < 0x100 && encoder[j] != null) {
      buffer.append(encoder[j]);
      buffer.append(';');
    }
 else     if (j < 0x80) {
      buffer.append((char)j);
    }
 else {
      buffer.append("&#");
      buffer.append(j).append(';');
    }
  }
  return buffer.toString();
}
