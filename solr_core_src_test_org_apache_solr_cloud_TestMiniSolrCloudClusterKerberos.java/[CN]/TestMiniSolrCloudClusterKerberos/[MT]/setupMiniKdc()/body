{
  String kdcDir=createTempDir() + File.separator + "minikdc";
  File keytabFile=new File(kdcDir,"keytabs");
  String principal="HTTP/127.0.0.1";
  String zkServerPrincipal="zookeeper/127.0.0.1";
  KerberosTestServices kerberosTestServices=KerberosTestServices.builder().withKdc(new File(kdcDir)).withJaasConfiguration(principal,keytabFile,zkServerPrincipal,keytabFile).build();
  kerberosTestServices.start();
  kerberosTestServices.getKdc().createPrincipal(keytabFile,principal,zkServerPrincipal);
  String jaas="Client {\n" + " com.sun.security.auth.module.Krb5LoginModule required\n" + " useKeyTab=true\n"+ " keyTab=\"" + keytabFile.getAbsolutePath() + "\"\n"+ " storeKey=true\n"+ " useTicketCache=false\n"+ " doNotPrompt=true\n"+ " debug=true\n"+ " principal=\""+ principal+ "\";\n"+ "};\n"+ "Server {\n"+ " com.sun.security.auth.module.Krb5LoginModule required\n"+ " useKeyTab=true\n"+ " keyTab=\""+ keytabFile.getAbsolutePath()+ "\"\n"+ " storeKey=true\n"+ " doNotPrompt=true\n"+ " useTicketCache=false\n"+ " debug=true\n"+ " principal=\""+ zkServerPrincipal+ "\";\n"+ "};\n";
  String jaasFilePath=kdcDir + File.separator + "jaas-client.conf";
  FileUtils.write(new File(jaasFilePath),jaas,StandardCharsets.UTF_8);
  System.setProperty("java.security.auth.login.config",jaasFilePath);
  System.setProperty("solr.kerberos.cookie.domain","127.0.0.1");
  System.setProperty("solr.kerberos.principal",principal);
  System.setProperty("solr.kerberos.keytab",keytabFile.getAbsolutePath());
  System.setProperty("authenticationPlugin","org.apache.solr.security.KerberosPlugin");
}
