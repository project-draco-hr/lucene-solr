{
  Directory index=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),index);
  addDoc("foobar",w);
  addDoc("test",w);
  addDoc("working",w);
  IndexReader reader=w.getReader();
  IndexSearcher searcher=newSearcher(reader);
  w.close();
  SlowFuzzyQuery q=new SlowFuzzyQuery(new Term("field","fouba"),2);
  ScoreDoc[] hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("foobar",searcher.doc(hits[0].doc).get("field"));
  q=new SlowFuzzyQuery(new Term("field","foubara"),2);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("foobar",searcher.doc(hits[0].doc).get("field"));
  q=new SlowFuzzyQuery(new Term("field","t"),3);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  q=new SlowFuzzyQuery(new Term("field","a"),4f,0,50);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  q=new SlowFuzzyQuery(new Term("field","a"),6f,0,50);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(2,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  assertEquals("foobar",searcher.doc(hits[1].doc).get("field"));
  reader.close();
  index.close();
}
