{
  CoreContainer cc=jetty.getCoreContainer();
  try (SolrCore core=cc.getCore("collection1")){
    SimilarityFactory simfac=core.getLatestSchema().getSimilarityFactory();
    assertNotNull(simfac);
    assertTrue("test only works with SchemaSimilarityFactory",simfac instanceof SchemaSimilarityFactory);
    Similarity mainSim=core.getLatestSchema().getSimilarity();
    assertNotNull(mainSim);
    assertEquals(mainSim,simfac.getSimilarity());
    assertTrue("test only works with PerFieldSimilarityWrapper, SchemaSimilarityFactory redefined?",mainSim instanceof PerFieldSimilarityWrapper);
    Similarity fieldSim=((PerFieldSimilarityWrapper)mainSim).get(fieldname);
    assertEquals("wrong sim for field=" + fieldname,expected,fieldSim.getClass());
  }
 }
