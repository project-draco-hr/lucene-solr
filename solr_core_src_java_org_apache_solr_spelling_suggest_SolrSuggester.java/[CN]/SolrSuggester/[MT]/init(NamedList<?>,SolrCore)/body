{
  LOG.info("init: " + config);
  name=config.get(NAME) != null ? (String)config.get(NAME) : DEFAULT_DICT_NAME;
  sourceLocation=(String)config.get(LOCATION);
  lookupImpl=(String)config.get(LOOKUP_IMPL);
  dictionaryImpl=(String)config.get(DICTIONARY_IMPL);
  String store=(String)config.get(STORE_DIR);
  if (lookupImpl == null) {
    lookupImpl=LookupFactory.DEFAULT_FILE_BASED_DICT;
    LOG.info("No " + LOOKUP_IMPL + " parameter was provided falling back to "+ lookupImpl);
  }
  factory=core.getResourceLoader().newInstance(lookupImpl,LookupFactory.class);
  lookup=factory.create(config,core);
  core.addCloseHook(new CloseHook(){
    @Override public void preClose(    SolrCore core){
      if (lookup != null && lookup instanceof Closeable) {
        try {
          ((Closeable)lookup).close();
        }
 catch (        IOException e) {
          LOG.warn("Could not close the suggester lookup.",e);
        }
      }
    }
    @Override public void postClose(    SolrCore core){
    }
  }
);
  if (store != null && !store.isEmpty()) {
    storeDir=new File(store);
    if (!storeDir.isAbsolute()) {
      storeDir=new File(core.getDataDir() + File.separator + storeDir);
    }
    if (!storeDir.exists()) {
      storeDir.mkdirs();
    }
 else     if (getStoreFile().exists()) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("attempt reload of the stored lookup from file " + getStoreFile());
      }
      try {
        lookup.load(new FileInputStream(getStoreFile()));
      }
 catch (      IOException e) {
        LOG.warn("Loading stored lookup data failed, possibly not cached yet");
      }
    }
  }
  if (dictionaryImpl == null) {
    dictionaryImpl=(sourceLocation == null) ? DictionaryFactory.DEFAULT_INDEX_BASED_DICT : DictionaryFactory.DEFAULT_FILE_BASED_DICT;
    LOG.info("No " + DICTIONARY_IMPL + " parameter was provided falling back to "+ dictionaryImpl);
  }
  dictionaryFactory=core.getResourceLoader().newInstance(dictionaryImpl,DictionaryFactory.class);
  dictionaryFactory.setParams(config);
  LOG.info("Dictionary loaded with params: " + config);
  return name;
}
