{
  final FakeScorer scorer=new FakeScorer();
  Map<String,Scorer> context=new HashMap<>();
  if (keepScores) {
    context.put("scorer",scorer);
  }
  IntsRef scratch=new IntsRef();
  for (  MatchingDocs hits : matchingDocs) {
    OrdinalsReader.OrdinalsSegmentReader ords=ordinalsReader.getReader(hits.context);
    int scoresIdx=0;
    float[] scores=hits.scores;
    FunctionValues functionValues=valueSource.getValues(context,hits.context);
    DocIdSetIterator docs=hits.bits.iterator();
    int doc;
    while ((doc=docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
      ords.get(doc,scratch);
      if (keepScores) {
        scorer.docID=doc;
        scorer.score=scores[scoresIdx++];
      }
      float value=(float)functionValues.doubleVal(doc);
      for (int i=0; i < scratch.length; i++) {
        values[scratch.ints[i]]+=value;
      }
    }
  }
  rollup();
}
