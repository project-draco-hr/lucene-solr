{
  super.setUp();
  collector=new Collector();
  if (EXTERNAL_SOLR_SERVER_URL != null) {
    solrServer=new HttpSolrServer(EXTERNAL_SOLR_SERVER_URL);
    ((HttpSolrServer)solrServer).setParser(new XMLResponseParser());
  }
 else {
    if (TEST_WITH_EMBEDDED_SOLR_SERVER) {
      solrServer=new EmbeddedTestSolrServer(h.getCoreContainer(),"");
    }
 else {
      throw new RuntimeException("Not yet implemented");
    }
  }
  int batchSize=SEQ_NUM2.incrementAndGet() % 2 == 0 ? 100 : 1;
  testServer=new SolrServerDocumentLoader(solrServer,batchSize);
  deleteAllDocuments();
  tempDir=new File(dataDir + "/test-morphlines-" + System.currentTimeMillis()).getAbsolutePath();
  new File(tempDir).mkdirs();
}
