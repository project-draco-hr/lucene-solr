{
  super.setUp();
  collector=new Collector();
  if (EXTERNAL_SOLR_SERVER_URL != null) {
    solrClient=new HttpSolrClient(EXTERNAL_SOLR_SERVER_URL);
    ((HttpSolrClient)solrClient).setParser(new XMLResponseParser());
  }
 else {
    if (TEST_WITH_EMBEDDED_SOLR_SERVER) {
      solrClient=new EmbeddedTestSolrServer(h.getCoreContainer(),DEFAULT_TEST_CORENAME);
    }
 else {
      throw new RuntimeException("Not yet implemented");
    }
  }
  int batchSize=SEQ_NUM2.incrementAndGet() % 2 == 0 ? 100 : 1;
  testServer=new SolrClientDocumentLoader(solrClient,batchSize);
  deleteAllDocuments();
  tempDir=createTempDir().toFile().getAbsolutePath();
}
