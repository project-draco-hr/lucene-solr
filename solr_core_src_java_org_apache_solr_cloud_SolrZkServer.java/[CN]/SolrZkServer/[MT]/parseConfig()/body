{
  if (zkProps == null) {
    zkProps=new SolrZkServerProps();
    zkProps.setDataDir(dataHome);
    zkProps.zkRun=zkRun;
    zkProps.solrPort=Integer.toString(solrPort);
  }
  try {
    props=SolrZkServerProps.getProperties(confHome + '/' + "zoo.cfg");
    SolrZkServerProps.injectServers(props,zkRun,zkHost);
    zkProps.parseProperties(props);
    if (zkProps.getClientPortAddress() == null) {
      zkProps.setClientPort(solrPort + 1000);
    }
  }
 catch (  QuorumPeerConfig.ConfigException|IOException e) {
    if (zkRun != null)     throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,e);
  }
}
