{
  HttpSolrClient client=new HttpSolrClient(jetty.getBaseUrl().toString() + "/redirect/foo");
  SolrQuery q=new SolrQuery("*:*");
  try {
    QueryResponse response=client.query(q);
    fail("Should have thrown an exception.");
  }
 catch (  SolrServerException e) {
    assertTrue(e.getMessage().contains("redirect"));
  }
  client.setFollowRedirects(true);
  try {
    QueryResponse response=client.query(q);
  }
 catch (  Throwable t) {
    fail("Exception was thrown:" + t);
  }
  client.setFollowRedirects(false);
  try {
    QueryResponse response=client.query(q);
    fail("Should have thrown an exception.");
  }
 catch (  SolrServerException e) {
    assertTrue(e.getMessage().contains("redirect"));
  }
  client.shutdown();
}
