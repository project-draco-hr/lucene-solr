{
  final LongValues ordMap=map == null ? null : map.getGlobalOrds(subIndex);
  int missingDocCount=0;
  int doc;
  while ((doc=disi.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    si.setDocument(doc);
    long ord;
    boolean emptyTerm=true;
    while ((ord=si.nextOrd()) != SortedSetDocValues.NO_MORE_ORDS) {
      emptyTerm=false;
      int term=(int)ord;
      if (map != null) {
        term=(int)ordMap.get(term);
      }
      counts[term]++;
      for (      FieldFacetStats f : facetStats) {
        f.facetTermNum(docBase + doc,term);
      }
    }
    if (emptyTerm) {
      for (      FieldFacetStats f : facetStats) {
        f.facetMissingNum(docBase + doc);
      }
      missingDocCount++;
    }
  }
  return missingDocCount;
}
