{
  Directory dir=newDirectory(newRandom());
  IndexWriter w=new IndexWriter(dir,new MockAnalyzer(),IndexWriter.MaxFieldLength.UNLIMITED);
  Document doc=new Document();
  Field f=new Field("field","",Field.Store.NO,Field.Index.NOT_ANALYZED);
  doc.add(f);
  for (int i=0; i < 17; i++) {
    f.setValue("" + i);
    w.addDocument(doc);
    w.commit();
  }
  IndexReader r=w.getReader();
  w.close();
  assertTrue(r.getSequentialSubReaders().length > 1);
  ValueSource s1=new IntFieldSource("field");
  DocValues v1=s1.getValues(r);
  DocValues v2=new MultiValueSource(s1).getValues(r);
  for (int i=0; i < r.maxDoc(); i++) {
    assertEquals(v1.intVal(i),i);
    assertEquals(v2.intVal(i),i);
  }
  FieldCache.DEFAULT.purgeAllCaches();
  r.close();
  dir.close();
}
