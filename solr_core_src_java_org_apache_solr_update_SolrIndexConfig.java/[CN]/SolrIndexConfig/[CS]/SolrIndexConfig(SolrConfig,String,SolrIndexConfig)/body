{
  if (prefix == null) {
    prefix="indexConfig";
    log.debug("Defaulting to prefix \"" + prefix + "\" for index configuration");
  }
  if (def == null) {
    def=new SolrIndexConfig(solrConfig);
  }
  Object unused=solrConfig.getNode(prefix,false);
  luceneVersion=solrConfig.luceneMatchVersion;
  assertWarnOrFail("The <mergeScheduler>myclass</mergeScheduler> syntax is no longer supported in solrconfig.xml. Please use syntax <mergeScheduler class=\"myclass\"/> instead.",!((solrConfig.getNode(prefix + "/mergeScheduler",false) != null) && (solrConfig.get(prefix + "/mergeScheduler/@class",null) == null)),true);
  assertWarnOrFail("The <mergePolicy>myclass</mergePolicy> syntax is no longer supported in solrconfig.xml. Please use syntax <mergePolicy class=\"myclass\"/> instead.",!((solrConfig.getNode(prefix + "/mergePolicy",false) != null) && (solrConfig.get(prefix + "/mergePolicy/@class",null) == null)),true);
  assertWarnOrFail("The <luceneAutoCommit>true|false</luceneAutoCommit> parameter is no longer valid in solrconfig.xml.",solrConfig.get(prefix + "/luceneAutoCommit",null) == null,true);
  effectiveUseCompoundFileSetting=solrConfig.getBool(prefix + "/useCompoundFile",def.getUseCompoundFile());
  maxBufferedDocs=solrConfig.getInt(prefix + "/maxBufferedDocs",def.maxBufferedDocs);
  maxMergeDocs=solrConfig.getInt(prefix + "/maxMergeDocs",def.maxMergeDocs);
  mergeFactor=solrConfig.getInt(prefix + "/mergeFactor",def.mergeFactor);
  ramBufferSizeMB=solrConfig.getDouble(prefix + "/ramBufferSizeMB",def.ramBufferSizeMB);
  writeLockTimeout=solrConfig.getInt(prefix + "/writeLockTimeout",def.writeLockTimeout);
  lockType=solrConfig.get(prefix + "/lockType",def.lockType);
  mergeSchedulerInfo=getPluginInfo(prefix + "/mergeScheduler",solrConfig,def.mergeSchedulerInfo);
  mergePolicyInfo=getPluginInfo(prefix + "/mergePolicy",solrConfig,def.mergePolicyInfo);
  mergePolicyFactoryInfo=getPluginInfo(prefix + "/mergePolicyFactory",solrConfig,def.mergePolicyInfo);
  if (mergePolicyInfo != null && mergePolicyFactoryInfo != null) {
    throw new IllegalArgumentException("<mergePolicy> and <mergePolicyFactory> are mutually exclusive.");
  }
  assertWarnOrFail("Beginning with Solr 5.5, <mergePolicy> is deprecated, use <mergePolicyFactory> instead.",(mergePolicyInfo == null),false);
  assertWarnOrFail("Beginning with Solr 5.5, <maxMergeDocs> is deprecated, configure it on the relevant <mergePolicyFactory> instead.",(mergePolicyFactoryInfo != null && maxMergeDocs == def.maxMergeDocs),false);
  assertWarnOrFail("Beginning with Solr 5.5, <mergeFactor> is deprecated, configure it on the relevant <mergePolicyFactory> instead.",(mergePolicyFactoryInfo != null && mergeFactor == def.mergeFactor),false);
  String val=solrConfig.get(prefix + "/termIndexInterval",null);
  if (val != null) {
    throw new IllegalArgumentException("Illegal parameter 'termIndexInterval'");
  }
  boolean infoStreamEnabled=solrConfig.getBool(prefix + "/infoStream",false);
  if (infoStreamEnabled) {
    String infoStreamFile=solrConfig.get(prefix + "/infoStream/@file",null);
    if (infoStreamFile == null) {
      log.info("IndexWriter infoStream solr logging is enabled");
      infoStream=new LoggingInfoStream();
    }
 else {
      throw new IllegalArgumentException("Remove @file from <infoStream> to output messages to solr's logfile");
    }
  }
  mergedSegmentWarmerInfo=getPluginInfo(prefix + "/mergedSegmentWarmer",solrConfig,def.mergedSegmentWarmerInfo);
  assertWarnOrFail("Begining with Solr 5.0, <checkIntegrityAtMerge> option is no longer supported and should be removed from solrconfig.xml (these integrity checks are now automatic)",(null == solrConfig.getNode(prefix + "/checkIntegrityAtMerge",false)),true);
}
