{
  IndexSchema schema=core.getLatestSchema();
  IndexWriterConfig iwc=new IndexWriterConfig(new DelayedSchemaAnalyzer(core));
  if (maxBufferedDocs != -1)   iwc.setMaxBufferedDocs(maxBufferedDocs);
  if (ramBufferSizeMB != -1)   iwc.setRAMBufferSizeMB(ramBufferSizeMB);
  if (writeLockTimeout != -1)   iwc.setWriteLockTimeout(writeLockTimeout);
  iwc.setSimilarity(schema.getSimilarity());
  iwc.setMergePolicy(buildMergePolicy(schema));
  iwc.setMergeScheduler(buildMergeScheduler(schema));
  iwc.setInfoStream(infoStream);
  iwc.setUseCompoundFile(getUseCompoundFile());
  if (maxIndexingThreads != -1) {
    iwc.setMaxThreadStates(maxIndexingThreads);
  }
  if (mergedSegmentWarmerInfo != null) {
    IndexReaderWarmer warmer=schema.getResourceLoader().newInstance(mergedSegmentWarmerInfo.className,IndexReaderWarmer.class,null,new Class[]{InfoStream.class},new Object[]{iwc.getInfoStream()});
    iwc.setMergedSegmentWarmer(warmer);
  }
  return iwc;
}
