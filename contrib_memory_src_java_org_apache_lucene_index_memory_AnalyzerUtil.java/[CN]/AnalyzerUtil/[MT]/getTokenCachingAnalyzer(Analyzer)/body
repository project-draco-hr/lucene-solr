{
  if (child == null)   throw new IllegalArgumentException("child analyzer must not be null");
  return new Analyzer(){
    private final HashMap cache=new HashMap();
    public TokenStream tokenStream(    String fieldName,    Reader reader){
      final ArrayList tokens=(ArrayList)cache.get(fieldName);
      if (tokens == null) {
        final ArrayList tokens2=new ArrayList();
        TokenStream tokenStream=new TokenFilter(child.tokenStream(fieldName,reader)){
          public boolean incrementToken() throws IOException {
            boolean hasNext=input.incrementToken();
            if (hasNext)             tokens2.add(captureState());
            return hasNext;
          }
        }
;
        cache.put(fieldName,tokens2);
        return tokenStream;
      }
 else {
        return new TokenStream(){
          private Iterator iter=tokens.iterator();
          public boolean incrementToken(){
            if (!iter.hasNext())             return false;
            restoreState((AttributeSource.State)iter.next());
            return true;
          }
        }
;
      }
    }
  }
;
}
