{
  return new SegmentInfos.FindSegmentsFile<DirectoryReader>(directory){
    @Override protected DirectoryReader doBody(    String segmentFileName) throws IOException {
      SegmentInfos sis=SegmentInfos.readCommit(directory,segmentFileName);
      final SegmentReader[] readers=new SegmentReader[sis.size()];
      boolean success=false;
      try {
        for (int i=sis.size() - 1; i >= 0; i--) {
          readers[i]=new SegmentReader(sis.info(i),IOContext.READ);
        }
        DirectoryReader reader=new StandardDirectoryReader(directory,readers,null,sis,false,false);
        success=true;
        return reader;
      }
  finally {
        if (success == false) {
          IOUtils.closeWhileHandlingException(readers);
        }
      }
    }
  }
.run(commit);
}
