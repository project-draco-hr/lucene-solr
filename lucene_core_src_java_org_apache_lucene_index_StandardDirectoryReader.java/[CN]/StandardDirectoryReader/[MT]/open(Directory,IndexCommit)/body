{
  return (DirectoryReader)new SegmentInfos.FindSegmentsFile(directory){
    @Override protected Object doBody(    String segmentFileName) throws IOException {
      SegmentInfos sis=new SegmentInfos();
      sis.read(directory,segmentFileName);
      final SegmentReader[] readers=new SegmentReader[sis.size()];
      for (int i=sis.size() - 1; i >= 0; i--) {
        boolean success=false;
        try {
          readers[i]=new SegmentReader(sis.info(i),IOContext.READ);
          success=true;
        }
  finally {
          if (!success) {
            IOUtils.closeWhileHandlingException(readers);
          }
        }
      }
      return new StandardDirectoryReader(directory,readers,null,sis,false);
    }
  }
.run(commit);
}
