{
  MiniSolrCloudCluster miniCluster=new MiniSolrCloudCluster(5,createTempDir(),buildJettyConfig("/solr"));
  final CloudSolrClient cloudSolrClient=miniCluster.getSolrClient();
  try {
    assertNotNull(miniCluster.getZkServer());
    List<JettySolrRunner> jettys=miniCluster.getJettySolrRunners();
    assertEquals(5,jettys.size());
    for (    JettySolrRunner jetty : jettys) {
      assertTrue(jetty.isRunning());
    }
    String collectionName="testSolrCloudCollection";
    String configName="solrCloudCollectionConfig";
    File configDir=new File(SolrTestCaseJ4.TEST_HOME() + File.separator + "collection1"+ File.separator+ "conf");
    miniCluster.uploadConfigDir(configDir,configName);
    miniCluster.createCollection(collectionName,2,2,configName,null);
    QueryRequest req=new QueryRequest();
    QueryResponse rsp=req.process(cloudSolrClient,collectionName);
    assertTrue(rsp.getResponseHeader().getBooleanArg("zkConnected"));
    miniCluster.deleteCollection(collectionName);
  }
  finally {
    miniCluster.shutdown();
  }
}
