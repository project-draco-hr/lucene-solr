{
  MiniSolrCloudCluster miniCluster=new MiniSolrCloudCluster(5,createTempDir(),buildJettyConfig("/solr"));
  final CloudSolrClient cloudSolrClient=miniCluster.getSolrClient();
  try {
    assertNotNull(miniCluster.getZkServer());
    List<JettySolrRunner> jettys=miniCluster.getJettySolrRunners();
    assertEquals(5,jettys.size());
    for (    JettySolrRunner jetty : jettys) {
      assertTrue(jetty.isRunning());
    }
    String collectionName="testSolrCloudCollection";
    String configName="solrCloudCollectionConfig";
    miniCluster.uploadConfigSet(SolrTestCaseJ4.TEST_PATH().resolve("collection1/conf"),configName);
    CollectionAdminRequest.createCollection(collectionName,configName,2,2).process(miniCluster.getSolrClient());
    QueryRequest req=new QueryRequest();
    QueryResponse rsp=req.process(cloudSolrClient,collectionName);
    assertTrue(rsp.getResponseHeader().getBooleanArg("zkConnected"));
  }
  finally {
    miniCluster.shutdown();
  }
}
