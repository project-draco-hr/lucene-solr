{
  String file=getFile("mailing_lists.pdf").toURI().toASCIIString();
  String xml="<?xml version=\"1.0\"?>" + "<!DOCTYPE foo [" + "<!ENTITY bar SYSTEM \"" + file + "\">"+ "<!ENTITY wacky \"zzz\">"+ "]>"+ "<random>"+ " &bar;"+ " <document>"+ "  <node name=\"id\" value=\"12345\"/>"+ "  <node name=\"foo_s\" value=\"&wacky;\"/>"+ " </document>"+ "</random>";
  SolrQueryRequest req=req(CommonParams.TR,"xsl-update-handler-test.xsl");
  SolrQueryResponse rsp=new SolrQueryResponse();
  BufferingRequestProcessor p=new BufferingRequestProcessor(null);
  XMLLoader loader=new XMLLoader().init(null);
  loader.load(req,rsp,new ContentStreamBase.StringStream(xml),p);
  AddUpdateCommand add=p.addCommands.get(0);
  assertEquals("12345",add.solrDoc.getField("id").getFirstValue());
  assertEquals("zzz",add.solrDoc.getField("foo_s").getFirstValue());
  req.close();
}
