{
  Fields fields=MultiFields.getFields(reader);
  final Terms terms=fields.terms(field);
  return new IntDocValues(this){
    DocsEnum docs;
    int atDoc;
    int lastDocRequested=-1;
{
      reset();
    }
    public void reset() throws IOException {
      docs=terms.docs(null,indexedBytes,null);
      if (docs == null) {
        docs=new DocsEnum(){
          @Override public int freq(){
            return 0;
          }
          @Override public int docID(){
            return DocIdSetIterator.NO_MORE_DOCS;
          }
          @Override public int nextDoc() throws IOException {
            return DocIdSetIterator.NO_MORE_DOCS;
          }
          @Override public int advance(          int target) throws IOException {
            return DocIdSetIterator.NO_MORE_DOCS;
          }
        }
;
      }
      atDoc=-1;
    }
    @Override public int intVal(    int doc){
      try {
        if (doc < lastDocRequested) {
          reset();
        }
        lastDocRequested=doc;
        if (atDoc < doc) {
          atDoc=docs.advance(doc);
        }
        if (atDoc > doc) {
          return 0;
        }
        return docs.freq();
      }
 catch (      IOException e) {
        throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"caught exception in function " + description() + " : doc="+ doc,e);
      }
    }
  }
;
}
