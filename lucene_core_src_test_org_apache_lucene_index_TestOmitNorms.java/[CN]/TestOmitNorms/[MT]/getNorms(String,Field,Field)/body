{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(new MockAnalyzer(random())).setMergePolicy(newLogMergePolicy());
  RandomIndexWriter riw=new RandomIndexWriter(random(),dir,iwc);
  Document d=new Document();
  d.add(f1);
  riw.addDocument(d);
  d=new Document();
  d.add(f2);
  riw.addDocument(d);
  int numExtraDocs=TestUtil.nextInt(random(),1,1000);
  for (int i=0; i < numExtraDocs; i++) {
    d=new Document();
    d.add(random().nextBoolean() ? f1 : f2);
    riw.addDocument(d);
  }
  IndexReader ir1=riw.getReader();
  NumericDocValues norms1=MultiDocValues.getNormValues(ir1,field);
  riw.forceMerge(1);
  DirectoryReader ir2=riw.getReader();
  NumericDocValues norms2=getOnlyLeafReader(ir2).getNormValues(field);
  if (norms1 == null) {
    assertNull(norms2);
  }
 else {
    while (true) {
      int norms1DocID=norms1.nextDoc();
      int norms2DocID=norms2.nextDoc();
      while (norms1DocID < norms2DocID) {
        assertEquals(0,norms1.longValue());
        norms1DocID=norms1.nextDoc();
      }
      while (norms2DocID < norms1DocID) {
        assertEquals(0,norms2.longValue());
        norms2DocID=norms2.nextDoc();
      }
      if (norms1.docID() == NO_MORE_DOCS) {
        break;
      }
      assertEquals(norms1.longValue(),norms2.longValue());
    }
  }
  ir1.close();
  ir2.close();
  riw.close();
  dir.close();
  return norms1;
}
