{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(new MockAnalyzer(random())).setMergePolicy(newLogMergePolicy());
  RandomIndexWriter riw=new RandomIndexWriter(random(),dir,iwc);
  Document d=new Document();
  d.add(f1);
  riw.addDocument(d);
  d=new Document();
  d.add(f2);
  riw.addDocument(d);
  int numExtraDocs=TestUtil.nextInt(random(),1,1000);
  for (int i=0; i < numExtraDocs; i++) {
    d=new Document();
    d.add(random().nextBoolean() ? f1 : f2);
    riw.addDocument(d);
  }
  IndexReader ir1=riw.getReader();
  NumericDocValues norms1=MultiDocValues.getNormValues(ir1,field);
  riw.forceMerge(1);
  DirectoryReader ir2=riw.getReader();
  NumericDocValues norms2=getOnlyLeafReader(ir2).getNormValues(field);
  if (norms1 == null) {
    assertNull(norms2);
  }
 else {
    for (int docID=0; docID < ir1.maxDoc(); docID++) {
      assertEquals(norms1.get(docID),norms2.get(docID));
    }
  }
  ir1.close();
  ir2.close();
  riw.close();
  dir.close();
  return norms1;
}
