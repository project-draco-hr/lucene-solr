{
  Directory ram=newDirectory();
  Analyzer analyzer=new MockAnalyzer(random());
  IndexWriter writer=new IndexWriter(ram,newIndexWriterConfig(analyzer));
  Document d=new Document();
  Field f1=newTextField("f1","This field has norms",Field.Store.NO);
  d.add(f1);
  FieldType customType=new FieldType(TextField.TYPE_NOT_STORED);
  customType.setOmitNorms(true);
  Field f2=newField("f2","This field has NO norms in all docs",customType);
  d.add(f2);
  writer.addDocument(d);
  writer.forceMerge(1);
  d=new Document();
  d.add(newField("f1","This field has norms",customType));
  d.add(newTextField("f2","This field has NO norms in all docs",Field.Store.NO));
  writer.addDocument(d);
  writer.forceMerge(1);
  writer.close();
  LeafReader reader=getOnlyLeafReader(DirectoryReader.open(ram));
  FieldInfos fi=reader.getFieldInfos();
  assertTrue("OmitNorms field bit should be set.",fi.fieldInfo("f1").omitsNorms());
  assertTrue("OmitNorms field bit should be set.",fi.fieldInfo("f2").omitsNorms());
  reader.close();
  ram.close();
}
