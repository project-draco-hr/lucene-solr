{
  QueryScorer scorer=new QueryScorer(query,request.getParams().getFieldBool(fieldName,HighlightParams.FIELD_MATCH,false) ? fieldName : null);
  scorer.setExpandMultiTermQuery(request.getParams().getBool(HighlightParams.HIGHLIGHT_MULTI_TERM,true));
  boolean defaultPayloads=true;
  try {
    final Terms terms=request.getSearcher().getLeafReader().fields().terms(fieldName);
    if (terms != null) {
      defaultPayloads=terms.hasPayloads();
    }
  }
 catch (  IOException e) {
    log.error("Couldn't check for existence of payloads",e);
  }
  scorer.setUsePayloads(request.getParams().getFieldBool(fieldName,HighlightParams.PAYLOADS,defaultPayloads));
  return scorer;
}
