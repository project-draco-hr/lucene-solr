{
  assert inputWasReset;
  windowTokenIncremented=true;
  while (true) {
    if (capturedState == null) {
      if (!input.incrementToken()) {
        return false;
      }
    }
 else {
      restoreState(capturedState);
      capturedState=null;
      posIncAtt.setPositionIncrement(1);
    }
    final int startOffset=offsetAtt.startOffset();
    final int endOffset=offsetAtt.endOffset();
    if (startOffset >= windowEndOffset) {
      capturedState=captureState();
      return false;
    }
    if (startOffset >= windowStartOffset) {
      offsetAtt.setOffset(startOffset - windowStartOffset,endOffset - windowStartOffset);
      return true;
    }
  }
}
