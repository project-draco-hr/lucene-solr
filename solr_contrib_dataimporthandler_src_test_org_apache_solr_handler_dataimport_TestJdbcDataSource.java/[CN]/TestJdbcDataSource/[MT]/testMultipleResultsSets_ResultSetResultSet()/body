{
  MockInitialContextFactory.bind("java:comp/env/jdbc/JndiDB",dataSource);
  props.put(JdbcDataSource.JNDI_NAME,"java:comp/env/jdbc/JndiDB");
  EasyMock.expect(dataSource.getConnection()).andReturn(connection);
  jdbcDataSource.init(context,props);
  connection.setAutoCommit(false);
  Statement statement=mockControl.createMock(Statement.class);
  EasyMock.expect(connection.createStatement(ResultSet.TYPE_FORWARD_ONLY,ResultSet.CONCUR_READ_ONLY)).andReturn(statement);
  statement.setFetchSize(500);
  statement.setMaxRows(0);
  EasyMock.expect(statement.execute("query")).andReturn(true);
  ResultSet resultSet1=mockControl.createMock(ResultSet.class);
  EasyMock.expect(statement.getResultSet()).andReturn(resultSet1);
  ResultSetMetaData metaData1=mockControl.createMock(ResultSetMetaData.class);
  EasyMock.expect(resultSet1.getMetaData()).andReturn(metaData1);
  EasyMock.expect(metaData1.getColumnCount()).andReturn(0);
  EasyMock.expect(resultSet1.next()).andReturn(false);
  resultSet1.close();
  EasyMock.expect(statement.getMoreResults()).andReturn(true);
  ResultSet resultSet2=mockControl.createMock(ResultSet.class);
  EasyMock.expect(statement.getResultSet()).andReturn(resultSet2);
  ResultSetMetaData metaData2=mockControl.createMock(ResultSetMetaData.class);
  EasyMock.expect(resultSet2.getMetaData()).andReturn(metaData2);
  EasyMock.expect(metaData2.getColumnCount()).andReturn(0);
  EasyMock.expect(resultSet2.next()).andReturn(true);
  EasyMock.expect(resultSet2.next()).andReturn(false);
  resultSet2.close();
  EasyMock.expect(statement.getMoreResults()).andReturn(false);
  EasyMock.expect(statement.getUpdateCount()).andReturn(-1);
  statement.close();
  mockControl.replay();
  final ResultSetIterator resultSetIterator=jdbcDataSource.new ResultSetIterator("query");
  assertSame(resultSet1,resultSetIterator.getResultSet());
  assertTrue(resultSetIterator.hasnext());
  assertSame(resultSet2,resultSetIterator.getResultSet());
  assertFalse(resultSetIterator.hasnext());
  mockControl.verify();
}
