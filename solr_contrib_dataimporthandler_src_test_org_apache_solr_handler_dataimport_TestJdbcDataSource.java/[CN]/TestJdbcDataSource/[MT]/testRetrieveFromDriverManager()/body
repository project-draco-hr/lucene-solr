{
  DriverManager.registerDriver(driver);
  try {
    EasyMock.expect(driver.connect((String)EasyMock.notNull(),(Properties)EasyMock.notNull())).andReturn(connection);
    connection.setAutoCommit(false);
    connection.setHoldability(1);
    props.put(JdbcDataSource.DRIVER,driver.getClass().getName());
    props.put(JdbcDataSource.URL,"jdbc:fakedb");
    props.put("holdability","HOLD_CURSORS_OVER_COMMIT");
    mockControl.replay();
    Connection conn=jdbcDataSource.createConnectionFactory(context,props).call();
    mockControl.verify();
    assertSame("connection",conn,connection);
  }
 catch (  Exception e) {
    throw e;
  }
 finally {
    DriverManager.deregisterDriver(driver);
  }
}
