{
  StackTraceElement[] trace=new Exception().getStackTrace();
  boolean isCommit=false;
  boolean isDelete=false;
  for (int i=0; i < trace.length; i++) {
    if ("org.apache.lucene.index.SegmentInfos".equals(trace[i].getClassName()) && "prepareCommit".equals(trace[i].getMethodName()))     isCommit=true;
    if ("org.apache.lucene.store.MockDirectoryWrapper".equals(trace[i].getClassName()) && "deleteFile".equals(trace[i].getMethodName()))     isDelete=true;
  }
  if (isCommit) {
    if (!isDelete) {
      fail1=true;
      throw new RuntimeException("now fail first");
    }
 else {
      fail2=true;
      throw new IOException("now fail during delete");
    }
  }
}
