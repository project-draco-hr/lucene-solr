{
  SolrParams params=req.getParams();
  params=adjustParams(params);
  req.setParams(params);
  TupleStream tupleStream=null;
  try {
    tupleStream=this.streamFactory.constructStream(params.get("expr"));
  }
 catch (  Exception e) {
    SolrException.log(logger,e);
    Map requestContext=req.getContext();
    requestContext.put("stream",new DummyErrorStream(e));
    return;
  }
  StreamContext context=new StreamContext();
  context.setSolrClientCache(StreamHandler.clientCache);
  context.put("core",this.coreName);
  Traversal traversal=new Traversal();
  context.put("traversal",traversal);
  tupleStream.setStreamContext(context);
  Map requestContext=req.getContext();
  requestContext.put("stream",new TimerStream(new ExceptionStream(tupleStream)));
  requestContext.put("traversal",traversal);
}
