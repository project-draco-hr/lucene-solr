{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig();
  IndexWriter w=new IndexWriter(dir,iwc);
  Document doc=new Document();
  for (int i=0; i < 10000; ++i) {
    w.addDocument(doc);
  }
  w.forceMerge(1);
  DirectoryReader reader=DirectoryReader.open(w);
  w.close();
  TermsQuery query=new TermsQuery(new Term("foo","bar"),new Term("foo","baz"));
  UsageTrackingQueryCachingPolicy policy=new UsageTrackingQueryCachingPolicy();
  assertFalse(policy.shouldCache(query,getOnlyLeafReader(reader).getContext()));
  policy.onUse(query);
  policy.onUse(query);
  assertTrue(policy.shouldCache(query,getOnlyLeafReader(reader).getContext()));
  reader.close();
  dir.close();
}
