{
  byte[] content=null;
  String contentType=null;
  URL url=new URL("http://svn.apache.org/repos/asf/lucene/dev/trunk/");
  InputStream in=null;
  try {
    HttpURLConnection conn=(HttpURLConnection)url.openConnection();
    conn.setConnectTimeout(1000);
    conn.setReadTimeout(1000);
    conn.connect();
    int code=conn.getResponseCode();
    assumeTrue("wrong response code from server: " + code,200 == code);
    in=conn.getInputStream();
    contentType=conn.getContentType();
    content=IOUtils.toByteArray(in);
    assumeTrue("not enough content for test to be useful",content.length > 10);
  }
 catch (  IOException ex) {
    assumeNoException("Unable to connect to " + url + " to run the test.",ex);
  }
 finally {
    if (in != null) {
      IOUtils.closeQuietly(in);
    }
  }
  ContentStreamBase stream=new ContentStreamBase.URLStream(url);
  in=stream.getStream();
  assertEquals(content.length,stream.getSize().intValue());
  try {
    assertTrue(IOUtils.contentEquals(new ByteArrayInputStream(content),in));
  }
  finally {
    IOUtils.closeQuietly(in);
  }
  String charset=ContentStreamBase.getCharsetFromContentType(contentType);
  if (charset == null)   charset=ContentStreamBase.DEFAULT_CHARSET;
  stream=new ContentStreamBase.URLStream(url);
  assertTrue(IOUtils.contentEquals(new StringReader(new String(content,charset)),stream.getReader()));
}
