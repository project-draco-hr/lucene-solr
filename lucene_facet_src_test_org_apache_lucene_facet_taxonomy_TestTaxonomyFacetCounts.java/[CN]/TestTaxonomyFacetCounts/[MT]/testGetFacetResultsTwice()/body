{
  Directory indexDir=newDirectory();
  Directory taxoDir=newDirectory();
  DirectoryTaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(taxoDir);
  IndexWriter iw=new IndexWriter(indexDir,newIndexWriterConfig(new MockAnalyzer(random())));
  FacetsConfig config=new FacetsConfig();
  Document doc=new Document();
  doc.add(new FacetField("a","1"));
  doc.add(new FacetField("b","1"));
  iw.addDocument(config.build(taxoWriter,doc));
  DirectoryReader r=DirectoryReader.open(iw);
  DirectoryTaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoWriter);
  final FacetsCollector sfc=new FacetsCollector();
  newSearcher(r).search(new MatchAllDocsQuery(),sfc);
  Facets facets=getTaxonomyFacetCounts(taxoReader,config,sfc);
  List<FacetResult> res1=facets.getAllDims(10);
  List<FacetResult> res2=facets.getAllDims(10);
  assertEquals("calling getFacetResults twice should return the .equals()=true result",res1,res2);
  iw.close();
  IOUtils.close(taxoWriter,taxoReader,taxoDir,r,indexDir);
}
