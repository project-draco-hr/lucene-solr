{
  int numGroups=collapsedSet.size();
  groups=new LongObjectOpenHashMap<>(numGroups * 2);
  DocIdSetIterator iterator=new BitSetIterator(groupBits,0);
  int group;
  while ((group=iterator.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    Collector collector=(sort == null) ? TopScoreDocCollector.create(limit,true) : TopFieldCollector.create(sort,limit,false,false,false,true);
    groups.put(group,collector);
  }
  this.collapsedSet=collapsedSet;
  this.groupBits=groupBits;
  this.docValues=docValues;
  if (docValues instanceof MultiDocValues.MultiSortedDocValues) {
    this.multiSortedDocValues=(MultiDocValues.MultiSortedDocValues)docValues;
    this.ordinalMap=multiSortedDocValues.mapping;
  }
}
