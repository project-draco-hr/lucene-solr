{
  if (!rb.doExpand) {
    return;
  }
  if ((sreq.purpose & ShardRequest.PURPOSE_GET_FIELDS) != 0) {
    SolrQueryRequest req=rb.req;
    Map expanded=(Map)req.getContext().get("expanded");
    if (expanded == null) {
      expanded=new HashMap();
      req.getContext().put("expanded",expanded);
    }
    for (    ShardResponse srsp : sreq.responses) {
      NamedList response=srsp.getSolrResponse().getResponse();
      Map ex=(Map)response.get("expanded");
      Iterator<Map.Entry<String,SolrDocumentList>> it=ex.entrySet().iterator();
      while (it.hasNext()) {
        Map.Entry<String,SolrDocumentList> entry=it.next();
        String name=entry.getKey();
        SolrDocumentList val=entry.getValue();
        expanded.put(name,val);
      }
    }
  }
}
