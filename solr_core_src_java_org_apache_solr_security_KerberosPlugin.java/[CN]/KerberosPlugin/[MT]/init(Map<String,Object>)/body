{
  try {
    Map<String,String> params=new HashMap();
    params.put("type","kerberos");
    putParam(params,"kerberos.name.rules",NAME_RULES_PARAM,"DEFAULT");
    putParam(params,"token.valid",TOKEN_VALID_PARAM,"30");
    putParam(params,"cookie.path",COOKIE_PATH_PARAM,"/");
    putParam(params,"kerberos.principal",PRINCIPAL_PARAM,null);
    putParam(params,"kerberos.keytab",KEYTAB_PARAM,null);
    String usePortStr=System.getProperty(COOKIE_PORT_AWARE_PARAM,null);
    boolean needPortAwareCookies=(usePortStr == null) ? false : Boolean.parseBoolean(usePortStr);
    if (!needPortAwareCookies || !coreContainer.isZooKeeperAware()) {
      putParam(params,"cookie.domain",COOKIE_DOMAIN_PARAM,null);
    }
 else {
      String host=System.getProperty(COOKIE_DOMAIN_PARAM,null);
      if (host == null) {
        throw new SolrException(ErrorCode.SERVER_ERROR,"Missing required parameter '" + COOKIE_DOMAIN_PARAM + "'.");
      }
      int port=coreContainer.getZkController().getHostPort();
      params.put("cookie.domain",host + ":" + port);
    }
    log.info("Params: " + params);
    FilterConfig conf=new FilterConfig(){
      @Override public ServletContext getServletContext(){
        return noContext;
      }
      @Override public Enumeration<String> getInitParameterNames(){
        return new IteratorEnumeration(params.keySet().iterator());
      }
      @Override public String getInitParameter(      String param){
        return params.get(param);
      }
      @Override public String getFilterName(){
        return "KerberosFilter";
      }
    }
;
    kerberosFilter.init(conf);
  }
 catch (  ServletException e) {
    throw new SolrException(ErrorCode.SERVER_ERROR,"Error initializing kerberos authentication plugin: " + e);
  }
}
