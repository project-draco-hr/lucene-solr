{
  dirName=fullDir(dirName);
  Directory dir=FSDirectory.getDirectory(dirName);
  IndexSearcher searcher=new IndexSearcher(dir);
  Hits hits=searcher.search(new TermQuery(new Term("content","aaa")));
  assertEquals("wrong number of hits",34,hits.length());
  Document d=hits.doc(0);
  assertEquals("wrong first document","21",d.get("id"));
  searcher.close();
  IndexReader reader=IndexReader.open(dir);
  Term searchTerm=new Term("id","6");
  int delCount=reader.deleteDocuments(searchTerm);
  assertEquals("wrong delete count",1,delCount);
  reader.setNorm(22,"content",(float)2.0);
  reader.close();
  searcher=new IndexSearcher(dir);
  hits=searcher.search(new TermQuery(new Term("content","aaa")));
  assertEquals("wrong number of hits",33,hits.length());
  d=hits.doc(0);
  assertEquals("wrong first document","22",d.get("id"));
  testHits(hits,33,searcher.getIndexReader());
  searcher.close();
  IndexWriter writer=new IndexWriter(dir,autoCommit,new WhitespaceAnalyzer(),false);
  writer.optimize();
  writer.close();
  searcher=new IndexSearcher(dir);
  hits=searcher.search(new TermQuery(new Term("content","aaa")));
  assertEquals("wrong number of hits",33,hits.length());
  d=hits.doc(0);
  assertEquals("wrong first document","22",d.get("id"));
  testHits(hits,33,searcher.getIndexReader());
  searcher.close();
  dir.close();
}
