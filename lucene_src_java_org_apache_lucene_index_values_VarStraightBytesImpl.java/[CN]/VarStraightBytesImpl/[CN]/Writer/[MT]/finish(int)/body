{
  try {
    if (lastDocID == -1) {
      idxOut.writeVLong(0);
      final PackedInts.Writer w=PackedInts.getWriter(idxOut,docCount,PackedInts.bitsRequired(0));
      for (int i=0; i < docCount; i++) {
        w.add(0);
      }
      w.finish();
    }
 else {
      fill(docCount);
      idxOut.writeVLong(address);
      final PackedInts.Writer w=PackedInts.getWriter(idxOut,docCount,PackedInts.bitsRequired(address));
      for (int i=0; i < docCount; i++) {
        w.add(docToAddress[i]);
      }
      w.finish();
    }
  }
  finally {
    bytesUsed.addAndGet(-(docToAddress.length) * RamUsageEstimator.NUM_BYTES_INT);
    docToAddress=null;
    super.finish(docCount);
  }
}
