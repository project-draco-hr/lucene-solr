{
  int num=100;
  Directory indexA=new MockRAMDirectory();
  Directory indexB=new MockRAMDirectory();
  fillIndex(indexA,0,num);
  boolean fail=verifyIndex(indexA,0);
  if (fail) {
    fail("Index a is invalid");
  }
  fillIndex(indexB,num,num);
  fail=verifyIndex(indexB,num);
  if (fail) {
    fail("Index b is invalid");
  }
  Directory merged=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(merged,new StandardAnalyzer(TEST_VERSION_CURRENT),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMergeFactor(2);
  writer.addIndexesNoOptimize(new Directory[]{indexA,indexB});
  writer.optimize();
  writer.close();
  fail=verifyIndex(merged,0);
  merged.close();
  assertFalse("The merged index is invalid",fail);
}
