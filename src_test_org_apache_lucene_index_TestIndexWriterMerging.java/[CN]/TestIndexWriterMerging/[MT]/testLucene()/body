{
  int num=100;
  Directory indexA=new RAMDirectory();
  Directory indexB=new RAMDirectory();
  fillIndex(indexA,0,num);
  boolean fail=verifyIndex(indexA,0);
  if (fail) {
    fail("Index a is invalid");
  }
  fillIndex(indexB,num,num);
  fail=verifyIndex(indexB,num);
  if (fail) {
    fail("Index b is invalid");
  }
  Directory merged=new RAMDirectory();
  IndexWriter writer=new IndexWriter(merged,new StandardAnalyzer(),true);
  writer.setMergeFactor(2);
  writer.addIndexes(new Directory[]{indexA,indexB});
  writer.close();
  merged.close();
  fail=verifyIndex(merged,0);
  assertFalse("The merged index is invalid",fail);
}
