{
  clientConnectionManager=new PoolingHttpClientConnectionManager(HttpClientUtil.getSchemaRegisteryProvider().getSchemaRegistry());
  if (cfg != null) {
    clientConnectionManager.setMaxTotal(cfg.getMaxUpdateConnections());
    clientConnectionManager.setDefaultMaxPerRoute(cfg.getMaxUpdateConnectionsPerHost());
  }
  ModifiableSolrParams clientParams=new ModifiableSolrParams();
  if (cfg != null) {
    clientParams.set(HttpClientUtil.PROP_SO_TIMEOUT,cfg.getDistributedSocketTimeout());
    clientParams.set(HttpClientUtil.PROP_CONNECTION_TIMEOUT,cfg.getDistributedConnectionTimeout());
  }
  client=HttpClientUtil.createClient(clientParams,clientConnectionManager);
  if (cfg != null) {
    clientParams.set(HttpClientUtil.PROP_MAX_CONNECTIONS,cfg.getMaxUpdateConnections());
    clientParams.set(HttpClientUtil.PROP_MAX_CONNECTIONS_PER_HOST,cfg.getMaxUpdateConnectionsPerHost());
  }
  log.info("Created UpdateShardHandler HTTP client with params: {}",clientParams);
}
