{
  this.writeLock.lock();
  try {
    if (this.isClosed.get())     throw new IllegalStateException("Lock has been closed");
    Thread t=Thread.currentThread();
    if (!this.threads.containsKey(t))     return false;
    String key=this.threads.get(t);
    this.threads.remove(t);
    if (!this.locks.containsKey(key))     return false;
    this.locks.remove(key);
    return true;
  }
  finally {
    this.writeLock.unlock();
  }
}
