{
  String chroot="/foo/bar3";
  String configName="testWithUploadDir";
  System.setProperty("bootstrap_conf","false");
  System.setProperty("bootstrap_confdir",home + "/collection1/conf");
  System.setProperty("collection.configName",configName);
  System.setProperty("zkHost",zkServer.getZkHost() + chroot);
  SolrZkClient zkClient=null;
  try {
    zkClient=new SolrZkClient(zkServer.getZkHost(),AbstractZkTestCase.TIMEOUT);
    assertFalse("Path '" + chroot + "' should not exist before the test",zkClient.exists(chroot,true));
    cores=CoreContainer.createAndLoad(home);
    assertTrue("solrconfig.xml should have been uploaded to zk to the correct config directory",zkClient.exists(chroot + ZkConfigManager.CONFIGS_ZKNODE + "/"+ configName+ "/solrconfig.xml",true));
  }
  finally {
    if (cores != null)     cores.shutdown();
    if (zkClient != null)     zkClient.close();
  }
}
