{
  try {
    this.folder=folder;
    this.batchSize=batchSize;
    SearchTerm st=getSearchTerm();
    if (st != null) {
      doBatching=false;
      messagesInCurBatch=folder.search(st);
      totalInFolder=messagesInCurBatch.length;
      folder.fetch(messagesInCurBatch,fp);
      current=0;
      LOG.info("Total messages : " + totalInFolder);
      LOG.info("Search criteria applied. Batching disabled");
    }
 else {
      totalInFolder=folder.getMessageCount();
      LOG.info("Total messages : " + totalInFolder);
      getNextBatch(batchSize,folder);
    }
  }
 catch (  MessagingException e) {
    throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"Message retreival failed",e);
  }
}
