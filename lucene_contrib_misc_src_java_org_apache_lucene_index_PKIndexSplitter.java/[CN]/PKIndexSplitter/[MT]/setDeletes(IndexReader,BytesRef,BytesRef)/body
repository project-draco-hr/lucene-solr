{
  OpenBitSet incl=new OpenBitSet(reader.maxDoc());
  Terms terms=MultiFields.getTerms(reader,midTerm.field());
  TermsEnum te=terms.iterator();
  if (startTerm != null) {
    te.seek(startTerm);
  }
  while (true) {
    final BytesRef term=te.next();
    if (term == null) {
      break;
    }
    if (endTermExcl != null && term.compareTo(endTermExcl) >= 0) {
      break;
    }
    DocsEnum docs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),midTerm.field(),term);
    while (true) {
      final int doc=docs.nextDoc();
      if (doc != DocsEnum.NO_MORE_DOCS) {
        incl.set(doc);
      }
 else       break;
    }
  }
  OpenBitSet dels=new OpenBitSet(reader.maxDoc());
  for (int x=0; x < reader.maxDoc(); x++) {
    if (!incl.get(x)) {
      dels.set(x);
    }
  }
  return dels;
}
