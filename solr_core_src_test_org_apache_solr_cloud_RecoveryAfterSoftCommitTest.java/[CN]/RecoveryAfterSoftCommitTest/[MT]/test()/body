{
  waitForRecoveriesToFinish(DEFAULT_COLLECTION,true);
  int i=0;
  for (; i < MAX_BUFFERED_DOCS + 1; i++) {
    SolrInputDocument document=new SolrInputDocument();
    document.addField("id",String.valueOf(i));
    document.addField("a_t","text_" + i);
    cloudClient.add(document);
  }
  AbstractUpdateRequest request=new UpdateRequest().setAction(AbstractUpdateRequest.ACTION.COMMIT,true,true,true);
  cloudClient.request(request);
  Replica notLeader=ensureAllReplicasAreActive(DEFAULT_COLLECTION,"shard1",1,2,30).get(0);
  SocketProxy proxy=getProxyForReplica(notLeader);
  proxy.close();
  int MAX_DOCS=2 + MAX_BUFFERED_DOCS + ULOG_NUM_RECORDS_TO_KEEP;
  for (; i < MAX_DOCS; i++) {
    SolrInputDocument document=new SolrInputDocument();
    document.addField("id",String.valueOf(i));
    document.addField("a_t","text_" + i);
    cloudClient.add(document);
  }
  Thread.sleep(2000L);
  proxy.reopen();
  List<Replica> notLeaders=ensureAllReplicasAreActive(DEFAULT_COLLECTION,"shard1",1,2,30);
}
