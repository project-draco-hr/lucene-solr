{
  List<CharsRef> stems=new ArrayList<CharsRef>();
  BytesRef scratch=new BytesRef();
  for (int i=0; i < length; i++) {
    List<Affix> suffixes=dictionary.lookupSuffix(word,i,length - i);
    if (suffixes == null) {
      continue;
    }
    for (    Affix suffix : suffixes) {
      if (hasCrossCheckedFlag(suffix.getFlag(),flags)) {
        int appendLength=length - i;
        int deAffixedLength=length - appendLength;
        dictionary.stripLookup.get(suffix.getStrip(),scratch);
        String strippedWord=new StringBuilder().append(word,0,deAffixedLength).append(scratch.utf8ToString()).toString();
        List<CharsRef> stemList=applyAffix(strippedWord.toCharArray(),strippedWord.length(),suffix,recursionDepth);
        stems.addAll(stemList);
      }
    }
  }
  for (int i=length - 1; i >= 0; i--) {
    List<Affix> prefixes=dictionary.lookupPrefix(word,0,i);
    if (prefixes == null) {
      continue;
    }
    for (    Affix prefix : prefixes) {
      if (hasCrossCheckedFlag(prefix.getFlag(),flags)) {
        int deAffixedStart=i;
        int deAffixedLength=length - deAffixedStart;
        dictionary.stripLookup.get(prefix.getStrip(),scratch);
        String strippedWord=new StringBuilder().append(scratch.utf8ToString()).append(word,deAffixedStart,deAffixedLength).toString();
        List<CharsRef> stemList=applyAffix(strippedWord.toCharArray(),strippedWord.length(),prefix,recursionDepth);
        stems.addAll(stemList);
      }
    }
  }
  return stems;
}
