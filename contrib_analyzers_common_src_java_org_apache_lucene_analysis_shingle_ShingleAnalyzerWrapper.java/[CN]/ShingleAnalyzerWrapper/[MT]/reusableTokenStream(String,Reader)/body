{
  if (overridesTokenStreamMethod) {
    return tokenStream(fieldName,reader);
  }
  SavedStreams streams=(SavedStreams)getPreviousTokenStream();
  if (streams == null) {
    streams=new SavedStreams();
    streams.wrapped=defaultAnalyzer.reusableTokenStream(fieldName,reader);
    streams.shingle=new ShingleFilter(streams.wrapped);
    setPreviousTokenStream(streams);
  }
 else {
    TokenStream result=defaultAnalyzer.reusableTokenStream(fieldName,reader);
    if (result == streams.wrapped) {
      streams.shingle.reset();
    }
 else {
      streams.wrapped=result;
      streams.shingle=new ShingleFilter(streams.wrapped);
    }
  }
  streams.shingle.setMaxShingleSize(maxShingleSize);
  streams.shingle.setOutputUnigrams(outputUnigrams);
  return streams.shingle;
}
