{
  String paramSetNames=req.getParams().get(ParamSet.TYPE);
  if (paramSetNames != null) {
    for (    String name : StrUtils.splitSmart(paramSetNames,',')) {
      ParamSet paramSet=req.getCore().getSolrConfig().getParamSets().get(name);
      if (paramSet != null) {
        if (paramSet.defaults != null)         defaults=SolrParams.wrapDefaults(SolrParams.toSolrParams(paramSet.defaults),defaults);
        if (paramSet.invariants != null)         invariants=SolrParams.wrapDefaults(invariants,SolrParams.toSolrParams(paramSet.invariants));
        if (paramSet.appends != null)         appends=SolrParams.wrapAppended(appends,SolrParams.toSolrParams(paramSet.appends));
      }
    }
  }
  SolrParams p=req.getParams();
  p=SolrParams.wrapDefaults(p,defaults);
  p=SolrParams.wrapAppended(p,appends);
  p=SolrParams.wrapDefaults(invariants,p);
  req.setParams(p);
}
