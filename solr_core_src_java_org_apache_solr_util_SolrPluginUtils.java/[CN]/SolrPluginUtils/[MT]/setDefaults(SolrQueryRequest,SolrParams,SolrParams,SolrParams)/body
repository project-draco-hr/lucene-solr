{
  List<String> paramNames=null;
  String useParams=req.getParams().get(RequestParams.USEPARAM);
  if (useParams != null && !useParams.isEmpty()) {
    req.setParams(SolrParams.wrapDefaults(maskUseParams,req.getParams()));
  }
  if (useParams == null)   useParams=(String)req.getContext().get(RequestParams.USEPARAM);
  if (useParams != null && !useParams.isEmpty())   paramNames=StrUtils.splitSmart(useParams,',');
  if (paramNames != null) {
    for (    String name : paramNames) {
      SolrParams requestParams=req.getCore().getSolrConfig().getRequestParams().getParams(name);
      if (requestParams != null) {
        defaults=SolrParams.wrapDefaults(requestParams,defaults);
      }
    }
  }
  SolrParams p=req.getParams();
  p=SolrParams.wrapDefaults(p,defaults);
  p=SolrParams.wrapAppended(p,appends);
  p=SolrParams.wrapDefaults(invariants,p);
  req.setParams(p);
}
