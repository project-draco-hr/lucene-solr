{
  String useParams=(String)req.getContext().get(USEPARAM);
  if (useParams != null) {
    RequestParams rp=req.getCore().getSolrConfig().getRequestParams();
    defaults=applyParamSet(rp,defaults,useParams,DEFAULTS);
    appends=applyParamSet(rp,appends,useParams,APPENDS);
    invariants=applyParamSet(rp,invariants,useParams,INVARIANTS);
  }
  useParams=req.getParams().get(USEPARAM);
  if (useParams != null && !useParams.isEmpty()) {
    RequestParams rp=req.getCore().getSolrConfig().getRequestParams();
    req.setParams(SolrParams.wrapDefaults(maskUseParams,req.getParams()));
    defaults=applyParamSet(rp,defaults,useParams,DEFAULTS);
    appends=applyParamSet(rp,appends,useParams,APPENDS);
    invariants=applyParamSet(rp,invariants,useParams,INVARIANTS);
  }
  RequestUtil.processParams(handler,req,defaults,appends,invariants);
}
