{
  try {
    DataImporter di=new DataImporter();
    di.loadAndInit(dc_singleEntity);
    DataConfig cfg=di.getConfig();
    DataConfig.Entity ent=cfg.document.entities.get(0);
    ent.isDocRoot=true;
    DataImporter.RequestParams rp=new DataImporter.RequestParams();
    rp.command="full-import";
    List l=new ArrayList();
    l.add(createMap("id",1,"desc","one"));
    l.add(createMap("id",2,"desc","two"));
    l.add(createMap("id",3,"desc","three"));
    MockDataSource.setIterator("select * from x",l.iterator());
    ent.dataSrc=new MockDataSource();
    SolrWriterImpl swi=new SolrWriterImpl();
    di.runCmd(rp,swi);
    Assert.assertEquals(Boolean.TRUE,swi.deleteAllCalled);
    Assert.assertEquals(Boolean.TRUE,swi.commitCalled);
    Assert.assertEquals(3,swi.docs.size());
    for (int i=0; i < l.size(); i++) {
      Map<String,Object> map=(Map<String,Object>)l.get(i);
      SolrInputDocument doc=swi.docs.get(i);
      for (      Map.Entry<String,Object> entry : map.entrySet()) {
        Assert.assertEquals(entry.getValue(),doc.getFieldValue(entry.getKey()));
      }
      Assert.assertEquals(map.get("desc"),doc.getFieldValue("desc_s"));
    }
    Assert.assertEquals(1,di.getDocBuilder().importStatistics.queryCount.get());
    Assert.assertEquals(3,di.getDocBuilder().importStatistics.docCount.get());
    Assert.assertEquals(3,di.getDocBuilder().importStatistics.rowsCount.get());
  }
  finally {
    MockDataSource.clearCache();
  }
}
