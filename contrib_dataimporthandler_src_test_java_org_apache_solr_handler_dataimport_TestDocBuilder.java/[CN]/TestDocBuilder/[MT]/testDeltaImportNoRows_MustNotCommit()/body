{
  try {
    DataImporter di=new DataImporter();
    di.loadAndInit(dc_deltaConfig);
    DataConfig cfg=di.getConfig();
    DataConfig.Entity ent=cfg.document.entities.get(0);
    MockDataSource.setIterator("select * from x",new ArrayList().iterator());
    MockDataSource.setIterator("select id from x",new ArrayList().iterator());
    ent.dataSrc=new MockDataSource();
    ent.isDocRoot=true;
    DataImporter.RequestParams rp=new DataImporter.RequestParams(createMap("command","delta-import"));
    SolrWriterImpl swi=new SolrWriterImpl();
    di.runCmd(rp,swi);
    Assert.assertEquals(Boolean.FALSE,swi.deleteAllCalled);
    Assert.assertEquals(Boolean.FALSE,swi.commitCalled);
    Assert.assertEquals(0,swi.docs.size());
    Assert.assertEquals(1,di.getDocBuilder().importStatistics.queryCount.get());
    Assert.assertEquals(0,di.getDocBuilder().importStatistics.docCount.get());
    Assert.assertEquals(0,di.getDocBuilder().importStatistics.rowsCount.get());
  }
  finally {
    MockDataSource.clearCache();
  }
}
