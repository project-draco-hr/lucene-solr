{
  Directory dir=new RAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
  for (int i=0; i < 11; i++) {
    addDoc(writer,"aaa");
  }
  writer.close();
  IndexReader reader=IndexReader.open(dir);
  boolean gotException=false;
  try {
    reader.deleteDocument(11);
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    gotException=true;
  }
  reader.close();
  writer=new IndexWriter(dir,new WhitespaceAnalyzer(),false);
  for (int i=0; i < 11; i++) {
    addDoc(writer,"aaa");
  }
  try {
    writer.optimize();
  }
 catch (  IllegalStateException e) {
    e.printStackTrace();
    fail("hit unexpected illegal state exception during optimize");
  }
  if (!gotException) {
    fail("delete of out-of-bounds doc number failed to hit exception");
  }
}
