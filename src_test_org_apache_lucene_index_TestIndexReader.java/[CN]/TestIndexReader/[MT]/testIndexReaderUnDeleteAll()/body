{
  MockRAMDirectory dir=new MockRAMDirectory();
  dir.setPreventDoubleWrite(false);
  IndexWriter writer=new IndexWriter(dir,new StandardAnalyzer(TEST_VERSION_CURRENT),IndexWriter.MaxFieldLength.UNLIMITED);
  writer.addDocument(createDocument("a"));
  writer.addDocument(createDocument("b"));
  writer.addDocument(createDocument("c"));
  writer.close();
  IndexReader reader=IndexReader.open(dir,false);
  reader.deleteDocuments(new Term("id","a"));
  reader.flush();
  reader.deleteDocuments(new Term("id","b"));
  reader.undeleteAll();
  reader.deleteDocuments(new Term("id","b"));
  reader.close();
  IndexReader.open(dir,true).close();
  dir.close();
}
