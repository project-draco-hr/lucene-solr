{
  RAMDirectory d=new RAMDirectory();
  IndexWriter writer=new IndexWriter(d,new StandardAnalyzer(),true);
  addDocumentWithFields(writer);
  writer.close();
  IndexReader reader=IndexReader.open(d);
  Collection fieldNames=reader.getFieldNames();
  assertTrue(fieldNames.contains("keyword"));
  assertTrue(fieldNames.contains("text"));
  assertTrue(fieldNames.contains("unindexed"));
  assertTrue(fieldNames.contains("unstored"));
  writer=new IndexWriter(d,new StandardAnalyzer(),false);
  for (int i=0; i < 5 * writer.getMergeFactor(); i++) {
    addDocumentWithFields(writer);
  }
  for (int i=0; i < 5 * writer.getMergeFactor(); i++) {
    addDocumentWithDifferentFields(writer);
  }
  writer.close();
  reader=IndexReader.open(d);
  fieldNames=reader.getFieldNames();
  assertEquals(8,fieldNames.size());
  assertTrue(fieldNames.contains("keyword"));
  assertTrue(fieldNames.contains("text"));
  assertTrue(fieldNames.contains("unindexed"));
  assertTrue(fieldNames.contains("unstored"));
  assertTrue(fieldNames.contains("keyword2"));
  assertTrue(fieldNames.contains("text2"));
  assertTrue(fieldNames.contains("unindexed2"));
  assertTrue(fieldNames.contains("unstored2"));
  Collection indexedFieldNames=reader.getFieldNames(true);
  assertEquals(6,indexedFieldNames.size());
  assertTrue(indexedFieldNames.contains("keyword"));
  assertTrue(indexedFieldNames.contains("text"));
  assertTrue(indexedFieldNames.contains("unstored"));
  assertTrue(indexedFieldNames.contains("keyword2"));
  assertTrue(indexedFieldNames.contains("text2"));
  assertTrue(indexedFieldNames.contains("unstored2"));
  Collection unindexedFieldNames=reader.getFieldNames(false);
  assertEquals(2,unindexedFieldNames.size());
  assertTrue(unindexedFieldNames.contains("unindexed"));
  assertTrue(unindexedFieldNames.contains("unindexed2"));
}
