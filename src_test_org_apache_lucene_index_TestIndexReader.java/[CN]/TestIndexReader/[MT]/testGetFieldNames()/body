{
  RAMDirectory d=new RAMDirectory();
  IndexWriter writer=new IndexWriter(d,new StandardAnalyzer(),true);
  addDocumentWithFields(writer);
  writer.close();
  IndexReader reader=IndexReader.open(d);
  Collection fieldNames=reader.getFieldNames();
  assertTrue(fieldNames.contains("keyword"));
  assertTrue(fieldNames.contains("text"));
  assertTrue(fieldNames.contains("unindexed"));
  assertTrue(fieldNames.contains("unstored"));
  writer=new IndexWriter(d,new StandardAnalyzer(),false);
  for (int i=0; i < 5 * writer.mergeFactor; i++) {
    addDocumentWithFields(writer);
  }
  for (int i=0; i < 5 * writer.mergeFactor; i++) {
    addDocumentWithDifferentFields(writer);
  }
  writer.close();
  reader=IndexReader.open(d);
  fieldNames=reader.getFieldNames();
  assertTrue(fieldNames.contains("keyword"));
  assertTrue(fieldNames.contains("text"));
  assertTrue(fieldNames.contains("unindexed"));
  assertTrue(fieldNames.contains("unstored"));
  assertTrue(fieldNames.contains("keyword2"));
  assertTrue(fieldNames.contains("text2"));
  assertTrue(fieldNames.contains("unindexed2"));
  assertTrue(fieldNames.contains("unstored2"));
}
