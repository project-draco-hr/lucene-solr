{
  Directory dir=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new StandardAnalyzer(TEST_VERSION_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  writer.setMaxBufferedDocs(2);
  writer.addDocument(createDocument("a"));
  writer.addDocument(createDocument("a"));
  writer.addDocument(createDocument("a"));
  writer.close();
  Collection<IndexCommit> commits=IndexReader.listCommits(dir);
  for (  final IndexCommit commit : commits) {
    Collection<String> files=commit.getFileNames();
    HashSet<String> seen=new HashSet<String>();
    for (    final String fileName : files) {
      assertTrue("file " + fileName + " was duplicated",!seen.contains(fileName));
      seen.add(fileName);
    }
  }
  dir.close();
}
