{
  Directory dir=new RAMDirectory();
  IndexWriter writer=null;
  IndexReader reader=null;
  Searcher searcher=null;
  Term searchTerm=new Term("content","aaa");
  Hits hits=null;
  try {
    writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
    for (int i=0; i < 100; i++) {
      addDoc(writer,"aaa");
    }
    writer.close();
    reader=IndexReader.open(dir);
    writer=new IndexWriter(dir,new WhitespaceAnalyzer(),false);
    for (int i=0; i < 100; i++) {
      addDoc(writer,"bbb");
    }
    writer.optimize();
    writer.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  try {
    reader.delete(searchTerm);
    reader.close();
  }
 catch (  IOException e) {
    try {
      reader.close();
      reader=IndexReader.open(dir);
      reader.delete(searchTerm);
      reader.close();
    }
 catch (    IOException e1) {
      e1.printStackTrace();
    }
  }
  try {
    searcher=new IndexSearcher(dir);
    hits=searcher.search(new TermQuery(searchTerm));
    assertEquals(0,hits.length());
    searcher.close();
  }
 catch (  IOException e1) {
    e1.printStackTrace();
  }
}
