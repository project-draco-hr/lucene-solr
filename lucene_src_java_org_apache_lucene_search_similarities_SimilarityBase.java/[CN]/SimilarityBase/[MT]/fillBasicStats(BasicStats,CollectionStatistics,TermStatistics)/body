{
  int numberOfDocuments=collectionStats.maxDoc();
  int docFreq=termStats.docFreq();
  long totalTermFreq=termStats.totalTermFreq();
  if (totalTermFreq == -1) {
    totalTermFreq=docFreq;
  }
  final long numberOfFieldTokens;
  final float avgFieldLength;
  long sumTotalTermFreq=collectionStats.sumTotalTermFreq();
  if (sumTotalTermFreq <= 0) {
    numberOfFieldTokens=docFreq;
    avgFieldLength=1;
  }
 else {
    numberOfFieldTokens=sumTotalTermFreq;
    avgFieldLength=(float)numberOfFieldTokens / numberOfDocuments;
  }
  stats.setNumberOfDocuments(numberOfDocuments);
  stats.setNumberOfFieldTokens(numberOfFieldTokens);
  stats.setAvgFieldLength(avgFieldLength);
  stats.setDocFreq(docFreq);
  stats.setTotalTermFreq(totalTermFreq);
}
