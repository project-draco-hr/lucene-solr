{
  IndexReader reader=searcher.getIndexReader();
  int numberOfDocuments=reader.maxDoc();
  int docFreq=termContext.docFreq();
  long totalTermFreq=termContext.totalTermFreq();
  if (totalTermFreq == -1) {
    totalTermFreq=docFreq;
  }
  final long numberOfFieldTokens;
  final float avgFieldLength;
  Terms terms=MultiFields.getTerms(searcher.getIndexReader(),fieldName);
  if (terms == null) {
    numberOfFieldTokens=0;
    avgFieldLength=1;
  }
 else {
    long sumTotalTermFreq=terms.getSumTotalTermFreq();
    if (sumTotalTermFreq == -1) {
      numberOfFieldTokens=docFreq;
      avgFieldLength=1;
    }
 else {
      numberOfFieldTokens=sumTotalTermFreq;
      avgFieldLength=(float)numberOfFieldTokens / numberOfDocuments;
    }
  }
  stats.setNumberOfDocuments(numberOfDocuments);
  stats.setNumberOfFieldTokens(numberOfFieldTokens);
  stats.setAvgFieldLength(avgFieldLength);
  stats.setDocFreq(docFreq);
  stats.setTotalTermFreq(totalTermFreq);
}
