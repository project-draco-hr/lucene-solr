{
  try (ZkConnection conn=new ZkConnection()){
    final SolrZkClient zkClient=conn.getClient();
    zkClient.makePath("/collections",true);
    final int numColls=random().nextInt(100);
    final CountDownLatch latch=new CountDownLatch(numColls);
    for (int i=1; i <= numColls; i++) {
      String collPath="/collections/collection" + i;
      zkClient.makePath(collPath,true);
      zkClient.getChildren(collPath,new Watcher(){
        @Override public void process(        WatchedEvent event){
          latch.countDown();
          try {
            Thread.sleep(1000);
          }
 catch (          InterruptedException e) {
          }
        }
      }
,true);
    }
    for (int i=1; i <= numColls; i++) {
      String shardsPath="/collections/collection" + i + "/shards";
      zkClient.makePath(shardsPath,true);
    }
    assertTrue(latch.await(1000,TimeUnit.MILLISECONDS));
  }
 }
