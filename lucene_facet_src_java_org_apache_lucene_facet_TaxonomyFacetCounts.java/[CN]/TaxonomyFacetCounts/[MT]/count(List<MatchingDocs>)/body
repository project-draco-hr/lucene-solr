{
  IntsRef scratch=new IntsRef();
  for (  MatchingDocs hits : matchingDocs) {
    OrdinalsReader.OrdinalsSegmentReader ords=ordinalsReader.getReader(hits.context);
    FixedBitSet bits=hits.bits;
    final int length=hits.bits.length();
    int doc=0;
    while (doc < length && (doc=bits.nextSetBit(doc)) != -1) {
      ords.get(doc,scratch);
      for (int i=0; i < scratch.length; i++) {
        counts[scratch.ints[scratch.offset + i]]++;
      }
      ++doc;
    }
  }
  for (  Map.Entry<String,FacetsConfig.DimConfig> ent : config.getDimConfigs().entrySet()) {
    String dim=ent.getKey();
    FacetsConfig.DimConfig ft=ent.getValue();
    if (ft.hierarchical && ft.multiValued == false) {
      int dimRootOrd=taxoReader.getOrdinal(new FacetLabel(dim));
      if (dimRootOrd > 0) {
        counts[dimRootOrd]+=rollup(children[dimRootOrd]);
      }
    }
  }
}
