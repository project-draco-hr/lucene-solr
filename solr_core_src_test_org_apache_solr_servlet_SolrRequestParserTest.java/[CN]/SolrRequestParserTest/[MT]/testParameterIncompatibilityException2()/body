{
  HttpServletRequest request=createMock(HttpServletRequest.class);
  expect(request.getMethod()).andReturn("POST").anyTimes();
  expect(request.getContentType()).andReturn("application/x-www-form-urlencoded").anyTimes();
  expect(request.getContentLength()).andReturn(100).anyTimes();
  expect(request.getQueryString()).andReturn(null).anyTimes();
  expect(request.getInputStream()).andThrow(new IllegalStateException());
  replay(request);
  FormDataRequestParser formdata=new FormDataRequestParser(2048);
  try {
    formdata.parseParamsAndFillStreams(request,new ArrayList<ContentStream>());
    fail("should throw SolrException");
  }
 catch (  SolrException solre) {
    assertTrue(solre.getMessage().startsWith("Solr requires that request parameters"));
    assertEquals(500,solre.code());
  }
}
