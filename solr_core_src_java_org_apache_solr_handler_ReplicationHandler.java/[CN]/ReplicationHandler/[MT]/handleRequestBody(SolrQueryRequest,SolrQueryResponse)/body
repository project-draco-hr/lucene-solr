{
  rsp.setHttpCaching(false);
  final SolrParams solrParams=req.getParams();
  String command=solrParams.get(COMMAND);
  if (command == null) {
    rsp.add(STATUS,OK_STATUS);
    rsp.add("message","No command");
    return;
  }
  if (command.equals(CMD_INDEX_VERSION)) {
    IndexCommit commitPoint=indexCommitPoint;
    if (commitPoint == null) {
      commitPoint=core.getDeletionPolicy().getLatestCommit();
    }
    if (commitPoint != null && replicationEnabled.get()) {
      core.getDeletionPolicy().setReserveDuration(commitPoint.getGeneration(),reserveCommitDuration);
      rsp.add(CMD_INDEX_VERSION,IndexDeletionPolicyWrapper.getCommitTimestamp(commitPoint));
      rsp.add(GENERATION,commitPoint.getGeneration());
    }
 else {
      rsp.add(CMD_INDEX_VERSION,0L);
      rsp.add(GENERATION,0L);
    }
  }
 else   if (command.equals(CMD_GET_FILE)) {
    getFileStream(solrParams,rsp);
  }
 else   if (command.equals(CMD_GET_FILE_LIST)) {
    getFileList(solrParams,rsp);
  }
 else   if (command.equalsIgnoreCase(CMD_BACKUP)) {
    doSnapShoot(new ModifiableSolrParams(solrParams),rsp,req);
    rsp.add(STATUS,OK_STATUS);
  }
 else   if (command.equalsIgnoreCase(CMD_DELETE_BACKUP)) {
    deleteSnapshot(new ModifiableSolrParams(solrParams));
    rsp.add(STATUS,OK_STATUS);
  }
 else   if (command.equalsIgnoreCase(CMD_FETCH_INDEX)) {
    String masterUrl=solrParams.get(MASTER_URL);
    if (!isSlave && masterUrl == null) {
      rsp.add(STATUS,ERR_STATUS);
      rsp.add("message","No slave configured or no 'masterUrl' Specified");
      return;
    }
    final SolrParams paramsCopy=new ModifiableSolrParams(solrParams);
    Thread puller=new Thread("explicit-fetchindex-cmd"){
      @Override public void run(){
        doFetch(paramsCopy,false);
      }
    }
;
    puller.setDaemon(false);
    puller.start();
    if (solrParams.getBool(WAIT,false)) {
      puller.join();
    }
    rsp.add(STATUS,OK_STATUS);
  }
 else   if (command.equalsIgnoreCase(CMD_DISABLE_POLL)) {
    if (snapPuller != null) {
      snapPuller.disablePoll();
      rsp.add(STATUS,OK_STATUS);
    }
 else {
      rsp.add(STATUS,ERR_STATUS);
      rsp.add("message","No slave configured");
    }
  }
 else   if (command.equalsIgnoreCase(CMD_ENABLE_POLL)) {
    if (snapPuller != null) {
      snapPuller.enablePoll();
      rsp.add(STATUS,OK_STATUS);
    }
 else {
      rsp.add(STATUS,ERR_STATUS);
      rsp.add("message","No slave configured");
    }
  }
 else   if (command.equalsIgnoreCase(CMD_ABORT_FETCH)) {
    SnapPuller temp=tempSnapPuller;
    if (temp != null) {
      temp.abortPull();
      rsp.add(STATUS,OK_STATUS);
    }
 else {
      rsp.add(STATUS,ERR_STATUS);
      rsp.add("message","No slave configured");
    }
  }
 else   if (command.equals(CMD_SHOW_COMMITS)) {
    rsp.add(CMD_SHOW_COMMITS,getCommits());
  }
 else   if (command.equals(CMD_DETAILS)) {
    rsp.add(CMD_DETAILS,getReplicationDetails(solrParams.getBool("slave",true)));
  }
 else   if (CMD_ENABLE_REPL.equalsIgnoreCase(command)) {
    replicationEnabled.set(true);
    rsp.add(STATUS,OK_STATUS);
  }
 else   if (CMD_DISABLE_REPL.equalsIgnoreCase(command)) {
    replicationEnabled.set(false);
    rsp.add(STATUS,OK_STATUS);
  }
}
