{
  if (restoreFuture != null && !restoreFuture.isDone()) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"Restore in progress. Cannot run multiple restore operations" + "for the same core");
  }
  String name=params.get(NAME);
  String location=params.get(LOCATION);
  if (location == null) {
    location=core.getDataDir();
  }
  if (name == null) {
    File[] files=new File(location).listFiles();
    List<OldBackupDirectory> dirs=new ArrayList<>();
    for (    File f : files) {
      OldBackupDirectory obd=new OldBackupDirectory(f);
      if (obd.dir != null) {
        dirs.add(obd);
      }
    }
    Collections.sort(dirs);
    if (dirs.size() == 0) {
      throw new SolrException(ErrorCode.BAD_REQUEST,"No backup name specified and none found in " + core.getDataDir());
    }
    name=dirs.get(0).dir.getName();
  }
 else {
    name="snapshot." + name;
  }
  RestoreCore restoreCore=new RestoreCore(core,location,name);
  restoreFuture=restoreExecutor.submit(restoreCore);
  currentRestoreName=name;
}
