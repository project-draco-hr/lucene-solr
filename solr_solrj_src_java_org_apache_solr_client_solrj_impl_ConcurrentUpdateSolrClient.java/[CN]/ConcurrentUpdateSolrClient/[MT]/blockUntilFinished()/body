{
  lock=new CountDownLatch(1);
  try {
synchronized (runners) {
      while (!runners.isEmpty()) {
        try {
          runners.wait();
        }
 catch (        InterruptedException e) {
          Thread.interrupted();
        }
        if (scheduler.isTerminated())         break;
        int queueSize=queue.size();
        if (queueSize > 0) {
          log.warn("No more runners, but queue still has " + queueSize + " adding more runners to process remaining requests on queue");
          Runner r=new Runner();
          runners.add(r);
          scheduler.execute(r);
        }
      }
    }
  }
  finally {
    lock.countDown();
    lock=null;
  }
}
