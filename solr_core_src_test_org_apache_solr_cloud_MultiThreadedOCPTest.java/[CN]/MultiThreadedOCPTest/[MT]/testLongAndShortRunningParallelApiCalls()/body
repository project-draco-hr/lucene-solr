{
  Thread indexThread=new Thread(){
    @Override public void run(){
      Random random=random();
      int max=atLeast(random,200);
      for (int id=101; id < max; id++) {
        try {
          doAddDoc(String.valueOf(id));
        }
 catch (        Exception e) {
          log.error("Exception while adding docs",e);
        }
      }
    }
  }
;
  indexThread.start();
  try (SolrClient client=createNewSolrClient("",getBaseUrl((HttpSolrClient)clients.get(0)))){
    SplitShard splitShardRequest=new SplitShard().setCollectionName("collection1").setShardName(SHARD1).setAsyncId("2000");
    splitShardRequest.process(client);
    String state=getRequestState("2000",client);
    while (state.equals("submitted")) {
      state=getRequestState("2000",client);
      Thread.sleep(10);
    }
    assertTrue("SplitShard task [2000] was supposed to be in [running] but isn't. It is [" + state + "]",state.equals("running"));
    ModifiableSolrParams params=new ModifiableSolrParams();
    params.set("action",CollectionParams.CollectionAction.CLUSTERSTATUS.toString());
    params.set("collection","collection1");
    SolrRequest request=new QueryRequest(params);
    request.setPath("/admin/collections");
    client.request(request);
    state=getRequestState("2000",client);
    assertTrue("After invoking OVERSEERSTATUS, SplitShard task [2000] was still supposed to be in [running] but isn't." + "It is [" + state + "]",state.equals("running"));
  }
  finally {
    try {
      indexThread.join();
    }
 catch (    InterruptedException e) {
      log.warn("Indexing thread interrupted.");
    }
  }
}
