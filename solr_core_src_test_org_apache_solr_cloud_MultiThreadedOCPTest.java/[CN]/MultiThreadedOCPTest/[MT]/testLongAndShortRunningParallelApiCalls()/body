{
  Thread indexThread=new Thread(){
    @Override public void run(){
      Random random=random();
      int max=atLeast(random,200);
      for (int id=101; id < max; id++) {
        try {
          doAddDoc(String.valueOf(id));
        }
 catch (        Exception e) {
          log.error("Exception while adding docs",e);
        }
      }
    }
  }
;
  indexThread.start();
  try {
    SolrServer server=createNewSolrServer("",getBaseUrl((HttpSolrServer)clients.get(0)));
    SplitShard splitShardRequest=new SplitShard();
    splitShardRequest.setCollectionName("collection1");
    splitShardRequest.setShardName(SHARD1);
    splitShardRequest.setAsyncId("2000");
    splitShardRequest.process(server);
    String state=getRequestState("2000",server);
    while (state.equals("submitted")) {
      state=getRequestState("2000",server);
      Thread.sleep(10);
    }
    assertTrue("SplitShard task [2000] was supposed to be in [running] but isn't. It is [" + state + "]",state.equals("running"));
    ModifiableSolrParams params=new ModifiableSolrParams();
    params.set("action",CollectionParams.CollectionAction.CLUSTERSTATUS.toString());
    params.set("collection","collection1");
    SolrRequest request=new QueryRequest(params);
    request.setPath("/admin/collections");
    server.request(request);
    state=getRequestState("2000",server);
    assertTrue("After invoking OVERSEERSTATUS, SplitShard task [2000] was still supposed to be in [running] but isn't." + "It is [" + state + "]",state.equals("running"));
  }
  finally {
    try {
      indexThread.join();
    }
 catch (    InterruptedException e) {
      log.warn("Indexing thread interrupted.");
    }
  }
}
