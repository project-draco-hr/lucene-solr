{
  String toColl="to_2x2";
  createCollection(toColl,2,2,2);
  ensureAllReplicasAreActive(toColl,"shard1",2,2,30);
  ensureAllReplicasAreActive(toColl,"shard2",2,2,30);
  Set<String> nodeSet=new HashSet<>();
  ClusterState cs=cloudClient.getZkStateReader().getClusterState();
  for (  Slice slice : cs.getActiveSlices(toColl))   for (  Replica replica : slice.getReplicas())   nodeSet.add(replica.getNodeName());
  assertTrue(nodeSet.size() > 0);
  String fromColl="from_1x2";
  createCollection(null,fromColl,1,nodeSet.size(),1,null,StringUtils.join(nodeSet,","));
  ensureAllReplicasAreActive(fromColl,"shard1",1,nodeSet.size(),30);
  Integer toDocId=indexDoc(toColl,1001,"a",null,"b");
  indexDoc(fromColl,2001,"a","c",null);
  Thread.sleep(1000);
  testJoins(toColl,fromColl,toDocId,false);
  testJoins(toColl,fromColl,toDocId,true);
  log.info("DistribJoinFromCollectionTest logic complete ... deleting the " + toColl + " and "+ fromColl+ " collections");
  for (  String c : new String[]{toColl,fromColl}) {
    try {
      CollectionAdminRequest.Delete req=new CollectionAdminRequest.Delete().setCollectionName(c);
      req.process(cloudClient);
    }
 catch (    Exception e) {
      log.warn("Could not delete collection {} after test completed due to: " + e,c);
    }
  }
  log.info("DistribJoinFromCollectionTest succeeded ... shutting down now!");
}
