{
  setupCore(coreDuplicate,true);
  File workDir=new File(solrHomeDirectory,coreDuplicate);
  File data=new File(workDir,"data");
  SolrQueryResponse resp=new SolrQueryResponse();
  admin.handleRequestBody(req(CoreAdminParams.ACTION,CoreAdminParams.CoreAdminAction.CREATE.toString(),CoreAdminParams.NAME,coreDuplicate,CoreAdminParams.INSTANCE_DIR,workDir.getAbsolutePath(),CoreAdminParams.CONFIG,"solrconfig_ren.xml",CoreAdminParams.SCHEMA,"schema_ren.xml",CoreAdminParams.DATA_DIR,data.getAbsolutePath()),resp);
  assertNull("Exception on create",resp.getException());
  SolrQueryResponse resp2=new SolrQueryResponse();
  try {
    admin.handleRequestBody(req(CoreAdminParams.ACTION,CoreAdminParams.CoreAdminAction.CREATE.toString(),CoreAdminParams.NAME,"different_name_core",CoreAdminParams.INSTANCE_DIR,workDir.getAbsolutePath(),CoreAdminParams.CONFIG,"solrconfig_ren.xml",CoreAdminParams.SCHEMA,"schema_ren.xml",CoreAdminParams.DATA_DIR,data.getAbsolutePath()),resp2);
    fail("Creating two cores with a shared instance dir should throw an exception");
  }
 catch (  SolrException e) {
    assertTrue(e.getMessage().contains("already defined there"));
  }
}
