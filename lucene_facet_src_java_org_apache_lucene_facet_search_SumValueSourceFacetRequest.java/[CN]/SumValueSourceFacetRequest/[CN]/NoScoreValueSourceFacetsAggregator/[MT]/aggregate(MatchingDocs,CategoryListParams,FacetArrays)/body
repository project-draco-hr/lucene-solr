{
  final CategoryListIterator cli=clp.createCategoryListIterator(0);
  if (!cli.setNextReader(matchingDocs.context)) {
    return;
  }
  final FunctionValues fvalues=valueSource.getValues(Collections.emptyMap(),matchingDocs.context);
  final int length=matchingDocs.bits.length();
  final float[] aggValues=facetArrays.getFloatArray();
  int doc=0;
  while (doc < length && (doc=matchingDocs.bits.nextSetBit(doc)) != -1) {
    cli.getOrdinals(doc,ordinals);
    final int upto=ordinals.offset + ordinals.length;
    float val=(float)fvalues.doubleVal(doc);
    for (int i=ordinals.offset; i < upto; i++) {
      aggValues[ordinals.ints[i]]+=val;
    }
    ++doc;
  }
}
