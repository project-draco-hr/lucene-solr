{
  Directory currentDir=newDirectory();
  RandomIndexWriter riw=new RandomIndexWriter(random(),currentDir);
  riw.addDocument(new Document());
  riw.close();
  DirectoryReader ir=DirectoryReader.open(currentDir);
  SegmentReader air=(SegmentReader)ir.leaves().get(0).reader();
  String currentVersion=air.getSegmentInfo().info.getVersion();
  assertNotNull(currentVersion);
  ir.close();
  currentDir.close();
  Comparator<String> comparator=StringHelper.getVersionComparator();
  for (  String name : oldNames) {
    Directory dir=oldIndexDirs.get(name);
    DirectoryReader r=DirectoryReader.open(dir);
    for (    AtomicReaderContext context : r.leaves()) {
      air=(SegmentReader)context.reader();
      String oldVersion=air.getSegmentInfo().info.getVersion();
      assertNotNull(oldVersion);
      assertTrue("current Constants.LUCENE_MAIN_VERSION is <= an old index: did you forget to bump it?!",comparator.compare(oldVersion,currentVersion) < 0);
    }
    r.close();
  }
}
