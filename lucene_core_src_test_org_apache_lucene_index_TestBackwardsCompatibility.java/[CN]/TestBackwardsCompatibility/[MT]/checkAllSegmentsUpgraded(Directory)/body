{
  final SegmentInfos infos=new SegmentInfos();
  infos.read(dir);
  if (VERBOSE) {
    System.out.println("checkAllSegmentsUpgraded: " + infos);
  }
  for (  SegmentInfoPerCommit si : infos) {
    assertEquals(Constants.LUCENE_MAIN_VERSION,si.info.getVersion());
  }
  return infos.size();
}
