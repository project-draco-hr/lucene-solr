{
  for (int i=0; i < unsupportedNames.length; i++) {
    if (VERBOSE) {
      System.out.println("TEST: index " + unsupportedNames[i]);
    }
    File oldIndxeDir=_TestUtil.getTempDir(unsupportedNames[i]);
    _TestUtil.unzip(getDataFile("unsupported." + unsupportedNames[i] + ".zip"),oldIndxeDir);
    MockDirectoryWrapper dir=newFSDirectory(oldIndxeDir);
    dir.setCheckIndexOnClose(false);
    IndexReader reader=null;
    IndexWriter writer=null;
    try {
      reader=DirectoryReader.open(dir);
      fail("DirectoryReader.open should not pass for " + unsupportedNames[i]);
    }
 catch (    IndexFormatTooOldException e) {
    }
 finally {
      if (reader != null)       reader.close();
      reader=null;
    }
    try {
      writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())));
      fail("IndexWriter creation should not pass for " + unsupportedNames[i]);
    }
 catch (    IndexFormatTooOldException e) {
      if (VERBOSE) {
        System.out.println("TEST: got expected exc:");
        e.printStackTrace(System.out);
      }
      assertTrue("got exc message: " + e.getMessage(),e.getMessage().indexOf("path=\"") != -1);
    }
 finally {
      if (writer != null) {
        writer.close(false);
      }
      writer=null;
    }
    ByteArrayOutputStream bos=new ByteArrayOutputStream(1024);
    CheckIndex checker=new CheckIndex(dir);
    checker.setInfoStream(new PrintStream(bos,false,"UTF-8"));
    CheckIndex.Status indexStatus=checker.checkIndex();
    assertFalse(indexStatus.clean);
    assertTrue(bos.toString("UTF-8").contains(IndexFormatTooOldException.class.getName()));
    dir.close();
    _TestUtil.rmDir(oldIndxeDir);
  }
}
