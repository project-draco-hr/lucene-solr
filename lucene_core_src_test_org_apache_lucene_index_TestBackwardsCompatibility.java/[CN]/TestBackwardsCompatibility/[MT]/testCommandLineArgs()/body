{
  for (  String name : oldIndexDirs.keySet()) {
    File dir=_TestUtil.getTempDir(name);
    File dataFile=new File(TestBackwardsCompatibility.class.getResource("index." + name + ".zip").toURI());
    _TestUtil.unzip(dataFile,dir);
    String path=dir.getAbsolutePath();
    List<String> args=new ArrayList<String>();
    if (random().nextBoolean()) {
      args.add("-verbose");
    }
    if (random().nextBoolean()) {
      args.add("-delete-prior-commits");
    }
    if (random().nextBoolean()) {
      Class<? extends FSDirectory> dirImpl=random().nextBoolean() ? SimpleFSDirectory.class : NIOFSDirectory.class;
      args.add("-dir-impl");
      args.add(dirImpl.getName());
    }
    args.add(path);
    IndexUpgrader upgrader=null;
    try {
      upgrader=IndexUpgrader.parseArgs(args.toArray(new String[0]));
    }
 catch (    Exception e) {
      throw new AssertionError("unable to parse args: " + args,e);
    }
    upgrader.upgrade();
    Directory upgradedDir=newFSDirectory(dir);
    try {
      checkAllSegmentsUpgraded(upgradedDir);
    }
  finally {
      upgradedDir.close();
    }
  }
}
