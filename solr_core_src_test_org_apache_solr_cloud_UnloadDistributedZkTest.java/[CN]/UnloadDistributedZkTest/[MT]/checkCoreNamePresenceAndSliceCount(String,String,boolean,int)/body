{
  final TimeOut timeout=new TimeOut(45,TimeUnit.SECONDS);
  Boolean isPresent=null;
  while (null == isPresent || shouldBePresent != isPresent.booleanValue()) {
    final Collection<Slice> slices=getCommonCloudSolrClient().getZkStateReader().getClusterState().getSlices(collectionName);
    if (timeout.hasTimedOut()) {
      printLayout();
      fail("checkCoreNamePresenceAndSliceCount failed:" + " collection=" + collectionName + " CoreName="+ coreName+ " shouldBePresent="+ shouldBePresent+ " isPresent="+ isPresent+ " expectedSliceCount="+ expectedSliceCount+ " actualSliceCount="+ slices.size());
    }
    if (expectedSliceCount == (slices == null ? 0 : slices.size())) {
      isPresent=false;
      if (slices != null) {
        for (        Slice slice : slices) {
          for (          Replica replica : slice.getReplicas()) {
            if (coreName.equals(replica.get("core"))) {
              isPresent=true;
            }
          }
        }
      }
    }
    Thread.sleep(1000);
  }
}
