{
  IndexOutput datOut=null;
  boolean success=false;
  try {
    datOut=dir.createOutput(IndexFileNames.segmentFileName(id,"",DATA_EXTENSION));
    CodecUtil.writeHeader(datOut,CODEC_NAME,VERSION_CURRENT);
    if (!started) {
      minValue=maxValue=0;
    }
    byte headerType=typeOrd;
    if (typeOrd == PACKED) {
      final long delta=maxValue - minValue;
      if (delta <= (maxValue >= 0 && minValue <= 0 ? Long.MAX_VALUE : Long.MAX_VALUE - 1) && delta >= 0) {
        writePackedInts(datOut,docCount);
        return;
      }
      headerType=FIXED_64;
    }
    datOut.writeByte(headerType);
    array.write(datOut,docCount);
    success=true;
  }
  finally {
    IOUtils.closeSafely(!success,datOut);
    array.clear();
  }
}
