{
  boolean cancelRecovery=false;
synchronized (this) {
    refCnt--;
    if (refCnt == 0) {
      if (closer != null) {
        closer.closeWriter(indexWriter);
      }
 else       if (indexWriter != null) {
        indexWriter.close();
      }
      directoryFactory.close();
      closed=true;
      cancelRecovery=true;
    }
  }
  if (cancelRecovery)   cancelRecovery();
}
