{
  String coreName=core.getName();
  refCntWriter=null;
  IndexWriter iw=indexWriter;
  indexWriter=null;
  if (iw != null) {
    if (!rollback) {
      try {
        log.info("Closing old IndexWriter... core=" + coreName);
        iw.close();
      }
 catch (      Exception e) {
        SolrException.log(log,"Error closing old IndexWriter. core=" + coreName,e);
      }
    }
 else {
      try {
        log.info("Rollback old IndexWriter... core=" + coreName);
        iw.rollback();
      }
 catch (      Exception e) {
        SolrException.log(log,"Error rolling back old IndexWriter. core=" + coreName,e);
      }
    }
  }
  if (openNewWriter) {
    indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2");
    log.info("New IndexWriter is ready to be used.");
  }
}
