{
  if (closed) {
    throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"SolrCoreState already closed");
  }
synchronized (writerPauseLock) {
    if (core == null) {
      if (refCntWriter != null)       refCntWriter.incref();
      return refCntWriter;
    }
    while (pauseWriter) {
      try {
        writerPauseLock.wait(100);
      }
 catch (      InterruptedException e) {
      }
      if (closed) {
        throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"Already closed");
      }
    }
    if (indexWriter == null) {
      indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2",false);
    }
    initRefCntWriter();
    writerFree=false;
    writerPauseLock.notifyAll();
    refCntWriter.incref();
    return refCntWriter;
  }
}
