{
synchronized (writerPauseLock) {
    if (core == null) {
      if (refCntWriter != null)       refCntWriter.incref();
      return refCntWriter;
    }
    while (pauseWriter) {
      try {
        writerPauseLock.wait();
      }
 catch (      InterruptedException e) {
      }
    }
    if (indexWriter == null) {
      indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2",false,false);
    }
    if (refCntWriter == null) {
      refCntWriter=new RefCounted<IndexWriter>(indexWriter){
        @Override public void close(){
synchronized (writerPauseLock) {
            writerFree=true;
            writerPauseLock.notifyAll();
          }
        }
      }
;
    }
    writerFree=false;
    writerPauseLock.notifyAll();
    refCntWriter.incref();
    return refCntWriter;
  }
}
