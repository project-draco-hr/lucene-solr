{
  if (core == null) {
    if (refCntWriter != null)     refCntWriter.incref();
    return refCntWriter;
  }
  while (pauseWriter) {
    try {
      wait();
    }
 catch (    InterruptedException e) {
    }
  }
  if (indexWriter == null) {
    indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2",false,false);
  }
  if (refCntWriter == null) {
    refCntWriter=new RefCounted<IndexWriter>(indexWriter){
      @Override public void close(){
synchronized (DefaultSolrCoreState.this) {
          writerFree=true;
          DefaultSolrCoreState.this.notifyAll();
        }
      }
    }
;
  }
  writerFree=false;
  notifyAll();
  refCntWriter.incref();
  return refCntWriter;
}
