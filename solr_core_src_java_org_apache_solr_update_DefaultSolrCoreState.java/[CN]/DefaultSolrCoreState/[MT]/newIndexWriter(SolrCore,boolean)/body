{
  log.info("Creating new IndexWriter...");
  String coreName=core.getName();
synchronized (writerPauseLock) {
    pauseWriter=true;
    log.info("Waiting until IndexWriter is unused... core=" + coreName);
    while (!writerFree) {
      try {
        writerPauseLock.wait();
      }
 catch (      InterruptedException e) {
      }
    }
    try {
      if (indexWriter != null) {
        if (!rollback) {
          try {
            log.info("Closing old IndexWriter... core=" + coreName);
            indexWriter.close();
          }
 catch (          Throwable t) {
            SolrException.log(log,"Error closing old IndexWriter. core=" + coreName,t);
          }
        }
 else {
          try {
            log.info("Rollback old IndexWriter... core=" + coreName);
            indexWriter.rollback();
          }
 catch (          Throwable t) {
            SolrException.log(log,"Error rolling back old IndexWriter. core=" + coreName,t);
          }
        }
      }
      indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2",true);
      log.info("New IndexWriter is ready to be used.");
      refCntWriter=null;
    }
  finally {
      pauseWriter=false;
      writerPauseLock.notifyAll();
    }
  }
}
