{
  log.info("Creating new IndexWriter...");
  String coreName=core.getName();
synchronized (writerPauseLock) {
    pauseWriter=true;
    log.info("Waiting until IndexWriter is unused... core=" + coreName);
    while (!writerFree) {
      try {
        writerPauseLock.wait();
      }
 catch (      InterruptedException e) {
      }
    }
    try {
      if (indexWriter != null) {
        try {
          log.info("Closing old IndexWriter... core=" + coreName);
          indexWriter.close();
        }
 catch (        Throwable t) {
          SolrException.log(log,"Error closing old IndexWriter. core=" + coreName,t);
        }
      }
      indexWriter=createMainIndexWriter(core,"DirectUpdateHandler2",false,true);
      log.info("New IndexWriter is ready to be used.");
      refCntWriter=null;
    }
  finally {
      pauseWriter=false;
      writerPauseLock.notifyAll();
    }
  }
}
