{
  boolean acquired=false;
  do {
    try {
      acquired=lock.tryLock(100,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      log.warn("WARNING - Dangerous interrupt",e);
    }
    if (closed) {
      if (acquired) {
        lock.unlock();
      }
      throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"SolrCoreState already closed.");
    }
  }
 while (!acquired);
}
