{
  final Object readerKey=reader.getCoreCacheKey();
synchronized (readerCache) {
    Map<Entry,Object> innerCache=readerCache.get(readerKey);
    if (innerCache == null) {
      innerCache=new HashMap<Entry,Object>();
      readerCache.put(readerKey,innerCache);
      if (reader instanceof SegmentReader) {
        ((SegmentReader)reader).addCoreClosedListener(purgeCore);
      }
 else {
        reader.addReaderClosedListener(new IndexReader.ReaderClosedListener(){
          @Override public void onClose(          IndexReader reader){
            FieldCache.DEFAULT.purge(reader);
          }
        }
);
      }
    }
    if (innerCache.get(key) == null) {
      innerCache.put(key,value);
    }
 else {
    }
  }
}
