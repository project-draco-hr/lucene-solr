{
  if (reader instanceof SegmentReader) {
    ((SegmentReader)reader).addCoreClosedListener(purgeCore);
  }
 else {
    Object key=reader.getCoreCacheKey();
    if (key instanceof AtomicIndexReader) {
      ((AtomicIndexReader)key).addReaderClosedListener(purgeReader);
    }
 else {
      reader.addReaderClosedListener(purgeReader);
    }
  }
}
