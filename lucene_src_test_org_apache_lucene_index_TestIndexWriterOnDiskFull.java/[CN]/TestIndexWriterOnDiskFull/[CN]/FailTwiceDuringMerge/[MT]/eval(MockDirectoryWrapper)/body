{
  if (!doFail) {
    return;
  }
  StackTraceElement[] trace=new Exception().getStackTrace();
  for (int i=0; i < trace.length; i++) {
    if ("org.apache.lucene.index.SegmentMerger".equals(trace[i].getClassName()) && "mergeTerms".equals(trace[i].getMethodName()) && !didFail1) {
      didFail1=true;
      throw new IOException("fake disk full during mergeTerms");
    }
    if ("org.apache.lucene.util.BitVector".equals(trace[i].getClassName()) && "write".equals(trace[i].getMethodName()) && !didFail2) {
      didFail2=true;
      throw new IOException("fake disk full while writing BitVector");
    }
  }
}
