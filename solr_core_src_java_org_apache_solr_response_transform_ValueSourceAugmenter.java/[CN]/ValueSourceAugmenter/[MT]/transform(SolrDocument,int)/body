{
  try {
    int idx=ReaderUtil.subIndex(docid,readerContexts);
    IndexReader.AtomicReaderContext rcontext=readerContexts[idx];
    FunctionValues values=docValuesArr[idx];
    if (values == null) {
      docValuesArr[idx]=values=valueSource.getValues(fcontext,rcontext);
    }
    int localId=docid - rcontext.docBase;
    Object val=values.objectVal(localId);
    if (val != null) {
      doc.setField(name,val);
    }
  }
 catch (  IOException e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"exception at docid " + docid + " for valuesource "+ valueSource,e);
  }
}
