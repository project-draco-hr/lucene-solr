{
  if (mode == STANDARD) {
    return new Highlighter(formatter,new QueryScorer(query));
  }
 else   if (mode == SPAN) {
    CachingTokenFilter tokenStream=new CachingTokenFilter(stream);
    Highlighter highlighter;
    try {
      highlighter=new Highlighter(formatter,new SpanScorer(query,fieldName,tokenStream));
      tokenStream.reset();
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
    return highlighter;
  }
 else {
    throw new RuntimeException("Unknown highlight mode");
  }
}
