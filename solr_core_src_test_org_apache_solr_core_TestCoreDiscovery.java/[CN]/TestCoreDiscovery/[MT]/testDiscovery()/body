{
  setMeUp();
  addCoreWithProps("core1",makeCorePropFile("core1",false,true,"dataDir=core1"));
  addCoreWithProps("core2",makeCorePropFile("core2",false,false,"dataDir=core2"));
  addCoreWithProps("lazy1",makeCorePropFile("lazy1",true,false,"dataDir=lazy1"));
  CoreContainer cc=init();
  try {
    TestLazyCores.checkInCores(cc,"core1");
    TestLazyCores.checkNotInCores(cc,"lazy1","core2","collection1");
    try (SolrCore core1=cc.getCore("core1");SolrCore core2=cc.getCore("core2");SolrCore lazy1=cc.getCore("lazy1")){
      CoreDescriptor desc=core1.getCoreDescriptor();
      assertEquals("core1",desc.getName());
      assertNotNull(desc.getInstanceDir());
      assertFalse("InstanceDir should be ignored",desc.getInstanceDir().contains("totallybogus"));
      assertEquals("core1",desc.getDataDir());
      assertEquals("solrconfig-minimal.xml",desc.getConfigName());
      assertEquals("schema-tiny.xml",desc.getSchemaName());
      TestLazyCores.checkInCores(cc,"core1","core2","lazy1");
    }
   }
  finally {
    cc.shutdown();
  }
}
