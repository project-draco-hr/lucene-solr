{
synchronized (this) {
    long pos=-1;
    if ((cmd.getFlags() & UpdateCommand.REPLAY) == 0) {
      ensureLog();
      pos=tlog.writeDeleteByQuery(cmd,operationFlags);
    }
    if ((cmd.getFlags() & UpdateCommand.BUFFERING) == 0) {
      openRealtimeSearcher();
      trackDeleteByQuery(cmd.getQuery(),cmd.getVersion());
      if (trace) {
        LogPtr ptr=new LogPtr(pos,cmd.getVersion());
        log.trace("TLOG: added deleteByQuery " + cmd.query + " to "+ tlog+ " "+ ptr+ " map="+ System.identityHashCode(map));
      }
    }
  }
}
