{
  versionInfo.blockUpdates();
  try {
    if (state == State.BUFFERING) {
      log.info("Restarting buffering. previous=" + recoveryInfo);
    }
 else     if (state != State.ACTIVE) {
      log.warn("Unexpected state for bufferUpdates: " + state + ", Ignoring request.");
      return;
    }
    recoveryInfo=new RecoveryInfo();
    if (log.isInfoEnabled()) {
      log.info("Starting to buffer updates. " + this);
    }
synchronized (this) {
      recoveryInfo.positionOfStart=tlog == null ? 0 : tlog.snapshot();
    }
    state=State.BUFFERING;
    operationFlags|=FLAG_GAP;
  }
  finally {
    versionInfo.unblockUpdates();
  }
}
