{
  if (dataDir == null || dataDir.length() == 0) {
    dataDir=core.getDataDir();
  }
  this.uhandler=uhandler;
  if (dataDir.equals(lastDataDir)) {
    if (debug) {
      log.debug("UpdateHandler init: tlogDir=" + tlogDir + ", next id="+ id," this is a reopen... nothing else to do.");
    }
    return;
  }
  lastDataDir=dataDir;
  tlogDir=new File(dataDir,TLOG_NAME);
  tlogDir.mkdirs();
  tlogFiles=getLogList(tlogDir);
  id=getLastLogId() + 1;
  if (debug) {
    log.debug("UpdateHandler init: tlogDir=" + tlogDir + ", existing tlogs="+ Arrays.asList(tlogFiles)+ ", next id="+ id);
  }
  TransactionLog oldLog=null;
  for (  String oldLogName : tlogFiles) {
    File f=new File(tlogDir,oldLogName);
    try {
      oldLog=new TransactionLog(f,null,true);
      addOldLog(oldLog);
    }
 catch (    Exception e) {
      SolrException.log(log,"Failure to open existing log file (non fatal) " + f,e);
      f.delete();
    }
  }
  newestLogOnStartup=oldLog;
  versionInfo=new VersionInfo(uhandler,256);
}
