{
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(10));
  for (int j=0; j < nDocs; j++) {
    Document d=new Document();
    int nFields=random.nextInt(maxFields);
    for (int i=0; i < nFields; i++) {
      int flen=random.nextInt(maxFieldLen);
      StringBuilder sb=new StringBuilder("^ ");
      while (sb.length() < flen)       sb.append(' ').append(words[random.nextInt(words.length)]);
      sb.append(" $");
      Field.Store store=Field.Store.YES;
      Field.Index index=Field.Index.ANALYZED;
      d.add(newField("f" + i,sb.toString(),store,index));
    }
    iw.addDocument(d);
  }
  iw.close();
}
