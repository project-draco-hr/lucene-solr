{
  IndexWriter modifier=new IndexWriter(directory,ANALYZER,true);
  IndexerThread indexerThread=new IndexerThread(modifier);
  indexerThread.start();
  IndexerThread indexerThread2=new IndexerThread(modifier);
  indexerThread2.start();
  SearcherThread searcherThread1=new SearcherThread(directory);
  searcherThread1.start();
  SearcherThread searcherThread2=new SearcherThread(directory);
  searcherThread2.start();
  indexerThread.join();
  indexerThread2.join();
  searcherThread1.join();
  searcherThread2.join();
  modifier.close();
  assertTrue("hit unexpected exception in indexer",!indexerThread.failed);
  assertTrue("hit unexpected exception in indexer2",!indexerThread2.failed);
  assertTrue("hit unexpected exception in search1",!searcherThread1.failed);
  assertTrue("hit unexpected exception in search2",!searcherThread2.failed);
}
