{
  IndexWriter modifier=new IndexWriter(directory,ANALYZER,true,IndexWriter.MaxFieldLength.UNLIMITED);
  modifier.setMaxBufferedDocs(10);
  TimedThread[] threads=new TimedThread[4];
  int numThread=0;
  if (mergeScheduler != null)   modifier.setMergeScheduler(mergeScheduler);
  IndexerThread indexerThread=new IndexerThread(modifier,threads);
  threads[numThread++]=indexerThread;
  indexerThread.start();
  IndexerThread indexerThread2=new IndexerThread(modifier,threads);
  threads[numThread++]=indexerThread2;
  indexerThread2.start();
  SearcherThread searcherThread1=new SearcherThread(directory,threads);
  threads[numThread++]=searcherThread1;
  searcherThread1.start();
  SearcherThread searcherThread2=new SearcherThread(directory,threads);
  threads[numThread++]=searcherThread2;
  searcherThread2.start();
  for (int i=0; i < numThread; i++)   threads[i].join();
  modifier.close();
  for (int i=0; i < numThread; i++)   assertTrue(!((TimedThread)threads[i]).failed);
}
