{
  this.cc=cc;
  if (cc == null || !cc.isZooKeeperAware()) {
    return this;
  }
  String myNodeName=getNodeName();
  ClusterState state=cc.getZkController().getClusterState();
  for (  CloudDescriptor cloudDescriptor : getCloudDescriptors()) {
    String coll=cloudDescriptor.getCollectionName();
    String sliceName=getShardName(cloudDescriptor);
    if (shardsVsReplicaCounts.containsKey(sliceName))     continue;
    CountsForEachShard c=new CountsForEachShard(0,0,0);
    for (    Replica replica : getReplicas(state,coll,cloudDescriptor.getShardId())) {
      if (replica.getNodeName().equals(myNodeName)) {
        c.myReplicas++;
      }
 else {
        Set<String> liveNodes=state.getLiveNodes();
        if (liveNodes.contains(replica.getNodeName())) {
          c.totalReplicasInLiveNodes++;
        }
 else {
          c.totalReplicasInDownNodes++;
        }
      }
    }
    shardsVsReplicaCounts.put(sliceName,c);
  }
  return this;
}
