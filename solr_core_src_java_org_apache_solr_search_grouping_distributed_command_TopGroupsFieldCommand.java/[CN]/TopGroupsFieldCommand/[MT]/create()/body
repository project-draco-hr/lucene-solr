{
  if (firstPhaseGroups.isEmpty()) {
    return Collections.emptyList();
  }
  final List<Collector> collectors=new ArrayList<>(1);
  final FieldType fieldType=field.getType();
  if (fieldType.getNumericType() != null) {
    ValueSource vs=fieldType.getValueSource(field,null);
    Collection<SearchGroup<MutableValue>> v=GroupConverter.toMutable(field,firstPhaseGroups);
    secondPassCollector=new FunctionSecondPassGroupingCollector(v,groupSort,sortWithinGroup,maxDocPerGroup,needScores,needMaxScore,true,vs,new HashMap<Object,Object>());
  }
 else {
    secondPassCollector=new TermSecondPassGroupingCollector(field.getName(),firstPhaseGroups,groupSort,sortWithinGroup,maxDocPerGroup,needScores,needMaxScore,true);
  }
  collectors.add(secondPassCollector);
  return collectors;
}
