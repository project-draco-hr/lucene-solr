{
  File data=new File(dataDir + File.separator + "data_"+ port);
  data.mkdirs();
  System.setProperty("hostPort",Integer.toString(port));
  System.setProperty("shard",shard);
  Initializer init=new CoreContainer.Initializer();
  System.setProperty("solr.data.dir",data.getAbsolutePath());
  System.setProperty("solr.solr.home",TEST_HOME());
  Set<Integer> ports=shardPorts.get(shard);
  if (ports == null) {
    ports=new HashSet<Integer>();
    shardPorts.put(shard,ports);
  }
  ports.add(port);
  CoreContainer container=init.initialize();
  assertTrue("Container " + port + " has no cores!",container.getCores().size() > 0);
  containerMap.put(port,container);
  System.clearProperty("solr.solr.home");
  System.clearProperty("hostPort");
}
