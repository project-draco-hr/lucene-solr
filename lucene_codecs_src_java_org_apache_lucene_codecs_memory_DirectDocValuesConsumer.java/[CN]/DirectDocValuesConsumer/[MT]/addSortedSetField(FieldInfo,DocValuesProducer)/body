{
  Iterable<BytesRef> values=LegacyDocValuesIterables.valuesIterable(valuesProducer.getSortedSet(field));
  Iterable<Number> docToOrdCount=LegacyDocValuesIterables.sortedSetOrdCountIterable(valuesProducer,field,maxDoc);
  Iterable<Number> ords=LegacyDocValuesIterables.sortedSetOrdsIterable(valuesProducer,field);
  meta.writeVInt(field.number);
  if (isSingleValued(docToOrdCount)) {
    meta.writeByte(SORTED_SET_SINGLETON);
    addNumericFieldValues(field,singletonView(docToOrdCount,ords,-1L));
    addBinaryFieldValues(field,values);
  }
 else {
    meta.writeByte(SORTED_SET);
    addNumericFieldValues(field,countToAddressIterator(docToOrdCount));
    addNumericFieldValues(field,ords);
    addBinaryFieldValues(field,values);
  }
}
