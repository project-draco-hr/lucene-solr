{
  ensureOpen();
  boolean hasEvents=false;
  if (flushControl.anyStalledThreads() || flushControl.numQueuedFlushes() > 0) {
    if (infoStream.isEnabled("DW")) {
      infoStream.message("DW","DocumentsWriter has queued dwpt; will hijack this thread to flush pending segment(s)");
    }
    do {
      DocumentsWriterPerThread flushingDWPT;
      while ((flushingDWPT=flushControl.nextPendingFlush()) != null) {
        hasEvents|=doFlush(flushingDWPT);
      }
      if (infoStream.isEnabled("DW") && flushControl.anyStalledThreads()) {
        infoStream.message("DW","WARNING DocumentsWriter has stalled threads; waiting");
      }
      flushControl.waitIfStalled();
    }
 while (flushControl.numQueuedFlushes() != 0);
    if (infoStream.isEnabled("DW")) {
      infoStream.message("DW","continue indexing after helping out flushing DocumentsWriter is healthy");
    }
  }
  return hasEvents;
}
