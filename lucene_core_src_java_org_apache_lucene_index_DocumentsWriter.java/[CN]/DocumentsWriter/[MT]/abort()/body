{
  boolean success=false;
  try {
    deleteQueue.clear();
    if (infoStream.isEnabled("DW")) {
      infoStream.message("DW","abort");
    }
    final int limit=perThreadPool.getActiveThreadState();
    for (int i=0; i < limit; i++) {
      final ThreadState perThread=perThreadPool.getThreadState(i);
      perThread.lock();
      try {
        if (perThread.isActive()) {
          try {
            perThread.dwpt.abort();
          }
  finally {
            perThread.dwpt.checkAndResetHasAborted();
            flushControl.doOnAbort(perThread);
          }
        }
 else {
          assert closed;
        }
      }
  finally {
        perThread.unlock();
      }
    }
    flushControl.abortPendingFlushes();
    flushControl.waitForFlush();
    success=true;
  }
  finally {
    if (infoStream.isEnabled("DW")) {
      infoStream.message("DW","done abort; abortedFiles=" + abortedFiles + " success="+ success);
    }
  }
}
