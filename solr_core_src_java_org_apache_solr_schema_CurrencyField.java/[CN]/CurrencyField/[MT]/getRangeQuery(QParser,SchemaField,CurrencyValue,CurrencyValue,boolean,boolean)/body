{
  String currencyCode=(p1 != null) ? p1.getCurrencyCode() : (p2 != null) ? p2.getCurrencyCode() : defaultCurrency;
  final Filter docsWithValues=new QueryWrapperFilter(new FieldValueQuery(getAmountField(field).getName()));
  final Filter vsRangeFilter=new ValueSourceRangeFilter(new RawCurrencyValueSource(field,currencyCode,parser),p1 == null ? null : p1.getAmount() + "",p2 == null ? null : p2.getAmount() + "",minInclusive,maxInclusive);
  final BooleanFilter docsInRange=new BooleanFilter();
  docsInRange.add(docsWithValues,Occur.MUST);
  docsInRange.add(vsRangeFilter,Occur.MUST);
  return new SolrConstantScoreQuery(docsInRange);
}
