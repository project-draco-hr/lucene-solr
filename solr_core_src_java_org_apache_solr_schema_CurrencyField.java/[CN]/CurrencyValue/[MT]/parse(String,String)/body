{
  String amount=externalVal;
  String code=defaultCurrency;
  if (externalVal.contains(",")) {
    String[] amountAndCode=externalVal.split(",");
    amount=amountAndCode[0];
    code=amountAndCode[1];
  }
  Currency currency=java.util.Currency.getInstance(code);
  if (currency == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Invalid currency code " + code);
  }
  try {
    double value=Double.parseDouble(amount);
    long currencyValue=Math.round(value * Math.pow(10.0,currency.getDefaultFractionDigits()));
    return new CurrencyValue(currencyValue,code);
  }
 catch (  NumberFormatException e) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,e);
  }
}
