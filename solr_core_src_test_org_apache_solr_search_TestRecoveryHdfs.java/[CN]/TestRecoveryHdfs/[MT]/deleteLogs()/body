{
  String logDir=h.getCore().getUpdateHandler().getUpdateLog().getLogDir();
  Configuration conf=new Configuration();
  conf.setBoolean("fs.hdfs.impl.disable.cache",true);
  FileSystem fs;
  try {
    URI uri=new URI(hdfsUri);
    fs=FileSystem.newInstance(uri,conf);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
catch (  URISyntaxException e) {
    throw new RuntimeException(e);
  }
  h.close();
  try {
    String[] files=HdfsUpdateLog.getLogList(fs,new Path(logDir));
    for (    String file : files) {
      fs.delete(new Path(logDir,file),false);
    }
    assertEquals(0,HdfsUpdateLog.getLogList(fs,new Path(logDir)).length);
  }
  finally {
    createCore();
    assertJQ(req("q","*:*"),"/response/numFound==");
  }
}
