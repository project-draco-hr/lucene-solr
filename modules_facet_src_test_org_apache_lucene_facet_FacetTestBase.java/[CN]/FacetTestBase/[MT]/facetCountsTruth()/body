{
  FacetIndexingParams iParams=getFacetIndexingParams(Integer.MAX_VALUE);
  String delim=String.valueOf(iParams.getFacetDelimChar());
  Map<CategoryPath,Integer> res=new HashMap<CategoryPath,Integer>();
  HashSet<Term> handledTerms=new HashSet<Term>();
  for (  CategoryListParams clp : iParams.getAllCategoryListParams()) {
    Term baseTerm=new Term(clp.getTerm().field());
    if (!handledTerms.add(baseTerm)) {
      continue;
    }
    Terms terms=MultiFields.getTerms(indexReader,baseTerm.field());
    if (terms == null) {
      continue;
    }
    Bits deletedDocs=MultiFields.getDeletedDocs(indexReader);
    TermsEnum te=terms.iterator();
    DocsEnum de=null;
    while (te.next() != null) {
      de=te.docs(deletedDocs,de);
      int cnt=0;
      while (de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS) {
        cnt++;
      }
      res.put(new CategoryPath(te.term().utf8ToString().split(delim)),cnt);
    }
  }
  return res;
}
