{
  if (VERBOSE) {
    System.out.println("Partition Size: " + partitionSize + "  onDisk: "+ onDisk);
  }
  if (onDisk) {
    File indexFile=_TestUtil.getTempDir("index");
    indexDir=newFSDirectory(indexFile);
    taxoDir=newFSDirectory(new File(indexFile,"facets"));
  }
 else {
    indexDir=newDirectory();
    taxoDir=newDirectory();
  }
  RandomIndexWriter iw=new RandomIndexWriter(random,indexDir,getIndexWriterConfig(getAnalyzer()));
  TaxonomyWriter taxo=new DirectoryTaxonomyWriter(taxoDir,OpenMode.CREATE);
  populateIndex(iw,taxo,getFacetIndexingParams(partitionSize));
  taxo.commit();
  iw.commit();
  taxo.close();
  iw.close();
  taxoReader=new DirectoryTaxonomyReader(taxoDir);
  indexReader=IndexReader.open(indexDir);
  searcher=newSearcher(indexReader);
}
