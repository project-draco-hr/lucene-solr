{
  if (VERBOSE) {
    System.out.println("Partition Size: " + partitionSize + "  forceDisk: "+ forceDisk);
  }
  SearchTaxoDirPair pair=dirsPerPartitionSize.get(Integer.valueOf(partitionSize));
  if (pair == null) {
    pair=new SearchTaxoDirPair();
    if (forceDisk) {
      pair.searchDir=newFSDirectory(new File(TEST_DIR,"index"));
      pair.taxoDir=newFSDirectory(new File(TEST_DIR,"taxo"));
    }
 else {
      pair.searchDir=newDirectory();
      pair.taxoDir=newDirectory();
    }
    RandomIndexWriter iw=new RandomIndexWriter(random,pair.searchDir,getIndexWriterConfig(getAnalyzer()));
    TaxonomyWriter taxo=new DirectoryTaxonomyWriter(pair.taxoDir,OpenMode.CREATE);
    populateIndex(iw,taxo,getFacetIndexingParams(partitionSize));
    taxo.commit();
    iw.commit();
    taxo.close();
    iw.close();
    dirsPerPartitionSize.put(Integer.valueOf(partitionSize),pair);
  }
  taxoReader=new DirectoryTaxonomyReader(pair.taxoDir);
  indexReader=IndexReader.open(pair.searchDir);
  searcher=newSearcher(indexReader);
}
