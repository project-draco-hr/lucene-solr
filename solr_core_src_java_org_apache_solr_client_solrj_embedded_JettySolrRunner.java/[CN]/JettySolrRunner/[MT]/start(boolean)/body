{
  if (startedBefore) {
    waitOnSolr=false;
    init(lastPort);
  }
 else {
    startedBefore=true;
  }
  if (dataDir != null) {
    System.setProperty("solr.data.dir",dataDir);
  }
  if (solrUlogDir != null) {
    System.setProperty("solr.ulog.dir",solrUlogDir);
  }
  if (shards != null) {
    System.setProperty("shard",shards);
  }
  if (coreNodeName != null) {
    System.setProperty("coreNodeName",coreNodeName);
  }
  try {
    if (!server.isRunning()) {
      server.start();
    }
synchronized (JettySolrRunner.this) {
      int cnt=0;
      while (!waitOnSolr) {
        this.wait(100);
        if (cnt++ == 5) {
          throw new RuntimeException("Jetty/Solr unresponsive");
        }
      }
    }
  }
  finally {
    System.clearProperty("shard");
    System.clearProperty("solr.data.dir");
    System.clearProperty("coreNodeName");
    System.clearProperty("solr.ulog.dir");
  }
}
