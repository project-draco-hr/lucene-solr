{
  if (server.getState().equals(Server.FAILED)) {
    Connector[] connectors=server.getConnectors();
    for (    Connector connector : connectors) {
      connector.stop();
    }
  }
  Filter filter=dispatchFilter.getFilter();
  ThreadPool threadPool=server.getThreadPool();
  server.getServer().stop();
  server.stop();
  if (threadPool instanceof QueuedThreadPool) {
    ((QueuedThreadPool)threadPool).setMaxStopTimeMs(15000);
    ((QueuedThreadPool)threadPool).stop();
    ((QueuedThreadPool)threadPool).stop();
    ((QueuedThreadPool)threadPool).stop();
  }
  if (server.getState().equals(Server.FAILED)) {
    filter.destroy();
  }
  server.join();
}
