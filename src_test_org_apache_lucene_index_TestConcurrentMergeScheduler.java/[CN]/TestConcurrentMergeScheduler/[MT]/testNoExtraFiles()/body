{
  RAMDirectory directory=new MockRAMDirectory();
  for (int pass=0; pass < 2; pass++) {
    boolean autoCommit=pass == 0;
    IndexWriter writer=new IndexWriter(directory,autoCommit,ANALYZER,true);
    for (int iter=0; iter < 7; iter++) {
      ConcurrentMergeScheduler cms=new ConcurrentMergeScheduler();
      writer.setMergeScheduler(cms);
      writer.setMaxBufferedDocs(2);
      for (int j=0; j < 21; j++) {
        Document doc=new Document();
        doc.add(new Field("content","a b c",Field.Store.NO,Field.Index.TOKENIZED));
        writer.addDocument(doc);
      }
      writer.close();
      TestIndexWriter.assertNoUnreferencedFiles(directory,"testNoExtraFiles autoCommit=" + autoCommit);
      writer=new IndexWriter(directory,autoCommit,ANALYZER,false);
    }
    writer.close();
  }
  directory.close();
}
