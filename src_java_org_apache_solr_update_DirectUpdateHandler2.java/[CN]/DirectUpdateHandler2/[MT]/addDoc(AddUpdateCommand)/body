{
  addCommands.incrementAndGet();
  addCommandsCumulative.incrementAndGet();
  int rc=-1;
  if (idField == null) {
    cmd.allowDups=true;
    cmd.overwriteCommitted=false;
    cmd.overwritePending=false;
  }
  iwAccess.lock();
  try {
synchronized (this) {
      closeSearcher();
      openWriter();
      tracker.addedDocument();
    }
    if (cmd.overwriteCommitted || cmd.overwritePending) {
      if (cmd.indexedId == null) {
        cmd.indexedId=getIndexedId(cmd.doc);
      }
      writer.updateDocument(idTerm.createTerm(cmd.indexedId),cmd.getLuceneDocument(schema));
    }
 else {
      writer.addDocument(cmd.getLuceneDocument(schema));
    }
    rc=1;
  }
  finally {
    iwAccess.unlock();
    if (rc != 1) {
      numErrors.incrementAndGet();
      numErrorsCumulative.incrementAndGet();
    }
 else {
      numDocsPending.incrementAndGet();
    }
  }
  return rc;
}
