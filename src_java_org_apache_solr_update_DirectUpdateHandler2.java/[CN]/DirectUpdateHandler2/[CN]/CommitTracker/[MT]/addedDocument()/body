{
  docsSinceCommit++;
  lastAddedTime=System.currentTimeMillis();
  if (docsUpperBound > 0 && (docsSinceCommit > docsUpperBound)) {
    if (pending != null && pending.getDelay(TimeUnit.MILLISECONDS) > DOC_COMMIT_DELAY_MS) {
      pending.cancel(false);
      pending=null;
    }
    if (pending == null) {
      pending=scheduler.schedule(this,DOC_COMMIT_DELAY_MS,TimeUnit.MILLISECONDS);
    }
  }
  if (pending == null && timeUpperBound > 0) {
    pending=scheduler.schedule(this,timeUpperBound,TimeUnit.MILLISECONDS);
  }
}
