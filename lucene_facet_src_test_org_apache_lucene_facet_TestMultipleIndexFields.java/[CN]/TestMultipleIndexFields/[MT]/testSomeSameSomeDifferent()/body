{
  Directory indexDir=newDirectory();
  Directory taxoDir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),indexDir,newIndexWriterConfig(new MockAnalyzer(random(),MockTokenizer.WHITESPACE,false)));
  TaxonomyWriter tw=new DirectoryTaxonomyWriter(taxoDir,OpenMode.CREATE);
  FacetsConfig config=getConfig();
  config.setIndexFieldName("Band","$music");
  config.setIndexFieldName("Composer","$music");
  config.setIndexFieldName("Author","$literature");
  seedIndex(tw,iw,config);
  IndexReader ir=iw.getReader();
  tw.commit();
  TaxonomyReader tr=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=newSearcher(ir);
  FacetsCollector sfc=performSearch(tr,ir,searcher);
  Map<String,Facets> facetsMap=new HashMap<>();
  Facets facets2=getTaxonomyFacetCounts(tr,config,sfc,"$music");
  facetsMap.put("Band",facets2);
  facetsMap.put("Composer",facets2);
  facetsMap.put("Author",getTaxonomyFacetCounts(tr,config,sfc,"$literature"));
  Facets facets=new MultiFacets(facetsMap,getTaxonomyFacetCounts(tr,config,sfc));
  assertCorrectResults(facets);
  assertOrdinalsExist("$music",ir);
  assertOrdinalsExist("$literature",ir);
  iw.close();
  IOUtils.close(tr,ir,iw,tw,indexDir,taxoDir);
}
