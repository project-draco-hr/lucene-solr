{
  SolrQueryRequest req=req("qt",handler,"q","{!parent which=type_s:parent}+SIZE_s:XL","fq","{!term f=BRAND_s tag=rbrand}Nike","facet","true","facet.field","BRAND_s","child.facet.field","COLOR_s");
  assertQ("no exclusion, brand facet got only one Nike",req,"//*[@numFound='" + 1 + "']","count(//lst[@name='BRAND_s']/int[.='1'])=1");
  assertQ("nike filter is excluded, expecting both brand in facet",req("qt",handler,"q","{!parent which=type_s:parent}+SIZE_s:XL","fq","{!term f=BRAND_s tag=rbrand}Nike","facet","true","facet.field","{!ex=rbrand}BRAND_s","child.facet.field","COLOR_s"),"//*[@numFound='" + 1 + "']","count(//lst[@name='BRAND_s']/int[.='1'])=2");
}
