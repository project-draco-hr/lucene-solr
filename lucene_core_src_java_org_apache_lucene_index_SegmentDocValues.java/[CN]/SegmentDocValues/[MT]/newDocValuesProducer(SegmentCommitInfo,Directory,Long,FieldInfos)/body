{
  Directory dvDir=dir;
  String segmentSuffix="";
  if (gen.longValue() != -1) {
    dvDir=si.info.dir;
    segmentSuffix=Long.toString(gen.longValue(),Character.MAX_RADIX);
  }
  SegmentReadState srs=new SegmentReadState(dvDir,si.info,infos,IOContext.READ,segmentSuffix);
  DocValuesFormat dvFormat=si.info.getCodec().docValuesFormat();
  return new RefCount<DocValuesProducer>(dvFormat.fieldsProducer(srs)){
    @SuppressWarnings("synthetic-access") @Override protected void release() throws IOException {
      object.close();
synchronized (SegmentDocValues.this) {
        genDVProducers.remove(gen);
      }
    }
  }
;
}
