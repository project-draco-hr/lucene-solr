{
  NamedList rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  assertEquals(-1l,rsp.get(CdcrParams.CHECKPOINT));
  index(SOURCE_COLLECTION,getDoc(id,"a"));
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  assertEquals(-1l,rsp.get(CdcrParams.CHECKPOINT));
  index(SOURCE_COLLECTION,getDoc(id,"b"));
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  long checkpoint1=(Long)rsp.get(CdcrParams.CHECKPOINT);
  long expected=(Long)invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.SHARDCHECKPOINT).get(CdcrParams.CHECKPOINT);
  assertEquals(expected,checkpoint1);
  index(SOURCE_COLLECTION,getDoc(id,"c"));
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  assertEquals(checkpoint1,rsp.get(CdcrParams.CHECKPOINT));
  index(SOURCE_COLLECTION,getDoc(id,"d"));
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  long checkpoint2=(Long)rsp.get(CdcrParams.CHECKPOINT);
  expected=(Long)invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.SHARDCHECKPOINT).get(CdcrParams.CHECKPOINT);
  assertEquals(expected,checkpoint2);
  deleteByQuery(SOURCE_COLLECTION,"*:*");
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.COLLECTIONCHECKPOINT);
  long checkpoint3=(Long)rsp.get(CdcrParams.CHECKPOINT);
  assertTrue(checkpoint3 > 0);
  checkpoint3=(Long)invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.SHARDCHECKPOINT).get(CdcrParams.CHECKPOINT);
  assertTrue(checkpoint3 > 0);
  checkpoint3=(Long)invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.SHARDCHECKPOINT).get(CdcrParams.CHECKPOINT);
  assertTrue(checkpoint3 > 0);
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD1),CdcrParams.CdcrAction.LASTPROCESSEDVERSION);
  long lastVersion=(Long)rsp.get(CdcrParams.LAST_PROCESSED_VERSION);
  assertEquals(-1l,lastVersion);
  rsp=invokeCdcrAction(shardToLeaderJetty.get(SOURCE_COLLECTION).get(SHARD2),CdcrParams.CdcrAction.LASTPROCESSEDVERSION);
  lastVersion=(Long)rsp.get(CdcrParams.LAST_PROCESSED_VERSION);
  assertEquals(-1l,lastVersion);
}
