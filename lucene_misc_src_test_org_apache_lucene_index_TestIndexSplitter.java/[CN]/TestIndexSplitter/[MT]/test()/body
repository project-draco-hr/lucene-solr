{
  File dir=new File(TEMP_DIR,"testfilesplitter");
  _TestUtil.rmDir(dir);
  dir.mkdirs();
  File destDir=new File(TEMP_DIR,"testfilesplitterdest");
  _TestUtil.rmDir(destDir);
  destDir.mkdirs();
  Directory fsDir=newFSDirectory(dir);
  LogMergePolicy mergePolicy=new LogByteSizeMergePolicy();
  mergePolicy.setNoCFSRatio(1);
  IndexWriter iw=new IndexWriter(fsDir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setOpenMode(OpenMode.CREATE).setMergePolicy(mergePolicy));
  for (int x=0; x < 100; x++) {
    Document doc=DocHelper.createDocument(x,"index",5);
    iw.addDocument(doc);
  }
  iw.commit();
  for (int x=100; x < 150; x++) {
    Document doc=DocHelper.createDocument(x,"index2",5);
    iw.addDocument(doc);
  }
  iw.commit();
  for (int x=150; x < 200; x++) {
    Document doc=DocHelper.createDocument(x,"index3",5);
    iw.addDocument(doc);
  }
  iw.commit();
  DirectoryReader iwReader=iw.getReader();
  assertEquals(3,iwReader.leaves().size());
  iwReader.close();
  iw.close();
  IndexSplitter is=new IndexSplitter(dir);
  String splitSegName=is.infos.info(1).info.name;
  is.split(destDir,new String[]{splitSegName});
  Directory fsDirDest=newFSDirectory(destDir);
  DirectoryReader r=DirectoryReader.open(fsDirDest);
  assertEquals(50,r.maxDoc());
  r.close();
  fsDirDest.close();
  File destDir2=new File(TEMP_DIR,"testfilesplitterdest2");
  _TestUtil.rmDir(destDir2);
  destDir2.mkdirs();
  IndexSplitter.main(new String[]{dir.getAbsolutePath(),destDir2.getAbsolutePath(),splitSegName});
  assertEquals(5,destDir2.listFiles().length);
  Directory fsDirDest2=newFSDirectory(destDir2);
  r=DirectoryReader.open(fsDirDest2);
  assertEquals(50,r.maxDoc());
  r.close();
  fsDirDest2.close();
  IndexSplitter.main(new String[]{dir.getAbsolutePath(),"-d",splitSegName});
  r=DirectoryReader.open(fsDir);
  assertEquals(2,r.leaves().size());
  r.close();
  fsDir.close();
}
