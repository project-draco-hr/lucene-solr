{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  int num=atLeast(3);
  int skip=random().nextInt(num);
  List<Term> terms=new ArrayList<>();
  for (int i=0; i < num; i++) {
    terms.add(new Term("field" + i,"content1"));
    Document doc=new Document();
    if (skip == i) {
      continue;
    }
    doc.add(newStringField("field" + i,"content1",Field.Store.YES));
    w.addDocument(doc);
  }
  w.forceMerge(1);
  IndexReader reader=w.getReader();
  w.close();
  assertEquals(1,reader.leaves().size());
  AtomicReaderContext context=reader.leaves().get(0);
  TermsFilter tf=new TermsFilter(terms);
  FixedBitSet bits=(FixedBitSet)tf.getDocIdSet(context,context.reader().getLiveDocs());
  assertEquals("Must be num fields - 1 since we skip only one field",num - 1,bits.cardinality());
  reader.close();
  dir.close();
}
