{
  final int len=nextInt(rand,minLen,maxLen);
  char[] buffer=new char[len];
  for (int i=0; i < len; i++) {
    int t=rand.nextInt(doUnpairedSurr ? 6 : 5);
    if (0 == t && i < len - 1) {
      buffer[i++]=(char)nextInt(rand,0xd800,0xdc00);
      buffer[i]=(char)nextInt(rand,0xdc00,0xe000);
    }
 else     if (t <= 1) {
      buffer[i]=(char)nextInt(rand,0x80);
    }
 else     if (2 == t) {
      buffer[i]=(char)nextInt(rand,0x80,0x800);
    }
 else     if (3 == t) {
      buffer[i]=(char)nextInt(rand,0x800,0xd800);
    }
 else     if (4 == t) {
      buffer[i]=(char)nextInt(rand,0xe000,0xffff);
    }
 else     if (5 == t) {
      if (rand.nextBoolean()) {
        buffer[i]=(char)nextInt(rand,0xd800,0xdc00);
      }
 else {
        buffer[i]=(char)nextInt(rand,0xdc00,0xe000);
      }
    }
  }
  return new String(buffer);
}
