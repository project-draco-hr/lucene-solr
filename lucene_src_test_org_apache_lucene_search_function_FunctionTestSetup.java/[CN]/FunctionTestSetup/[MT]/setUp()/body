{
  super.setUp();
  dir=new MockRAMDirectory();
  anlzr=new MockAnalyzer();
  Random r=newRandom();
  IndexWriterConfig iwc=newIndexWriterConfig(r,TEST_VERSION_CURRENT,anlzr);
  if (doMultiSegment) {
    iwc.setMaxBufferedDocs(_TestUtil.nextInt(r,2,7));
  }
  RandomIndexWriter iw=new RandomIndexWriter(r,dir,iwc);
  int remaining=N_DOCS;
  boolean done[]=new boolean[N_DOCS];
  int i=0;
  while (remaining > 0) {
    if (done[i]) {
      throw new Exception("to set this test correctly N_DOCS=" + N_DOCS + " must be primary and greater than 2!");
    }
    addDoc(iw,i);
    done[i]=true;
    i=(i + 4) % N_DOCS;
    remaining--;
  }
  if (!doMultiSegment) {
    iw.optimize();
  }
  iw.close();
}
