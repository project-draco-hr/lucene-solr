{
  super(reader,queryTerm.field());
  this.automaton=automaton;
  this.finite=finite;
  if (preCompiled == null)   runAutomaton=new RunAutomaton(this.automaton);
 else   runAutomaton=preCompiled;
  commonSuffixRef=finite ? null : new BytesRef(getValidUTF16Suffix(SpecialOperations.getCommonSuffix(automaton)));
  allTransitions=new Transition[runAutomaton.getSize()][];
  for (  State state : this.automaton.getStates())   allTransitions[state.getNumber()]=state.getSortedTransitionArray(false);
  visited=new long[runAutomaton.getSize()];
  setUseTermsCache(finite);
  termComp=getComparator();
}
