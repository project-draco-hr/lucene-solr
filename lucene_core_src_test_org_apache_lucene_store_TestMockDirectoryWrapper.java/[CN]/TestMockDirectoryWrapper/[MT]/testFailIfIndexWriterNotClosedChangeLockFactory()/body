{
  MockDirectoryWrapper dir=newMockDirectory();
  dir.setLockFactory(new SingleInstanceLockFactory());
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(null));
  try {
    dir.close();
    fail();
  }
 catch (  Exception expected) {
    assertTrue(expected.getMessage().contains("there are still open locks"));
  }
  iw.close();
  dir.close();
}
