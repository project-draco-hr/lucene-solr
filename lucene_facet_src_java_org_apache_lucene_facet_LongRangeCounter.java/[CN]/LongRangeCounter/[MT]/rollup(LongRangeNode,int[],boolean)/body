{
  int count;
  sawOutputs|=node.outputs != null;
  if (node.left != null) {
    count=rollup(node.left,counts,sawOutputs);
    count+=rollup(node.right,counts,sawOutputs);
  }
 else {
    count=leafCounts[leafUpto];
    leafUpto++;
    if (!sawOutputs) {
      missingCount+=count;
    }
  }
  if (node.outputs != null) {
    for (    int rangeIndex : node.outputs) {
      counts[rangeIndex]+=count;
    }
  }
  return count;
}
