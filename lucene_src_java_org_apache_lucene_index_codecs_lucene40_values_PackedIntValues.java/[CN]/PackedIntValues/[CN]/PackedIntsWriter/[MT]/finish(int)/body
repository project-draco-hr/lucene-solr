{
  boolean success=false;
  final IndexOutput dataOut=getOrCreateDataOut();
  try {
    if (!started) {
      minValue=maxValue=0;
    }
    final long delta=maxValue - minValue;
    if (delta <= (maxValue >= 0 && minValue <= 0 ? Long.MAX_VALUE : Long.MAX_VALUE - 1) && delta >= 0) {
      dataOut.writeByte(PACKED);
      writePackedInts(dataOut,docCount);
      return;
    }
 else {
      dataOut.writeByte(FIXED_64);
    }
    writeData(dataOut);
    writeZeros(docCount - (lastDocID + 1),dataOut);
    success=true;
  }
  finally {
    resetPool();
    if (success) {
      IOUtils.close(dataOut);
    }
 else {
      IOUtils.closeWhileHandlingException(dataOut);
    }
  }
}
