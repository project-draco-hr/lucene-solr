{
  if (node == null) {
    return null;
  }
 else {
    SimilarityFactory similarityFactory;
    final Object obj=loader.newInstance(((Element)node).getAttribute("class"));
    if (obj instanceof SimilarityFactory) {
      SolrParams params=SolrParams.toSolrParams(DOMUtil.childNodesToNamedList(node));
      similarityFactory=(SimilarityFactory)obj;
      similarityFactory.init(params);
    }
 else {
      similarityFactory=new SimilarityFactory(){
        @Override public Similarity getSimilarity(){
          return (Similarity)obj;
        }
      }
;
    }
    return similarityFactory.getSimilarity();
  }
}
