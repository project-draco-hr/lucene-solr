{
  if (!Overseer.isLegacy(zkStateReader.getClusterProps())) {
    DocCollection coll=zkStateReader.getClusterState().getCollection(cd.getCollectionName());
    CloudDescriptor cloudDesc=cd.getCloudDescriptor();
    if (cloudDesc.getShardId() == null)     throw new RuntimeException("No shard id for :" + cd.toString());
    Slice slice=coll.getSlice(cloudDesc.getShardId());
    if (slice == null)     throw new RuntimeException("Invalid slice : " + cloudDesc.getShardId());
    Replica replica=null;
    if (cloudDesc.getCoreNodeName() != null) {
      replica=slice.getReplica(cloudDesc.getCoreNodeName());
    }
 else {
      for (      Replica r : slice.getReplicas()) {
        if (cd.getName().equals(r.get(ZkStateReader.CORE_NAME_PROP)) && getBaseUrl().equals(r.get(ZkStateReader.BASE_URL_PROP))) {
          replica=r;
          break;
        }
      }
    }
    if (replica == null) {
      throw new RuntimeException(" No such replica in clusterstate " + cd.toString());
    }
  }
}
