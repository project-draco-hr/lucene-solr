{
  if (SKIP_AUTO_RECOVERY) {
    log.warn("Skipping recovery according to sys prop solrcloud.skip.autorecovery");
    return false;
  }
  boolean doRecovery=true;
  if (!isLeader) {
    if (skipRecovery || (!afterExpiration && core.isReloaded() && !recoverReloadedCores)) {
      doRecovery=false;
    }
    if (doRecovery) {
      log.info("Core needs to recover:" + core.getName());
      core.getUpdateHandler().getSolrCoreState().doRecovery(cc,core.getCoreDescriptor());
      return true;
    }
    final Replica.State lirState=getLeaderInitiatedRecoveryState(collection,shardId,core.getCoreDescriptor().getCloudDescriptor().getCoreNodeName());
    if (lirState == Replica.State.DOWN) {
      log.info("Leader marked core " + core.getName() + " down; starting recovery process");
      core.getUpdateHandler().getSolrCoreState().doRecovery(cc,core.getCoreDescriptor());
      return true;
    }
  }
 else {
    log.info("I am the leader, no recovery necessary");
  }
  return false;
}
