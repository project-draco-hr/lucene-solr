{
  String collection=cloudDesc.getCollectionName();
  String shardId=cloudDesc.getShardId();
  String leaderUrl;
  try {
    leaderUrl=getLeaderProps(collection,cloudDesc.getShardId(),timeoutms).getCoreUrl();
    String clusterStateLeaderUrl=zkStateReader.getLeaderUrl(collection,shardId,timeoutms * 2);
    int tries=0;
    while (!leaderUrl.equals(clusterStateLeaderUrl)) {
      if (tries == 60) {
        throw new SolrException(ErrorCode.SERVER_ERROR,"There is conflicting information about the leader of shard: " + cloudDesc.getShardId() + " our state says:"+ clusterStateLeaderUrl+ " but zookeeper says:"+ leaderUrl);
      }
      Thread.sleep(1000);
      tries++;
      clusterStateLeaderUrl=zkStateReader.getLeaderUrl(collection,shardId,timeoutms);
      leaderUrl=getLeaderProps(collection,cloudDesc.getShardId(),timeoutms).getCoreUrl();
    }
  }
 catch (  Exception e) {
    log.error("Error getting leader from zk",e);
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Error getting leader from zk for shard " + shardId,e);
  }
  return leaderUrl;
}
