{
  if (!confDirectoryWatchers.containsKey(zkDir)) {
    confDirectoryWatchers.put(zkDir,new HashSet<Runnable>());
  }
 else {
    return;
  }
  Watcher watcher=new Watcher(){
    @Override public void process(    WatchedEvent event){
      try {
synchronized (confDirectoryWatchers) {
          if (!confDirectoryWatchers.containsKey(zkDir))           return;
        }
        if (event.getType() == Event.EventType.NodeChildrenChanged) {
synchronized (confDirectoryWatchers) {
            final Set<Runnable> listeners=confDirectoryWatchers.get(zkDir);
            if (listeners != null) {
              new Thread(){
                @Override public synchronized void run(){
                  for (                  Runnable listener : listeners)                   listener.run();
                }
              }
.start();
            }
          }
        }
      }
  finally {
        if (Event.EventType.None.equals(event.getType())) {
          return;
        }
 else {
          setConfWatcher(zkDir,this);
        }
      }
    }
  }
;
  setConfWatcher(zkDir,watcher);
}
