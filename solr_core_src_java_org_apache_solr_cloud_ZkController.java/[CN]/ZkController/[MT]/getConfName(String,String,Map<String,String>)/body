{
  log.info("Looking for collection configName");
  List<String> configNames=null;
  int retry=1;
  int retryLimt=6;
  for (; retry < retryLimt; retry++) {
    if (zkClient.exists(collectionPath,true)) {
      ZkNodeProps cProps=ZkNodeProps.load(zkClient.getData(collectionPath,null,null,true));
      if (cProps.containsKey(CONFIGNAME_PROP)) {
        break;
      }
    }
    try {
      configNames=zkClient.getChildren(CONFIGS_ZKNODE,null,true);
    }
 catch (    NoNodeException e) {
    }
    if (configNames != null && configNames.size() == 1) {
      log.info("Only one config set found in zk - using it:" + configNames.get(0));
      collectionProps.put(CONFIGNAME_PROP,configNames.get(0));
      break;
    }
    if (configNames != null && configNames.contains(collection)) {
      log.info("Could not find explicit collection configName, but found config name matching collection name - using that set.");
      collectionProps.put(CONFIGNAME_PROP,collection);
      break;
    }
    log.info("Could not find collection configName - pausing for 3 seconds and trying again - try: " + retry);
    Thread.sleep(3000);
  }
  if (retry == retryLimt) {
    log.error("Could not find configName for collection " + collection);
    throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"Could not find configName for collection " + collection + " found:"+ configNames);
  }
}
