{
  int iterCount=timeoutms / 1000;
  Exception exp=null;
  while (iterCount-- > 0) {
    try {
      byte[] data=zkClient.getData(ZkStateReader.getShardLeadersPath(collection,slice),null,null,true);
      ZkCoreNodeProps leaderProps=new ZkCoreNodeProps(ZkNodeProps.load(data));
      return leaderProps;
    }
 catch (    InterruptedException e) {
      throw e;
    }
catch (    SessionExpiredException e) {
      if (failImmediatelyOnExpiration) {
        throw new RuntimeException("Session has expired - could not get leader props",exp);
      }
      exp=e;
      Thread.sleep(1000);
    }
catch (    Exception e) {
      exp=e;
      Thread.sleep(1000);
    }
    if (cc.isShutDown()) {
      throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"CoreContainer is close");
    }
  }
  throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"Could not get leader props",exp);
}
