{
  final String shardZkNodeName=getNodeName() + "_" + coreName;
  int retryCount=120;
  while (retryCount-- > 0) {
    final String shardId=zkStateReader.getCloudState().getShardId(shardZkNodeName);
    if (shardId != null) {
      return shardId;
    }
    try {
      Thread.sleep(500);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
    }
  }
  throw new SolrException(ErrorCode.SERVER_ERROR,"Could not get shard_id for core: " + coreName);
}
