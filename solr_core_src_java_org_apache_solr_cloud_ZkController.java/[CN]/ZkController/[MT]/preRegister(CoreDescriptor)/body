{
  publish(cd,ZkStateReader.DOWN);
  String shardZkNodeName=getCoreNodeName(cd);
  if (cd.getCloudDescriptor().getShardId() == null && needsToBeAssignedShardId(cd,zkStateReader.getCloudState(),shardZkNodeName)) {
    String shardId;
    try {
      shardId=doGetShardIdProcess(cd.getName(),cd.getCloudDescriptor());
    }
 catch (    InterruptedException e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Interrupted");
    }
    cd.getCloudDescriptor().setShardId(shardId);
  }
}
