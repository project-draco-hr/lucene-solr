{
  publish(cd,ZkStateReader.DOWN,false);
  String coreNodeName=getCoreNodeName(cd);
  if (cd.getCloudDescriptor().getCoreNodeName() == null) {
    cd.getCloudDescriptor().setCoreNodeName(coreNodeName);
  }
  if (cd.getCloudDescriptor().getShardId() == null && needsToBeAssignedShardId(cd,zkStateReader.getClusterState(),coreNodeName)) {
    String shardId;
    shardId=doGetShardIdProcess(cd.getName(),cd);
    cd.getCloudDescriptor().setShardId(shardId);
  }
 else {
    doGetShardIdProcess(cd.getName(),cd);
  }
}
