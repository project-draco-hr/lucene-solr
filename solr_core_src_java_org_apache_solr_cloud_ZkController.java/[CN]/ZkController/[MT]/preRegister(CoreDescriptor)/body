{
  publish(cd,ZkStateReader.DOWN);
  String shardZkNodeName=getCoreNodeName(cd);
  if (cd.getCloudDescriptor().getShardId() == null && needsToBeAssignedShardId(cd,zkStateReader.getCloudState(),shardZkNodeName)) {
    String shardId;
    shardId=doGetShardIdProcess(cd.getName(),cd.getCloudDescriptor());
    cd.getCloudDescriptor().setShardId(shardId);
  }
}
