{
  CloudDescriptor cloudDesc=cd.getCloudDescriptor();
  if (cloudDesc.getShardId() == null && needsToBeAssignedShardId(cd,zkStateReader.getCloudState(),shardZkNodeName)) {
    doPublish(shardZkNodeName,coreName,props,cloudDesc);
    String shardId;
    try {
      shardId=doGetShardIdProcess(coreName,cloudDesc);
    }
 catch (    InterruptedException e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Interrupted");
    }
    cloudDesc.setShardId(shardId);
  }
  if (!props.containsKey(ZkStateReader.SHARD_ID_PROP) && cloudDesc.getShardId() != null) {
    props.put(ZkStateReader.SHARD_ID_PROP,cloudDesc.getShardId());
  }
  doPublish(shardZkNodeName,coreName,props,cloudDesc);
}
