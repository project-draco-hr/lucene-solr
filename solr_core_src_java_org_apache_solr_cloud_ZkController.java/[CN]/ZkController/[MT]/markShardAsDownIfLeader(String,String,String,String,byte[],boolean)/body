{
  String leaderSeqPath=getLeaderSeqPath(collection,leaderCoreNodeName);
  if (leaderSeqPath == null) {
    throw new NotLeaderException(ErrorCode.SERVER_ERROR,"Failed to update data to 'down' for znode: " + znodePath + " because the zookeeper leader sequence for leader: "+ leaderCoreNodeName+ " is null");
  }
  if (zkClient.exists(znodePath,retryOnConnLoss)) {
    List<Op> ops=new ArrayList<>(2);
    ops.add(Op.check(leaderSeqPath,-1));
    ops.add(Op.setData(znodePath,znodeData,-1));
    zkClient.multi(ops,retryOnConnLoss);
  }
 else {
    String parentZNodePath=getLeaderInitiatedRecoveryZnodePath(collection,shardId);
    try {
      zkClient.makePath(parentZNodePath,retryOnConnLoss);
    }
 catch (    KeeperException.NodeExistsException nee) {
    }
    List<Op> ops=new ArrayList<>(2);
    ops.add(Op.check(leaderSeqPath,-1));
    ops.add(Op.create(znodePath,znodeData,zkClient.getZkACLProvider().getACLsToAdd(znodePath),CreateMode.PERSISTENT));
    zkClient.multi(ops,retryOnConnLoss);
  }
}
