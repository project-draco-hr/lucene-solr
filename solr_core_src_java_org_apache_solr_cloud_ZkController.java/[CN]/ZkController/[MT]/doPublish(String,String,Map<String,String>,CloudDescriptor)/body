{
  Integer numShards=cloudDesc.getNumShards();
  if (numShards == null) {
    numShards=Integer.getInteger(ZkStateReader.NUM_SHARDS_PROP);
  }
  CoreState coreState=new CoreState(coreName,cloudDesc.getCollectionName(),props,numShards);
  final String nodePath="/node_states/" + getNodeName();
synchronized (coreStates) {
    coreStates.put(shardZkNodeName,coreState);
    try {
      zkClient.setData(nodePath,ZkStateReader.toJSON(coreStates.values()),true);
    }
 catch (    KeeperException e) {
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"could not publish node state",e);
    }
catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"could not publish node state",e);
    }
  }
}
