{
  if (host == null || host.length() == 0) {
    String hostaddress;
    try {
      hostaddress=InetAddress.getLocalHost().getHostAddress();
    }
 catch (    UnknownHostException e) {
      hostaddress="127.0.0.1";
    }
    if ("127.0.0.1".equals(hostaddress)) {
      Enumeration<NetworkInterface> netInterfaces=null;
      try {
        netInterfaces=NetworkInterface.getNetworkInterfaces();
        while (netInterfaces.hasMoreElements()) {
          NetworkInterface ni=netInterfaces.nextElement();
          Enumeration<InetAddress> ips=ni.getInetAddresses();
          while (ips.hasMoreElements()) {
            InetAddress ip=ips.nextElement();
            if (ip.isSiteLocalAddress()) {
              hostaddress=ip.getHostAddress();
            }
          }
        }
      }
 catch (      Throwable e) {
        SolrException.log(log,"Error while looking for a better host name than 127.0.0.1",e);
      }
    }
    host="http://" + hostaddress;
  }
 else {
    Matcher m=URL_PREFIX.matcher(host);
    if (!m.matches()) {
      host="http://" + host;
    }
  }
  return host;
}
