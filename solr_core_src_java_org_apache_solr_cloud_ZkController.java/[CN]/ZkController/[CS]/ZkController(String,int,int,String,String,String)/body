{
  this.zkServerAddress=zkServerAddress;
  this.localHostPort=locaHostPort;
  this.localHostContext=localHostContext;
  this.localHost=localHost;
  zkClient=new SolrZkClient(zkServerAddress,zkClientTimeout,zkClientConnectTimeout,new OnReconnect(){
    public void command(){
      try {
        zkStateReader.makeCollectionsNodeWatches();
        zkStateReader.makeShardsWatches(true);
        createEphemeralLiveNode();
        zkStateReader.updateCloudState(false);
      }
 catch (      KeeperException e) {
        log.error("",e);
        throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
      }
catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        log.error("",e);
        throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
      }
catch (      IOException e) {
        log.error("",e);
        throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
      }
    }
  }
);
  zkStateReader=new ZkStateReader(zkClient);
  init();
}
