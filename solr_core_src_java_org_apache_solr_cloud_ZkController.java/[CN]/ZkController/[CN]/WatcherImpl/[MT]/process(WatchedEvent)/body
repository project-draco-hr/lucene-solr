{
  try {
synchronized (confDirectoryListeners) {
      if (!confDirectoryListeners.containsKey(zkDir)) {
        log.info("Watcher on {} is removed ",zkDir);
        return;
      }
      Set<Runnable> listeners=confDirectoryListeners.get(zkDir);
      if (listeners != null && !listeners.isEmpty()) {
        final Set<Runnable> listenersCopy=new HashSet<>(listeners);
        new Thread(){
          public void run(){
            for (            final Runnable listener : listenersCopy) {
              try {
                listener.run();
              }
 catch (              Exception e) {
                log.warn("listener throws error",e);
              }
            }
          }
        }
.start();
      }
    }
  }
  finally {
    if (Event.EventType.None.equals(event.getType())) {
      log.info("A node got unwatched for {}",zkDir);
      return;
    }
 else {
      setConfWatcher(zkDir,this);
    }
  }
}
