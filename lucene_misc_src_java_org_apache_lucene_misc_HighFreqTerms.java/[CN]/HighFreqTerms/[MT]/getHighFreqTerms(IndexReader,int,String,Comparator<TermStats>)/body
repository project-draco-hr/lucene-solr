{
  TermStatsQueue tiq=null;
  if (field != null) {
    Fields fields=MultiFields.getFields(reader);
    if (fields == null) {
      throw new RuntimeException("field " + field + " not found");
    }
    Terms terms=fields.terms(field);
    if (terms != null) {
      TermsEnum termsEnum=terms.iterator(null);
      tiq=new TermStatsQueue(numTerms,comparator);
      tiq.fill(field,termsEnum);
    }
  }
 else {
    Fields fields=MultiFields.getFields(reader);
    if (fields == null) {
      throw new RuntimeException("no fields found for this index");
    }
    tiq=new TermStatsQueue(numTerms,comparator);
    for (    String fieldName : fields) {
      Terms terms=fields.terms(fieldName);
      if (terms != null) {
        tiq.fill(fieldName,terms.iterator(null));
      }
    }
  }
  TermStats[] result=new TermStats[tiq.size()];
  int count=tiq.size() - 1;
  while (tiq.size() != 0) {
    result[count]=tiq.pop();
    count--;
  }
  return result;
}
