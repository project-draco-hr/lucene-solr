{
  long totalTF=0L;
  for (  final AtomicReaderContext ctx : reader.leaves()) {
    AtomicReader r=ctx.reader();
    if (!r.hasDeletions()) {
      final long totTF=r.totalTermFreq(term);
      if (totTF != -1) {
        totalTF+=totTF;
        continue;
      }
    }
    DocsEnum de=r.termDocsEnum(term);
    if (de != null) {
      while (de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS)       totalTF+=de.freq();
    }
  }
  return totalTF;
}
