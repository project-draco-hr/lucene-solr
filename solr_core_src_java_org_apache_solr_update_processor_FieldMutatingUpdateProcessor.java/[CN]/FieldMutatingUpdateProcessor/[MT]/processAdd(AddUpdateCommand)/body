{
  final SolrInputDocument doc=cmd.getSolrInputDocument();
  final Collection<String> fieldNames=new ArrayList<String>(doc.getFieldNames());
  for (  final String fname : fieldNames) {
    if (!selector.shouldMutate(fname))     continue;
    final SolrInputField src=doc.get(fname);
    final SolrInputField dest=mutate(src);
    if (null == dest) {
      doc.remove(fname);
    }
 else {
      if (!fname.equals(dest.getName())) {
        throw new SolrException(SERVER_ERROR,"mutute returned field with different name: " + fname + " => "+ dest.getName());
      }
      doc.put(dest.getName(),dest);
    }
  }
  super.processAdd(cmd);
}
