{
  final String nonBmpString="AB\uD840\uDC00C";
  while (true) {
    try {
      Pattern p=Pattern.compile(TestUtil.randomRegexpishString(random));
      String replacement=null;
      try {
        replacement=p.matcher(nonBmpString).replaceAll("_");
      }
 catch (      StringIndexOutOfBoundsException jdkBug) {
        System.out.println("WARNING: your jdk is buggy!");
        System.out.println("Pattern.compile(\"" + p.pattern() + "\").matcher(\"AB\\uD840\\uDC00C\").replaceAll(\"_\"); should not throw IndexOutOfBounds!");
      }
      if (replacement != null && UnicodeUtil.validUTF16String(replacement)) {
        return p;
      }
    }
 catch (    PatternSyntaxException ignored) {
    }
  }
}
