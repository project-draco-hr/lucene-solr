{
  if (output == null) {
    output=new ByteArrayOutputStream(1024);
  }
  try (CheckIndex checker=new CheckIndex(dir,NoLockFactory.INSTANCE.obtainLock(dir,"bogus"))){
    checker.setCrossCheckTermVectors(crossCheckTermVectors);
    checker.setFailFast(failFast);
    checker.setInfoStream(new PrintStream(output,false,IOUtils.UTF_8),false);
    CheckIndex.Status indexStatus=checker.checkIndex(null);
    if (indexStatus == null || indexStatus.clean == false) {
      System.out.println("CheckIndex failed");
      System.out.println(output.toString(IOUtils.UTF_8));
      throw new RuntimeException("CheckIndex failed");
    }
 else {
      if (LuceneTestCase.INFOSTREAM) {
        System.out.println(output.toString(IOUtils.UTF_8));
      }
      return indexStatus;
    }
  }
 }
