{
  if (prefix.length() < 3) {
    throw new IllegalArgumentException("The prefix must be at least 3 characters: " + prefix);
  }
  if (parent == null) {
    parent=tempDirectory();
  }
  if (!parent.exists()) {
    throw new RuntimeException("Parent location does not exist: " + parent.getAbsolutePath());
  }
  if (!parent.isDirectory()) {
    throw new RuntimeException("Parent location is not a folder: " + parent.getAbsolutePath());
  }
  if (!parent.canWrite()) {
    throw new RuntimeException("Parent folder not writeable: " + parent.getAbsolutePath());
  }
  int attempt=0;
  File f;
  do {
    f=genTempFile(prefix + "_","",parent);
  }
 while (!f.mkdir() && (attempt++) < GET_TEMP_DIR_RETRY_THRESHOLD);
  if (attempt > GET_TEMP_DIR_RETRY_THRESHOLD) {
    throw new RuntimeException("Failed to get a temporary dir too many times, check your temp directory and consider manually cleaning it: " + parent.getAbsolutePath());
  }
  return maybeRemoveAfterSuite(f);
}
