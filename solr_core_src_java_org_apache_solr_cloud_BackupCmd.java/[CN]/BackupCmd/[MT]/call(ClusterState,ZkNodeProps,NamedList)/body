{
  String collectionName=message.getStr(COLLECTION_PROP);
  String backupName=message.getStr(NAME);
  String repo=message.getStr(CoreAdminParams.BACKUP_REPOSITORY);
  Instant startTime=Instant.now();
  CoreContainer cc=ocmh.overseer.getZkController().getCoreContainer();
  BackupRepository repository=cc.newBackupRepository(Optional.ofNullable(repo));
  BackupManager backupMgr=new BackupManager(repository,ocmh.zkStateReader);
  URI location=repository.createURI(message.getStr(CoreAdminParams.BACKUP_LOCATION));
  URI backupPath=repository.resolve(location,backupName);
  if (repository.exists(backupPath)) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"The backup directory already exists: " + backupPath);
  }
  repository.createDirectory(backupPath);
  String strategy=message.getStr(CollectionAdminParams.INDEX_BACKUP_STRATEGY,CollectionAdminParams.COPY_FILES_STRATEGY);
switch (strategy) {
case CollectionAdminParams.COPY_FILES_STRATEGY:
{
      copyIndexFiles(backupPath,message,results);
      break;
    }
case CollectionAdminParams.NO_INDEX_BACKUP_STRATEGY:
{
    break;
  }
}
log.info("Starting to backup ZK data for backupName={}",backupName);
String configName=ocmh.zkStateReader.readConfigName(collectionName);
backupMgr.downloadConfigDir(location,backupName,configName);
DocCollection collectionState=ocmh.zkStateReader.getClusterState().getCollection(collectionName);
backupMgr.writeCollectionState(location,backupName,collectionName,collectionState);
Properties properties=new Properties();
properties.put(BackupManager.BACKUP_NAME_PROP,backupName);
properties.put(BackupManager.COLLECTION_NAME_PROP,collectionName);
properties.put(COLL_CONF,configName);
properties.put(BackupManager.START_TIME_PROP,startTime.toString());
properties.put(BackupManager.INDEX_VERSION_PROP,Version.LATEST.toString());
backupMgr.writeBackupProperties(location,backupName,properties);
log.info("Completed backing up ZK data for backupName={}",backupName);
}
