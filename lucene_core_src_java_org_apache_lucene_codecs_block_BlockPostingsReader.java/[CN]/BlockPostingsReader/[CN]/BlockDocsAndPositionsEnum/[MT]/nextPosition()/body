{
  if (DEBUG) {
    System.out.println("    FPR.nextPosition posPendingCount=" + posPendingCount + " posBufferUpto="+ posBufferUpto);
  }
  if (posPendingFP != -1) {
    if (DEBUG) {
      System.out.println("      seek to pendingFP=" + posPendingFP);
    }
    posIn.seek(posPendingFP);
    posPendingFP=-1;
    posBufferUpto=blockSize;
  }
  if (posPendingCount > freq) {
    skipPositions();
    posPendingCount=freq;
  }
  if (posBufferUpto == blockSize) {
    refillPositions();
    posBufferUpto=0;
  }
  position+=posDeltaBuffer[posBufferUpto++];
  posPendingCount--;
  if (DEBUG) {
    System.out.println("      return pos=" + position);
  }
  return position;
}
