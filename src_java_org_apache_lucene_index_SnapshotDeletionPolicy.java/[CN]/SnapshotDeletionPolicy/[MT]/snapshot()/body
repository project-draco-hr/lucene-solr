{
  if (snapshot == null)   snapshot=lastCommit;
 else   throw new IllegalStateException("snapshot is already set; please call release() first");
  return snapshot;
}
