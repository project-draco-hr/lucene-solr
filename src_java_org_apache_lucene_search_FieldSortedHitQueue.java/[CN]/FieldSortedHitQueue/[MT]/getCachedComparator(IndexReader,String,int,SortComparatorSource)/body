{
  if (type == SortField.DOC)   return ScoreDocComparator.INDEXORDER;
  if (type == SortField.SCORE)   return ScoreDocComparator.RELEVANCE;
  ScoreDocComparator comparator=lookup(reader,fieldname,type,factory);
  if (comparator == null) {
switch (type) {
case SortField.AUTO:
      comparator=comparatorAuto(reader,fieldname);
    break;
case SortField.INT:
  comparator=comparatorInt(reader,fieldname);
break;
case SortField.FLOAT:
comparator=comparatorFloat(reader,fieldname);
break;
case SortField.STRING:
comparator=comparatorString(reader,fieldname);
break;
case SortField.CUSTOM:
comparator=factory.newComparator(reader,fieldname);
break;
default :
throw new RuntimeException("unknown field type: " + type);
}
store(reader,fieldname,type,factory,comparator);
}
return comparator;
}
