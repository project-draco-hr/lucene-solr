{
  fieldOrder=(int[])fieldCache.get(field);
  if (fieldOrder == null || fieldOrder.length != reader.maxDoc()) {
    fieldOrder=new int[reader.maxDoc()];
    TermEnum enumerator=reader.terms(new Term(field,""));
    TermDocs termDocs=reader.termDocs();
    if (enumerator.term() == null) {
      throw new RuntimeException("no terms in field " + field);
    }
    try {
      Term term=enumerator.term();
      while (term.field() == field) {
        termDocs.seek(term);
        if (termDocs.next()) {
          fieldOrder[termDocs.doc()]=Integer.parseInt(term.text());
        }
 else {
          throw new RuntimeException("termDocs.next() failed!");
        }
        if (!enumerator.next()) {
          break;
        }
        term=enumerator.term();
      }
    }
  finally {
      enumerator.close();
      termDocs.close();
    }
    HashMap newCache=(HashMap)fieldCache.clone();
    newCache.put(field,fieldOrder);
    fieldCache=newCache;
  }
}
