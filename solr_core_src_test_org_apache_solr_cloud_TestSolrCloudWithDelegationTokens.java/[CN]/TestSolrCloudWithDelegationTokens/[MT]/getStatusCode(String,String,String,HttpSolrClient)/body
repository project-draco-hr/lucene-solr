{
  HttpSolrClient delegationTokenServer=new HttpSolrClient.Builder(client.getBaseURL().toString()).withDelegationToken(token).withResponseParser(client.getParser()).build();
  try {
    ModifiableSolrParams p=new ModifiableSolrParams();
    if (user != null)     p.set(USER_PARAM,user);
    if (op != null)     p.set("op",op);
    SolrRequest req=getAdminRequest(p);
    if (user != null || op != null) {
      Set<String> queryParams=new HashSet<String>();
      if (user != null)       queryParams.add(USER_PARAM);
      if (op != null)       queryParams.add("op");
      req.setQueryParams(queryParams);
    }
    try {
      delegationTokenServer.request(req,null,null);
      return HttpStatus.SC_OK;
    }
 catch (    HttpSolrClient.RemoteSolrException re) {
      return re.code();
    }
  }
  finally {
    delegationTokenServer.close();
  }
}
