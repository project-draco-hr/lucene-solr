{
  if (field.getDocValuesGen() != -1) {
    throw new UnsupportedOperationException("4.2 does not support dv updates");
  }
  meta.writeVInt(field.number);
  meta.writeByte(BYTES);
  int minLength=Integer.MAX_VALUE;
  int maxLength=Integer.MIN_VALUE;
  final long startFP=data.getFilePointer();
  for (  BytesRef v : values) {
    final int length=v == null ? 0 : v.length;
    if (length > Lucene42DocValuesFormat.MAX_BINARY_FIELD_LENGTH) {
      throw new IllegalArgumentException("DocValuesField \"" + field.name + "\" is too large, must be <= "+ Lucene42DocValuesFormat.MAX_BINARY_FIELD_LENGTH);
    }
    minLength=Math.min(minLength,length);
    maxLength=Math.max(maxLength,length);
    if (v != null) {
      data.writeBytes(v.bytes,v.offset,v.length);
    }
  }
  meta.writeLong(startFP);
  meta.writeLong(data.getFilePointer() - startFP);
  meta.writeVInt(minLength);
  meta.writeVInt(maxLength);
  if (minLength != maxLength) {
    meta.writeVInt(PackedInts.VERSION_CURRENT);
    meta.writeVInt(BLOCK_SIZE);
    final MonotonicBlockPackedWriter writer=new MonotonicBlockPackedWriter(data,BLOCK_SIZE);
    long addr=0;
    for (    BytesRef v : values) {
      if (v != null) {
        addr+=v.length;
      }
      writer.add(addr);
    }
    writer.finish();
  }
}
