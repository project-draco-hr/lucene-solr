{
  Analyzer analyzer=new MockAnalyzer(random(),MockTokenizer.WHITESPACE,true,MockTokenFilter.ENGLISH_STOPSET);
  builder=new CorePlusExtensionsParser("contents",analyzer);
  BufferedReader d=new BufferedReader(new InputStreamReader(TestParser.class.getResourceAsStream("reuters21578.txt"),StandardCharsets.US_ASCII));
  dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,analyzer));
  String line=d.readLine();
  while (line != null) {
    int endOfDate=line.indexOf('\t');
    String date=line.substring(0,endOfDate).trim();
    String content=line.substring(endOfDate).trim();
    Document doc=new Document();
    doc.add(newTextField("date",date,Field.Store.YES));
    doc.add(newTextField("contents",content,Field.Store.YES));
    doc.add(new IntField("date2",Integer.valueOf(date),Field.Store.NO));
    writer.addDocument(doc);
    line=d.readLine();
  }
  d.close();
  writer.shutdown();
  reader=DirectoryReader.open(dir);
  searcher=newSearcher(reader);
}
