{
  boolean locked=false;
  try {
    locked=lock.obtain();
    int sleepCount=0;
    while (!locked) {
      if (++sleepCount == maxSleeps) {
        throw new IOException("Timed out waiting for: " + lock);
      }
      try {
        Thread.sleep(sleepInterval);
      }
 catch (      InterruptedException e) {
        throw new IOException(e.toString());
      }
      locked=lock.obtain();
    }
    return doBody();
  }
  finally {
    if (locked)     lock.release();
  }
}
