{
  int docCount=0;
  int rawDocLengths[]=new int[MAX_RAW_MERGE_DOCS];
  int idx=0;
  for (  MergeState.IndexReaderAndLiveDocs reader : mergeState.readers) {
    final SegmentReader matchingSegmentReader=mergeState.matchingSegmentReaders[idx++];
    DefaultStoredFieldsReader matchingFieldsReader=null;
    if (matchingSegmentReader != null) {
      final StoredFieldsReader fieldsReader=matchingSegmentReader.getFieldsReader();
      if (fieldsReader != null && fieldsReader instanceof DefaultStoredFieldsReader) {
        matchingFieldsReader=(DefaultStoredFieldsReader)fieldsReader;
      }
    }
    if (reader.liveDocs != null) {
      docCount+=copyFieldsWithDeletions(mergeState,reader,matchingFieldsReader,rawDocLengths);
    }
 else {
      docCount+=copyFieldsNoDeletions(mergeState,reader,matchingFieldsReader,rawDocLengths);
    }
  }
  finish(docCount);
  return docCount;
}
