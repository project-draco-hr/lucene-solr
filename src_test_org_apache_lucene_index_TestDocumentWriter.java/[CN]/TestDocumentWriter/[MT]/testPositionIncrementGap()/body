{
  Analyzer analyzer=new Analyzer(){
    public TokenStream tokenStream(    String fieldName,    Reader reader){
      return new WhitespaceTokenizer(reader);
    }
    public int getPositionIncrementGap(    String fieldName){
      return 500;
    }
  }
;
  Similarity similarity=Similarity.getDefault();
  IndexWriter writer=new IndexWriter(dir,analyzer,true);
  Document doc=new Document();
  doc.add(new Field("repeated","repeated one",Field.Store.YES,Field.Index.TOKENIZED));
  doc.add(new Field("repeated","repeated two",Field.Store.YES,Field.Index.TOKENIZED));
  writer.addDocument(doc);
  writer.flush();
  SegmentInfo info=writer.segmentInfos.info(writer.segmentInfos.size() - 1);
  writer.close();
  SegmentReader reader=SegmentReader.get(info);
  TermPositions termPositions=reader.termPositions(new Term("repeated","repeated"));
  assertTrue(termPositions.next());
  int freq=termPositions.freq();
  assertEquals(2,freq);
  assertEquals(0,termPositions.nextPosition());
  assertEquals(502,termPositions.nextPosition());
}
