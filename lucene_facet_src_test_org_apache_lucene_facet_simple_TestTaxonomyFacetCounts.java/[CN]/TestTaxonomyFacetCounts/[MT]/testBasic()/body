{
  Directory dir=newDirectory();
  Directory taxoDir=newDirectory();
  DirectoryTaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(taxoDir,IndexWriterConfig.OpenMode.CREATE);
  FacetsConfig config=new FacetsConfig();
  config.setHierarchical("Publish Date",true);
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir);
  DocumentBuilder builder=new DocumentBuilder(taxoWriter,config);
  Document doc=new Document();
  doc.add(new FacetField("Author","Bob"));
  doc.add(new FacetField("Publish Date","2010","10","15"));
  writer.addDocument(builder.build(doc));
  doc=new Document();
  doc.add(new FacetField("Author","Lisa"));
  doc.add(new FacetField("Publish Date","2010","10","20"));
  writer.addDocument(builder.build(doc));
  doc=new Document();
  doc.add(new FacetField("Author","Lisa"));
  doc.add(new FacetField("Publish Date","2012","1","1"));
  writer.addDocument(builder.build(doc));
  doc=new Document();
  doc.add(new FacetField("Author","Susan"));
  doc.add(new FacetField("Publish Date","2012","1","7"));
  writer.addDocument(builder.build(doc));
  doc=new Document();
  doc.add(new FacetField("Author","Frank"));
  doc.add(new FacetField("Publish Date","1999","5","5"));
  writer.addDocument(builder.build(doc));
  IndexSearcher searcher=newSearcher(writer.getReader());
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoWriter);
  SimpleFacetsCollector c=new SimpleFacetsCollector();
  searcher.search(new MatchAllDocsQuery(),c);
  Facets facets=new FastTaxonomyFacetCounts(taxoReader,config,c);
  assertEquals("Publish Date (5)\n  2010 (2)\n  2012 (2)\n  1999 (1)\n",facets.getTopChildren(10,"Publish Date").toString());
  assertEquals("Author (5)\n  Lisa (2)\n  Bob (1)\n  Susan (1)\n  Frank (1)\n",facets.getTopChildren(10,"Author").toString());
  SimpleDrillDownQuery q2=new SimpleDrillDownQuery(config);
  q2.add("Publish Date","2010");
  c=new SimpleFacetsCollector();
  searcher.search(q2,c);
  facets=new FastTaxonomyFacetCounts(taxoReader,config,c);
  assertEquals("Author (2)\n  Bob (1)\n  Lisa (1)\n",facets.getTopChildren(10,"Author").toString());
  assertEquals(1,facets.getSpecificValue("Author","Lisa"));
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  PrintTaxonomyStats.printStats(taxoReader,new PrintStream(bos,false,"UTF-8"),true);
  String result=bos.toString("UTF-8");
  assertTrue(result.indexOf("/Author: 4 immediate children; 5 total categories") != -1);
  assertTrue(result.indexOf("/Publish Date: 3 immediate children; 12 total categories") != -1);
  assertTrue(result.indexOf("  /1999") != -1);
  assertTrue(result.indexOf("  /2012") != -1);
  assertTrue(result.indexOf("      /20") != -1);
  IOUtils.close(writer,taxoWriter,searcher.getIndexReader(),taxoReader,taxoDir,dir);
}
