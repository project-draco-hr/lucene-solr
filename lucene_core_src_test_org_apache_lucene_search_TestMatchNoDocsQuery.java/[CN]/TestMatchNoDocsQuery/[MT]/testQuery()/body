{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,newIndexWriterConfig(analyzer).setMaxBufferedDocs(2).setMergePolicy(newLogMergePolicy()));
  addDoc("one",iw);
  addDoc("two",iw);
  addDoc("three four",iw);
  IndexReader ir=DirectoryReader.open(iw,true);
  IndexSearcher is=newSearcher(ir);
  ScoreDoc[] hits;
  hits=is.search(new MatchNoDocsQuery(),1000).scoreDocs;
  assertEquals(0,hits.length);
  MatchNoDocsQuery mndq=new MatchNoDocsQuery();
  Query rewritten=mndq.rewrite(ir);
  assertTrue(rewritten instanceof BooleanQuery);
  assertEquals(0,((BooleanQuery)rewritten).clauses().size());
  hits=is.search(mndq,1000).scoreDocs;
  assertEquals(0,hits.length);
  iw.close();
  ir.close();
  dir.close();
}
