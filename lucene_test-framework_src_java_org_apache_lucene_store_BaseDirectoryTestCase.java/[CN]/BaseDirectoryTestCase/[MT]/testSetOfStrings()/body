{
  Directory dir=getDirectory(createTempDir("testSetOfStrings"));
  IndexOutput output=dir.createOutput("stringset",newIOContext(random()));
  output.writeSetOfStrings(asSet("test1","test2"));
  output.writeSetOfStrings(Collections.emptySet());
  output.writeSetOfStrings(asSet("test3"));
  output.close();
  IndexInput input=dir.openInput("stringset",newIOContext(random()));
  Set<String> set=input.readSetOfStrings();
  assertEquals(asSet("test1","test2"),set);
  try {
    set.add("bogus");
    fail("set should be immutable");
  }
 catch (  UnsupportedOperationException expected) {
  }
  set=input.readSetOfStrings();
  assertEquals(Collections.emptySet(),set);
  try {
    set.add("bogus");
    fail("set should be immutable");
  }
 catch (  UnsupportedOperationException expected) {
  }
  set=input.readSetOfStrings();
  assertEquals(Collections.singleton("test3"),set);
  try {
    set.add("bogus");
    fail("set should be immutable");
  }
 catch (  UnsupportedOperationException expected) {
  }
  assertEquals(input.length(),input.getFilePointer());
  input.close();
  dir.close();
}
