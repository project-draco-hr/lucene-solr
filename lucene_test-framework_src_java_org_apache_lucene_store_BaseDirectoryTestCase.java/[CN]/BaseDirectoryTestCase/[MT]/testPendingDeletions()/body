{
  try (Directory dir=getDirectory(addVirusChecker(createTempDir()))){
    assumeTrue("we can only install VirusCheckingFS on an FSDirectory",dir instanceof FSDirectory);
    FSDirectory fsDir=(FSDirectory)dir;
    String fileName;
    while (true) {
      fileName=TestUtil.randomSimpleString(random());
      if (fileName.length() == 0) {
        continue;
      }
      try (IndexOutput out=dir.createOutput(fileName,IOContext.DEFAULT)){
      }
       fsDir.deleteFile(fileName);
      if (fsDir.checkPendingDeletions()) {
        break;
      }
    }
    assertFalse(Arrays.asList(fsDir.listAll()).contains(fileName));
    try {
      fsDir.fileLength(fileName);
      fail("did not hit exception");
    }
 catch (    NoSuchFileException nsfe) {
    }
    try {
      fsDir.renameFile(fileName,"file2");
      fail("did not hit exception");
    }
 catch (    NoSuchFileException nsfe) {
    }
    try {
      fsDir.deleteFile(fileName);
      fail("did not hit exception");
    }
 catch (    NoSuchFileException nsfe) {
    }
    try {
      fsDir.openInput(fileName,IOContext.DEFAULT);
      fail("did not hit exception");
    }
 catch (    NoSuchFileException nsfe) {
    }
    if (random().nextBoolean()) {
      try (IndexOutput out=fsDir.createOutput(fileName + "z",IOContext.DEFAULT)){
      }
       fsDir.renameFile(fileName + "z",fileName);
    }
 else {
      try (IndexOutput out=dir.createOutput(fileName,IOContext.DEFAULT)){
      }
     }
    assertEquals(0,fsDir.fileLength(fileName));
    assertTrue(Arrays.asList(fsDir.listAll()).contains(fileName));
  }
 }
