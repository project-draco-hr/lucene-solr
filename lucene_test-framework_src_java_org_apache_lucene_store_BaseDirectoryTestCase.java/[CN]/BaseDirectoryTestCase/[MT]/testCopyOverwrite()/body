{
  Directory source=getDirectory(createTempDir("testCopyOverwrite"));
  Directory dest=newDirectory();
  if (dest instanceof MockDirectoryWrapper) {
    ((MockDirectoryWrapper)dest).setPreventDoubleWrite(false);
  }
  IndexOutput output=source.createOutput("foobar",newIOContext(random()));
  int numBytes=random().nextInt(20000);
  byte bytes[]=new byte[numBytes];
  random().nextBytes(bytes);
  output.writeBytes(bytes,bytes.length);
  output.close();
  IndexOutput output2=dest.createOutput("foobaz",newIOContext(random()));
  output2.writeString("bogus!");
  output2.close();
  dest.copyFrom(source,"foobar","foobaz",newIOContext(random()));
  assertTrue(slowFileExists(dest,"foobaz"));
  IndexInput input=dest.openInput("foobaz",newIOContext(random()));
  byte bytes2[]=new byte[numBytes];
  input.readBytes(bytes2,0,bytes2.length);
  assertEquals(input.length(),numBytes);
  input.close();
  assertArrayEquals(bytes,bytes2);
  IOUtils.close(source,dest);
}
