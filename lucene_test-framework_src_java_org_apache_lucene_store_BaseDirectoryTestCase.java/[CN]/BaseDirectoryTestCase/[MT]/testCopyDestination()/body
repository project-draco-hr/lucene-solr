{
  Directory source=newDirectory();
  Directory dest=getDirectory(createTempDir("testCopyDestination"));
  IndexOutput output=source.createOutput("foobar",newIOContext(random()));
  int numBytes=random().nextInt(20000);
  byte bytes[]=new byte[numBytes];
  random().nextBytes(bytes);
  output.writeBytes(bytes,bytes.length);
  output.close();
  source.copy(dest,"foobar","foobaz",newIOContext(random()));
  assertTrue(slowFileExists(dest,"foobaz"));
  IndexInput input=dest.openInput("foobaz",newIOContext(random()));
  byte bytes2[]=new byte[numBytes];
  input.readBytes(bytes2,0,bytes2.length);
  assertEquals(input.length(),numBytes);
  input.close();
  assertArrayEquals(bytes,bytes2);
  IOUtils.close(source,dest);
}
