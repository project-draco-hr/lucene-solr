{
  System.setProperty("configSetBaseDir",TEST_HOME());
  System.setProperty("coreRootDirectory",testDir.toPath().resolve("control").toString());
  writeCoreProperties(testDir.toPath().resolve("control/cores"),DEFAULT_TEST_CORENAME);
  controlJetty=createJetty(new File(getSolrHome()),testDir + "/control/data",null,getSolrConfigFile(),getSchemaFile());
  controlClient=createNewSolrClient(controlJetty.getLocalPort());
  shardsArr=new String[numShards];
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < numShards; i++) {
    if (sb.length() > 0)     sb.append(',');
    String shardname="shard" + i;
    Path coresPath=testDir.toPath().resolve(shardname).resolve("cores");
    writeCoreProperties(coresPath,DEFAULT_TEST_CORENAME);
    System.setProperty("coreRootDirectory",testDir.toPath().resolve(shardname).toString());
    JettySolrRunner j=createJetty(new File(getSolrHome()),testDir + "/shard" + i+ "/data",null,getSolrConfigFile(),getSchemaFile());
    jettys.add(j);
    clients.add(createNewSolrClient(j.getLocalPort()));
    String shardStr=buildUrl(j.getLocalPort());
    shardsArr[i]=shardStr;
    sb.append(shardStr);
  }
  shards=sb.toString();
}
