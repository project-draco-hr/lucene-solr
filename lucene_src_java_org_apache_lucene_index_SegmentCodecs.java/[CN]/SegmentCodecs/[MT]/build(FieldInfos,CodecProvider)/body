{
  final Map<Codec,Integer> codecRegistry=new IdentityHashMap<Codec,Integer>();
  final ArrayList<Codec> codecs=new ArrayList<Codec>();
  for (  FieldInfo fi : infos) {
    if (fi.isIndexed) {
      final Codec fieldCodec=provider.lookup(provider.getFieldCodec(fi.name));
      Integer ord=codecRegistry.get(fieldCodec);
      if (ord == null) {
        ord=Integer.valueOf(codecs.size());
        codecRegistry.put(fieldCodec,ord);
        codecs.add(fieldCodec);
      }
      fi.setCodecId(ord.intValue());
    }
  }
  return new SegmentCodecs(provider,codecs.toArray(Codec.EMPTY));
}
