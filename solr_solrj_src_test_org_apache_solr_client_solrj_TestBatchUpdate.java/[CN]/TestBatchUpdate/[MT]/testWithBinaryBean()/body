{
  HttpSolrServer httpSolrServer=(HttpSolrServer)getSolrServer();
  httpSolrServer.setRequestWriter(new BinaryRequestWriter());
  httpSolrServer.deleteByQuery("*:*");
  final int[] counter=new int[1];
  counter[0]=0;
  httpSolrServer.addBeans(new Iterator<Bean>(){
    @Override public boolean hasNext(){
      return counter[0] < numdocs;
    }
    @Override public Bean next(){
      Bean bean=new Bean();
      bean.id="" + (++counter[0]);
      bean.cat="foocat";
      return bean;
    }
    @Override public void remove(){
    }
  }
);
  httpSolrServer.commit();
  SolrQuery query=new SolrQuery("*:*");
  QueryResponse response=httpSolrServer.query(query);
  assertEquals(0,response.getStatus());
  assertEquals(numdocs,response.getResults().getNumFound());
}
