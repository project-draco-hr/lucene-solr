{
  final int maxDoc=reader.maxDoc();
  final Bits liveDocs=reader.getLiveDocs();
  if (matchingVectorsReader != null) {
    for (int docNum=0; docNum < maxDoc; ) {
      if (!liveDocs.get(docNum)) {
        ++docNum;
        continue;
      }
      int start=docNum, numDocs=0;
      do {
        docNum++;
        numDocs++;
        if (docNum >= maxDoc)         break;
        if (!liveDocs.get(docNum)) {
          docNum++;
          break;
        }
      }
 while (numDocs < MAX_RAW_MERGE_DOCS);
      matchingVectorsReader.rawDocs(rawDocLengths,rawDocLengths2,start,numDocs);
      termVectorsWriter.addRawDocuments(matchingVectorsReader,rawDocLengths,rawDocLengths2,numDocs);
      checkAbort.work(300 * numDocs);
    }
  }
 else {
    for (int docNum=0; docNum < maxDoc; docNum++) {
      if (!liveDocs.get(docNum)) {
        continue;
      }
      TermFreqVector[] vectors=reader.getTermFreqVectors(docNum);
      termVectorsWriter.addAllDocVectors(vectors);
      checkAbort.work(300);
    }
  }
}
