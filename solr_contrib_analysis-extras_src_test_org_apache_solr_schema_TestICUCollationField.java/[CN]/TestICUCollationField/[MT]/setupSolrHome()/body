{
  File tmpFile=File.createTempFile("test","tmp",TEMP_DIR);
  tmpFile.delete();
  tmpFile.mkdir();
  new File(tmpFile,"data").mkdir();
  File confDir=new File(tmpFile,"conf");
  confDir.mkdir();
  FileUtils.copyFile(getFile("solr-analysis-extras/conf/solrconfig-icucollate.xml"),new File(confDir,"solrconfig.xml"));
  FileUtils.copyFile(getFile("solr-analysis-extras/conf/schema-icucollate.xml"),new File(confDir,"schema.xml"));
  RuleBasedCollator baseCollator=(RuleBasedCollator)Collator.getInstance(new ULocale("de","DE"));
  String DIN5007_2_tailorings="& ae , a\u0308 & AE , A\u0308" + "& oe , o\u0308 & OE , O\u0308" + "& ue , u\u0308 & UE , u\u0308";
  RuleBasedCollator tailoredCollator=new RuleBasedCollator(baseCollator.getRules() + DIN5007_2_tailorings);
  String tailoredRules=tailoredCollator.getRules();
  FileOutputStream os=new FileOutputStream(new File(confDir,"customrules.dat"));
  IOUtils.write(tailoredRules,os,"UTF-8");
  os.close();
  return tmpFile.getAbsolutePath();
}
