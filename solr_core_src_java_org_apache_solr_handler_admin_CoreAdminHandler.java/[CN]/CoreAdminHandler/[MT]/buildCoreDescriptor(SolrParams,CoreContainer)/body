{
  String name=checkNotEmpty(params.get(CoreAdminParams.NAME),"Missing parameter [" + CoreAdminParams.NAME + "]");
  String instancedir=params.get(CoreAdminParams.INSTANCE_DIR);
  if (StringUtils.isEmpty(instancedir)) {
    instancedir=name;
  }
  Properties coreProps=new Properties();
  for (  String param : paramToProp.keySet()) {
    String value=params.get(param,null);
    if (StringUtils.isNotEmpty(value)) {
      coreProps.setProperty(paramToProp.get(param),value);
    }
  }
  Iterator<String> paramsIt=params.getParameterNamesIterator();
  while (paramsIt.hasNext()) {
    String param=paramsIt.next();
    if (!param.startsWith(CoreAdminParams.PROPERTY_PREFIX))     continue;
    String propName=param.substring(CoreAdminParams.PROPERTY_PREFIX.length());
    String propValue=params.get(param);
    coreProps.setProperty(propName,propValue);
  }
  return new CoreDescriptor(container,name,instancedir,coreProps,params);
}
