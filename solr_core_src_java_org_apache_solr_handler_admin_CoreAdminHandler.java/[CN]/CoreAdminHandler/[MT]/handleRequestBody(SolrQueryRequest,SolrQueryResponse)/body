{
  CoreContainer cores=getCoreContainer();
  if (cores == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Core container instance missing");
  }
  String taskId=req.getParams().get("async");
  TaskObject taskObject=new TaskObject(taskId);
  if (taskId != null) {
    if (getMap(RUNNING).containsKey(taskId) || getMap(COMPLETED).containsKey(taskId) || getMap(FAILED).containsKey(taskId)) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Duplicate request with the same requestid found.");
    }
    addTask(RUNNING,taskObject);
  }
  SolrParams params=req.getParams();
  CoreAdminAction action=CoreAdminAction.STATUS;
  String a=params.get(CoreAdminParams.ACTION);
  if (a != null) {
    action=CoreAdminAction.get(a);
    if (action == null) {
      this.handleCustomAction(req,rsp);
    }
  }
  if (taskId == null) {
    handleRequestInternal(req,rsp,action);
  }
 else {
    ParallelCoreAdminHandlerThread parallelHandlerThread=new ParallelCoreAdminHandlerThread(req,rsp,action,taskObject);
    if (parallelExecutor == null || parallelExecutor.isShutdown())     parallelExecutor=Executors.newFixedThreadPool(50,new DefaultSolrThreadFactory("parallelCoreAdminExecutor"));
    parallelExecutor.execute(parallelHandlerThread);
  }
}
