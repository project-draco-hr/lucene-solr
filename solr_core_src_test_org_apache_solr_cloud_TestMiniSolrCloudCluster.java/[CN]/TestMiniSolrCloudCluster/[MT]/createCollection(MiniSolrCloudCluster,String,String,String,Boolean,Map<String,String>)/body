{
  String configName="solrCloudCollectionConfig";
  File configDir=new File(SolrTestCaseJ4.TEST_HOME() + File.separator + "collection1"+ File.separator+ "conf");
  miniCluster.uploadConfigDir(configDir,configName);
  final boolean persistIndex=(indexToPersist != null ? indexToPersist.booleanValue() : random().nextBoolean());
  if (collectionProperties == null) {
    collectionProperties=new HashMap<>();
  }
  collectionProperties.putIfAbsent(CoreDescriptor.CORE_CONFIG,"solrconfig-tlog.xml");
  collectionProperties.putIfAbsent("solr.tests.maxBufferedDocs","100000");
  collectionProperties.putIfAbsent("solr.tests.ramBufferSizeMB","100");
  collectionProperties.putIfAbsent("solr.tests.mergePolicy","org.apache.lucene.index.TieredMergePolicy");
  collectionProperties.putIfAbsent("solr.tests.mergeScheduler","org.apache.lucene.index.ConcurrentMergeScheduler");
  collectionProperties.putIfAbsent("solr.directoryFactory",(persistIndex ? "solr.StandardDirectoryFactory" : "solr.RAMDirectoryFactory"));
  miniCluster.createCollection(collectionName,NUM_SHARDS,REPLICATION_FACTOR,configName,createNodeSet,asyncId,collectionProperties);
}
