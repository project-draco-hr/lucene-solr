{
  int maxFailures=LuceneTestCase.ignoreAfterMaxFailures.getMaxFailures();
  try {
    LuceneTestCase.ignoreAfterMaxFailures.setMaxFailures(2);
    JUnitCore core=new JUnitCore();
    final int[] assumptions=new int[1];
    core.addListener(new RunListener(){
      @Override public void testAssumptionFailure(      Failure failure){
        assumptions[0]++;
      }
    }
);
    Result result=core.run(Nested.class);
    Assert.assertEquals(2,result.getFailureCount());
    Assert.assertEquals(0,result.getIgnoreCount());
    Assert.assertEquals(100,result.getRunCount());
    Assert.assertTrue(assumptions[0] > 50);
  }
  finally {
    LuceneTestCase.ignoreAfterMaxFailures.setMaxFailures(maxFailures);
  }
}
