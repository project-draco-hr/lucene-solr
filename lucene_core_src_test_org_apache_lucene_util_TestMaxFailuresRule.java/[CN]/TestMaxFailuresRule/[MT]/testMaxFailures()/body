{
  int maxFailures=LuceneTestCase.ignoreAfterMaxFailures.maxFailures;
  int failuresSoFar=LuceneTestCase.ignoreAfterMaxFailures.failuresSoFar;
  System.clearProperty(SysGlobals.SYSPROP_ITERATIONS());
  try {
    LuceneTestCase.ignoreAfterMaxFailures.maxFailures=2;
    LuceneTestCase.ignoreAfterMaxFailures.failuresSoFar=0;
    JUnitCore core=new JUnitCore();
    final int[] assumptions=new int[1];
    core.addListener(new RunListener(){
      @Override public void testAssumptionFailure(      Failure failure){
        assumptions[0]++;
      }
    }
);
    Result result=core.run(Nested.class);
    Assert.assertEquals(100,result.getRunCount());
    Assert.assertEquals(0,result.getIgnoreCount());
    Assert.assertEquals(2,result.getFailureCount());
    Assert.assertTrue(assumptions[0] > 50);
  }
  finally {
    LuceneTestCase.ignoreAfterMaxFailures.maxFailures=maxFailures;
    LuceneTestCase.ignoreAfterMaxFailures.failuresSoFar=failuresSoFar;
  }
}
