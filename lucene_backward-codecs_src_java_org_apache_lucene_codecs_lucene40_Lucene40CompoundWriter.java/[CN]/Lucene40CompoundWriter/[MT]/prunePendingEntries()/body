{
  if (outputTaken.compareAndSet(false,true)) {
    try {
      while (!pendingEntries.isEmpty()) {
        FileEntry entry=pendingEntries.poll();
        copyFileEntry(getOutput(new IOContext(new FlushInfo(0,entry.length))),entry);
        entries.put(entry.file,entry);
      }
    }
  finally {
      final boolean compareAndSet=outputTaken.compareAndSet(true,false);
      assert compareAndSet;
    }
  }
}
