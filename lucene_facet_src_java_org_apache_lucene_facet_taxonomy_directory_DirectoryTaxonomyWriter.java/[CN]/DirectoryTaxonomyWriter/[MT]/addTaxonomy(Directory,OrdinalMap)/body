{
  ensureOpen();
  IndexReader r=DirectoryReader.open(taxoDir);
  try {
    final int size=r.numDocs();
    final OrdinalMap ordinalMap=map;
    ordinalMap.setSize(size);
    CategoryPath cp=new CategoryPath();
    Terms terms=MultiFields.getTerms(r,Consts.FULL);
    TermsEnum te=terms.iterator(null);
    Bits liveDocs=MultiFields.getLiveDocs(r);
    DocsEnum docs=null;
    while (te.next() != null) {
      String value=te.term().utf8ToString();
      cp.clear();
      cp.add(value,Consts.DEFAULT_DELIMITER);
      int ordinal=findCategory(cp);
      if (ordinal < 0) {
        ordinal=addCategory(cp);
      }
      docs=te.docs(liveDocs,docs,false);
      ordinalMap.addMapping(docs.nextDoc(),ordinal);
    }
    ordinalMap.addMapping(0,0);
    ordinalMap.addDone();
  }
  finally {
    r.close();
  }
}
