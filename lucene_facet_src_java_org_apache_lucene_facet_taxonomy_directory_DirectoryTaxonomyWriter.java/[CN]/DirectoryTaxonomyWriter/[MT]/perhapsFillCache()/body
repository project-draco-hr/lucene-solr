{
  if (cacheMisses < cacheMissesUntilFill) {
    return false;
  }
  if (alreadyCalledFillCache) {
    return false;
  }
  alreadyCalledFillCache=true;
  if (reader == null) {
    openInternalReader();
  }
  if (!cache.hasRoom(reader.numDocs())) {
    return false;
  }
  CategoryPath cp=new CategoryPath();
  TermsEnum termsEnum=null;
  DocsEnum docsEnum=null;
  int base=0;
  for (  AtomicReader r : reader.getSequentialSubReaders()) {
    Terms terms=r.terms(Consts.FULL);
    if (terms != null) {
      termsEnum=terms.iterator(termsEnum);
      while (termsEnum.next() != null) {
        BytesRef t=termsEnum.term();
        cp.clear();
        cp.add(t.utf8ToString(),delimiter);
        docsEnum=termsEnum.docs(null,docsEnum,false);
        cache.put(cp,docsEnum.nextDoc() + base);
      }
    }
    base+=r.maxDoc();
  }
  cacheIsComplete=true;
  reader.close();
  reader=null;
  return true;
}
