{
  int res=cache.get(categoryPath,prefixLen);
  if (res >= 0 || cacheIsComplete) {
    return res;
  }
  cacheMisses.incrementAndGet();
  perhapsFillCache();
  res=cache.get(categoryPath,prefixLen);
  if (res >= 0 || cacheIsComplete) {
    return res;
  }
  initReaderManager();
  int doc=-1;
  DirectoryReader reader=readerManager.acquire();
  try {
    TermsEnum termsEnum=null;
    DocsEnum docs=null;
    final BytesRef catTerm=new BytesRef(categoryPath.toString(delimiter,prefixLen));
    for (    AtomicReaderContext ctx : reader.leaves()) {
      Terms terms=ctx.reader().terms(Consts.FULL);
      if (terms != null) {
        termsEnum=terms.iterator(termsEnum);
        if (termsEnum.seekExact(catTerm,true)) {
          docs=termsEnum.docs(null,docs,0);
          doc=docs.nextDoc() + ctx.docBase;
          break;
        }
      }
    }
  }
  finally {
    readerManager.release(reader);
  }
  if (doc > 0) {
    addToCache(categoryPath,prefixLen,doc);
  }
  return doc;
}
