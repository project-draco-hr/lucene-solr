{
  Map context=ValueSource.newContext(searcher);
  try {
    expected.createWeight(context,searcher);
    actual.createWeight(context,searcher);
    for (    org.apache.lucene.index.LeafReaderContext leaf : reader.leaves()) {
      final FunctionValues expectedVals=expected.getValues(context,leaf);
      final FunctionValues actualVals=actual.getValues(context,leaf);
      String msg=expected.toString() + " ?= " + actual.toString()+ " -> ";
      for (int i=0; i < leaf.reader().maxDoc(); ++i) {
        assertEquals(msg + i,expectedVals.exists(i),actualVals.exists(i));
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(actual.toString(),e);
  }
}
