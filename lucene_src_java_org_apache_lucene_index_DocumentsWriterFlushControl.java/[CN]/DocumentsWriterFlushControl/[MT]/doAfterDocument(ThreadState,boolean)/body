{
  commitPerThreadBytes(perThread);
  if (!perThread.flushPending) {
    if (isUpdate) {
      flushPolicy.onUpdate(this,perThread);
    }
 else {
      flushPolicy.onInsert(this,perThread);
    }
    if (!perThread.flushPending && perThread.perThreadBytes > maxBytesPerDWPT) {
      setFlushPending(perThread);
    }
  }
  final DocumentsWriterPerThread flushingDWPT=getFlushIfPending(perThread);
  healthiness.updateStalled(this);
  return flushingDWPT;
}
