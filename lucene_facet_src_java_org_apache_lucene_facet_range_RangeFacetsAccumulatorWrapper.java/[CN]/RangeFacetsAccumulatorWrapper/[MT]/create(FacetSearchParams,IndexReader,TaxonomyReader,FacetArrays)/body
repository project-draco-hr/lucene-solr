{
  List<FacetRequest> rangeRequests=new ArrayList<FacetRequest>();
  List<FacetRequest> nonRangeRequests=new ArrayList<FacetRequest>();
  for (  FacetRequest fr : fsp.facetRequests) {
    if (fr instanceof RangeFacetRequest) {
      rangeRequests.add(fr);
    }
 else {
      nonRangeRequests.add(fr);
    }
  }
  if (rangeRequests.isEmpty()) {
    return new FacetsAccumulator(fsp,indexReader,taxoReader,arrays);
  }
 else   if (nonRangeRequests.isEmpty()) {
    return new RangeAccumulator(fsp,indexReader);
  }
 else {
    FacetsAccumulator accumulator=new FacetsAccumulator(new FacetSearchParams(fsp.indexingParams,nonRangeRequests),indexReader,taxoReader,arrays);
    RangeAccumulator rangeAccumulator=new RangeAccumulator(new FacetSearchParams(fsp.indexingParams,rangeRequests),indexReader);
    return new RangeFacetsAccumulatorWrapper(accumulator,rangeAccumulator,fsp);
  }
}
