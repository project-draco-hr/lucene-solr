{
  int num=atLeast(3989);
  for (int i=0; i < num; i++) {
    String unicode=_TestUtil.randomRealisticUnicodeString(random);
    BytesRef ref=new BytesRef(unicode);
    char[] arr=new char[1 + random.nextInt(100)];
    int offset=random.nextInt(arr.length);
    int len=random.nextInt(arr.length - offset);
    CharsRef cRef=new CharsRef(arr,offset,len);
    UnicodeUtil.UTF8toUTF16(ref,cRef);
    assertEquals(cRef.toString(),unicode);
    assertEquals(cRef,unicode);
    assertEquals(cRef,ref.utf8ToString());
  }
}
