{
  HttpClientUtil.setSchemeRegistryProvider(new SchemaRegistryProvider(){
    @Override public Registry<ConnectionSocketFactory> getSchemaRegistry(){
      SSLConnectionSocketFactory sslConnectionFactory;
      try {
        boolean sslCheckPeerName=toBooleanDefaultIfNull(toBooleanObject(System.getProperty(HttpClientUtil.SYS_PROP_CHECK_PEER_NAME)),true);
        if (sslCheckPeerName == false) {
          sslConnectionFactory=new SSLConnectionSocketFactory(buildSSLContext(),SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER);
        }
 else {
          sslConnectionFactory=new SSLConnectionSocketFactory(buildSSLContext());
        }
      }
 catch (      KeyManagementException|UnrecoverableKeyException|NoSuchAlgorithmException|KeyStoreException e) {
        throw new IllegalStateException("Unable to setup https scheme for HTTPClient to test SSL.",e);
      }
      return RegistryBuilder.<ConnectionSocketFactory>create().register("https",sslConnectionFactory).build();
    }
  }
);
  HttpClientUtil.setHttpClientBuilder(builder);
  return builder;
}
