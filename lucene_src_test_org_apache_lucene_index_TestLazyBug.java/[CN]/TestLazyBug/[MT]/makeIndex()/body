{
  Directory dir=new MockRAMDirectory();
  try {
    Random r=newRandom();
    IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(r,TEST_VERSION_CURRENT,new MockAnalyzer()));
    LogMergePolicy lmp=(LogMergePolicy)writer.getConfig().getMergePolicy();
    lmp.setUseCompoundFile(false);
    lmp.setUseCompoundDocStore(false);
    for (int d=1; d <= NUM_DOCS; d++) {
      Document doc=new Document();
      for (int f=1; f <= NUM_FIELDS; f++) {
        doc.add(new Field("f" + f,data[f % data.length] + '#' + data[r.nextInt(data.length)],Field.Store.YES,Field.Index.ANALYZED));
      }
      writer.addDocument(doc);
    }
    writer.close();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  return dir;
}
