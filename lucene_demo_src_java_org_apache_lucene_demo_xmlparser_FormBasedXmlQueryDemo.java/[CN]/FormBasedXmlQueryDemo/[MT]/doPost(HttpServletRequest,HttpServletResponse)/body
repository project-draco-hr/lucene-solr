{
  Properties completedFormFields=new Properties();
  Enumeration<?> pNames=request.getParameterNames();
  while (pNames.hasMoreElements()) {
    String propName=(String)pNames.nextElement();
    String value=request.getParameter(propName);
    if ((value != null) && (value.trim().length() > 0)) {
      completedFormFields.setProperty(propName,value);
    }
  }
  try {
    org.w3c.dom.Document xmlQuery=queryTemplateManager.getQueryAsDOM(completedFormFields);
    Query query=xmlParser.getQuery(xmlQuery.getDocumentElement());
    TopDocs topDocs=searcher.search(query,10);
    if (topDocs != null) {
      ScoreDoc[] sd=topDocs.scoreDocs;
      Document[] results=new Document[sd.length];
      for (int i=0; i < results.length; i++) {
        results[i]=searcher.doc(sd[i].doc);
        request.setAttribute("results",results);
      }
    }
    RequestDispatcher dispatcher=getServletContext().getRequestDispatcher("/index.jsp");
    dispatcher.forward(request,response);
  }
 catch (  Exception e) {
    throw new ServletException("Error processing query",e);
  }
}
