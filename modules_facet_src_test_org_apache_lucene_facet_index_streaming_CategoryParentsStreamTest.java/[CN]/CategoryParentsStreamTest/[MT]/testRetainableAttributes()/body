{
  Directory directory=newDirectory();
  TaxonomyWriter taxonomyWriter=new LuceneTaxonomyWriter(directory);
  FacetIndexingParams indexingParams=new DefaultFacetIndexingParams();
  new CategoryParentsStream(new CategoryAttributesStream(categoryContainer),taxonomyWriter,indexingParams);
  categoryContainer.clear();
  categoryContainer.addCategory(initialCatgeories[0],new DummyProperty());
  CategoryParentsStream stream=new CategoryParentsStream(new CategoryAttributesStream(categoryContainer),taxonomyWriter,new DefaultFacetIndexingParams());
  stream.addRetainableProperty(DummyProperty.class);
  MyCategoryListTokenizer tokenizer=new MyCategoryListTokenizer(stream,indexingParams);
  int nAttributes=0;
  try {
    while (tokenizer.incrementToken()) {
      if (stream.categoryAttribute.getProperty(DummyProperty.class) != null) {
        nAttributes++;
      }
    }
  }
 catch (  IOException e) {
    fail("Properties retained after stream closed");
  }
  assertEquals("Wrong number of tokens with attributes",3,nAttributes);
  taxonomyWriter.close();
  directory.close();
}
