{
  Random random=newRandom();
  MockRAMDirectory dir=newDirectory(random);
  InstantiatedIndex ii=new InstantiatedIndex();
  IndexWriter indexWriter=new IndexWriter(dir,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()));
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    indexWriter.addDocument(document);
  }
  indexWriter.close();
  InstantiatedIndexWriter instantiatedIndexWriter=ii.indexWriterFactory(new MockAnalyzer(),true);
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    instantiatedIndexWriter.addDocument(document);
  }
  instantiatedIndexWriter.close();
  testEqualBehaviour(dir,ii);
  dir.close();
}
