{
  Directory dir=newDirectory();
  InstantiatedIndex ii=new InstantiatedIndex();
  long seed=random.nextLong();
  IndexWriter indexWriter=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(new Random(seed))).setMergePolicy(newLogMergePolicy()));
  indexWriter.setInfoStream(VERBOSE ? System.out : null);
  if (VERBOSE) {
    System.out.println("TEST: make test index");
  }
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    indexWriter.addDocument(document);
  }
  indexWriter.close();
  InstantiatedIndexWriter instantiatedIndexWriter=ii.indexWriterFactory(new MockAnalyzer(new Random(seed)),true);
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    instantiatedIndexWriter.addDocument(document);
  }
  instantiatedIndexWriter.close();
  testEqualBehaviour(dir,ii);
  dir.close();
}
