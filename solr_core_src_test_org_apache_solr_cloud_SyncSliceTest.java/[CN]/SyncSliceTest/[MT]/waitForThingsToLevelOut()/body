{
  int cnt=0;
  boolean retry=false;
  do {
    waitForRecoveriesToFinish(false);
    commit();
    updateMappingsFromZk(jettys,clients);
    Set<String> theShards=shardToJetty.keySet();
    String failMessage=null;
    for (    String shard : theShards) {
      failMessage=checkShardConsistency(shard,false);
    }
    if (failMessage != null) {
      retry=true;
    }
 else {
      retry=false;
    }
    cnt++;
    if (cnt > 10)     break;
    Thread.sleep(2000);
  }
 while (retry);
}
