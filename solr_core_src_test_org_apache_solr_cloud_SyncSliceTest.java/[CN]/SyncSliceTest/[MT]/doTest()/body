{
  handle.clear();
  handle.put("QTime",SKIPVAL);
  handle.put("timestamp",SKIPVAL);
  waitForThingsToLevelOut();
  List<String> skipServers=new ArrayList<String>();
  indexDoc(skipServers,id,0,i1,50,tlong,50,t1,"to come to the aid of their country.");
  indexDoc(skipServers,id,1,i1,50,tlong,50,t1,"old haven was blue.");
  skipServers.add(shardToJetty.get("shard1").get(1).url + "/");
  indexDoc(skipServers,id,2,i1,50,tlong,50,t1,"but the song was fancy.");
  skipServers.add(shardToJetty.get("shard1").get(2).url + "/");
  indexDoc(skipServers,id,3,i1,50,tlong,50,t1,"under the moon and over the lake");
  commit();
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action",CollectionAction.SYNCSHARD.toString());
  params.set("collection","collection1");
  params.set("shard","shard1");
  SolrRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  String baseUrl=((HttpSolrServer)shardToClient.get("shard1").get(2)).getBaseURL();
  baseUrl=baseUrl.substring(0,baseUrl.length() - "collection1".length());
  HttpSolrServer baseServer=new HttpSolrServer(baseUrl);
  baseServer.request(request);
  waitForThingsToLevelOut();
  checkShardConsistency(false,true);
  long cloudClientDocs=cloudClient.query(new SolrQuery("*:*")).getResults().getNumFound();
  assertEquals(4,cloudClientDocs);
  skipServers=new ArrayList<String>();
  skipServers.add(shardToJetty.get("shard1").get(random().nextInt(shardCount)).url + "/");
  indexDoc(skipServers,id,4,i1,50,tlong,50,t1,"to come to the aid of their country.");
  chaosMonkey.killJetty(shardToLeaderJetty.get("shard1").jetty);
  waitForThingsToLevelOut();
  checkShardConsistency(false,true);
  cloudClientDocs=cloudClient.query(new SolrQuery("*:*")).getResults().getNumFound();
  assertEquals(5,cloudClientDocs);
}
