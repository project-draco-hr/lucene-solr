{
  final TeeSinkTokenFilter tee1=new TeeSinkTokenFilter(whitespaceMockTokenizer(buffer1.toString()));
  final TeeSinkTokenFilter.SinkTokenStream dogDetector=tee1.newSinkTokenStream(dogFilter);
  final TeeSinkTokenFilter.SinkTokenStream theDetector=tee1.newSinkTokenStream(theFilter);
  final TokenStream source1=new CachingTokenFilter(tee1);
  tee1.addAttribute(CheckClearAttributesAttribute.class);
  dogDetector.addAttribute(CheckClearAttributesAttribute.class);
  theDetector.addAttribute(CheckClearAttributesAttribute.class);
  MockTokenizer tokenizer=new MockTokenizer(tee1.getAttributeFactory(),MockTokenizer.WHITESPACE,false);
  tokenizer.setReader(new StringReader(buffer2.toString()));
  final TeeSinkTokenFilter tee2=new TeeSinkTokenFilter(tokenizer);
  tee2.addSinkTokenStream(dogDetector);
  tee2.addSinkTokenStream(theDetector);
  final TokenStream source2=tee2;
  assertTokenStreamContents(source1,tokens1);
  assertTokenStreamContents(source2,tokens2);
  assertTokenStreamContents(theDetector,new String[]{"The","the","The","the"});
  assertTokenStreamContents(dogDetector,new String[]{"Dogs","Dogs"});
  TokenStream lowerCasing=new LowerCaseFilter(source1);
  String[] lowerCaseTokens=new String[tokens1.length];
  for (int i=0; i < tokens1.length; i++)   lowerCaseTokens[i]=tokens1[i].toLowerCase(Locale.ROOT);
  assertTokenStreamContents(lowerCasing,lowerCaseTokens);
}
