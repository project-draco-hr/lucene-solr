{
  Directory dir=newDirectory();
  Directory taxDir=newDirectory();
  FacetIndexingParams fip=new FacetIndexingParams(randomCategoryListParams());
  buildIndexWithFacets(dir,taxDir,true,fip);
  Directory dir1=newDirectory();
  Directory taxDir1=newDirectory();
  buildIndexWithFacets(dir1,taxDir1,false,fip);
  IndexWriter destIndexWriter=new IndexWriter(dir1,new IndexWriterConfig(TEST_VERSION_CURRENT,null));
  DirectoryTaxonomyWriter destTaxWriter=new DirectoryTaxonomyWriter(taxDir1);
  try {
    TaxonomyMergeUtils.merge(dir,taxDir,new MemoryOrdinalMap(),destIndexWriter,destTaxWriter,fip);
  }
  finally {
    IOUtils.close(destIndexWriter,destTaxWriter);
  }
  verifyResults(dir1,taxDir1,fip);
  dir1.close();
  taxDir1.close();
  dir.close();
  taxDir.close();
}
