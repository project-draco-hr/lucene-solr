{
  BytesRef[] sortedTerms=terms.toArray(new BytesRef[terms.size()]);
  boolean sorted=terms instanceof SortedSet && ((SortedSet<BytesRef>)terms).comparator() == null;
  if (!sorted) {
    ArrayUtil.timSort(sortedTerms);
  }
  PrefixCodedTerms.Builder builder=new PrefixCodedTerms.Builder();
  BytesRefBuilder previous=null;
  for (  BytesRef term : sortedTerms) {
    if (previous == null) {
      previous=new BytesRefBuilder();
    }
 else     if (previous.get().equals(term)) {
      continue;
    }
    builder.add(field,term);
    previous.copyBytes(term);
  }
  termData=builder.finish();
  termDataHashCode=termData.hashCode();
}
