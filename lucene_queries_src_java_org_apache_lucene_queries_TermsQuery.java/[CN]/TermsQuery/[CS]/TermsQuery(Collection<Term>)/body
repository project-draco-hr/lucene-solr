{
  Term[] sortedTerms=terms.toArray(new Term[terms.size()]);
  boolean sorted=terms instanceof SortedSet && ((SortedSet<Term>)terms).comparator() == null;
  if (!sorted) {
    ArrayUtil.timSort(sortedTerms);
  }
  PrefixCodedTerms.Builder builder=new PrefixCodedTerms.Builder();
  Set<String> fields=new HashSet<>();
  Term previous=null;
  for (  Term term : sortedTerms) {
    if (term.equals(previous) == false) {
      fields.add(term.field());
      builder.add(term);
    }
    previous=term;
  }
  singleField=fields.size() == 1;
  termData=builder.finish();
  termDataHashCode=termData.hashCode();
}
