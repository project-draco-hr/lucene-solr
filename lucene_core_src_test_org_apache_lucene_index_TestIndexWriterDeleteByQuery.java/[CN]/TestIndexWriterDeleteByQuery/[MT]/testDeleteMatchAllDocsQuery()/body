{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig());
  Document doc=new Document();
  doc.add(newStringField("field","foo",Field.Store.NO));
  w.addDocument(doc);
  DirectoryReader r=DirectoryReader.open(w);
  FieldInfo fi=MultiFields.getMergedFieldInfos(r).fieldInfo("field");
  assertNotNull(fi);
  assertFalse(fi.hasNorms());
  assertEquals(1,r.numDocs());
  assertEquals(1,r.maxDoc());
  w.deleteDocuments(new MatchAllDocsQuery());
  DirectoryReader r2=DirectoryReader.openIfChanged(r);
  r.close();
  assertNotNull(r2);
  assertEquals(0,r2.numDocs());
  assertEquals(0,r2.maxDoc());
  doc=new Document();
  doc.add(newTextField("field","foo",Field.Store.NO));
  w.addDocument(doc);
  DirectoryReader r3=DirectoryReader.openIfChanged(r2);
  r2.close();
  assertNotNull(r3);
  assertEquals(1,r3.numDocs());
  assertEquals(1,r3.maxDoc());
  fi=MultiFields.getMergedFieldInfos(r3).fieldInfo("field");
  assertNotNull(fi);
  assertTrue(fi.hasNorms());
  r3.close();
  w.close();
  dir.close();
}
