{
  log.debug("Closing Writer " + name);
  Directory directory=getDirectory();
  final InfoStream infoStream=isClosed ? null : getConfig().getInfoStream();
  try {
    while (true) {
      try {
        super.close();
      }
 catch (      ThreadInterruptedException e) {
        continue;
      }
catch (      Throwable t) {
        if (t instanceof OutOfMemoryError) {
          throw (OutOfMemoryError)t;
        }
        log.error("Error closing IndexWriter, trying rollback",t);
        super.rollback();
      }
      if (IndexWriter.isLocked(directory)) {
        try {
          IndexWriter.unlock(directory);
        }
 catch (        Exception e) {
          log.error("Coud not unlock directory after seemingly failed IndexWriter#close()",e);
        }
      }
      break;
    }
  }
  finally {
    if (infoStream != null) {
      infoStream.close();
    }
    isClosed=true;
    directoryFactory.release(directory);
    numCloses.incrementAndGet();
  }
}
