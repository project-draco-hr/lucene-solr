def prepare(root, version, gpgKeyID):
    print 
    print 'Prepare release...'
    if os.path.exists(LOG):
        os.remove(LOG)
    os.chdir(root)
    print '  svn up...'
    run('svn up')
    rev = getSVNRev()
    print ('  svn rev: %s' % rev)
    log(('\nSVN rev: %s\n' % rev))
    print '  ant clean test'
    run('ant clean test')
    print '  clean checkout'
    scrubCheckout()
    open('rev.txt', 'wb').write(rev)
    print '  lucene prepare-release'
    os.chdir('lucene')
    run(('ant -Dversion=%s -Dspecversion=%s -Dgpg.key=%s prepare-release' % (version, version, gpgKeyID)))
    print '  solr prepare-release'
    os.chdir('../solr')
    run(('ant -Dversion=%s -Dspecversion=%s -Dgpg.key=%s prepare-release' % (version, version, gpgKeyID)))
    print '  done!'
    print 
    return rev
