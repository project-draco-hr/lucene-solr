def parse_config():
    epilogue = textwrap.dedent('\n    Example usage for a Release Manager:\n    python3 -u dev-tools/scripts/buildAndPushRelease.py --push-local /tmp/releases/6.0.1 --sign 6E68DA61 --rc-num 1\n  ')
    description = 'Utility to build, push, and test a release.'
    parser = argparse.ArgumentParser(description=description, epilog=epilogue, formatter_class=argparse.RawDescriptionHelpFormatter)
    parser.add_argument('--no-prepare', dest='prepare', default=True, action='store_false', help='Use the already built release in the provided checkout')
    parser.add_argument('--push-local', metavar='PATH', help='Push the release to the local path')
    parser.add_argument('--sign', metavar='KEYID', help='Sign the release with the given gpg key')
    parser.add_argument('--rc-num', metavar='NUM', type=int, default=1, help='Release Candidate number, required')
    parser.add_argument('--root', metavar='WORKING_TREE_PATH', default='.', help='Root of Git working tree for lucene-solr')
    config = parser.parse_args()
    if ((not config.prepare) and config.sign):
        parser.error('Cannot sign already built release')
    if ((config.push_local is not None) and os.path.exists(config.push_local)):
        parser.error('Cannot push to local path that already exists')
    if (config.rc_num <= 0):
        parser.error('Release Candidate number must be a positive integer')
    if (not os.path.isdir(config.root)):
        parser.error(('Root path "%s" is not a directory' % config.root))
    cwd = os.getcwd()
    os.chdir(config.root)
    config.root = os.getcwd()
    if (os.system('git rev-parse') or (3 != len([d for d in ('dev-tools', 'lucene', 'solr') if os.isdir(d)]))):
        parser.error(('Root path "%s" is not a valid lucene-solr checkout' % config.root))
    os.chdir(cwd)
    config.version = read_version(config.root)
    print ('Building version: %s' % config.version)
    if config.sign:
        sys.stdout.flush()
        import getpass
        config.key_id = config.sign
        config.key_password = getpass.getpass('Enter GPG keystore password: ')
    else:
        config.gpg_password = None
    return config
