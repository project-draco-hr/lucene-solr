def getGitRev():
    status = os.popen('git status').read().strip()
    if ('nothing to commit, working directory clean' not in status):
        raise RuntimeError(('git clone is dirty:\n\n%s' % status))
    branch = os.popen('git rev-parse --abbrev-ref HEAD').read().strip()
    unpushedCommits = os.popen(('git log origin/%s..' % branch)).read().strip()
    if (len(unpushedCommits) > 0):
        raise RuntimeError(('There are unpushed commits - "git log origin.." output is:\n\n%s' % unpushedCommits))
    print '  git clone is clean'
    return os.popen('git rev-parse HEAD').read().strip()
