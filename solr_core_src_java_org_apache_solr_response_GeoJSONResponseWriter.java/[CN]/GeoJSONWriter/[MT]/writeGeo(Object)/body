{
  Shape shape=null;
  String str=null;
  if (geo instanceof Shape) {
    shape=(Shape)geo;
  }
 else   if (geo instanceof IndexableField) {
    str=((IndexableField)geo).stringValue();
  }
 else   if (geo instanceof WriteableGeoJSON) {
    shape=((WriteableGeoJSON)geo).shape;
  }
 else {
    str=geo.toString();
  }
  if (str != null) {
    if (str.startsWith("{") && str.endsWith("}")) {
      writer.write(str);
      return;
    }
    if (formats == null) {
      throw new SolrException(ErrorCode.BAD_REQUEST,"GeoJSON unable to write field: '&" + GeoJSONResponseWriter.FIELD + "="+ geofield+ "' ("+ str+ ")");
    }
    shape=formats.read(str);
  }
  if (geowriter == null) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"GeoJSON unable to write field: '&" + GeoJSONResponseWriter.FIELD + "="+ geofield+ "'");
  }
  if (shape != null) {
    geowriter.write(writer,shape);
  }
}
