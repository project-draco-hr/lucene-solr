{
  if (idx > 0) {
    writeArraySeparator();
  }
  indent();
  writeMapOpener(-1);
  incLevel();
  writeKey("type",false);
  writeVal(null,"Feature");
  Object val=doc.getFieldValue(geofield);
  if (val != null) {
    writeFeatureGeometry(val);
  }
  boolean first=true;
  for (  String fname : doc.getFieldNames()) {
    if (fname.equals(geofield) || ((returnFields != null && !returnFields.wantsField(fname)))) {
      continue;
    }
    writeMapSeparator();
    if (first) {
      indent();
      writeKey("properties",false);
      writeMapOpener(-1);
      incLevel();
      first=false;
    }
    indent();
    writeKey(fname,true);
    val=doc.getFieldValue(fname);
    if (val instanceof List) {
      writeArray(name,((Iterable)val).iterator());
    }
 else {
      writeVal(fname,val);
    }
  }
  if (doc.hasChildDocuments()) {
    if (first == false) {
      writeMapSeparator();
      indent();
    }
    writeKey("_childDocuments_",true);
    writeArrayOpener(doc.getChildDocumentCount());
    List<SolrDocument> childDocs=doc.getChildDocuments();
    for (int i=0; i < childDocs.size(); i++) {
      writeSolrDocument(null,childDocs.get(i),null,i);
    }
    writeArrayCloser();
  }
  if (!first) {
    decLevel();
    writeMapCloser();
  }
  decLevel();
  writeMapCloser();
}
