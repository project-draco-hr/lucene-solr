{
  if (rb.stage == ResponseBuilder.STAGE_GET_FIELDS) {
    NamedList<Object> termVectorsNL=new NamedList<>();
    Map.Entry<String,Object>[] arr=new NamedList.NamedListEntry[rb.resultIds.size()];
    for (    ShardRequest sreq : rb.finished) {
      if ((sreq.purpose & ShardRequest.PURPOSE_GET_FIELDS) == 0 || !sreq.params.getBool(COMPONENT_NAME,false)) {
        continue;
      }
      for (      ShardResponse srsp : sreq.responses) {
        NamedList<Object> nl=(NamedList<Object>)srsp.getSolrResponse().getResponse().get(TERM_VECTORS);
        Object warningsNL=nl.get(TV_KEY_WARNINGS);
        if (warningsNL != null && termVectorsNL.indexOf(TV_KEY_WARNINGS,0) < 0) {
          termVectorsNL.add(TV_KEY_WARNINGS,warningsNL);
        }
        SolrPluginUtils.copyNamedListIntoArrayByDocPosInResponse(nl,rb.resultIds,arr);
      }
    }
    SolrPluginUtils.removeNulls(arr,termVectorsNL);
    rb.rsp.add(TERM_VECTORS,termVectorsNL);
  }
}
