{
  if (rb.stage == ResponseBuilder.STAGE_GET_FIELDS) {
    NamedList termVectors=new NamedList<Object>();
    Map.Entry<String,Object>[] arr=new NamedList.NamedListEntry[rb.resultIds.size()];
    for (    ShardRequest sreq : rb.finished) {
      if ((sreq.purpose & ShardRequest.PURPOSE_GET_FIELDS) == 0 || !sreq.params.getBool(COMPONENT_NAME,false)) {
        continue;
      }
      for (      ShardResponse srsp : sreq.responses) {
        NamedList<Object> nl=(NamedList<Object>)srsp.getSolrResponse().getResponse().get(TERM_VECTORS);
        for (int i=0; i < nl.size(); i++) {
          String key=nl.getName(i);
          ShardDoc sdoc=rb.resultIds.get(key);
          if (null == sdoc) {
            if (termVectors.indexOf(key,0) < 0) {
              termVectors.add(key,nl.getVal(i));
            }
          }
 else {
            int idx=sdoc.positionInResponse;
            arr[idx]=new NamedList.NamedListEntry<Object>(key,nl.getVal(i));
          }
        }
      }
    }
    termVectors.addAll(SolrPluginUtils.removeNulls(new NamedList<Object>(arr)));
    rb.rsp.add(TERM_VECTORS,termVectors);
  }
}
