{
  createNewCollection("collection2");
  createNewCollection("collection3");
  while (pending != null && pending.size() > 0) {
    Future<Request> future=completionService.take();
    if (future == null)     return;
    pending.remove(future);
  }
  indexDoc("collection2",getDoc(id,"10000000"));
  indexDoc("collection2",getDoc(id,"10000001"));
  indexDoc("collection2",getDoc(id,"10000003"));
  indexDoc("collection3",getDoc(id,"20000000"));
  indexDoc("collection3",getDoc(id,"20000001"));
  otherCollectionClients.get("collection2").get(0).commit();
  otherCollectionClients.get("collection3").get(0).commit();
  long collection1Docs=solrj.query(new SolrQuery("*:*")).getResults().getNumFound();
  long collection2Docs=otherCollectionClients.get("collection2").get(0).query(new SolrQuery("*:*")).getResults().getNumFound();
  long collection3Docs=otherCollectionClients.get("collection3").get(0).query(new SolrQuery("*:*")).getResults().getNumFound();
  SolrQuery query=new SolrQuery("*:*");
  query.set("collection","collection2,collection3");
  long found=clients.get(0).query(query).getResults().getNumFound();
  assertEquals(collection2Docs + collection3Docs,found);
  query=new SolrQuery("*:*");
  query.set("collection","collection1,collection2,collection3");
  found=clients.get(0).query(query).getResults().getNumFound();
  assertEquals(collection1Docs + collection2Docs + collection3Docs,found);
  found=solrj.query(query).getResults().getNumFound();
  assertEquals(collection1Docs + collection2Docs + collection3Docs,found);
  query.set("collection","collection2,collection3");
  found=solrj.query(query).getResults().getNumFound();
  assertEquals(collection2Docs + collection3Docs,found);
  query.set("collection","collection3");
  found=solrj.query(query).getResults().getNumFound();
  assertEquals(collection3Docs,found);
  query.remove("collection");
  found=solrj.query(query).getResults().getNumFound();
  assertEquals(collection1Docs,found);
}
