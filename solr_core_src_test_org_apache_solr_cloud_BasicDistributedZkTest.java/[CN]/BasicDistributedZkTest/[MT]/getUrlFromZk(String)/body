{
  CloudState cloudState=solrj.getZkStateReader().getCloudState();
  Map<String,Slice> slices=cloudState.getCollectionStates().get(collection);
  if (slices == null) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"Could not find collection:" + collection);
  }
  for (  Map.Entry<String,Slice> entry : slices.entrySet()) {
    Slice slice=entry.getValue();
    Map<String,ZkNodeProps> shards=slice.getShards();
    Set<Map.Entry<String,ZkNodeProps>> shardEntries=shards.entrySet();
    for (    Map.Entry<String,ZkNodeProps> shardEntry : shardEntries) {
      final ZkNodeProps node=shardEntry.getValue();
      if (cloudState.liveNodesContain(node.get(ZkStateReader.NODE_NAME_PROP))) {
        return new ZkCoreNodeProps(node).getCoreUrl();
      }
    }
  }
  throw new RuntimeException("Could not find a live node for collection:" + collection);
}
