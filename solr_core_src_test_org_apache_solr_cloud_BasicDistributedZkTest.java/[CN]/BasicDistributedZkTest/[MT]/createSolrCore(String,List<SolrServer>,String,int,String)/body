{
  Callable call=new Callable(){
    @Override public Object call(){
      HttpSolrServer server=null;
      try {
        server=new HttpSolrServer(baseUrl);
        server.setConnectionTimeout(15000);
        Create createCmd=new Create();
        createCmd.setRoles("none");
        createCmd.setCoreName(collection + num);
        createCmd.setCollection(collection);
        if (random().nextBoolean()) {
          createCmd.setCoreNodeName("anode" + nodeCounter.incrementAndGet());
        }
        if (shardId == null) {
          createCmd.setNumShards(2);
        }
        createCmd.setDataDir(getDataDir(dataDir.getAbsolutePath() + File.separator + collection+ num));
        if (shardId != null) {
          createCmd.setShardId(shardId);
        }
        server.request(createCmd);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
 finally {
        if (server != null) {
          server.shutdown();
        }
      }
      return null;
    }
  }
;
  pending.add(completionService.submit(call));
  collectionClients.add(createNewSolrServer(collection + num,baseUrl));
}
