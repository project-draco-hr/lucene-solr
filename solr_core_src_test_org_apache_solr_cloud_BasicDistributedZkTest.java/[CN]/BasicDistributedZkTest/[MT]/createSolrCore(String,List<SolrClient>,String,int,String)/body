{
  Callable call=new Callable(){
    @Override public Object call(){
      HttpSolrClient client=null;
      try {
        client=new HttpSolrClient(baseUrl);
        client.setConnectionTimeout(15000);
        Create createCmd=new Create();
        createCmd.setRoles("none");
        createCmd.setCoreName(collection + num);
        createCmd.setCollection(collection);
        if (random().nextBoolean()) {
          createCmd.setCoreNodeName("anode" + nodeCounter.incrementAndGet());
        }
        if (shardId == null) {
          createCmd.setNumShards(2);
        }
        createCmd.setDataDir(getDataDir(createTempDir(collection).toFile().getAbsolutePath()));
        if (shardId != null) {
          createCmd.setShardId(shardId);
        }
        client.request(createCmd);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
 finally {
        if (client != null) {
          client.shutdown();
        }
      }
      return null;
    }
  }
;
  pending.add(completionService.submit(call));
  collectionClients.add(createNewSolrClient(collection + num,baseUrl));
}
