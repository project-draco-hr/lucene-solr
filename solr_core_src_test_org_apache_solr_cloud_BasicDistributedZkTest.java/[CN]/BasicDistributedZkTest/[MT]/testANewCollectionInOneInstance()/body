{
  log.info("### STARTING testANewCollectionInOneInstance");
  List<SolrClient> collectionClients=new ArrayList<>();
  SolrClient client=clients.get(0);
  final String baseUrl=((HttpSolrClient)client).getBaseURL().substring(0,((HttpSolrClient)client).getBaseURL().length() - DEFAULT_COLLECTION.length() - 1);
  createCollection(oneInstanceCollection,collectionClients,baseUrl,1);
  createCollection(oneInstanceCollection,collectionClients,baseUrl,2);
  createCollection(oneInstanceCollection,collectionClients,baseUrl,3);
  createCollection(oneInstanceCollection,collectionClients,baseUrl,4);
  while (pending != null && pending.size() > 0) {
    Future<Object> future=completionService.take();
    if (future == null)     return;
    pending.remove(future);
  }
  SolrClient client1=collectionClients.get(0);
  SolrClient client2=collectionClients.get(1);
  SolrClient client3=collectionClients.get(2);
  SolrClient client4=collectionClients.get(3);
  waitForRecoveriesToFinish(oneInstanceCollection,getCommonCloudSolrClient().getZkStateReader(),false);
  assertAllActive(oneInstanceCollection,getCommonCloudSolrClient().getZkStateReader());
  client2.add(getDoc(id,"1"));
  client3.add(getDoc(id,"2"));
  client4.add(getDoc(id,"3"));
  client1.commit();
  SolrQuery query=new SolrQuery("*:*");
  query.set("distrib",false);
  long oneDocs=client1.query(query).getResults().getNumFound();
  long twoDocs=client2.query(query).getResults().getNumFound();
  long threeDocs=client3.query(query).getResults().getNumFound();
  long fourDocs=client4.query(query).getResults().getNumFound();
  query.set("collection",oneInstanceCollection);
  query.set("distrib",true);
  long allDocs=getCommonCloudSolrClient().query(query).getResults().getNumFound();
  assertEquals(3,allDocs);
  for (  SolrClient newCollectionClient : collectionClients) {
    newCollectionClient.shutdown();
  }
}
