{
  Evaluator dateFormatEval=EvaluatorBag.getDateFormatEvaluator();
  ContextImpl context=new ContextImpl(null,resolver,null,Context.FULL_DUMP,Collections.EMPTY_MAP,null,null);
  Context.CURRENT_CONTEXT.set(context);
  try {
    long time=System.currentTimeMillis();
    assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm").format(new Date(time - 2 * 86400 * 1000)),dateFormatEval.evaluate("'NOW-2DAYS','yyyy-MM-dd HH:mm'",Context.CURRENT_CONTEXT.get()));
    Map<String,Object> map=new HashMap<String,Object>();
    map.put("key",new Date(time));
    resolver.addNamespace("A",map);
    assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm").format(new Date(time)),dateFormatEval.evaluate("A.key, 'yyyy-MM-dd HH:mm'",Context.CURRENT_CONTEXT.get()));
  }
  finally {
    Context.CURRENT_CONTEXT.remove();
  }
}
