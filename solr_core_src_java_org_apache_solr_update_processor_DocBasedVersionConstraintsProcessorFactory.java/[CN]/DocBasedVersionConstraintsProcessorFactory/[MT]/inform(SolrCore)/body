{
  if (core.getUpdateHandler().getUpdateLog() == null) {
    throw new SolrException(SERVER_ERROR,"updateLog must be enabled.");
  }
  if (core.getLatestSchema().getUniqueKeyField() == null) {
    throw new SolrException(SERVER_ERROR,"schema must have uniqueKey defined.");
  }
  SchemaField userVersionField=core.getLatestSchema().getField(versionField);
  if (userVersionField == null || !userVersionField.stored() || userVersionField.multiValued()) {
    throw new SolrException(SERVER_ERROR,"field " + versionField + " must be defined in schema, be stored, and be single valued.");
  }
  try {
    ValueSource vs=userVersionField.getType().getValueSource(userVersionField,null);
    useFieldCache=true;
  }
 catch (  Exception e) {
    log.warn("Can't use fieldcache/valuesource: " + e.getMessage());
  }
}
