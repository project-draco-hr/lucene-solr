{
  List<IndexableField> fields=doc.getFields();
  Analyzer analyzer=getRunData().getAnalyzer();
  int tokenCount=0;
  for (  final IndexableField field : fields) {
    if (!field.fieldType().tokenized() || field instanceof LegacyIntField || field instanceof LegacyLongField|| field instanceof LegacyFloatField|| field instanceof LegacyDoubleField) {
      continue;
    }
    final TokenStream stream=field.tokenStream(analyzer,null);
    stream.reset();
    TermToBytesRefAttribute termAtt=stream.getAttribute(TermToBytesRefAttribute.class);
    while (stream.incrementToken()) {
      termAtt.getBytesRef();
      tokenCount++;
    }
    stream.end();
    stream.close();
  }
  totalTokenCount+=tokenCount;
  return tokenCount;
}
