{
  final boolean expectCFS=Boolean.parseBoolean(System.getProperty("useCompoundFile"));
  initCore("solrconfig-tieredmergepolicy.xml","schema-minimal.xml");
  IndexWriterConfig iwc=solrConfig.indexConfig.toIndexWriterConfig(h.getCore());
  assertEquals(expectCFS,iwc.getUseCompoundFile());
  TieredMergePolicy tieredMP=assertAndCast(TieredMergePolicy.class,iwc.getMergePolicy());
  assertEquals(7,tieredMP.getMaxMergeAtOnce());
  assertEquals(19,tieredMP.getMaxMergeAtOnceExplicit());
  assertEquals(0.1D,tieredMP.getNoCFSRatio(),0.0D);
  assertEquals(9D,tieredMP.getSegmentsPerTier(),0.001);
  assertCommitSomeNewDocs();
  assertCompoundSegments(h.getCore(),expectCFS);
  assertCommitSomeNewDocs();
  assertNumSegments(h.getCore(),2);
  assertCompoundSegments(h.getCore(),expectCFS);
  assertU(optimize());
  assertNumSegments(h.getCore(),1);
  assertCompoundSegments(h.getCore(),false);
}
