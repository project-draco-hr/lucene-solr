{
  CoreContainer cores=null;
  String solrHome=SolrResourceLoader.locateSolrHome();
  File fconf=new File(solrHome,solrConfigFilename == null ? "solr.xml" : solrConfigFilename);
  log.info("looking for solr.xml: " + fconf.getAbsolutePath());
  if (fconf.exists()) {
    cores=new CoreContainer();
    cores.load(solrHome,fconf);
    abortOnConfigurationError=false;
    for (    SolrCore c : cores.getCores()) {
      if (c.getSolrConfig().getBool("abortOnConfigurationError",false)) {
        abortOnConfigurationError=true;
        break;
      }
    }
    solrConfigFilename=cores.getConfigFile().getName();
  }
 else {
    cores=new CoreContainer(solrHome);
    CoreDescriptor dcore=new CoreDescriptor(cores,"",".");
    dcore.setCoreProperties(null);
    SolrResourceLoader resourceLoader=new SolrResourceLoader(solrHome,null,getCoreProps(solrHome,null,dcore.getCoreProperties()));
    cores.loader=resourceLoader;
    SolrConfig cfg=solrConfigFilename == null ? new SolrConfig(resourceLoader,SolrConfig.DEFAULT_CONF_FILE,null) : new SolrConfig(resourceLoader,solrConfigFilename,null);
    SolrCore singlecore=new SolrCore(null,null,cfg,null,dcore);
    abortOnConfigurationError=cfg.getBool("abortOnConfigurationError",abortOnConfigurationError);
    cores.register("",singlecore,false);
    cores.setPersistent(false);
    solrConfigFilename=cfg.getName();
  }
  return cores;
}
