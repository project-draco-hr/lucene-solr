{
  final CoreContainer cc=init();
  try {
    SolrCore core=cc.getCore("core1");
    SolrQueryResponse rsp=new SolrQueryResponse();
    SolrRequestHandler handler=core.getRequestHandler("/admin/file");
    ModifiableSolrParams params=params("file","schema.xml","op","write");
    core.execute(handler,new LocalSolrQueryRequest(core,params),rsp);
    assertEquals(rsp.getException().getMessage(),"Input stream list was null for admin file write operation.");
    params=params("op","write","stream.body","Testing rewrite of schema.xml file.");
    core.execute(handler,new LocalSolrQueryRequest(core,params),rsp);
    assertEquals(rsp.getException().getMessage(),"No file name specified for write operation.");
    params=params("op","write","file","bogus.txt");
    core.execute(handler,new LocalSolrQueryRequest(core,params),rsp);
    assertEquals(rsp.getException().getMessage(),"Can not access: bogus.txt");
    ArrayList<ContentStream> streams=new ArrayList<ContentStream>(2);
    streams.add(new ContentStreamBase.StringStream("Testing rewrite of schema.xml file."));
    params=params("op","write","file","schema.xml","stream.body","Testing rewrite of schema.xml file.");
    LocalSolrQueryRequest locReq=new LocalSolrQueryRequest(core,params);
    locReq.setContentStreams(streams);
    core.execute(handler,locReq,rsp);
    String contents=FileUtils.readFileToString(new File(core.getCoreDescriptor().getInstanceDir(),"conf/schema.xml"));
    assertEquals("Schema contents should have changed!","Testing rewrite of schema.xml file.",contents);
    streams.add(new ContentStreamBase.StringStream("This should barf"));
    locReq=new LocalSolrQueryRequest(core,params);
    locReq.setContentStreams(streams);
    core.execute(handler,locReq,rsp);
    assertEquals(rsp.getException().getMessage(),"More than one input stream was found for admin file write operation.");
    streams.clear();
    streams.add(new ContentStreamBase.StringStream("Some bogus stuff for a test."));
    params=params("op","write","file","velocity/test.vm");
    locReq=new LocalSolrQueryRequest(core,params);
    locReq.setContentStreams(streams);
    core.execute(handler,locReq,rsp);
    contents=FileUtils.readFileToString(new File(core.getCoreDescriptor().getInstanceDir(),"conf/velocity/test.vm"));
    assertEquals("Schema contents should have changed!","Some bogus stuff for a test.",contents);
    core.close();
  }
  finally {
    cc.shutdown();
    if (solrHomeDirectory.exists()) {
      FileUtils.deleteDirectory(solrHomeDirectory);
    }
  }
}
