{
  BooleanQuery.setMaxClauseCount(savedBoolMaxClauseCount);
  try {
    if (checkFieldCacheSanity)     assertSaneFieldCaches(getTestLabel());
    if (ConcurrentMergeScheduler.anyUnhandledExceptions()) {
      ConcurrentMergeScheduler.clearUnhandledExceptions();
      fail("ConcurrentMergeScheduler hit unhandled exceptions");
    }
  }
  finally {
    purgeFieldCache(FieldCache.DEFAULT);
  }
  Thread.setDefaultUncaughtExceptionHandler(savedUncaughtExceptionHandler);
  if (!uncaughtExceptions.isEmpty()) {
    System.err.println("The following exceptions were thrown by threads:");
    for (    UncaughtExceptionEntry entry : uncaughtExceptions) {
      System.err.println("*** Thread: " + entry.thread.getName() + " ***");
      entry.exception.printStackTrace(System.err);
    }
    fail("Some threads throwed uncaught exceptions!");
  }
}
