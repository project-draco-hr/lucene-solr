{
  int intVal=(int)d;
  final long doubleBits=Double.doubleToLongBits(d);
  if (d == intVal && intVal >= -1 && intVal <= 0x7C && doubleBits != NEGATIVE_ZERO_DOUBLE) {
    out.writeByte((byte)(0x80 | (intVal + 1)));
    return;
  }
 else   if (d == (float)d) {
    out.writeByte((byte)0xFE);
    out.writeInt(Float.floatToIntBits((float)d));
  }
 else   if ((doubleBits >>> 63) == 0) {
    out.writeLong(doubleBits);
  }
 else {
    out.writeByte((byte)0xFF);
    out.writeLong(doubleBits);
  }
}
