{
  ++numStoredFieldsInDoc;
  int bits=0;
  final BytesRef bytes;
  final String string;
  Number number=field.numericValue();
  if (number != null) {
    if (number instanceof Byte || number instanceof Short || number instanceof Integer) {
      bits=NUMERIC_INT;
    }
 else     if (number instanceof Long) {
      bits=NUMERIC_LONG;
    }
 else     if (number instanceof Float) {
      bits=NUMERIC_FLOAT;
    }
 else     if (number instanceof Double) {
      bits=NUMERIC_DOUBLE;
    }
 else {
      throw new IllegalArgumentException("cannot store numeric type " + number.getClass());
    }
    string=null;
    bytes=null;
  }
 else {
    bytes=field.binaryValue();
    if (bytes != null) {
      bits=BYTE_ARR;
      string=null;
    }
 else {
      bits=STRING;
      string=field.stringValue();
      if (string == null) {
        throw new IllegalArgumentException("field " + field.name() + " is stored but does not have binaryValue, stringValue nor numericValue");
      }
    }
  }
  final long infoAndBits=(((long)info.number) << TYPE_BITS) | bits;
  bufferedDocs.writeVLong(infoAndBits);
  if (bytes != null) {
    bufferedDocs.writeVInt(bytes.length);
    bufferedDocs.writeBytes(bytes.bytes,bytes.offset,bytes.length);
  }
 else   if (string != null) {
    scratchBytes=ArrayUtil.grow(scratchBytes,string.length() * UnicodeUtil.MAX_UTF8_BYTES_PER_CHAR);
    int length=UnicodeUtil.UTF16toUTF8(string,0,string.length(),scratchBytes);
    bufferedDocs.writeVInt(length);
    bufferedDocs.writeBytes(scratchBytes,length);
  }
 else {
    if (number instanceof Byte || number instanceof Short || number instanceof Integer) {
      bufferedDocs.writeZInt(number.intValue());
    }
 else     if (number instanceof Long) {
      writeTLong(bufferedDocs,number.longValue());
    }
 else     if (number instanceof Float) {
      writeZFloat(bufferedDocs,number.floatValue());
    }
 else     if (number instanceof Double) {
      writeZDouble(bufferedDocs,number.doubleValue());
    }
 else {
      throw new AssertionError("Cannot get here");
    }
  }
}
