{
  IndexReaderContext topLevelContext=reader.getContext();
  FixedBitSet bs=getRandomSet(reader.maxDoc(),rand.nextInt(reader.maxDoc() + 1));
  DocSet a=new BitDocSet(bs);
  DocSet b=getIntDocSet(bs);
  Filter fa=a.getTopFilter();
  Filter fb=b.getTopFilter();
  DocIdSet da;
  DocIdSet db;
  List<LeafReaderContext> leaves=topLevelContext.leaves();
  for (  LeafReaderContext readerContext : leaves) {
    da=fa.getDocIdSet(readerContext,null);
    db=fb.getDocIdSet(readerContext,null);
    doTestIteratorEqual(da,db);
  }
  int nReaders=leaves.size();
  for (int i=0; i < nReaders; i++) {
    LeafReaderContext readerContext=leaves.get(rand.nextInt(nReaders));
    da=fa.getDocIdSet(readerContext,null);
    db=fb.getDocIdSet(readerContext,null);
    doTestIteratorEqual(da,db);
  }
}
