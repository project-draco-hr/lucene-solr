{
  Map<String,Replica> result=new HashMap<String,Replica>();
  long endTime=System.nanoTime() + TimeUnit.NANOSECONDS.convert(3,TimeUnit.SECONDS);
  for (; ; ) {
    DocCollection coll=zkStateReader.getClusterState().getCollection(collectionName);
    for (    String coreName : coreNames) {
      if (result.containsKey(coreName))       continue;
      for (      Slice slice : coll.getSlices()) {
        for (        Replica replica : slice.getReplicas()) {
          if (coreName.equals(replica.getStr(ZkStateReader.CORE_NAME_PROP))) {
            result.put(coreName,replica);
            break;
          }
        }
      }
    }
    if (result.size() == coreNames.size()) {
      return result;
    }
    if (System.nanoTime() > endTime) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Unable to create replica entries in ZK");
    }
    Thread.sleep(100);
  }
}
