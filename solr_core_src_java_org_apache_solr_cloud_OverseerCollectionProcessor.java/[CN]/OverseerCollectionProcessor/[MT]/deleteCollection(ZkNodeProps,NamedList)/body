{
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set(CoreAdminParams.ACTION,CoreAdminAction.UNLOAD.toString());
  params.set(CoreAdminParams.DELETE_INSTANCE_DIR,true);
  params.set(CoreAdminParams.DELETE_DATA_DIR,true);
  collectionCmd(zkStateReader.getClusterState(),message,params,results,null);
  ZkNodeProps m=new ZkNodeProps(Overseer.QUEUE_OPERATION,Overseer.REMOVECOLLECTION,"name",message.getStr("name"));
  Overseer.getInQueue(zkStateReader.getZkClient()).offer(ZkStateReader.toJSON(m));
  long now=System.currentTimeMillis();
  long timeout=now + 30000;
  boolean removed=false;
  while (System.currentTimeMillis() < timeout) {
    Thread.sleep(100);
    removed=!zkStateReader.getClusterState().getCollections().contains(message.getStr("name"));
    if (removed) {
      Thread.sleep(100);
      break;
    }
  }
  if (!removed) {
    throw new SolrException(ErrorCode.SERVER_ERROR,"Could not fully remove collection: " + message.getStr("name"));
  }
}
