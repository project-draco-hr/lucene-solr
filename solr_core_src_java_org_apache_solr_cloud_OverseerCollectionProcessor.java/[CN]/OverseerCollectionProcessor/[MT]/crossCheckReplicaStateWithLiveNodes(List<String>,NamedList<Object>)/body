{
  Iterator<Map.Entry<String,Object>> colls=collectionProps.iterator();
  while (colls.hasNext()) {
    Map.Entry<String,Object> next=colls.next();
    Map<String,Object> collMap=(Map<String,Object>)next.getValue();
    Map<String,Object> shards=(Map<String,Object>)collMap.get("shards");
    for (    Object nextShard : shards.values()) {
      Map<String,Object> shardMap=(Map<String,Object>)nextShard;
      Map<String,Object> replicas=(Map<String,Object>)shardMap.get("replicas");
      for (      Object nextReplica : replicas.values()) {
        Map<String,Object> replicaMap=(Map<String,Object>)nextReplica;
        if (!ZkStateReader.DOWN.equals(replicaMap.get(ZkStateReader.STATE_PROP))) {
          String node_name=(String)replicaMap.get(ZkStateReader.NODE_NAME_PROP);
          if (!liveNodes.contains(node_name)) {
            replicaMap.put(ZkStateReader.STATE_PROP,ZkStateReader.DOWN);
          }
        }
      }
    }
  }
}
