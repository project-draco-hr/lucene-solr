{
  int retryCount=320;
  while (retryCount-- > 0) {
    Map<String,Slice> slicesMap=zkStateReader.getClusterState().getSlicesMap(collectionName);
    if (slicesMap != null) {
      for (      Slice slice : slicesMap.values()) {
        for (        Replica replica : slice.getReplicas()) {
          String nodeName=replica.getStr(ZkStateReader.NODE_NAME_PROP);
          String core=replica.getStr(ZkStateReader.CORE_NAME_PROP);
          if (nodeName.equals(msgNodeName) && core.equals(msgCore)) {
            return replica.getName();
          }
        }
      }
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
    }
  }
  throw new SolrException(ErrorCode.SERVER_ERROR,"Could not find coreNodeName");
}
