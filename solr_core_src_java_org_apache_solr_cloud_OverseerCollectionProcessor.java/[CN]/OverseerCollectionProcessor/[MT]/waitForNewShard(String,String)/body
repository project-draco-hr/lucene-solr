{
  log.info("Waiting for slice {} of collection {} to be available",sliceName,collectionName);
  long startTime=System.currentTimeMillis();
  int retryCount=320;
  while (retryCount-- > 0) {
    DocCollection collection=zkStateReader.getClusterState().getCollection(collectionName);
    if (collection == null) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Unable to find collection: " + collectionName + " in clusterstate");
    }
    Slice slice=collection.getSlice(sliceName);
    if (slice != null) {
      log.info("Waited for {} seconds for slice {} of collection {} to be available",(System.currentTimeMillis() - startTime) / 1000,sliceName,collectionName);
      return;
    }
    Thread.sleep(1000);
    zkStateReader.updateClusterState();
  }
  throw new SolrException(ErrorCode.SERVER_ERROR,"Could not find new slice " + sliceName + " in collection "+ collectionName+ " even after waiting for "+ (System.currentTimeMillis() - startTime) / 1000 + " seconds");
}
