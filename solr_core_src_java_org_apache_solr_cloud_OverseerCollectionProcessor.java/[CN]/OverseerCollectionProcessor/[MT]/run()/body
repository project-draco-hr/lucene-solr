{
  log.info("Process current queue of collection messages");
  while (amILeader() && !isClosed) {
    try {
      byte[] head=workQueue.peek(true);
      final ZkNodeProps message=ZkNodeProps.load(head);
      final String operation=message.getStr(QUEUE_OPERATION);
      try {
        boolean success=processMessage(message,operation);
        if (!success) {
          SolrException.log(log,"Collection " + operation + " of "+ message.getStr("name")+ " failed");
        }
      }
 catch (      Throwable t) {
        SolrException.log(log,"Collection " + operation + " of "+ message.getStr("name")+ " failed",t);
      }
      workQueue.poll();
    }
 catch (    KeeperException e) {
      if (e.code() == KeeperException.Code.SESSIONEXPIRED || e.code() == KeeperException.Code.CONNECTIONLOSS) {
        log.warn("Overseer cannot talk to ZK");
        return;
      }
      SolrException.log(log,"",e);
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
    }
catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      return;
    }
  }
}
