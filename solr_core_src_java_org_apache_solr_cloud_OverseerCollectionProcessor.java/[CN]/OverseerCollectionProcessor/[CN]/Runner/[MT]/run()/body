{
  final TimerContext timerContext=stats.time("collection_" + operation);
  boolean success=false;
  final String asyncId=message.getStr(ASYNC);
  String collectionName=message.containsKey(COLLECTION_PROP) ? message.getStr(COLLECTION_PROP) : message.getStr(NAME);
  try {
    try {
      log.debug("Runner processing {}",head.getId());
      response=processMessage(message,operation);
    }
  finally {
      timerContext.stop();
      updateStats();
    }
    if (asyncId != null) {
      if (response != null && (response.getResponse().get("failure") != null || response.getResponse().get("exception") != null)) {
        failureMap.put(asyncId,SolrResponse.serializable(response));
        log.debug("Updated failed map for task with zkid:[{}]",head.getId());
      }
 else {
        completedMap.put(asyncId,SolrResponse.serializable(response));
        log.debug("Updated completed map for task with zkid:[{}]",head.getId());
      }
    }
 else {
      head.setBytes(SolrResponse.serializable(response));
      log.debug("Completed task:[{}]",head.getId());
    }
    markTaskComplete(head.getId(),asyncId,collectionName);
    log.debug("Marked task [{}] as completed.",head.getId());
    printTrackingMaps();
    log.info("Overseer Collection Processor: Message id:" + head.getId() + " complete, response:"+ response.getResponse().toString());
    success=true;
  }
 catch (  KeeperException e) {
    SolrException.log(log,"",e);
  }
catch (  InterruptedException e) {
    resetTaskWithException(head.getId(),asyncId,collectionName);
    log.warn("Resetting task {} as the thread was interrupted.",head.getId());
    Thread.currentThread().interrupt();
  }
 finally {
    if (!success) {
      resetTaskWithException(head.getId(),asyncId,collectionName);
    }
synchronized (waitLock) {
      waitLock.notifyAll();
    }
  }
}
