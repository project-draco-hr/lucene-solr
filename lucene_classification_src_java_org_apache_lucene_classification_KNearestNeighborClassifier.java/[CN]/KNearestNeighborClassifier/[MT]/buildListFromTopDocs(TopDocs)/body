{
  Map<BytesRef,Integer> classCounts=new HashMap<>();
  for (  ScoreDoc scoreDoc : topDocs.scoreDocs) {
    BytesRef cl=new BytesRef(indexSearcher.doc(scoreDoc.doc).getField(classFieldName).stringValue());
    Integer count=classCounts.get(cl);
    if (count != null) {
      classCounts.put(cl,count + 1);
    }
 else {
      classCounts.put(cl,1);
    }
  }
  List<ClassificationResult<BytesRef>> returnList=new ArrayList<>();
  int sumdoc=0;
  for (  Map.Entry<BytesRef,Integer> entry : classCounts.entrySet()) {
    Integer count=entry.getValue();
    returnList.add(new ClassificationResult<>(entry.getKey().clone(),count / (double)k));
    sumdoc+=count;
  }
  if (sumdoc < k) {
    for (    ClassificationResult<BytesRef> cr : returnList) {
      cr.setScore(cr.getScore() * (double)k / (double)sumdoc);
    }
  }
  return returnList;
}
