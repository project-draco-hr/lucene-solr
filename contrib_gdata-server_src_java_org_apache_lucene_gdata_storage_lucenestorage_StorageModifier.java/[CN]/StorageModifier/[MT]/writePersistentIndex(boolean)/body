{
  try {
    for (    Term entryIdTerm : this.deletedForUpdateDocumentQueue) {
      this.modifier.deleteDocuments(entryIdTerm);
    }
    for (    Term term : this.forceWriteTerms) {
      this.modifier.deleteDocuments(term);
    }
    Collection<Document> documents=this.documentMap.values();
    for (    Document doc : documents) {
      this.modifier.addDocument(doc);
    }
    for (    Document docs : this.forceWriteDocuments) {
      this.modifier.addDocument(docs);
    }
    for (    Term entryIdTerm : this.deletedDocumentQueue) {
      this.modifier.deleteDocuments(entryIdTerm);
    }
    this.modifier.flush();
    if (optimize) {
      if (LOG.isInfoEnabled())       LOG.info("Optimizing index -- optimize interval " + this.optimizeInterval);
      this.modifier.optimize();
    }
  }
  finally {
    if (optimize)     this.optimizeCounter=0;
    this.modifier.close();
    this.deletedForUpdateDocumentQueue.clear();
    this.deletedDocumentQueue.clear();
    this.documentMap.clear();
    this.forceWriteDocuments.clear();
    this.forceWriteTerms.clear();
  }
}
