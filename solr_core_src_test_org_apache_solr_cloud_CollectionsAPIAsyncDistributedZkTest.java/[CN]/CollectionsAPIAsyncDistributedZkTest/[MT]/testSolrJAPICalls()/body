{
  SolrServer server=createNewSolrServer("",getBaseUrl((HttpSolrServer)clients.get(0)));
  Create createCollectionRequest=new Create();
  createCollectionRequest.setCollectionName("testasynccollectioncreation");
  createCollectionRequest.setNumShards(1);
  createCollectionRequest.setConfigName("conf1");
  createCollectionRequest.setAsyncId("1001");
  createCollectionRequest.process(server);
  String state=getRequestStateAfterCompletion("1001",MAX_TIMEOUT_SECONDS,server);
  assertEquals("CreateCollection task did not complete!","completed",state);
  createCollectionRequest=new Create();
  createCollectionRequest.setCollectionName("testasynccollectioncreation");
  createCollectionRequest.setNumShards(1);
  createCollectionRequest.setConfigName("conf1");
  createCollectionRequest.setAsyncId("1002");
  createCollectionRequest.process(server);
  state=getRequestStateAfterCompletion("1002",MAX_TIMEOUT_SECONDS,server);
  assertEquals("Recreating a collection with the same name didn't fail, should have.","failed",state);
  CollectionAdminRequest.AddReplica addReplica=new CollectionAdminRequest.AddReplica();
  addReplica.setCollectionName("testasynccollectioncreation");
  addReplica.setShardName("shard1");
  addReplica.setAsyncId("1003");
  server.request(addReplica);
  state=getRequestStateAfterCompletion("1003",MAX_TIMEOUT_SECONDS,server);
  assertEquals("Add replica did not complete","completed",state);
  SplitShard splitShardRequest=new SplitShard();
  splitShardRequest.setCollectionName("testasynccollectioncreation");
  splitShardRequest.setShardName("shard1");
  splitShardRequest.setAsyncId("1004");
  splitShardRequest.process(server);
  state=getRequestStateAfterCompletion("1004",MAX_TIMEOUT_SECONDS * 2,server);
  assertEquals("Shard split did not complete. Last recorded state: " + state,"completed",state);
}
