{
  SolrServer server=createNewSolrServer("",getBaseUrl((HttpSolrServer)clients.get(0)));
  CollectionAdminRequest.createCollection("testasynccollectioncreation",1,"conf1",server,"1001");
  String state=null;
  state=getRequestStateAfterCompletion("1001",MAX_TIMEOUT_SECONDS,server);
  assertEquals("CreateCollection task did not complete!","completed",state);
  CollectionAdminRequest.createCollection("testasynccollectioncreation",1,"conf1",server,"1002");
  state=getRequestStateAfterCompletion("1002",MAX_TIMEOUT_SECONDS,server);
  assertEquals("Recreating a collection with the same name didn't fail, should have.","failed",state);
  CollectionAdminRequest.AddReplica addReplica=new CollectionAdminRequest.AddReplica();
  addReplica.setCollectionName("testasynccollectioncreation");
  addReplica.setShardName("shard1");
  addReplica.setAsyncId("1003");
  server.request(addReplica);
  state=getRequestStateAfterCompletion("1003",MAX_TIMEOUT_SECONDS,server);
  assertEquals("Add replica did not complete","completed",state);
  CollectionAdminRequest.splitShard("testasynccollectioncreation","shard1",server,"1004");
  state=getRequestStateAfterCompletion("1004",MAX_TIMEOUT_SECONDS * 2,server);
  assertEquals("Shard split did not complete. Last recorded state: " + state,"completed",state);
}
