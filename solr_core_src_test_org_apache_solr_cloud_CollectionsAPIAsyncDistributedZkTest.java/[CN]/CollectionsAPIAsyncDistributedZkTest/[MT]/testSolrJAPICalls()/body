{
  try (SolrClient client=createNewSolrClient("",getBaseUrl((HttpSolrClient)clients.get(0)))){
    Create createCollectionRequest=new Create().setCollectionName("testasynccollectioncreation").setNumShards(1).setConfigName("conf1").setAsyncId("1001");
    createCollectionRequest.process(client);
    String state=getRequestStateAfterCompletion("1001",MAX_TIMEOUT_SECONDS,client);
    assertEquals("CreateCollection task did not complete!","completed",state);
    createCollectionRequest=new Create().setCollectionName("testasynccollectioncreation").setNumShards(1).setConfigName("conf1").setAsyncId("1002");
    createCollectionRequest.process(client);
    state=getRequestStateAfterCompletion("1002",MAX_TIMEOUT_SECONDS,client);
    assertEquals("Recreating a collection with the same name didn't fail, should have.","failed",state);
    CollectionAdminRequest.AddReplica addReplica=new CollectionAdminRequest.AddReplica().setCollectionName("testasynccollectioncreation").setShardName("shard1").setAsyncId("1003");
    client.request(addReplica);
    state=getRequestStateAfterCompletion("1003",MAX_TIMEOUT_SECONDS,client);
    assertEquals("Add replica did not complete","completed",state);
    SplitShard splitShardRequest=new SplitShard().setCollectionName("testasynccollectioncreation").setShardName("shard1").setAsyncId("1004");
    splitShardRequest.process(client);
    state=getRequestStateAfterCompletion("1004",MAX_TIMEOUT_SECONDS * 2,client);
    assertEquals("Shard split did not complete. Last recorded state: " + state,"completed",state);
  }
 }
