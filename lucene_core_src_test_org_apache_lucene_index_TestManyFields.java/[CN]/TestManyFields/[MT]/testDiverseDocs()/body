{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(new MockAnalyzer(random())).setRAMBufferSizeMB(0.5));
  int n=atLeast(1);
  for (int i=0; i < n; i++) {
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      for (int k=0; k < 100; k++) {
        doc.add(newField("field",Integer.toString(random().nextInt()),storedTextType));
      }
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      doc.add(newField("field","aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa",storedTextType));
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      StringBuilder b=new StringBuilder();
      String x=Integer.toString(j) + ".";
      for (int k=0; k < 1000; k++)       b.append(x);
      String longTerm=b.toString();
      Document doc=new Document();
      doc.add(newField("field",longTerm,storedTextType));
      writer.addDocument(doc);
    }
  }
  writer.close();
  IndexReader reader=DirectoryReader.open(dir);
  IndexSearcher searcher=newSearcher(reader);
  int totalHits=searcher.search(new TermQuery(new Term("field","aaa")),1).totalHits;
  assertEquals(n * 100,totalHits);
  reader.close();
  dir.close();
}
