{
  Directory dir=getRunData().getDirectory();
  Analyzer analyzer=getRunData().getAnalyzer();
  Config config=getRunData().getConfig();
  boolean cmpnd=config.get("compound",true);
  int mrgf=config.get("merge.factor",DEFAULT_MERGE_PFACTOR);
  int mxbf=config.get("max.buffered",DEFAULT_MAX_BUFFERED);
  int mxfl=config.get("max.field.length",DEFAULT_MAX_FIELD_LENGTH);
  double flushAtRAMUsage=config.get("ram.flush.mb",DEFAULT_RAM_FLUSH_MB);
  boolean autoCommit=config.get("autocommit",DEFAULT_AUTO_COMMIT);
  IndexWriter writer=new IndexWriter(dir,autoCommit,analyzer,false);
  if (flushAtRAMUsage > 0)   writer.setRAMBufferSizeMB(flushAtRAMUsage);
 else   if (mxbf != 0)   writer.setMaxBufferedDocs(mxbf);
 else   throw new RuntimeException("either max.buffered or ram.flush.mb must be non-zero");
  writer.setMaxFieldLength(mxfl);
  writer.setMergeFactor(mrgf);
  writer.setUseCompoundFile(cmpnd);
  if (flushAtRAMUsage > 0)   writer.setRAMBufferSizeMB(flushAtRAMUsage);
  getRunData().setIndexWriter(writer);
  return 1;
}
