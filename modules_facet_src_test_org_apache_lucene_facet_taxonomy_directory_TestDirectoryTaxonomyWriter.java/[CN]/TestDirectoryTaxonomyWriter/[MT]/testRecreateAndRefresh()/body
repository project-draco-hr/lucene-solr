{
  Directory dir=newDirectory();
  DirectoryTaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE_OR_APPEND,new NoOpCache());
  touchTaxo(taxoWriter,new CategoryPath("a"));
  DirectoryTaxonomyReader taxoReader=new DirectoryTaxonomyReader(dir);
  touchTaxo(taxoWriter,new CategoryPath("b"));
  taxoReader.refresh();
  taxoWriter.close();
  taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE,new NoOpCache());
  touchTaxo(taxoWriter,new CategoryPath("c"));
  taxoWriter.close();
  taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE_OR_APPEND,new NoOpCache());
  touchTaxo(taxoWriter,new CategoryPath("d"));
  taxoWriter.close();
  try {
    taxoReader.refresh();
    fail("IconsistentTaxonomyException should have been thrown");
  }
 catch (  InconsistentTaxonomyException e) {
  }
  taxoReader.close();
  dir.close();
}
