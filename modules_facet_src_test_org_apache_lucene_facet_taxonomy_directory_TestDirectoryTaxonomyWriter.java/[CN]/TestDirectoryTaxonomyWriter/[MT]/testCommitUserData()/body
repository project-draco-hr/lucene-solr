{
  Directory dir=newDirectory();
  DirectoryTaxonomyWriter ltw=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE_OR_APPEND,new NoOpCache());
  assertFalse(DirectoryReader.indexExists(dir));
  ltw.commit();
  ltw.addCategory(new CategoryPath("a"));
  ltw.addCategory(new CategoryPath("b"));
  Map<String,String> userCommitData=new HashMap<String,String>();
  userCommitData.put("testing","1 2 3");
  ltw.commit(userCommitData);
  ltw.close();
  DirectoryReader r=IndexReader.open(dir);
  assertEquals("2 categories plus root should have been committed to the underlying directory",3,r.numDocs());
  Map<String,String> readUserCommitData=r.getCommitUserData();
  assertTrue("wrong value extracted from commit data","1 2 3".equals(readUserCommitData.get("testing")));
  r.close();
  dir.close();
}
