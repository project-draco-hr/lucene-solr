{
  String dqZNode="/distqueue/test";
  byte[] data="hello world".getBytes(UTF8);
  DistributedQueue dq=makeDistributedQueue(dqZNode);
  assertNull(dq.poll());
  try {
    dq.remove();
    fail("NoSuchElementException expected");
  }
 catch (  NoSuchElementException expected) {
  }
  dq.offer(data);
  assertArrayEquals(dq.peek(500),data);
  assertArrayEquals(dq.remove(),data);
  assertNull(dq.poll());
  dq.offer(data);
  assertArrayEquals(dq.take(),data);
  assertNull(dq.poll());
  dq.offer(data);
  dq.peek(true);
  assertArrayEquals(dq.remove(),data);
  assertNull(dq.poll());
  (new QueueChangerThread(dq,1000)).start();
  assertNotNull(dq.peek(true));
  assertNotNull(dq.remove());
  assertNull(dq.poll());
  QueueChangerThread qct=new QueueChangerThread(dq,1000);
  qct.start();
  assertNull(dq.peek(500));
  qct.join();
}
