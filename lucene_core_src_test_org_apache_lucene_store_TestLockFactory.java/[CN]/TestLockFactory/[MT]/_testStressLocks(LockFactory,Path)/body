{
  Directory dir=newFSDirectory(indexDir,lockFactory);
  IndexWriter w=new IndexWriter(dir,new IndexWriterConfig(new MockAnalyzer(random())).setOpenMode(OpenMode.CREATE));
  addDoc(w);
  w.close();
  WriterThread writer=new WriterThread(100,dir);
  SearcherThread searcher=new SearcherThread(100,dir);
  writer.start();
  searcher.start();
  while (writer.isAlive() || searcher.isAlive()) {
    Thread.sleep(1000);
  }
  assertTrue("IndexWriter hit unexpected exceptions",!writer.hitException);
  assertTrue("IndexSearcher hit unexpected exceptions",!searcher.hitException);
  dir.close();
  IOUtils.rm(indexDir);
}
