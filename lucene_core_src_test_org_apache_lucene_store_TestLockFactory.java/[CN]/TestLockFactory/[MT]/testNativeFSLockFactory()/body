{
  NativeFSLockFactory f=new NativeFSLockFactory(TEMP_DIR);
  f.setLockPrefix("test");
  Lock l=f.makeLock("commit");
  Lock l2=f.makeLock("commit");
  assertTrue("failed to obtain lock",l.obtain());
  assertTrue("succeeded in obtaining lock twice",!l2.obtain());
  l.release();
  assertTrue("failed to obtain 2nd lock after first one was freed",l2.obtain());
  l2.release();
  assertTrue("failed to obtain lock",l.obtain());
  assertTrue(l.isLocked());
  assertTrue(l2.isLocked());
  l.release();
  assertFalse(l.isLocked());
  assertFalse(l2.isLocked());
}
