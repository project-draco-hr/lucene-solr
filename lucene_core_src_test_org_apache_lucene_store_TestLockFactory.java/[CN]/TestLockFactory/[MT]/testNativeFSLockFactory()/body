{
  Directory dir=FSDirectory.open(createTempDir(LuceneTestCase.getTestClass().getSimpleName()),NativeFSLockFactory.INSTANCE);
  Lock l=dir.makeLock("commit");
  Lock l2=dir.makeLock("commit");
  assertTrue("failed to obtain lock",l.obtain());
  assertTrue("succeeded in obtaining lock twice",!l2.obtain());
  l.close();
  assertTrue("failed to obtain 2nd lock after first one was freed",l2.obtain());
  l2.close();
  assertTrue("failed to obtain lock",l.obtain());
  assertTrue(l.isLocked());
  assertTrue(l2.isLocked());
  l.close();
  assertFalse(l.isLocked());
  assertFalse(l2.isLocked());
}
