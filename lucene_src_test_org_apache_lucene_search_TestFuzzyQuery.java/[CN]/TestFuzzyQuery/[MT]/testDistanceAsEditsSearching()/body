{
  Directory index=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random,index);
  addDoc("foobar",w);
  addDoc("test",w);
  addDoc("working",w);
  IndexReader reader=w.getReader();
  IndexSearcher searcher=new IndexSearcher(reader);
  w.close();
  QueryParser qp=new QueryParser(TEST_VERSION_CURRENT,"field",new MockAnalyzer());
  FuzzyQuery q=(FuzzyQuery)qp.parse("fouba~2");
  ScoreDoc[] hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("foobar",searcher.doc(hits[0].doc).get("field"));
  q=(FuzzyQuery)qp.parse("foubara~2");
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("foobar",searcher.doc(hits[0].doc).get("field"));
  q=(FuzzyQuery)qp.parse("t~3");
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  q=new FuzzyQuery(new Term("field","a"),4f,0,50);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  q=new FuzzyQuery(new Term("field","a"),6f,0,50);
  hits=searcher.search(q,10).scoreDocs;
  assertEquals(2,hits.length);
  assertEquals("test",searcher.doc(hits[0].doc).get("field"));
  assertEquals("foobar",searcher.doc(hits[1].doc).get("field"));
  searcher.close();
  reader.close();
  index.close();
}
