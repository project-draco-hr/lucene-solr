{
  final String parentType="parent";
  int parentsNum=2 + random().nextInt(3);
  int depth=2 + random().nextInt(3);
  ContextHolder holder=new ContextHolder();
  String config=createRandomizedConfig(depth,parentType,parentsNum,holder);
  runFullImport(config);
  assertTrue("Update request processor processAdd was not called",TestUpdateRequestProcessor.processAddCalled);
  assertTrue("Update request processor processCommit was not callled",TestUpdateRequestProcessor.processCommitCalled);
  assertTrue("Update request processor finish was not called",TestUpdateRequestProcessor.finishCalled);
  assertQ(req("type_s:" + parentType),"//*[@numFound='" + parentsNum + "']");
  assertQ(req("-type_s:" + parentType),"//*[@numFound='" + (holder.counter - parentsNum) + "']");
  Hierarchy randomHierarchy=holder.hierarchies.get(random().nextInt(holder.hierarchies.size()));
  Query deepestQuery=createBlockJoinQuery(randomHierarchy);
  assertSearch(deepestQuery,FIELD_ID,(String)randomHierarchy.elementData.get(FIELD_ID));
}
