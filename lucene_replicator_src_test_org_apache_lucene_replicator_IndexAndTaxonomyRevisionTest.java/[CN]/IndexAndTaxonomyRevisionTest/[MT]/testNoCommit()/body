{
  Directory indexDir=newDirectory();
  IndexWriterConfig conf=new IndexWriterConfig(null);
  conf.setIndexDeletionPolicy(new SnapshotDeletionPolicy(conf.getIndexDeletionPolicy()));
  IndexWriter indexWriter=new IndexWriter(indexDir,conf);
  Directory taxoDir=newDirectory();
  SnapshotDirectoryTaxonomyWriter taxoWriter=new SnapshotDirectoryTaxonomyWriter(taxoDir);
  try {
    assertNotNull(new IndexAndTaxonomyRevision(indexWriter,taxoWriter));
    fail("should have failed when there are no commits to snapshot");
  }
 catch (  IllegalStateException e) {
  }
 finally {
    indexWriter.close();
    IOUtils.close(taxoWriter,taxoDir,indexDir);
  }
}
