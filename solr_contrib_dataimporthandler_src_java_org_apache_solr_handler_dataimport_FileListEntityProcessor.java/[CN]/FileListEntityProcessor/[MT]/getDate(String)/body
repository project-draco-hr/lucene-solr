{
  if (dateStr == null)   return null;
  Matcher m=PLACE_HOLDER_PATTERN.matcher(dateStr);
  if (m.find()) {
    Object o=context.resolve(m.group(1));
    if (o instanceof Date)     return (Date)o;
    dateStr=(String)o;
  }
 else {
    dateStr=context.replaceTokens(dateStr);
  }
  m=Evaluator.IN_SINGLE_QUOTES.matcher(dateStr);
  if (m.find()) {
    String expr=m.group(1);
    if (expr.startsWith("NOW")) {
      expr=expr.substring("NOW".length());
    }
    try {
      return new DateMathParser(TimeZone.getDefault()).parseMath(expr);
    }
 catch (    ParseException exp) {
      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"Invalid expression for date",exp);
    }
  }
  try {
    return new SimpleDateFormat("yyyy-MM-dd HH:mm:ss",Locale.ROOT).parse(dateStr);
  }
 catch (  ParseException exp) {
    throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"Invalid expression for date",exp);
  }
}
