{
  final int softCommitWaitMillis=500;
  final int hardCommitWaitMillis=1200;
  CommitTracker hardTracker=updater.commitTracker;
  CommitTracker softTracker=updater.softCommitTracker;
  softTracker.setTimeUpperBound(softCommitWaitMillis);
  softTracker.setDocsUpperBound(-1);
  hardTracker.setTimeUpperBound(hardCommitWaitMillis);
  hardTracker.setDocsUpperBound(-1);
  long fast5start=System.nanoTime();
  for (int i=0; i < 5; i++) {
    assertU(adoc("id","" + 500 + i,"subject","five fast docs"));
  }
  long fast5end=System.nanoTime() - TimeUnit.NANOSECONDS.convert(200,TimeUnit.MILLISECONDS);
  long fast5time=1 + TimeUnit.MILLISECONDS.convert(fast5end - fast5start,TimeUnit.NANOSECONDS);
  long expectedSoft=(long)Math.ceil((double)fast5time / softCommitWaitMillis);
  long expectedHard=(long)Math.ceil((double)fast5time / hardCommitWaitMillis);
  for (int i=1; i <= expectedSoft; i++) {
    Long soft=monitor.soft.poll(softCommitWaitMillis * 2,MILLISECONDS);
    assertNotNull(i + ": soft wasn't fast enough",soft);
    monitor.assertSaneOffers();
    long softMs=TimeUnit.MILLISECONDS.convert(soft - fast5end,TimeUnit.NANOSECONDS);
    assertTrue(i + ": soft occured too fast: " + softMs+ " < ("+ softCommitWaitMillis+ " * "+ i+ ")",softMs >= (softCommitWaitMillis * i));
  }
  for (int i=1; i <= expectedHard; i++) {
    Long hard=monitor.hard.poll(hardCommitWaitMillis,MILLISECONDS);
    assertNotNull(i + ": hard wasn't fast enough",hard);
    monitor.assertSaneOffers();
    long hardMs=TimeUnit.MILLISECONDS.convert(hard - fast5end,TimeUnit.NANOSECONDS);
    assertTrue(i + ": hard occured too fast: " + hardMs+ " < ("+ hardCommitWaitMillis+ " * "+ i+ ")",hardMs >= (hardCommitWaitMillis * i));
  }
}
