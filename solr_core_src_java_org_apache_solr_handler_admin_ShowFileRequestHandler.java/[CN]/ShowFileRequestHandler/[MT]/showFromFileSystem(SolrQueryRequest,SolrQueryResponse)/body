{
  File adminFile=null;
  final SolrResourceLoader loader=req.getCore().getResourceLoader();
  File configdir=new File(loader.getConfigDir());
  if (!configdir.exists()) {
    try {
      configdir=new File(loader.getClassLoader().getResource(loader.getConfigDir()).toURI());
    }
 catch (    URISyntaxException e) {
      rsp.setException(new SolrException(ErrorCode.FORBIDDEN,"Can not access configuration directory!",e));
      return;
    }
  }
  String fname=req.getParams().get("file",null);
  if (fname == null) {
    adminFile=configdir;
  }
 else {
    fname=fname.replace('\\','/');
    if (hiddenFiles.contains(fname.toUpperCase(Locale.ROOT))) {
      rsp.setException(new SolrException(ErrorCode.FORBIDDEN,"Can not access: " + fname));
      return;
    }
    if (fname.indexOf("..") >= 0) {
      rsp.setException(new SolrException(ErrorCode.FORBIDDEN,"Invalid path: " + fname));
      return;
    }
    adminFile=new File(configdir,fname);
  }
  if (!adminFile.exists()) {
    rsp.setException(new SolrException(ErrorCode.NOT_FOUND,"Can not find: " + adminFile.getName() + " ["+ adminFile.getAbsolutePath()+ "]"));
    return;
  }
  if (!adminFile.canRead() || adminFile.isHidden()) {
    rsp.setException(new SolrException(ErrorCode.NOT_FOUND,"Can not show: " + adminFile.getName() + " ["+ adminFile.getAbsolutePath()+ "]"));
    return;
  }
  if (adminFile.isDirectory()) {
    int basePath=configdir.getAbsolutePath().length() + 1;
    NamedList<SimpleOrderedMap<Object>> files=new SimpleOrderedMap<SimpleOrderedMap<Object>>();
    for (    File f : adminFile.listFiles()) {
      String path=f.getAbsolutePath().substring(basePath);
      path=path.replace('\\','/');
      if (hiddenFiles.contains(path.toUpperCase(Locale.ROOT))) {
        continue;
      }
      if (f.isHidden() || f.getName().startsWith(".")) {
        continue;
      }
      SimpleOrderedMap<Object> fileInfo=new SimpleOrderedMap<Object>();
      files.add(path,fileInfo);
      if (f.isDirectory()) {
        fileInfo.add("directory",true);
      }
 else {
        fileInfo.add("size",f.length());
      }
      fileInfo.add("modified",new Date(f.lastModified()));
    }
    rsp.add("files",files);
  }
 else {
    ModifiableSolrParams params=new ModifiableSolrParams(req.getParams());
    params.set(CommonParams.WT,"raw");
    req.setParams(params);
    ContentStreamBase content=new ContentStreamBase.FileStream(adminFile);
    content.setContentType(req.getParams().get(USE_CONTENT_TYPE));
    rsp.add(RawResponseWriter.CONTENT,content);
  }
  rsp.setHttpCaching(false);
}
