{
  File home=null;
  try {
    home=new File(FileUtils.getTempDirectory(),"SOLR_5459");
    FileUtils.writeStringToFile(new File(home,"solr.xml"),"<solr></solr>","UTF-8");
    File coll=new File(home,"SOLR_5459");
    SolrCore core=req.getCore();
    CoreDescriptor desc=core.getCoreDescriptor();
    CoreContainer coreContainer=desc.getCoreContainer();
    if (coreContainer.isZooKeeperAware()) {
      try {
        String confPath=((ZkSolrResourceLoader)core.getResourceLoader()).getCollectionZkPath();
        ZkController.downloadConfigDir(coreContainer.getZkController().getZkClient(),confPath,new File(coll,"conf"));
      }
 catch (      Exception ex) {
        log.error("Error when attempting to download conf from ZooKeeper: " + ex.getMessage());
        rsp.setException(new SolrException(ErrorCode.BAD_REQUEST,"Error when attempting to download conf from ZooKeeper" + ex.getMessage()));
        return false;
      }
    }
 else {
      FileUtils.copyDirectory(new File(desc.getInstanceDir(),"conf"),new File(coll,"conf"));
    }
    FileUtils.writeStringToFile(new File(coll,"core.properties"),"name=SOLR_5459","UTF-8");
    FileUtils.copyInputStreamToFile(stream.getStream(),new File(new File(coll,"conf"),req.getParams().get("file",null)));
    return tryReloading(rsp,home);
  }
 catch (  IOException ex) {
    log.warn("Caught IO exception when trying to verify configs. " + ex.getMessage());
    rsp.setException(new SolrException(ErrorCode.SERVER_ERROR,"Caught IO exception when trying to verify configs. " + ex.getMessage()));
    return false;
  }
 finally {
    if (home != null) {
      try {
        FileUtils.deleteDirectory(home);
      }
 catch (      IOException e) {
        log.warn("Caught IO exception trying to delete temporary directory " + home + e.getMessage());
        return true;
      }
    }
  }
}
