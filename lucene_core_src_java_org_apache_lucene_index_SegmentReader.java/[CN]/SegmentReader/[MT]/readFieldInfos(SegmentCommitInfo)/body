{
  final Directory dir;
  final boolean closeDir;
  if (info.getFieldInfosGen() == -1 && info.info.getUseCompoundFile()) {
    dir=info.info.getCodec().compoundFormat().getCompoundReader(info.info.dir,info.info,IOContext.READONCE);
    closeDir=true;
  }
 else {
    dir=info.info.dir;
    closeDir=false;
  }
  try {
    final String segmentSuffix=info.getFieldInfosGen() == -1 ? "" : Long.toString(info.getFieldInfosGen(),Character.MAX_RADIX);
    Codec codec=info.info.getCodec();
    FieldInfosFormat fisFormat=codec.fieldInfosFormat();
    return fisFormat.getFieldInfosReader().read(dir,info.info,segmentSuffix,IOContext.READONCE);
  }
  finally {
    if (closeDir) {
      dir.close();
    }
  }
}
