{
  final Directory dir;
  final boolean closeDir;
  if (info.getFieldInfosGen() == -1 && info.info.getUseCompoundFile()) {
    dir=new CompoundFileDirectory(info.info.getId(),info.info.dir,IndexFileNames.segmentFileName(info.info.name,"",IndexFileNames.COMPOUND_FILE_EXTENSION),IOContext.READONCE,false);
    closeDir=true;
  }
 else {
    dir=info.info.dir;
    closeDir=false;
  }
  try {
    final String segmentSuffix=info.getFieldInfosGen() == -1 ? "" : Long.toString(info.getFieldInfosGen(),Character.MAX_RADIX);
    Codec codec=info.info.getCodec();
    FieldInfosFormat fisFormat=codec.fieldInfosFormat();
    return fisFormat.getFieldInfosReader().read(dir,info.info,segmentSuffix,IOContext.READONCE);
  }
  finally {
    if (closeDir) {
      dir.close();
    }
  }
}
