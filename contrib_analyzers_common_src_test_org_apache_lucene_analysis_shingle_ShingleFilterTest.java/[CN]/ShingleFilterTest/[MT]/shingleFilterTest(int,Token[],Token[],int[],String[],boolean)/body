{
  ShingleFilter filter=new ShingleFilter(new TestTokenStream(tokensToShingle),maxSize);
  filter.setOutputUnigrams(outputUnigrams);
  TermAttribute termAtt=(TermAttribute)filter.addAttribute(TermAttribute.class);
  OffsetAttribute offsetAtt=(OffsetAttribute)filter.addAttribute(OffsetAttribute.class);
  PositionIncrementAttribute posIncrAtt=(PositionIncrementAttribute)filter.addAttribute(PositionIncrementAttribute.class);
  TypeAttribute typeAtt=(TypeAttribute)filter.addAttribute(TypeAttribute.class);
  int i=0;
  while (filter.incrementToken()) {
    assertTrue("ShingleFilter outputted more tokens than expected",i < tokensToCompare.length);
    String termText=termAtt.term();
    String goldText=tokensToCompare[i].term();
    assertEquals("Wrong termText",goldText,termText);
    assertEquals("Wrong startOffset for token \"" + termText + "\"",tokensToCompare[i].startOffset(),offsetAtt.startOffset());
    assertEquals("Wrong endOffset for token \"" + termText + "\"",tokensToCompare[i].endOffset(),offsetAtt.endOffset());
    assertEquals("Wrong positionIncrement for token \"" + termText + "\"",positionIncrements[i],posIncrAtt.getPositionIncrement());
    assertEquals("Wrong type for token \"" + termText + "\"",types[i],typeAtt.type());
    i++;
  }
  assertEquals("ShingleFilter outputted wrong # of tokens. (# output = " + i + "; # expected ="+ tokensToCompare.length+ ")",tokensToCompare.length,i);
}
