{
  MockAnalyzer analyzer=new MockAnalyzer(random());
  LeafReader leafReader=getRandomIndex(analyzer,100);
  try {
    long trainStart=System.currentTimeMillis();
    BooleanPerceptronClassifier classifier=new BooleanPerceptronClassifier(leafReader,analyzer,null,1,null,booleanFieldName,textFieldName);
    long trainEnd=System.currentTimeMillis();
    long trainTime=trainEnd - trainStart;
    assertTrue("training took more than 10s: " + trainTime / 1000 + "s",trainTime < 10000);
    long evaluationStart=System.currentTimeMillis();
    ConfusionMatrixGenerator.ConfusionMatrix confusionMatrix=ConfusionMatrixGenerator.getConfusionMatrix(leafReader,classifier,categoryFieldName,textFieldName);
    assertNotNull(confusionMatrix);
    long evaluationEnd=System.currentTimeMillis();
    long evaluationTime=evaluationEnd - evaluationStart;
    assertTrue("evaluation took more than 1m: " + evaluationTime / 1000 + "s",evaluationTime < 60000);
    double avgClassificationTime=confusionMatrix.getAvgClassificationTime();
    assertTrue(5000 > avgClassificationTime);
  }
  finally {
    leafReader.close();
  }
}
