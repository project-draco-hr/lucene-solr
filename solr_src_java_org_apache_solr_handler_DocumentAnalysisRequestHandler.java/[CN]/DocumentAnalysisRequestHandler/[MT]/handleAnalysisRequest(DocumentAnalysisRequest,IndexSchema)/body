{
  SchemaField uniqueKeyField=schema.getUniqueKeyField();
  NamedList<Object> result=new SimpleOrderedMap<Object>();
  for (  SolrInputDocument document : request.getDocuments()) {
    NamedList<NamedList> theTokens=new SimpleOrderedMap<NamedList>();
    result.add(document.getFieldValue(uniqueKeyField.getName()).toString(),theTokens);
    for (    String name : document.getFieldNames()) {
      SchemaField field=schema.getField(name);
      if (!field.indexed()) {
        continue;
      }
      NamedList<Object> fieldTokens=new SimpleOrderedMap<Object>();
      theTokens.add(name,fieldTokens);
      FieldType fieldType=schema.getFieldType(name);
      Set<String> termsToMatch=new HashSet<String>();
      if (request.getQuery() != null && request.isShowMatch()) {
        try {
          List<Token> tokens=analyzeValue(request.getQuery(),fieldType.getQueryAnalyzer());
          for (          Token token : tokens) {
            termsToMatch.add(token.term());
          }
        }
 catch (        Exception e) {
        }
      }
      if (request.getQuery() != null) {
        try {
          AnalysisContext analysisContext=new AnalysisContext(fieldType,fieldType.getQueryAnalyzer(),Collections.EMPTY_SET);
          NamedList<List<NamedList>> tokens=analyzeValue(request.getQuery(),analysisContext);
          fieldTokens.add("query",tokens);
        }
 catch (        Exception e) {
        }
      }
      Analyzer analyzer=fieldType.getAnalyzer();
      AnalysisContext analysisContext=new AnalysisContext(fieldType,analyzer,termsToMatch);
      Collection<Object> fieldValues=document.getFieldValues(name);
      NamedList<NamedList<List<NamedList>>> indexTokens=new SimpleOrderedMap<NamedList<List<NamedList>>>();
      for (      Object fieldValue : fieldValues) {
        NamedList<List<NamedList>> tokens=analyzeValue(fieldValue.toString(),analysisContext);
        indexTokens.add(String.valueOf(fieldValue),tokens);
      }
      fieldTokens.add("index",indexTokens);
    }
  }
  return result;
}
