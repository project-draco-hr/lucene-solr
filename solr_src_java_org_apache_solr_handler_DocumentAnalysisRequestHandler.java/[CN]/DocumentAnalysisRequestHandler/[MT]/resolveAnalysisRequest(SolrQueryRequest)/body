{
  DocumentAnalysisRequest request=new DocumentAnalysisRequest();
  SolrParams params=req.getParams();
  String query=params.get(AnalysisParams.QUERY,params.get(CommonParams.Q,null));
  request.setQuery(query);
  boolean showMatch=params.getBool(AnalysisParams.SHOW_MATCH,false);
  request.setShowMatch(showMatch);
  ContentStream stream=extractSingleContentStream(req);
  Reader reader=stream.getReader();
  XMLStreamReader parser=inputFactory.createXMLStreamReader(reader);
  try {
    while (true) {
      int event=parser.next();
switch (event) {
case XMLStreamConstants.END_DOCUMENT:
{
          parser.close();
          return request;
        }
case XMLStreamConstants.START_ELEMENT:
{
        String currTag=parser.getLocalName();
        if ("doc".equals(currTag)) {
          log.trace("Reading doc...");
          SolrInputDocument document=readDocument(parser,req.getSchema());
          request.addDocument(document);
        }
        break;
      }
  }
}
}
  finally {
parser.close();
IOUtils.closeQuietly(reader);
}
}
