{
  String zkDir=createTempDir("zkData").getAbsolutePath();
  ZkTestServer server=new ZkTestServer(zkDir);
  ZkController zkController=null;
  boolean testFinished=false;
  CoreContainer cc=null;
  try {
    server.run();
    AbstractZkTestCase.makeSolrZkNode(server.getZkHost());
    cc=getCoreContainer();
    zkController=new ZkController(cc,server.getZkAddress(),TIMEOUT,10000,"127.0.0.1","8983","solr",0,60000,true,new CurrentCoreDescriptorProvider(){
      @Override public List<CoreDescriptor> getCurrentDescriptors(){
        return null;
      }
    }
);
    zkController.uploadToZK(new File(ExternalPaths.EXAMPLE_HOME + "/collection1/conf"),ZkController.CONFIGS_ZKNODE + "/config1");
    zkController.uploadToZK(new File(ExternalPaths.EXAMPLE_HOME + "/collection1/conf"),ZkController.CONFIGS_ZKNODE + "/config1");
    if (DEBUG) {
      zkController.printLayoutToStdOut();
    }
    testFinished=true;
  }
  finally {
    if (!testFinished & zkController != null) {
      zkController.getZkClient().printLayoutToStdOut();
    }
    if (zkController != null) {
      zkController.close();
    }
    if (cc != null) {
      cc.shutdown();
    }
    server.shutdown();
  }
}
