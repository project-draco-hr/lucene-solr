{
  SynonymMap currMap=this;
  for (Iterator iter=singleMatch.iterator(); iter.hasNext(); ) {
    String str=(String)iter.next();
    if (currMap.submap == null) {
      currMap.submap=new HashMap(1);
    }
    SynonymMap map=(SynonymMap)currMap.submap.get(str);
    if (map == null) {
      map=new SynonymMap();
      currMap.submap.put(str,map);
    }
    currMap=map;
  }
  if (currMap.synonyms != null && !mergeExisting) {
    throw new RuntimeException("SynonymFilter: there is already a mapping for " + singleMatch);
  }
  List superset=currMap.synonyms == null ? replacement : mergeTokens(Arrays.asList(currMap.synonyms),replacement);
  currMap.synonyms=(Token[])superset.toArray(new Token[superset.size()]);
  if (includeOrig)   currMap.flags|=INCLUDE_ORIG;
}
