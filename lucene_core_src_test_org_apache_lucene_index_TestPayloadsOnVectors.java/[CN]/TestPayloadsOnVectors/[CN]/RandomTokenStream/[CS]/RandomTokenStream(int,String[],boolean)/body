{
  terms=new String[len];
  positionsIncrements=new int[len];
  positions=new int[len];
  startOffsets=new int[len];
  endOffsets=new int[len];
  payloads=new BytesRef[len];
  for (int i=0; i < len; ++i) {
    terms[i]=RandomPicks.randomFrom(random(),sampleTerms);
    if (weird) {
      positionsIncrements[i]=_TestUtil.nextInt(random(),1,1 << 18);
      startOffsets[i]=random().nextInt();
      endOffsets[i]=random().nextInt();
    }
 else     if (i == 0) {
      positionsIncrements[i]=_TestUtil.nextInt(random(),1,1 << 5);
      startOffsets[i]=_TestUtil.nextInt(random(),0,1 << 16);
      endOffsets[i]=startOffsets[i] + _TestUtil.nextInt(random(),0,rarely() ? 1 << 10 : 20);
    }
 else {
      positionsIncrements[i]=_TestUtil.nextInt(random(),0,1 << 5);
      startOffsets[i]=startOffsets[i - 1] + _TestUtil.nextInt(random(),0,1 << 16);
      endOffsets[i]=startOffsets[i] + _TestUtil.nextInt(random(),0,rarely() ? 1 << 10 : 20);
    }
  }
  for (int i=0; i < len; ++i) {
    if (i == 0) {
      positions[i]=positionsIncrements[i] - 1;
    }
 else {
      positions[i]=positions[i - 1] + positionsIncrements[i];
    }
  }
  if (rarely()) {
    Arrays.fill(payloads,randomPayload());
  }
 else {
    for (int i=0; i < len; ++i) {
      payloads[i]=randomPayload();
    }
  }
  positionToTerms=new HashMap<Integer,Set<Integer>>();
  startOffsetToTerms=new HashMap<Integer,Set<Integer>>();
  for (int i=0; i < len; ++i) {
    if (!positionToTerms.containsKey(positions[i])) {
      positionToTerms.put(positions[i],new HashSet<Integer>(1));
    }
    positionToTerms.get(positions[i]).add(i);
    if (!startOffsetToTerms.containsKey(startOffsets[i])) {
      startOffsetToTerms.put(startOffsets[i],new HashSet<Integer>(1));
    }
    startOffsetToTerms.get(startOffsets[i]).add(i);
  }
  addAttributeImpl(new PermissiveOffsetAttributeImpl());
  termAtt=addAttribute(CharTermAttribute.class);
  piAtt=addAttribute(PositionIncrementAttribute.class);
  oAtt=addAttribute(OffsetAttribute.class);
  pAtt=addAttribute(PayloadAttribute.class);
}
