{
  super();
  boolean success=false;
  this.fs=fs;
  try {
    if (debug) {
    }
    this.tlogFile=tlogFile;
    if (fs.exists(tlogFile) && openExisting) {
      tlogOutStream=fs.append(tlogFile);
    }
 else {
      fs.delete(tlogFile,false);
      tlogOutStream=fs.create(tlogFile,(short)1);
      tlogOutStream.hsync();
    }
    fos=new FastOutputStream(tlogOutStream,new byte[65536],0);
    long start=tlogOutStream.getPos();
    if (openExisting) {
      if (start > 0) {
        readHeader(null);
        fos.setWritten(start);
      }
 else {
        addGlobalStrings(globalStrings);
      }
    }
 else {
      if (start > 0) {
        log.error("New transaction log already exists:" + tlogFile + " size="+ tlogOutStream.size());
      }
      addGlobalStrings(globalStrings);
    }
    success=true;
  }
 catch (  IOException e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,e);
  }
 finally {
    if (!success && tlogOutStream != null) {
      try {
        tlogOutStream.close();
      }
 catch (      Exception e) {
        log.error("Error closing tlog file (after error opening)",e);
      }
    }
  }
}
