{
  for (  SolrInputField sif : fromDoc.values()) {
    Object val=sif.getValue();
    if (val instanceof Map) {
      for (      Entry<String,Object> entry : ((Map<String,Object>)val).entrySet()) {
        String key=entry.getKey();
        Object fieldVal=entry.getValue();
        boolean updateField=false;
switch (key) {
case "add":
          updateField=true;
        doAdd(toDoc,sif,fieldVal);
      break;
case "set":
    updateField=true;
  doSet(toDoc,sif,fieldVal);
break;
case "remove":
updateField=true;
doRemove(toDoc,sif,fieldVal);
break;
case "removeregex":
updateField=true;
doRemoveRegex(toDoc,sif,fieldVal);
break;
case "inc":
updateField=true;
doInc(toDoc,sif,fieldVal);
break;
default :
log.warn("Unknown operation for the an atomic update, operation ignored: " + key);
break;
}
if (updateField && idField.getName().equals(sif.getName())) {
throw new SolrException(ErrorCode.BAD_REQUEST,"Invalid update of id field: " + sif);
}
}
}
 else {
toDoc.put(sif.getName(),sif);
}
}
return toDoc;
}
