{
  assertU(add(doc("id","1","name_s","john","title_s","Director","dept_ss","Engineering")));
  assertU(add(doc("id","2","name_s","mark","title_s","VP","dept_ss","Marketing")));
  assertU(add(doc("id","3","name_s","nancy","title_s","MTS","dept_ss","Sales")));
  assertU(add(doc("id","4","name_s","dave","title_s","MTS","dept_ss","Support","dept_ss","Engineering")));
  assertU(add(doc("id","5","name_s","tina","title_s","VP","dept_ss","Engineering")));
  assertU(add(doc("id","10","dept_id_s","Engineering","text_t","These guys develop stuff")));
  assertU(add(doc("id","11","dept_id_s","Marketing","text_t","These guys make you look good")));
  assertU(add(doc("id","12","dept_id_s","Sales","text_t","These guys sell stuff")));
  assertU(add(doc("id","13","dept_id_s","Support","text_t","These guys help customers")));
  assertU(commit());
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s" + whateverScore() + "}title_s:MTS","fl","id"),"/response=={'numFound':3,'start':0,'docs':[{'id':'10'},{'id':'12'},{'id':'13'}]}");
  assertJQ(req("q","{!join from=noexist_s to=dept_id_s" + whateverScore() + "}*:*","fl","id"),"/response=={'numFound':0,'start':0,'docs':[]}");
  assertJQ(req("q","{!join from=dept_ss to=noexist_s" + whateverScore() + "}*:*","fl","id"),"/response=={'numFound':0,'start':0,'docs':[]}");
  assertJQ(req("q","{!join from=title_s to=title_s" + whateverScore() + "}name_s:dave","fl","id"),"/response=={'numFound':2,'start':0,'docs':[{'id':'3'},{'id':'4'}]}");
  assertJQ(req("q","{!join from=dept_id_s to=dept_ss" + whateverScore() + "}text_t:develop","fl","id"),"/response=={'numFound':3,'start':0,'docs':[{'id':'1'},{'id':'4'},{'id':'5'}]}");
  assertJQ(req("q","{!join from=title_s to=title_s" + whateverScore() + "}name_s:dave","fl","id"),"/response=={'numFound':2,'start':0,'docs':[{'id':'3'},{'id':'4'}]}");
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s" + whateverScore() + "}title_s:MTS","fl","id","debugQuery","true"),"/response=={'numFound':3,'start':0,'docs':[{'id':'10'},{'id':'12'},{'id':'13'}]}");
  final String davesDepartments="/response=={'numFound':2,'start':0,'docs':[{'id':'10'},{'id':'13'}]}";
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s" + whateverScore() + "}name_s:dave","fl","id"),davesDepartments);
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s v=$qq" + whateverScore() + "}","qq","{!dismax}dave","qf","name_s","fl","id","debugQuery","true"),davesDepartments);
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s v=$qq" + whateverScore() + "}","qq","{!dismax qf=name_s}dave","fl","id","debugQuery","true"),davesDepartments);
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s defType=dismax" + whateverScore() + "}dave","qf","name_s","fl","id","debugQuery","true"),davesDepartments);
  assertJQ(req("q","{!join from=dept_id_s to=dept_ss" + whateverScore() + "}text_t:develop","fl","id","fq","name_s:john"),"/response=={'numFound':1,'start':0,'docs':[{'id':'1'}]}");
  assertJQ(req("q","{!join from=dept_ss to=dept_id_s" + whateverScore() + "}title_s:MTS","fl","id"),"/response=={'numFound':3,'start':0,'docs':[{'id':'10'},{'id':'12'},{'id':'13'}]}");
  assertJQ(req("q","{!join from=dept_id_s to=dept_ss" + whateverScore() + "}text_t:develop","fl","id"),"/response=={'numFound':3,'start':0,'docs':[{'id':'1'},{'id':'4'},{'id':'5'}]}");
}
