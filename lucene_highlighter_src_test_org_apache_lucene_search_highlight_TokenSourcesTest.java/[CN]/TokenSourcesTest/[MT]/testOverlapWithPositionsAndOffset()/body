{
  final String TEXT="the fox did not jump";
  final Directory directory=newDirectory();
  final IndexWriter indexWriter=new IndexWriter(directory,newIndexWriterConfig(TEST_VERSION_CURRENT,null));
  try {
    final Document document=new Document();
    FieldType customType=new FieldType(TextField.TYPE_UNSTORED);
    customType.setStoreTermVectors(true);
    customType.setStoreTermVectorOffsets(true);
    customType.setStoreTermVectorPositions(true);
    document.add(new Field(FIELD,new OverlappingTokenStream(),customType));
    indexWriter.addDocument(document);
  }
  finally {
    indexWriter.close();
  }
  final IndexReader indexReader=DirectoryReader.open(directory);
  try {
    assertEquals(1,indexReader.numDocs());
    final IndexSearcher indexSearcher=newSearcher(indexReader);
    final DisjunctionMaxQuery query=new DisjunctionMaxQuery(1);
    query.add(new SpanTermQuery(new Term(FIELD,"{fox}")));
    query.add(new SpanTermQuery(new Term(FIELD,"fox")));
    TopDocs hits=indexSearcher.search(query,1);
    assertEquals(1,hits.totalHits);
    final Highlighter highlighter=new Highlighter(new SimpleHTMLFormatter(),new SimpleHTMLEncoder(),new QueryScorer(query));
    final TokenStream tokenStream=TokenSources.getTokenStream(indexReader.getTermVector(0,FIELD),false);
    assertEquals("<B>the fox</B> did not jump",highlighter.getBestFragment(tokenStream,TEXT));
  }
  finally {
    indexReader.close();
    directory.close();
  }
}
