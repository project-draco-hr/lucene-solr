{
  LuceneTestCase.assumeFalse("This test fails on UNIX with Turkish default locale (https://issues.apache.org/jira/browse/LUCENE-6036)",new Locale("tr").getLanguage().equals(Locale.getDefault().getLanguage()));
  final Random rnd=RandomizedContext.current().getRandom();
  Set<String> avail;
  final String codecName=new ArrayList<>(avail=Codec.availableCodecs()).get(rnd.nextInt(avail.size()));
  final String pfName=new ArrayList<>(avail=PostingsFormat.availablePostingsFormats()).get(rnd.nextInt(avail.size()));
  final String dvfName=new ArrayList<>(avail=DocValuesFormat.availableDocValuesFormats()).get(rnd.nextInt(avail.size()));
  final Process p=new ProcessBuilder(Paths.get(System.getProperty("java.home"),"bin","java").toString(),"-cp",System.getProperty("java.class.path"),getClass().getName(),codecName,pfName,dvfName).inheritIO().start();
  if (p.waitFor(30,TimeUnit.SECONDS)) {
    assertEquals("Process died abnormally",0,p.waitFor());
  }
 else {
    p.destroyForcibly().waitFor();
    fail("Process did not exit after 30 secs -> classloader deadlock?");
  }
}
