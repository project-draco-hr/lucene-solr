{
  Directory directory=new RAMDirectory();
  IndexWriter writer=new IndexWriter(directory,new IndexWriterConfig(new MockAnalyzer(random())));
  Document document=new Document();
  document.add(new StringField("deleted","0",Field.Store.YES));
  writer.addDocument(document);
  DirectoryReader reader=DirectoryReader.open(writer,true);
  writer.close();
  Directory directory2=new RAMDirectory();
  writer=new IndexWriter(directory2,new IndexWriterConfig(new MockAnalyzer(random())));
  List<LeafReaderContext> leaves=reader.leaves();
  CodecReader[] codecReaders=new CodecReader[leaves.size()];
  for (int i=0; i < leaves.size(); i++) {
    codecReaders[i]=new MigratingCodecReader((CodecReader)leaves.get(i).reader());
  }
  writer.addIndexes(codecReaders);
  IOUtils.close(writer,reader,directory);
}
