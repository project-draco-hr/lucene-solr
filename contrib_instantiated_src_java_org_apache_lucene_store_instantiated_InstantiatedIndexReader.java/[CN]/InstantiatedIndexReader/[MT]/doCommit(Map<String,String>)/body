{
  if (uncommittedNormsByFieldNameAndDocumentNumber != null) {
    for (    Map.Entry<String,List<NormUpdate>> e : uncommittedNormsByFieldNameAndDocumentNumber.entrySet()) {
      byte[] norms=getIndex().getNormsByFieldNameAndDocumentNumber().get(e.getKey());
      for (      NormUpdate normUpdate : e.getValue()) {
        norms[normUpdate.doc]=normUpdate.value;
      }
    }
    uncommittedNormsByFieldNameAndDocumentNumber=null;
  }
  if (uncommittedDeletedDocuments != null) {
    if (index.getDeletedDocuments() == null) {
      index.setDeletedDocuments(uncommittedDeletedDocuments);
    }
 else {
      for (int d=0; d < uncommittedDeletedDocuments.size(); d++) {
        if (uncommittedDeletedDocuments.get(d)) {
          index.getDeletedDocuments().set(d);
        }
      }
    }
    uncommittedDeletedDocuments=null;
  }
}
