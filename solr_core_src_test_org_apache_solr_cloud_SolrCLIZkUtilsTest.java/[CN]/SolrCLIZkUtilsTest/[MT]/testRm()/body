{
  Path src=TEST_PATH().resolve("configsets").resolve("cloud-subdirs").resolve("conf");
  Path configSet=TEST_PATH().resolve("configsets").resolve("cloud-subdirs");
  copyConfigUp(src,configSet,"rm1");
  copyConfigUp(src,configSet,"rm2");
  String[] args=new String[]{"-path","/configs/rm1","-zkHost",zkAddr};
  SolrCLI.ZkRmTool tool=new SolrCLI.ZkRmTool();
  int res=tool.runTool(SolrCLI.processCommandLineArgs(SolrCLI.joinCommonAndToolOptions(tool.getOptions()),args));
  assertTrue("Should have failed to remove node with children unless -recurse is set to true",res != 0);
  verifyZkLocalPathsMatch(src,"/configs/rm1");
  args=new String[]{"-path","zk:/configs/rm1","-recurse","false","-zkHost",zkAddr};
  res=tool.runTool(SolrCLI.processCommandLineArgs(SolrCLI.joinCommonAndToolOptions(tool.getOptions()),args));
  assertTrue("Should have failed to remove node with children if -recurse is set to false",res != 0);
  args=new String[]{"-path","/configs/rm1","-recurse","true","-zkHost",zkAddr};
  res=tool.runTool(SolrCLI.processCommandLineArgs(SolrCLI.joinCommonAndToolOptions(tool.getOptions()),args));
  assertEquals("Should have removed node /configs/rm1",res,0);
  assertFalse("Znode /configs/toremove really should be gone",zkClient.exists("/configs/rm1",true));
  args=new String[]{"-path","zk:/configs/rm2","-recurse","true","-zkHost",zkAddr};
  res=tool.runTool(SolrCLI.processCommandLineArgs(SolrCLI.joinCommonAndToolOptions(tool.getOptions()),args));
  assertEquals("Should have removed node /configs/rm2",res,0);
  assertFalse("Znode /configs/toremove2 really should be gone",zkClient.exists("/configs/rm2",true));
  args=new String[]{"-path","zk:/","-recurse","true","-zkHost",zkAddr};
  copyConfigUp(src,configSet,"rm3");
  res=tool.runTool(SolrCLI.processCommandLineArgs(SolrCLI.joinCommonAndToolOptions(tool.getOptions()),args));
  assertFalse("Should fail when trying to remove /.",res == 0);
}
