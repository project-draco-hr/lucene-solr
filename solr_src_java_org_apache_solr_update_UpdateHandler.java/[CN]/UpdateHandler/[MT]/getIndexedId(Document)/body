{
  if (idField == null)   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Operation requires schema to have a unique key field");
  Fieldable[] id=doc.getFieldables(idField.getName());
  if (id == null || id.length < 1)   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Document is missing mandatory uniqueKey field: " + idField.getName());
  if (id.length > 1)   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Document contains multiple values for uniqueKey field: " + idField.getName());
  return idFieldType.storedToIndexed(id[0]);
}
