{
  int maxIterations=100;
  while (0 < maxIterations--) {
    stateReader.updateClusterState();
    final ClusterState state=stateReader.getClusterState();
    Set<String> availableCollections=state.getCollections();
    int availableCount=0;
    for (    String requiredCollection : collections) {
      if (availableCollections.contains(requiredCollection)) {
        availableCount++;
      }
      if (availableCount == collections.length)       return;
      Thread.sleep(50);
    }
  }
  log.warn("Timeout waiting for collections: " + Arrays.asList(collections) + " state:"+ stateReader.getClusterState());
}
