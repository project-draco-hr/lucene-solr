{
  int maxIterations=100;
  while (maxIterations-- > 0) {
    reader.updateClusterState(true);
    ZkNodeProps props=reader.getClusterState().getLeader(collection,shard);
    if (props != null) {
      if (expectedCore.equals(props.get(ZkStateReader.CORE_NAME_PROP))) {
        return;
      }
    }
    Thread.sleep(100);
  }
  assertEquals("Unexpected shard leader coll:" + collection + " shard:"+ shard,expectedCore,(reader.getClusterState().getLeader(collection,shard) != null) ? reader.getClusterState().getLeader(collection,shard).get(ZkStateReader.CORE_NAME_PROP) : null);
}
