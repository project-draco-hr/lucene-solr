{
  int maxIterations=200;
  while (maxIterations-- > 0) {
    reader.updateClusterState();
    ZkNodeProps props=reader.getClusterState().getLeader(collection,shard);
    if (props != null) {
      if (expectedCore.equals(props.getStr(ZkStateReader.CORE_NAME_PROP))) {
        return;
      }
    }
    Thread.sleep(200);
  }
  assertEquals("Unexpected shard leader coll:" + collection + " shard:"+ shard,expectedCore,(reader.getClusterState().getLeader(collection,shard) != null) ? reader.getClusterState().getLeader(collection,shard).getStr(ZkStateReader.CORE_NAME_PROP) : null);
}
