{
  int maxIterations=100;
  String coreState=null;
  while (maxIterations-- > 0) {
    coreState=reader.getCloudState().getSlice("collection1","shard1").getShards().get("node1_core1").get(ZkStateReader.STATE_PROP);
    if (coreState.equals(expectedState)) {
      return;
    }
    Thread.sleep(50);
  }
  fail("Illegal state, was:" + coreState + " expected:"+ expectedState+ "cloudState:"+ reader.getCloudState());
}
