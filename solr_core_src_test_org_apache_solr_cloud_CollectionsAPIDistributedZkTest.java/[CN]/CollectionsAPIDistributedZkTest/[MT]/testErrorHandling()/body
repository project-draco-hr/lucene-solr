{
  final String baseUrl=getBaseUrl((HttpSolrServer)clients.get(0));
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action","BADACTION");
  String collectionName="badactioncollection";
  params.set("name",collectionName);
  params.set("numShards",2);
  QueryRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  boolean gotExp=false;
  NamedList<Object> resp=null;
  try {
    resp=createNewSolrServer("",baseUrl).request(request);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  params.set("numShards",2);
  collectionName="collection";
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  gotExp=false;
  resp=null;
  try {
    resp=createNewSolrServer("",baseUrl).request(request);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  collectionName="collection";
  params.set("name",collectionName);
  params.set("numShards",2);
  params.set(REPLICATION_FACTOR,10);
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  gotExp=false;
  resp=null;
  try {
    resp=createNewSolrServer("",baseUrl).request(request);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  collectionName="acollection";
  params.set("name",collectionName);
  params.set(REPLICATION_FACTOR,10);
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  gotExp=false;
  resp=null;
  try {
    resp=createNewSolrServer("",baseUrl).request(request);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  collectionName="acollection";
  params.set("name",collectionName);
  params.set(REPLICATION_FACTOR,10);
  params.set("numShards",0);
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  gotExp=false;
  resp=null;
  try {
    resp=createNewSolrServer("",baseUrl).request(request);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  Create createCmd=new Create();
  createCmd.setCoreName("halfcollection_shard1_replica1");
  createCmd.setCollection("halfcollectionblocker");
  String dataDir=SolrTestCaseJ4.dataDir.getAbsolutePath() + File.separator + System.currentTimeMillis()+ "halfcollection"+ "_3n";
  createCmd.setDataDir(dataDir);
  createCmd.setNumShards(1);
  createNewSolrServer("",baseUrl).request(createCmd);
  createCmd=new Create();
  createCmd.setCoreName("halfcollection_shard1_replica1");
  createCmd.setCollection("halfcollectionblocker2");
  dataDir=SolrTestCaseJ4.dataDir.getAbsolutePath() + File.separator + System.currentTimeMillis()+ "halfcollection"+ "_3n";
  createCmd.setDataDir(dataDir);
  createCmd.setNumShards(1);
  createNewSolrServer("",getBaseUrl((HttpSolrServer)clients.get(1))).request(createCmd);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  collectionName="halfcollection";
  params.set("name",collectionName);
  params.set("numShards",2);
  params.set("wt","xml");
  String nn1=((SolrDispatchFilter)jettys.get(0).getDispatchFilter().getFilter()).getCores().getZkController().getNodeName();
  String nn2=((SolrDispatchFilter)jettys.get(1).getDispatchFilter().getFilter()).getCores().getZkController().getNodeName();
  params.set(OverseerCollectionProcessor.CREATE_NODE_SET,nn1 + "," + nn2);
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  gotExp=false;
  resp=createNewSolrServer("",baseUrl).request(request);
  SimpleOrderedMap success=(SimpleOrderedMap)resp.get("success");
  SimpleOrderedMap failure=(SimpleOrderedMap)resp.get("failure");
  String val1=success.getVal(0).toString();
  String val2=failure.getVal(0).toString();
  assertTrue(val1.contains("SolrException") || val2.contains("SolrException"));
}
