{
  final String baseUrl=getBaseUrl((HttpSolrClient)clients.get(0));
  String collectionName="halfdeletedcollection";
  Create createCmd=new Create();
  createCmd.setCoreName("halfdeletedcollection_shard1_replica1");
  createCmd.setCollection(collectionName);
  String dataDir=createTempDir().toFile().getAbsolutePath();
  createCmd.setDataDir(dataDir);
  createCmd.setNumShards(2);
  if (secondConfigSet) {
    createCmd.setCollectionConfigName("conf1");
  }
  makeRequest(baseUrl,createCmd);
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action",CollectionAction.DELETE.toString());
  params.set("name",collectionName);
  QueryRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  makeRequest(baseUrl,request);
  checkForMissingCollection(collectionName);
  params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  params.set("name",collectionName);
  params.set("numShards",2);
  request=new QueryRequest(params);
  request.setPath("/admin/collections");
  if (secondConfigSet) {
    params.set("collection.configName","conf1");
  }
  makeRequest(baseUrl,request);
}
