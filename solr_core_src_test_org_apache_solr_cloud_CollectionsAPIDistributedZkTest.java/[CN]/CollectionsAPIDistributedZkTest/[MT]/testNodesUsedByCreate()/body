{
  final String baseUrl=getBaseUrl((HttpSolrClient)clients.get(0));
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action",CollectionAction.CREATE.toString());
  params.set("numShards",2);
  params.set(REPLICATION_FACTOR,2);
  String collectionName="nodes_used_collection";
  params.set("name",collectionName);
  if (secondConfigSet) {
    params.set("collection.configName","conf1");
  }
  QueryRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  makeRequest(baseUrl,request);
  List<Integer> numShardsNumReplicaList=new ArrayList<>();
  numShardsNumReplicaList.add(2);
  numShardsNumReplicaList.add(2);
  checkForCollection("nodes_used_collection",numShardsNumReplicaList,null);
  List<String> createNodeList=new ArrayList<>();
  Set<String> liveNodes=cloudClient.getZkStateReader().getClusterState().getLiveNodes();
  for (  String node : liveNodes) {
    createNodeList.add(node);
  }
  DocCollection col=cloudClient.getZkStateReader().getClusterState().getCollection("nodes_used_collection");
  Collection<Slice> slices=col.getSlices();
  for (  Slice slice : slices) {
    Collection<Replica> replicas=slice.getReplicas();
    for (    Replica replica : replicas) {
      createNodeList.remove(replica.getNodeName());
    }
  }
  assertEquals(createNodeList.toString(),1,createNodeList.size());
}
