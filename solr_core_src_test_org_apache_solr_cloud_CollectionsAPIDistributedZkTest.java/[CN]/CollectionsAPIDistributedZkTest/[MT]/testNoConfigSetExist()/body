{
  cloudClient.getZkStateReader().updateClusterState(true);
  assertFalse(cloudClient.getZkStateReader().getClusterState().hasCollection("corewithnocollection3"));
  Create createCmd=new Create();
  createCmd.setCoreName("corewithnocollection3");
  createCmd.setCollection("");
  String dataDir=createTempDir().toFile().getAbsolutePath();
  createCmd.setDataDir(dataDir);
  createCmd.setNumShards(1);
  createCmd.setCollectionConfigName("conf123");
  boolean gotExp=false;
  try {
    makeRequest(getBaseUrl((HttpSolrClient)clients.get(1)),createCmd);
  }
 catch (  SolrException e) {
    gotExp=true;
  }
  assertTrue(gotExp);
  TimeUnit.MILLISECONDS.sleep(200);
  cloudClient.getZkStateReader().updateClusterState(true);
  Collection<Slice> slices=cloudClient.getZkStateReader().getClusterState().getActiveSlices("corewithnocollection3");
  assertNull(slices);
  CollectionAdminRequest.List list=new CollectionAdminRequest.List();
  CollectionAdminResponse res=new CollectionAdminResponse();
  res.setResponse(makeRequest(getBaseUrl((HttpSolrClient)clients.get(1)),list));
  List<String> collections=(List<String>)res.getResponse().get("collections");
  assertFalse(collections.contains("corewithnocollection3"));
}
