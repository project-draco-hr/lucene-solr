{
  for (  Entry<String,DocCollection> e : colls.entrySet()) {
    DocCollection c=e.getValue();
    if (c == null) {
      isClusterStateModified=true;
      state=state.copyWith(singletonMap(e.getKey(),(DocCollection)null));
      continue;
    }
    if (c.isExternal()) {
      state.getStateReader().updateExternCollection(c);
      updateNodes.put(ZkStateReader.getCollectionPath(c.getName()),new ClusterState(-1,Collections.<String>emptySet(),singletonMap(c.getName(),c),state.getStateReader()));
    }
 else {
      isClusterStateModified=true;
      state=state.copyWith(singletonMap(e.getKey(),c));
    }
  }
  return state;
}
