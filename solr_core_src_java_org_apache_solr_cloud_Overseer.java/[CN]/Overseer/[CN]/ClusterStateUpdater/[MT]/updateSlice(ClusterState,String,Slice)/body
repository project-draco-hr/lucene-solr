{
  DocCollection newCollection=null;
  DocCollection coll=state.getCollectionOrNull(collectionName);
  Map<String,Slice> slices;
  if (coll == null) {
    slices=new LinkedHashMap<>(1);
    slices.put(slice.getName(),slice);
    Map<String,Object> props=new HashMap<>(1);
    props.put(DocCollection.DOC_ROUTER,ZkNodeProps.makeMap("name",ImplicitDocRouter.NAME));
    newCollection=new DocCollection(collectionName,slices,props,new ImplicitDocRouter());
  }
 else {
    slices=new LinkedHashMap<>(coll.getSlicesMap());
    slices.put(slice.getName(),slice);
    newCollection=coll.copyWith(slices);
  }
  return newState(state,singletonMap(collectionName,newCollection));
}
