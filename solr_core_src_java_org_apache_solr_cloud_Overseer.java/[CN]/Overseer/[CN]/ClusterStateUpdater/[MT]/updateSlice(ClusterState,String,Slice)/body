{
  Map<String,Map<String,Slice>> newCollections=new LinkedHashMap<String,Map<String,Slice>>(state.getCollectionStates());
  Map<String,Slice> slices=newCollections.get(collection);
  if (slices == null) {
    slices=new HashMap<String,Slice>(1);
  }
 else {
    slices=new LinkedHashMap<String,Slice>(slices);
  }
  slices.put(slice.getName(),slice);
  newCollections.put(collection,slices);
  return new ClusterState(state.getLiveNodes(),newCollections);
}
