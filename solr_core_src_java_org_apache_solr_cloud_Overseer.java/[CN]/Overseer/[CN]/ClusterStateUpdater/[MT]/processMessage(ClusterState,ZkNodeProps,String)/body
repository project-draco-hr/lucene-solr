{
  CollectionParams.CollectionAction collectionAction=CollectionParams.CollectionAction.get(operation);
  if (collectionAction != null) {
switch (collectionAction) {
case CREATE:
      clusterState=buildCollection(clusterState,message);
    break;
case DELETE:
  clusterState=removeCollection(clusterState,message);
break;
case CREATESHARD:
clusterState=createShard(clusterState,message);
break;
case DELETESHARD:
clusterState=removeShard(clusterState,message);
break;
case ADDREPLICA:
clusterState=createReplica(clusterState,message);
break;
case CLUSTERPROP:
handleProp(message);
break;
case ADDREPLICAPROP:
clusterState=addReplicaProp(clusterState,message);
break;
case DELETEREPLICAPROP:
clusterState=deleteReplicaProp(clusterState,message);
break;
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
 else {
OverseerAction overseerAction=OverseerAction.get(operation);
if (overseerAction != null) {
switch (overseerAction) {
case STATE:
if (isLegacy(clusterProps)) {
clusterState=updateState(clusterState,message);
}
 else {
clusterState=updateStateNew(clusterState,message);
}
break;
case LEADER:
clusterState=setShardLeader(clusterState,message);
break;
case DELETECORE:
clusterState=removeCore(clusterState,message);
break;
case ADDROUTINGRULE:
clusterState=addRoutingRule(clusterState,message);
break;
case REMOVEROUTINGRULE:
clusterState=removeRoutingRule(clusterState,message);
break;
case UPDATESHARDSTATE:
clusterState=updateShardState(clusterState,message);
break;
case QUIT:
if (myId.equals(message.get("id"))) {
log.info("Quit command received {}",LeaderElector.getNodeName(myId));
overseerCollectionProcessor.close();
close();
}
 else {
log.warn("Overseer received wrong QUIT message {}",message);
}
break;
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
 else {
switch (operation) {
case OverseerCollectionProcessor.CREATECOLLECTION:
clusterState=buildCollection(clusterState,message);
break;
case REMOVECOLLECTION:
clusterState=removeCollection(clusterState,message);
break;
case REMOVESHARD:
clusterState=removeShard(clusterState,message);
break;
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
}
return clusterState;
}
