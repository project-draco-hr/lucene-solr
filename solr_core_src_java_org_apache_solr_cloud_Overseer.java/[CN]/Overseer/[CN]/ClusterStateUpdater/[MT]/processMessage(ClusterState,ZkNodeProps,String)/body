{
  if ("state".equals(operation)) {
    clusterState=updateState(clusterState,message);
  }
 else   if (DELETECORE.equals(operation)) {
    clusterState=removeCore(clusterState,message);
  }
 else   if (REMOVECOLLECTION.equals(operation)) {
    clusterState=removeCollection(clusterState,message);
  }
 else   if (REMOVESHARD.equals(operation)) {
    clusterState=removeShard(clusterState,message);
  }
 else   if (ZkStateReader.LEADER_PROP.equals(operation)) {
    StringBuilder sb=new StringBuilder();
    String baseUrl=message.getStr(ZkStateReader.BASE_URL_PROP);
    String coreName=message.getStr(ZkStateReader.CORE_NAME_PROP);
    sb.append(baseUrl);
    if (baseUrl != null && !baseUrl.endsWith("/"))     sb.append("/");
    sb.append(coreName == null ? "" : coreName);
    if (!(sb.substring(sb.length() - 1).equals("/")))     sb.append("/");
    clusterState=setShardLeader(clusterState,message.getStr(ZkStateReader.COLLECTION_PROP),message.getStr(ZkStateReader.SHARD_ID_PROP),sb.length() > 0 ? sb.toString() : null);
  }
 else   if ("createshard".equals(operation)) {
    clusterState=createShard(clusterState,message);
  }
 else   if ("updateshardstate".equals(operation)) {
    clusterState=updateShardState(clusterState,message);
  }
 else   if (OverseerCollectionProcessor.CREATECOLLECTION.equals(operation)) {
    clusterState=buildCollection(clusterState,message);
  }
 else {
    throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
  }
  return clusterState;
}
