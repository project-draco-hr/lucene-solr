{
  String collection=message.getStr("name");
  log.info("building a new collection: " + collection);
  if (clusterState.hasCollection(collection)) {
    log.warn("Collection {} already exists. exit",collection);
    return clusterState;
  }
  ArrayList<String> shardNames=new ArrayList<String>();
  if (ImplicitDocRouter.NAME.equals(message.getStr("router.name",DocRouter.DEFAULT_NAME))) {
    getShardNames(shardNames,message.getStr("shards",DocRouter.DEFAULT_NAME));
  }
 else {
    int numShards=message.getInt(ZkStateReader.NUM_SHARDS_PROP,-1);
    if (numShards < 1)     throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"numShards is a required parameter for 'compositeId' router");
    getShardNames(numShards,shardNames);
  }
  return createCollection(clusterState,collection,shardNames,message);
}
