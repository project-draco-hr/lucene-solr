{
  log.info("processMessage: queueSize: {}, message = {}",queueSize,message);
  CollectionParams.CollectionAction collectionAction=CollectionParams.CollectionAction.get(operation);
  if (collectionAction != null) {
switch (collectionAction) {
case CREATE:
      return buildCollection(clusterState,message);
case DELETE:
    return removeCollection(clusterState,message);
case CREATESHARD:
  return createShard(clusterState,message);
case DELETESHARD:
return removeShard(clusterState,message);
case ADDREPLICA:
return createReplica(clusterState,message);
case CLUSTERPROP:
handleProp(message);
case ADDREPLICAPROP:
return addReplicaProp(clusterState,message);
case DELETEREPLICAPROP:
return deleteReplicaProp(clusterState,message);
case BALANCESHARDUNIQUE:
ExclusiveSliceProperty dProp=new ExclusiveSliceProperty(this,clusterState,message);
if (dProp.balanceProperty()) {
String collName=message.getStr(ZkStateReader.COLLECTION_PROP);
return new ZkWriteCommand(collName,dProp.getDocCollection());
}
break;
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
 else {
OverseerAction overseerAction=OverseerAction.get(operation);
if (overseerAction != null) {
switch (overseerAction) {
case STATE:
return new ReplicaMutator(getZkStateReader()).setState(clusterState,message);
case LEADER:
return setShardLeader(clusterState,message);
case DELETECORE:
return removeCore(clusterState,message);
case ADDROUTINGRULE:
return addRoutingRule(clusterState,message);
case REMOVEROUTINGRULE:
return removeRoutingRule(clusterState,message);
case UPDATESHARDSTATE:
return updateShardState(clusterState,message);
case QUIT:
if (myId.equals(message.get("id"))) {
log.info("Quit command received {}",LeaderElector.getNodeName(myId));
overseerCollectionProcessor.close();
close();
}
 else {
log.warn("Overseer received wrong QUIT message {}",message);
}
break;
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
 else {
switch (operation) {
case OverseerCollectionProcessor.CREATECOLLECTION:
return buildCollection(clusterState,message);
case REMOVECOLLECTION:
return removeCollection(clusterState,message);
case REMOVESHARD:
return removeShard(clusterState,message);
default :
throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
}
}
}
return ZkStateWriter.NO_OP;
}
