{
  if ("state".equals(operation)) {
    cloudState=updateState(cloudState,message);
  }
 else   if (DELETECORE.equals(operation)) {
    cloudState=removeCore(cloudState,message);
  }
 else   if (ZkStateReader.LEADER_PROP.equals(operation)) {
    StringBuilder sb=new StringBuilder();
    String baseUrl=message.get(ZkStateReader.BASE_URL_PROP);
    String coreName=message.get(ZkStateReader.CORE_NAME_PROP);
    sb.append(baseUrl);
    if (!baseUrl.endsWith("/"))     sb.append("/");
    sb.append(coreName == null ? "" : coreName);
    if (!(sb.substring(sb.length() - 1).equals("/")))     sb.append("/");
    cloudState=setShardLeader(cloudState,message.get(ZkStateReader.COLLECTION_PROP),message.get(ZkStateReader.SHARD_ID_PROP),sb.toString());
  }
 else {
    throw new RuntimeException("unknown operation:" + operation + " contents:"+ message.getProperties());
  }
  return cloudState;
}
