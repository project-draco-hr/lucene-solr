{
  log.debug("Cores changed: " + nodeName + " states:"+ states);
synchronized (reader.getUpdateLock()) {
    reader.updateCloudState(true);
    CloudState cloudState=reader.getCloudState();
    for (    CoreState state : states) {
      cloudState=updateState(cloudState,nodeName,state);
    }
    try {
      zkClient.setData(ZkStateReader.CLUSTER_STATE,ZkStateReader.toJSON(cloudState),true);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Interrupted while publishing new state",e);
    }
  }
}
