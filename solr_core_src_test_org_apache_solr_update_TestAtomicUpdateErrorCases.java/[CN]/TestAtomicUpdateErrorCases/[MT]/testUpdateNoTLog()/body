{
  try {
    System.setProperty("enable.update.log","false");
    initCore("solrconfig.xml","schema15.xml");
    UpdateHandler uh=h.getCore().getUpdateHandler();
    assertTrue("this test requires DirectUpdateHandler2",uh instanceof DirectUpdateHandler2);
    assertNull("this test requires that the updateLog not be enabled, it " + "seems that someone modified the configs",((DirectUpdateHandler2)uh).getUpdateLog());
    addAndGetVersion(sdoc("id","1","val_i","42"),null);
    assertU(commit());
    try {
      ignoreException("updateLog");
      addAndGetVersion(sdoc("id","1","val_i",map("inc",-666)),null);
      fail("didn't get error about needing updateLog");
    }
 catch (    SolrException ex) {
      assertEquals(400,ex.code());
      if (ex.getMessage().indexOf("unless <updateLog/> is configured") < 0) {
        throw new RuntimeException("exception message is not expected",ex);
      }
    }
 finally {
      resetExceptionIgnores();
    }
  }
  finally {
    System.clearProperty("enable.update.log");
    deleteCore();
  }
}
