{
  Directory directory=newDirectory();
  IndexWriterConfig config=newIndexWriterConfig(new MockAnalyzer(random()));
  RandomIndexWriter writer=new RandomIndexWriter(random(),directory,config);
  for (  String content : DOC_FIELDS) {
    Document doc=new Document();
    doc.add(newField(FIELD,content,TextField.TYPE_NOT_STORED));
    writer.addDocument(doc);
  }
  IndexReader reader=SlowCompositeReaderWrapper.wrap(writer.getReader());
  IndexSearcher searcher=new IndexSearcher(reader);
  writer.close();
  TermQuery tq=new TermQuery(new Term(FIELD,"a"));
  Weight weight=searcher.createNormalizedWeight(tq,PostingsEnum.FLAG_POSITIONS);
  LeafReaderContext ctx=(LeafReaderContext)searcher.getTopReaderContext();
  Scorer scorer=weight.scorer(ctx,null);
  assertEquals(scorer.nextDoc(),0);
  assertEquals(scorer.nextPosition(),0);
  assertEquals(scorer.nextDoc(),1);
  assertEquals(scorer.nextPosition(),0);
  assertEquals(scorer.nextPosition(),1);
  assertEquals(scorer.nextPosition(),2);
  assertEquals(scorer.nextPosition(),3);
  assertEquals(scorer.nextDoc(),3);
  assertEquals(scorer.nextPosition(),2);
  reader.close();
  directory.close();
}
