{
  SolrDocument solrDoc=new SolrDocument();
  for (  Fieldable f : (List<Fieldable>)doc.getFields()) {
    String fieldName=f.name();
    if (returnFields != null && !returnFields.contains(fieldName))     continue;
    FieldType ft=schema.getFieldTypeNoEx(fieldName);
    Object val;
    if (ft == null) {
      if (f.isBinary())       val=f.binaryValue();
 else       val=f.stringValue();
    }
 else {
      val=useFieldObjects ? ft.toObject(f) : ft.toExternal(f);
    }
    solrDoc.addField(fieldName,val);
  }
  return solrDoc;
}
