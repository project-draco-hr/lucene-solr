{
  Query query=new TermQuery(new Term("body","contents"));
  IndexReader r=searcher.getIndexReader();
  TopDocs hits=searcher.search(query,10);
  assertEquals(3,hits.totalHits);
  assertEquals("3",r.document(hits.scoreDocs[0].doc).get("id"));
  assertEquals("1",r.document(hits.scoreDocs[1].doc).get("id"));
  assertEquals("2",r.document(hits.scoreDocs[2].doc).get("id"));
  Sort sort=new Sort(new SortField("popularity",SortField.Type.INT,true));
  Rescorer rescorer=new SortRescorer(sort);
  hits=rescorer.rescore(searcher,hits,10);
  assertEquals(3,hits.totalHits);
  assertEquals("2",r.document(hits.scoreDocs[0].doc).get("id"));
  assertEquals("1",r.document(hits.scoreDocs[1].doc).get("id"));
  assertEquals("3",r.document(hits.scoreDocs[2].doc).get("id"));
  String expl=rescorer.explain(searcher,searcher.explain(query,hits.scoreDocs[0].doc),hits.scoreDocs[0].doc).toString();
  assertTrue(expl,expl.contains("= sort field <int: \"popularity\">! value=20"));
  assertTrue(expl.contains("= first pass score"));
  assertTrue(expl.contains("body:contents in"));
}
