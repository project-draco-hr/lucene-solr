{
  SegmentInfos.FindSegmentsFile finder=new SegmentInfos.FindSegmentsFile(directory){
    protected Object doBody(    String segmentFileName) throws CorruptIndexException, IOException {
      SegmentInfos infos=new SegmentInfos();
      infos.read(directory,segmentFileName);
      if (readOnly)       return new ReadOnlyDirectoryReader(directory,infos,deletionPolicy,closeDirectory);
 else       return new DirectoryReader(directory,infos,deletionPolicy,closeDirectory,false);
    }
  }
;
  IndexReader reader=null;
  try {
    reader=(IndexReader)finder.run(commit);
  }
  finally {
    if (reader == null && closeDirectory) {
      try {
        directory.close();
      }
 catch (      IOException ioe) {
      }
    }
  }
  return reader;
}
