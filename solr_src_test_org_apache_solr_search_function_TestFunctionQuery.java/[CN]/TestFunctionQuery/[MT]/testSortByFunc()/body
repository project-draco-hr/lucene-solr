{
  assertU(adoc("id","1","x_i","100"));
  assertU(adoc("id","2","x_i","300"));
  assertU(adoc("id","3","x_i","200"));
  assertU(commit());
  String desc="/response/docs==[{'x_i':300},{'x_i':200},{'x_i':100}]";
  String asc="/response/docs==[{'x_i':100},{'x_i':200},{'x_i':300}]";
  String q="id:[1 TO 3]";
  assertJQ(req("q",q,"fl","x_i","sort","add(x_i,x_i) desc"),desc);
  assertJQ(req("q",q,"fl","x_i","sort","$x asc","x","add(x_i,x_i)"),asc);
  assertJQ(req("q",q,"fl","x_i","sort","$x asc, $y desc","x","5","y","add(x_i,x_i)"),desc);
  assertJQ(req("q",q,"fl","x_i","sort","add( 10 , 10 ) asc, add(x_i , $const) desc","const","50"),desc);
  assertJQ(req("q",q,"fl","x_i","sort","{!key=foo}add(x_i,x_i) desc"),desc);
  assertJQ(req("q",q,"fl","x_i","sort","{!key=bar}add(10,20) asc, {!key=foo}add(x_i,x_i) desc"),desc);
  assertJQ(req("q",q,"fl","x_i","sort","{!key=bar v=$s1} asc, {!key=foo v=$s2} desc","s1","add(3,4)","s2","add(x_i,5)"),desc);
}
