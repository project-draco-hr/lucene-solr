{
  assertU(adoc("id","1","a_tdt","2009-08-31T12:10:10.123Z","b_tdt","2009-08-31T12:10:10.124Z"));
  assertU(adoc("id","2"));
  assertU(commit());
  assertU(adoc("id","3"));
  assertU(adoc("id","4"));
  assertU(commit());
  assertU(adoc("id","5"));
  assertU(adoc("id","6"));
  assertU(commit());
  assertQ(req("fl","*,score","q","{!func}ord(id)","fq","id:6"),"//float[@name='score']='6.0'");
  assertQ(req("fl","*,score","q","{!func}top(ord(id))","fq","id:6"),"//float[@name='score']='6.0'");
  assertQ(req("fl","*,score","q","{!func}rord(id)","fq","id:1"),"//float[@name='score']='6.0'");
  assertQ(req("fl","*,score","q","{!func}top(rord(id))","fq","id:1"),"//float[@name='score']='6.0'");
  assertQ(req("fl","*,score","q","{!func}ms(a_tdt,b_tdt)","fq","id:1"),"//float[@name='score']='-1.0'");
  assertQ(req("fl","*,score","q","{!func}ms(b_tdt,a_tdt)","fq","id:1"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}ms(2009-08-31T12:10:10.125Z,2009-08-31T12:10:10.124Z)","fq","id:1"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}ms(2009-08-31T12:10:10.124Z,a_tdt)","fq","id:1"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}ms(2009-08-31T12:10:10.125Z,b_tdt)","fq","id:1"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}ms(2009-08-31T12:10:10.125Z/SECOND,2009-08-31T12:10:10.124Z/SECOND)","fq","id:1"),"//float[@name='score']='0.0'");
  for (int i=100; i < 112; i++) {
    assertU(adoc("id","" + i,"text","batman"));
  }
  assertU(commit());
  assertU(adoc("id","120","text","batman superman"));
  assertU(commit());
  String q="{!func}query($qq)";
  String fq="id:120";
  assertQ(req("fl","*,score","q",q,"qq","text:batman","fq",fq),"//float[@name='score']<'1.0'");
  assertQ(req("fl","*,score","q",q,"qq","text:superman","fq",fq),"//float[@name='score']>'1.0'");
  assertQ(req("fl","*,score","q","{!frange l=1 u=10}query($qq)","qq","text:superman"),"//*[@numFound='1']");
  q="{!func}sub(div(sum(0.0,product(1,query($qq))),1),0)";
  assertQ(req("fl","*,score","q",q,"qq","text:batman","fq",fq),"//float[@name='score']<'1.0'");
  assertQ(req("fl","*,score","q",q,"qq","text:superman","fq",fq),"//float[@name='score']>'1.0'");
  doTestDegreeRads();
  doTestFuncs();
}
