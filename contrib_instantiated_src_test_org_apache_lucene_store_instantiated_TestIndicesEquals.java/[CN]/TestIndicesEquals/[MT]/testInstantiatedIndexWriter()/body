{
  RAMDirectory dir=new RAMDirectory();
  InstantiatedIndex ii=new InstantiatedIndex();
  IndexWriter indexWriter=new IndexWriter(dir,new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),true,IndexWriter.MaxFieldLength.UNLIMITED);
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    indexWriter.addDocument(document);
  }
  indexWriter.close();
  InstantiatedIndexWriter instantiatedIndexWriter=ii.indexWriterFactory(new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),true);
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    assembleDocument(document,i);
    instantiatedIndexWriter.addDocument(document);
  }
  instantiatedIndexWriter.close();
  testEqualBehaviour(dir,ii);
}
