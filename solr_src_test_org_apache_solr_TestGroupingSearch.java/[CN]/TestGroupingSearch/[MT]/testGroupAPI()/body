{
  createIndex();
  String filt=f + ":[* TO *]";
  assertQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f),"/response/lst[@name='grouped']/lst[@name='" + f + "']/arr[@name='groups']");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id"),"/responseHeader/status==0","/responseHeader=={'_SKIP_':'QTime', 'status':0}","/responseHeader=={'_MATCH_':'status', 'status':0}","/grouped=={'" + f + "':{'matches':10,'groups':[\n"+ "{'groupValue':1,'doclist':{'numFound':3,'start':0,'docs':[{'id':'8'}]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':0,'docs':[{'id':'3'}]}},"+ "{'groupValue':2,'doclist':{'numFound':3,'start':0,'docs':[{'id':'4'}]}},"+ "{'groupValue':5,'doclist':{'numFound':1,'start':0,'docs':[{'id':'1'}]}},"+ "{'groupValue':4,'doclist':{'numFound':1,'start':0,'docs':[{'id':'2'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","2"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "{'groupValue':1,'doclist':{'numFound':3,'start':0,'docs':[{'id':'8'}]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':0,'docs':[{'id':'3'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","1","start","1"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "{'groupValue':3,'doclist':{'numFound':2,'start':0,'docs':[{'id':'3'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","1","start","100"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","2","group.limit","3"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "{'groupValue':1,'doclist':{'numFound':3,'start':0,'docs':[{'id':'8'},{'id':'10'},{'id':'5'}]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':0,'docs':[{'id':'3'},{'id':'6'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","2","group.limit","3","group.offset","1"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "{'groupValue':1,'doclist':{'numFound':3,'start':1,'docs':[{'id':'10'},{'id':'5'}]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':1,'docs':[{'id':'6'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","rows","2","group.limit","3","group.offset","10"),"/grouped=={'" + f + "':{'matches':10,'groups':["+ "{'groupValue':1,'doclist':{'numFound':3,'start':10,'docs':[]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':10,'docs':[]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id,score","rows","2","group.limit","2","indent","off"),"/grouped/" + f + "/groups=="+ "["+ "{'groupValue':1,'doclist':{'numFound':3,'start':0,'maxScore':10.0,'docs':[{'id':'8','score':10.0},{'id':'10','score':3.0}]}},"+ "{'groupValue':3,'doclist':{'numFound':2,'start':0,'maxScore':7.0,'docs':[{'id':'3','score':7.0},{'id':'6','score':2.0}]}}"+ "]");
  String func="add(" + f + ","+ f+ ")";
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.func",func,"fl","id","rows","2"),"/grouped=={'" + func + "':{'matches':10,'groups':["+ "{'groupValue':2.0,'doclist':{'numFound':3,'start':0,'docs':[{'id':'8'}]}},"+ "{'groupValue':6.0,'doclist':{'numFound':2,'start':0,'docs':[{'id':'3'}]}}"+ "]}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","facet","true","facet.field",f),"/grouped/" + f + "/matches==10","/facet_counts/facet_fields/" + f + "==['1',3, '2',3, '3',2, '4',1, '5',1]");
  purgeFieldCache(FieldCache.DEFAULT);
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","hl","true","hl.fl",f),"/grouped/" + f + "/matches==10","/highlighting=={'_ORDERED_':'', '8':{},'3':{},'4':{},'1':{},'2':{}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.field",f,"fl","id","debugQuery","true"),"/grouped/" + f + "/matches==10","/debug/explain/8==","/debug/explain/2==");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.query","id:[2 TO 5]","fl","id","group.limit","3"),"/grouped=={'id:[2 TO 5]':{'matches':10," + "'doclist':{'numFound':4,'start':0,'docs':[{'id':'3'},{'id':'4'},{'id':'2'}]}}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.query","id:[2 TO 5]","fl","id","group.limit","3","group.offset","2"),"/grouped=={'id:[2 TO 5]':{'matches':10," + "'doclist':{'numFound':4,'start':2,'docs':[{'id':'2'},{'id':'5'}]}}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.query","id:[2 TO 5]","fl","id","group.limit","3","group.offset","10"),"/grouped=={'id:[2 TO 5]':{'matches':10," + "'doclist':{'numFound':4,'start':10,'docs':[]}}}");
  assertJQ(req("fq",filt,"q","{!func}" + f2,"group","true","group.query","id:[2 TO 5]","group.query","id:[5 TO 5]","group.field",f,"rows","1","fl","id","group.limit","2"),"/grouped/id:[2 TO 5]=={'matches':10,'doclist':{'numFound':4,'start':0,'docs':[{'id':'3'},{'id':'4'}]}}","/grouped/id:[5 TO 5]=={'matches':10,'doclist':{'numFound':1,'start':0,'docs':[{'id':'5'}]}}","/grouped/" + f + "=={'matches':10,'groups':[{'groupValue':1,'doclist':{'numFound':3,'start':0,'docs':[{'id':'8'},{'id':'10'}]}}]}");
}
