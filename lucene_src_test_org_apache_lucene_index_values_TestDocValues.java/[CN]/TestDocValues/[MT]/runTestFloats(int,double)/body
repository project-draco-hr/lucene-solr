{
  Directory dir=newDirectory();
  Writer w=Floats.getWriter(dir,"test",precision);
  final int NUM_VALUES=777 + random.nextInt(777);
  ;
  final double[] values=new double[NUM_VALUES];
  for (int i=0; i < NUM_VALUES; i++) {
    final double v=precision == 4 ? random.nextFloat() : random.nextDouble();
    values[i]=v;
    w.add(i,v);
  }
  final int additionalValues=1 + random.nextInt(10);
  w.finish(NUM_VALUES + additionalValues);
  DocValues r=Floats.getValues(dir,"test",NUM_VALUES + additionalValues);
  for (int iter=0; iter < 2; iter++) {
    Source s=getSource(r);
    for (int i=0; i < NUM_VALUES; i++) {
      assertEquals(values[i],s.getFloat(i),0.0f);
    }
  }
  for (int iter=0; iter < 2; iter++) {
    ValuesEnum fEnum=r.getEnum();
    FloatsRef floats=fEnum.getFloat();
    for (int i=0; i < NUM_VALUES; i++) {
      assertEquals(i,fEnum.nextDoc());
      assertEquals(values[i],floats.get(),delta);
    }
    for (int i=NUM_VALUES; i < NUM_VALUES + additionalValues; i++) {
      assertEquals(ValuesEnum.NO_MORE_DOCS,fEnum.nextDoc());
    }
    fEnum.close();
  }
  for (int iter=0; iter < 2; iter++) {
    ValuesEnum fEnum=r.getEnum();
    FloatsRef floats=fEnum.getFloat();
    for (int i=0; i < NUM_VALUES; i+=1 + random.nextInt(25)) {
      assertEquals(i,fEnum.advance(i));
      assertEquals(values[i],floats.get(),delta);
    }
    for (int i=NUM_VALUES; i < NUM_VALUES + additionalValues; i++) {
      assertEquals(ValuesEnum.NO_MORE_DOCS,fEnum.advance(i));
    }
    fEnum.close();
  }
  r.close();
  dir.close();
}
