{
  Directory dir1=getDir1();
  Directory dir2=getDir2();
  IndexWriter modifier=new IndexWriter(dir1,new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  Document d=new Document();
  d.add(new Field("f1","v1",Field.Store.YES,Field.Index.ANALYZED));
  modifier.addDocument(d);
  modifier.close();
  modifier=new IndexWriter(dir2,new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  d=new Document();
  d.add(new Field("f2","v2",Field.Store.YES,Field.Index.ANALYZED));
  modifier.addDocument(d);
  modifier.close();
  ParallelReader pr=new ParallelReader();
  pr.add(IndexReader.open(dir1,false));
  pr.add(IndexReader.open(dir2,false));
  assertFalse(pr.isOptimized());
  pr.close();
  modifier=new IndexWriter(dir1,new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  modifier.optimize();
  modifier.close();
  pr=new ParallelReader();
  pr.add(IndexReader.open(dir1,false));
  pr.add(IndexReader.open(dir2,false));
  assertFalse(pr.isOptimized());
  pr.close();
  modifier=new IndexWriter(dir2,new StandardAnalyzer(org.apache.lucene.util.Version.LUCENE_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  modifier.optimize();
  modifier.close();
  pr=new ParallelReader();
  pr.add(IndexReader.open(dir1,false));
  pr.add(IndexReader.open(dir2,false));
  assertTrue(pr.isOptimized());
  pr.close();
}
