{
  TermAttributeImpl t=new TermAttributeImpl();
  StringBuffer buf=new StringBuffer("ab");
  for (int i=0; i < 20; i++) {
    char[] content=buf.toString().toCharArray();
    t.setTermBuffer(content,0,content.length);
    assertEquals(buf.length(),t.termLength());
    assertEquals(buf.toString(),t.term());
    buf.append(buf.toString());
  }
  assertEquals(1048576,t.termLength());
  assertEquals(1179654,t.termBuffer().length);
  t=new TermAttributeImpl();
  buf=new StringBuffer("ab");
  for (int i=0; i < 20; i++) {
    String content=buf.toString();
    t.setTermBuffer(content,0,content.length());
    assertEquals(content.length(),t.termLength());
    assertEquals(content,t.term());
    buf.append(content);
  }
  assertEquals(1048576,t.termLength());
  assertEquals(1179654,t.termBuffer().length);
  t=new TermAttributeImpl();
  buf=new StringBuffer("ab");
  for (int i=0; i < 20; i++) {
    String content=buf.toString();
    t.setTermBuffer(content);
    assertEquals(content.length(),t.termLength());
    assertEquals(content,t.term());
    buf.append(content);
  }
  assertEquals(1048576,t.termLength());
  assertEquals(1179654,t.termBuffer().length);
  t=new TermAttributeImpl();
  buf=new StringBuffer("a");
  for (int i=0; i < 20000; i++) {
    String content=buf.toString();
    t.setTermBuffer(content);
    assertEquals(content.length(),t.termLength());
    assertEquals(content,t.term());
    buf.append("a");
  }
  assertEquals(20000,t.termLength());
  assertEquals(20167,t.termBuffer().length);
  t=new TermAttributeImpl();
  buf=new StringBuffer("a");
  for (int i=0; i < 20000; i++) {
    String content=buf.toString();
    t.setTermBuffer(content);
    assertEquals(content.length(),t.termLength());
    assertEquals(content,t.term());
    buf.append("a");
  }
  assertEquals(20000,t.termLength());
  assertEquals(20167,t.termBuffer().length);
}
