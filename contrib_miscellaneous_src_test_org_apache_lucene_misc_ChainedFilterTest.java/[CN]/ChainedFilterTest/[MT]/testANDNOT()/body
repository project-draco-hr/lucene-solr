{
  for (int mode=0; mode < 2; mode++) {
    boolean old=(mode == 0);
    ChainedFilter chain=getChainedFilter(new Filter[]{dateFilter,sueFilter},new int[]{ChainedFilter.AND,ChainedFilter.ANDNOT},old);
    Hits hits=searcher.search(query,chain);
    assertEquals("ANDNOT matches just bob",MAX / 2,hits.length());
    assertEquals("bob",hits.doc(0).get("owner"));
    chain=getChainedFilter(new Filter[]{bobFilter,bobFilter},new int[]{ChainedFilter.ANDNOT,ChainedFilter.ANDNOT},old);
    hits=searcher.search(query,chain);
    assertEquals("ANDNOT bob ANDNOT bob matches all sues",MAX / 2,hits.length());
    assertEquals("sue",hits.doc(0).get("owner"));
  }
}
