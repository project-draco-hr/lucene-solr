{
  final String s=RandomStrings.randomAsciiOfLength(random(),length);
  final TokenStream grams=new NGramTokenizer(TEST_VERSION_CURRENT,new StringReader(s),minGram,maxGram);
  final CharTermAttribute termAtt=grams.addAttribute(CharTermAttribute.class);
  final PositionIncrementAttribute posIncAtt=grams.addAttribute(PositionIncrementAttribute.class);
  final PositionLengthAttribute posLenAtt=grams.addAttribute(PositionLengthAttribute.class);
  final OffsetAttribute offsetAtt=grams.addAttribute(OffsetAttribute.class);
  grams.reset();
  for (int start=0; start < s.length(); ++start) {
    for (int end=start + minGram; end <= start + maxGram && end <= s.length(); ++end) {
      assertTrue(grams.incrementToken());
      assertEquals(s.substring(start,end),termAtt.toString());
      assertEquals(1,posIncAtt.getPositionIncrement());
      assertEquals(start,offsetAtt.startOffset());
      assertEquals(end,offsetAtt.endOffset());
    }
  }
  grams.end();
  assertEquals(s.length(),offsetAtt.startOffset());
  assertEquals(s.length(),offsetAtt.endOffset());
}
