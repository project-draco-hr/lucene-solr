{
  query=rewrite(query);
  Weight weight=createWeight(query,needsScores);
  float v=weight.getValueForNormalization();
  float norm=getSimilarity(needsScores).queryNorm(v);
  if (Float.isInfinite(norm) || Float.isNaN(norm)) {
    norm=1.0f;
  }
  weight.normalize(norm,1.0f);
  return weight;
}
