{
  Map<String,Object> map=req.getParams().required().getAll(null,COLLECTION_PROP,SHARD_ID_PROP);
  ClusterState clusterState=handler.coreContainer.getZkController().getClusterState();
  final String newShardName=req.getParams().get(SHARD_ID_PROP);
  if (!SolrIdentifierValidator.validateShardName(newShardName)) {
    throw new SolrException(ErrorCode.BAD_REQUEST,SolrIdentifierValidator.getIdentifierMessage(SolrIdentifierValidator.IdentifierType.SHARD,newShardName));
  }
  if (!ImplicitDocRouter.NAME.equals(((Map)clusterState.getCollection(req.getParams().get(COLLECTION_PROP)).get(DOC_ROUTER)).get(NAME)))   throw new SolrException(ErrorCode.BAD_REQUEST,"shards can be added only to 'implicit' collections");
  req.getParams().getAll(map,REPLICATION_FACTOR,CREATE_NODE_SET);
  return copyPropertiesWithPrefix(req.getParams(),map,COLL_PROP_PREFIX);
}
