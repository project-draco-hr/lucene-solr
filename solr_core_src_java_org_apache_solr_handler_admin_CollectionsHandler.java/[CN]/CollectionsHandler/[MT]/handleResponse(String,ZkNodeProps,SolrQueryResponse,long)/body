{
  long time=System.nanoTime();
  QueueEvent event=coreContainer.getZkController().getOverseerCollectionQueue().offer(ZkStateReader.toJSON(m),timeout);
  if (event.getBytes() != null) {
    SolrResponse response=SolrResponse.deserialize(event.getBytes());
    rsp.getValues().addAll(response.getResponse());
    SimpleOrderedMap exp=(SimpleOrderedMap)response.getResponse().get("exception");
    if (exp != null) {
      Integer code=(Integer)exp.get("rspCode");
      rsp.setException(new SolrException(code != null && code != -1 ? ErrorCode.getErrorCode(code) : ErrorCode.SERVER_ERROR,(String)exp.get("msg")));
    }
  }
 else {
    if (System.nanoTime() - time >= TimeUnit.NANOSECONDS.convert(timeout,TimeUnit.MILLISECONDS)) {
      throw new SolrException(ErrorCode.SERVER_ERROR,operation + " the collection time out:" + timeout / 1000 + "s");
    }
 else     if (event.getWatchedEvent() != null) {
      throw new SolrException(ErrorCode.SERVER_ERROR,operation + " the collection error [Watcher fired on path: " + event.getWatchedEvent().getPath()+ " state: "+ event.getWatchedEvent().getState()+ " type "+ event.getWatchedEvent().getType()+ "]");
    }
 else {
      throw new SolrException(ErrorCode.SERVER_ERROR,operation + " the collection unkown case");
    }
  }
}
