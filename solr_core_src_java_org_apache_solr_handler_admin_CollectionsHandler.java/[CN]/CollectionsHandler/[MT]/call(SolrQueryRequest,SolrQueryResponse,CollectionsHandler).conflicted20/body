{
  req.getParams().required().check(NAME,COLLECTION_PROP);
  String collectionName=req.getParams().get(COLLECTION_PROP);
  ClusterState clusterState=h.coreContainer.getZkController().getClusterState();
  if (!clusterState.hasCollection(collectionName)) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"Collection '" + collectionName + "' does not exist, no action taken.");
  }
  String location=req.getParams().get("location");
  if (location == null) {
    location=h.coreContainer.getZkController().getZkStateReader().getClusterProperty("location",(String)null);
  }
  if (location == null) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"'location' is not specified as a query parameter or set as a cluster property");
  }
  Map<String,Object> params=req.getParams().getAll(null,NAME,COLLECTION_PROP);
  params.put("location",location);
  return params;
}
