{
  Map<String,Object> props=req.getParams().required().getAll(null,NAME);
  props.put("fromApi","true");
  req.getParams().getAll(props,REPLICATION_FACTOR,COLL_CONF,NUM_SLICES,MAX_SHARDS_PER_NODE,CREATE_NODE_SET,CREATE_NODE_SET_SHUFFLE,SHARDS_PROP,STATE_FORMAT,AUTO_ADD_REPLICAS,RULE,SNITCH);
  if (props.get(STATE_FORMAT) == null) {
    props.put(STATE_FORMAT,"2");
  }
  addMapObject(props,RULE);
  addMapObject(props,SNITCH);
  verifyRuleParams(h.coreContainer,props);
  final String collectionName=SolrIdentifierValidator.validateCollectionName((String)props.get(NAME));
  final String shardsParam=(String)props.get(SHARDS_PROP);
  if (StringUtils.isNotEmpty(shardsParam)) {
    verifyShardsParam(shardsParam);
  }
  if (SYSTEM_COLL.equals(collectionName)) {
    props.put(NUM_SLICES,1);
    props.remove(SHARDS_PROP);
    createSysConfigSet(h.coreContainer);
  }
  copyPropertiesWithPrefix(req.getParams(),props,COLL_PROP_PREFIX);
  return copyPropertiesWithPrefix(req.getParams(),props,"router.");
}
