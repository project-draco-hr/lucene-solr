{
  log.info("Create shard: " + req.getParamString());
  req.getParams().required().check(COLLECTION_PROP,SHARD_ID_PROP);
  ClusterState clusterState=coreContainer.getZkController().getClusterState();
  if (!ImplicitDocRouter.NAME.equals(((Map)clusterState.getCollection(req.getParams().get(COLLECTION_PROP)).get(ROUTER)).get("name")))   throw new SolrException(ErrorCode.BAD_REQUEST,"shards can be added only to 'implicit' collections");
  Map<String,Object> map=makeMap(QUEUE_OPERATION,CREATESHARD);
  copyIfNotNull(req.getParams(),map,COLLECTION_PROP,SHARD_ID_PROP,ZkStateReader.REPLICATION_FACTOR,CREATE_NODE_SET,ASYNC);
  copyPropertiesIfNotNull(req.getParams(),map);
  ZkNodeProps m=new ZkNodeProps(map);
  handleResponse(CREATESHARD,m,rsp);
}
