{
  boolean success=false;
  IndexInput input=directory.openInput(segmentFileName);
  if (segmentFileName.equals(IndexFileNames.SEGMENTS)) {
    generation=0;
  }
 else {
    generation=Long.parseLong(segmentFileName.substring(1 + IndexFileNames.SEGMENTS.length()),Character.MAX_RADIX);
  }
  lastGeneration=generation;
  try {
    int format=input.readInt();
    if (format < 0) {
      if (format < FORMAT_SINGLE_NORM_FILE)       throw new CorruptIndexException("Unknown format version: " + format);
      version=input.readLong();
      counter=input.readInt();
    }
 else {
      counter=format;
    }
    for (int i=input.readInt(); i > 0; i--) {
      addElement(new SegmentInfo(directory,format,input));
    }
    if (format >= 0) {
      if (input.getFilePointer() >= input.length())       version=System.currentTimeMillis();
 else       version=input.readLong();
    }
    success=true;
  }
  finally {
    input.close();
    if (!success) {
      clear();
    }
  }
}
