{
  IndexInput input=directory.openInput(IndexFileNames.SEGMENTS);
  int format=0;
  long version=0;
  try {
    format=input.readInt();
    if (format < 0) {
      if (format < FORMAT)       throw new IOException("Unknown format version: " + format);
      version=input.readLong();
    }
  }
  finally {
    input.close();
  }
  if (format < 0)   return version;
  SegmentInfos sis=new SegmentInfos();
  sis.read(directory);
  return sis.getVersion();
}
