{
  IndexOutput output=directory.createOutput("segments.new");
  try {
    output.writeInt(FORMAT);
    output.writeLong(++version);
    output.writeInt(counter);
    output.writeInt(size());
    for (int i=0; i < size(); i++) {
      SegmentInfo si=info(i);
      output.writeString(si.name);
      output.writeInt(si.docCount);
    }
  }
  finally {
    output.close();
  }
  directory.renameFile("segments.new",Constants.INDEX_SEGMENTS_FILENAME);
}
