{
  Directory dir=newDirectory();
  IndexWriterConfig iwConf=newIndexWriterConfig(new MockAnalyzer(random()));
  iwConf.setMaxBufferedDocs(RandomInts.randomIntBetween(random(),2,30));
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwConf);
  final Document emptyDoc=new Document();
  final int numDocs=random().nextBoolean() ? 1 : atLeast(1000);
  for (int i=0; i < numDocs; ++i) {
    iw.addDocument(emptyDoc);
  }
  iw.commit();
  final DirectoryReader rd=DirectoryReader.open(dir);
  for (int i=0; i < numDocs; ++i) {
    final StoredDocument doc=rd.document(i);
    assertNotNull(doc);
    assertTrue(doc.getFields().isEmpty());
  }
  rd.close();
  iw.shutdown();
  dir.close();
}
