{
  int limit=searcher.getIndexReader().maxDoc();
  if (limit == 0) {
    limit=1;
  }
  topN=Math.min(topN,limit);
  boolean fillFields=true;
  TopFieldCollector hitsCollector=TopFieldCollector.create(sort,topN,null,fillFields,doDocScores,doMaxScore,false);
  if (filter != null) {
    q=new FilteredQuery(q,filter);
  }
  searcher.search(q,MultiCollector.wrap(hitsCollector,sfc));
  return (TopFieldDocs)hitsCollector.topDocs();
}
