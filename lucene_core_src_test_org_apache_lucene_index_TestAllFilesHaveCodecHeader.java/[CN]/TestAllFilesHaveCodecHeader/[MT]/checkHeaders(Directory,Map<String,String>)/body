{
  SegmentInfos sis=new SegmentInfos();
  sis.read(dir);
  checkHeader(dir,sis.getSegmentsFileName(),namesToExtensions);
  for (  SegmentCommitInfo si : sis) {
    for (    String file : si.files()) {
      checkHeader(dir,file,namesToExtensions);
    }
    if (si.info.getUseCompoundFile()) {
      try (Directory cfsDir=si.info.getCodec().compoundFormat().getCompoundReader(dir,si.info,newIOContext(random()))){
        for (        String cfsFile : cfsDir.listAll()) {
          checkHeader(cfsDir,cfsFile,namesToExtensions);
        }
      }
     }
  }
}
