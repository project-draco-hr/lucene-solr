{
  SegmentInfos sis=new SegmentInfos();
  sis.read(dir);
  checkHeader(dir,sis.getSegmentsFileName(),namesToExtensions,null);
  for (  SegmentCommitInfo si : sis) {
    assertNotNull(si.info.getId());
    for (    String file : si.files()) {
      checkHeader(dir,file,namesToExtensions,si.info.getId());
    }
    if (si.info.getUseCompoundFile()) {
      try (Directory cfsDir=si.info.getCodec().compoundFormat().getCompoundReader(dir,si.info,newIOContext(random()))){
        for (        String cfsFile : cfsDir.listAll()) {
          checkHeader(cfsDir,cfsFile,namesToExtensions,si.info.getId());
        }
      }
     }
  }
}
