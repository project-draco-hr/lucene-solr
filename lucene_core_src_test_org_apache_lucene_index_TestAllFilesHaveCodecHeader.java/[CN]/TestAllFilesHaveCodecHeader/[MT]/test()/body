{
  Directory dir=newDirectory();
  IndexWriterConfig conf=newIndexWriterConfig(new MockAnalyzer(random()));
  conf.setCodec(TestUtil.getDefaultCodec());
  RandomIndexWriter riw=new RandomIndexWriter(random(),dir,conf);
  Document doc=new Document();
  Field idField=newStringField("id","",Field.Store.YES);
  Field bodyField=newTextField("body","",Field.Store.YES);
  FieldType vectorsType=new FieldType(TextField.TYPE_STORED);
  vectorsType.setStoreTermVectors(true);
  vectorsType.setStoreTermVectorPositions(true);
  Field vectorsField=new Field("vectors","",vectorsType);
  Field dvField=new NumericDocValuesField("dv",5);
  doc.add(idField);
  doc.add(bodyField);
  doc.add(vectorsField);
  doc.add(dvField);
  for (int i=0; i < 100; i++) {
    idField.setStringValue(Integer.toString(i));
    bodyField.setStringValue(TestUtil.randomUnicodeString(random()));
    dvField.setLongValue(random().nextInt(5));
    vectorsField.setStringValue(TestUtil.randomUnicodeString(random()));
    riw.addDocument(doc);
    if (random().nextInt(7) == 0) {
      riw.commit();
    }
    if (random().nextInt(20) == 0) {
      riw.deleteDocuments(new Term("id",Integer.toString(i)));
    }
    if (random().nextInt(15) == 0) {
      riw.updateNumericDocValue(new Term("id"),"dv",Long.valueOf(i));
    }
  }
  riw.close();
  checkHeaders(dir,new HashMap<String,String>());
  dir.close();
}
