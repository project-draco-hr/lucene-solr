{
  for (  String file : dir.listAll()) {
    if (file.equals(IndexWriter.WRITE_LOCK_NAME)) {
      continue;
    }
    if (file.endsWith(IndexFileNames.COMPOUND_FILE_EXTENSION)) {
      CompoundFileDirectory cfsDir=new CompoundFileDirectory(dir,file,newIOContext(random()),false);
      checkHeaders(cfsDir);
      cfsDir.close();
    }
    IndexInput in=null;
    boolean success=false;
    try {
      in=dir.openInput(file,newIOContext(random()));
      int val=in.readInt();
      assertEquals(file + " has no codec header, instead found: " + val,CodecUtil.CODEC_MAGIC,val);
      success=true;
    }
  finally {
      if (success) {
        IOUtils.close(in);
      }
 else {
        IOUtils.closeWhileHandlingException(in);
      }
    }
  }
}
