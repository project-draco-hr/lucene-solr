{
  Directory dir=newDirectory();
  Directory taxoDir=newDirectory();
  writer=new RandomIndexWriter(random(),dir);
  taxoWriter=new DirectoryTaxonomyWriter(taxoDir,IndexWriterConfig.OpenMode.CREATE);
  facetFields=new FacetFields(taxoWriter);
  add("Author/Bob","Publish Date/2010/10/15");
  add("Author/Lisa","Publish Date/2010/10/20");
  writer.commit();
  add("Foobar/Lisa","Publish Date/2012/1/1");
  IndexSearcher searcher=newSearcher(writer.getReader());
  writer.close();
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoWriter);
  taxoWriter.close();
  FacetSearchParams fsp=new FacetSearchParams(new CountFacetRequest(new FacetLabel("Publish Date"),10),new CountFacetRequest(new FacetLabel("Author"),10));
  DrillDownQuery ddq=new DrillDownQuery(fsp.indexingParams,new MatchAllDocsQuery());
  ddq.add(new FacetLabel("Author","Lisa"));
  DrillSidewaysResult r=new DrillSideways(searcher,taxoReader).search(null,ddq,10,fsp);
  assertEquals(1,r.hits.totalHits);
  assertEquals(2,r.facetResults.size());
  assertEquals("Publish Date: 2010=1",toString(r.facetResults.get(0)));
  assertEquals("Author: Lisa=1 Bob=1",toString(r.facetResults.get(1)));
  searcher.getIndexReader().close();
  taxoReader.close();
  dir.close();
  taxoDir.close();
}
