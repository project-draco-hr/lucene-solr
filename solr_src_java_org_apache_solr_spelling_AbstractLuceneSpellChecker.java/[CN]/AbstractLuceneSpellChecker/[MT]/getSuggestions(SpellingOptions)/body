{
  SpellingResult result=new SpellingResult(options.tokens);
  IndexReader reader=determineReader(options.reader);
  Term term=field != null ? new Term(field,"") : null;
  float theAccuracy=(options.accuracy == Float.MIN_VALUE) ? spellChecker.getAccuracy() : options.accuracy;
  int count=(int)Math.max(options.count,AbstractLuceneSpellChecker.DEFAULT_SUGGESTION_COUNT);
  for (  Token token : options.tokens) {
    String tokenText=new String(token.buffer(),0,token.length());
    String[] suggestions=spellChecker.suggestSimilar(tokenText,count,field != null ? reader : null,field,options.onlyMorePopular,theAccuracy);
    if (suggestions.length == 1 && suggestions[0].equals(tokenText)) {
      continue;
    }
    if (options.extendedResults == true && reader != null && field != null) {
      term=term.createTerm(tokenText);
      result.add(token,reader.docFreq(term));
      int countLimit=Math.min(options.count,suggestions.length);
      for (int i=0; i < countLimit; i++) {
        term=term.createTerm(suggestions[i]);
        result.add(token,suggestions[i],reader.docFreq(term));
      }
    }
 else {
      if (suggestions.length > 0) {
        List<String> suggList=Arrays.asList(suggestions);
        if (suggestions.length > options.count) {
          suggList=suggList.subList(0,options.count);
        }
        result.add(token,suggList);
      }
    }
  }
  return result;
}
