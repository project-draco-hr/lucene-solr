{
  final OutputStream out=socket.getOutputStream();
  out.write(message);
  out.flush();
  final int ret=socket.getInputStream().read();
  if (ret < 0) {
    throw new IllegalStateException("Lock server died because of locking error.");
  }
  if (ret != message) {
    throw new IOException("Protocol violation.");
  }
}
