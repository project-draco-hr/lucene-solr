{
  File path=TestUtil.getTempDir("testPostingsFormat.testExact");
  Directory dir=newFSDirectory(path);
  FieldsProducer fieldsProducer=buildIndex(dir,options,withPayloads,true);
  testFields(fieldsProducer);
  IndexOptions[] allOptions=IndexOptions.values();
  int maxIndexOption=Arrays.asList(allOptions).indexOf(options);
  for (int i=0; i <= maxIndexOption; i++) {
    testTerms(fieldsProducer,EnumSet.allOf(Option.class),allOptions[i],options,true);
    if (withPayloads) {
      testTerms(fieldsProducer,EnumSet.complementOf(EnumSet.of(Option.PAYLOADS)),allOptions[i],options,true);
    }
  }
  fieldsProducer.close();
  dir.close();
  TestUtil.rmDir(path);
}
