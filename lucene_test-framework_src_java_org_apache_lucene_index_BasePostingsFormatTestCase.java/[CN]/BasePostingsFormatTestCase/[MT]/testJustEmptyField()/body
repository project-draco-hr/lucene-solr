{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(null);
  iwc.setCodec(getCodec());
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwc);
  Document doc=new Document();
  doc.add(newStringField("","something",Field.Store.NO));
  iw.addDocument(doc);
  DirectoryReader ir=iw.getReader();
  AtomicReader ar=getOnlySegmentReader(ir);
  Fields fields=ar.fields();
  int fieldCount=fields.size();
  assertTrue(fieldCount == 1 || fieldCount == -1);
  Terms terms=ar.terms("");
  assertNotNull(terms);
  TermsEnum termsEnum=terms.iterator(null);
  assertNotNull(termsEnum.next());
  assertEquals(termsEnum.term(),new BytesRef("something"));
  assertNull(termsEnum.next());
  ir.close();
  iw.shutdown();
  dir.close();
}
