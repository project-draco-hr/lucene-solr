{
  boolean unicodeSortOrder;
  if (termSortOrder == null) {
    unicodeSortOrder=true;
    StackTraceElement[] trace=new Exception().getStackTrace();
    for (int i=0; i < trace.length; i++) {
      if ("org.apache.lucene.index.IndexWriter".equals(trace[i].getClassName())) {
        unicodeSortOrder=false;
        break;
      }
    }
  }
 else {
    unicodeSortOrder=termSortOrder.equals("codepoint");
  }
  return new PreFlexFields(state.dir,state.fieldInfos,state.segmentInfo,state.readBufferSize,state.termsIndexDivisor,unicodeSortOrder);
}
