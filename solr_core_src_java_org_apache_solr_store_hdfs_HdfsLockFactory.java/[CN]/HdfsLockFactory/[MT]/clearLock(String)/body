{
  FileSystem fs=null;
  try {
    fs=FileSystem.newInstance(lockPath.toUri(),configuration);
    while (true) {
      if (fs.exists(lockPath)) {
        if (lockPrefix != null) {
          lockName=lockPrefix + "-" + lockName;
        }
        Path lockFile=new Path(lockPath,lockName);
        try {
          if (fs.exists(lockFile) && !fs.delete(lockFile,false)) {
            throw new IOException("Cannot delete " + lockFile);
          }
        }
 catch (        RemoteException e) {
          if (e.getClassName().equals("org.apache.hadoop.hdfs.server.namenode.SafeModeException")) {
            log.warn("The NameNode is in SafeMode - Solr will wait 5 seconds and try again.");
            try {
              Thread.sleep(5000);
            }
 catch (            InterruptedException e1) {
              Thread.interrupted();
            }
            continue;
          }
          throw e;
        }
        break;
      }
    }
  }
  finally {
    IOUtils.closeQuietly(fs);
  }
}
