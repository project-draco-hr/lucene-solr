{
  Document doc=new Document();
  Field idField=newStringField(random,"id","",Field.Store.YES);
  Field intIdField=new IntField("id_int",0,Store.YES);
  Field floatIdField=new FloatField("id_float",0,Store.YES);
  Field longIdField=new LongField("id_long",0,Store.YES);
  Field doubleIdField=new DoubleField("id_double",0,Store.YES);
  Field randField=newStringField(random,"rand","",Field.Store.YES);
  Field bodyField=newStringField(random,"body","",Field.Store.NO);
  doc.add(idField);
  doc.add(intIdField);
  doc.add(floatIdField);
  doc.add(longIdField);
  doc.add(doubleIdField);
  doc.add(randField);
  doc.add(bodyField);
  RandomIndexWriter writer=new RandomIndexWriter(random,index.index,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer(random)).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(TestUtil.nextInt(random,50,1000)).setMergePolicy(newLogMergePolicy()));
  TestUtil.reduceOpenFiles(writer.w);
  while (true) {
    int minCount=0;
    int maxCount=0;
    for (int d=minId; d <= maxId; d++) {
      idField.setStringValue(pad(d));
      intIdField.setIntValue(d);
      floatIdField.setFloatValue(d);
      longIdField.setLongValue(d);
      doubleIdField.setDoubleValue(d);
      int r=index.allowNegativeRandomInts ? random.nextInt() : random.nextInt(Integer.MAX_VALUE);
      if (index.maxR < r) {
        index.maxR=r;
        maxCount=1;
      }
 else       if (index.maxR == r) {
        maxCount++;
      }
      if (r < index.minR) {
        index.minR=r;
        minCount=1;
      }
 else       if (r == index.minR) {
        minCount++;
      }
      randField.setStringValue(pad(r));
      bodyField.setStringValue("body");
      writer.addDocument(doc);
    }
    if (minCount == 1 && maxCount == 1) {
      IndexReader ir=writer.getReader();
      writer.close();
      return ir;
    }
    writer.deleteAll();
  }
}
