{
  ensureOpen();
  RAMFile file=fileMap.get(source);
  if (file == null) {
    throw new FileNotFoundException(source);
  }
  if (fileMap.putIfAbsent(dest,file) != null) {
    throw new FileAlreadyExistsException(dest);
  }
  if (!fileMap.remove(source,file)) {
    throw new IllegalStateException("file was unexpectedly replaced: " + source);
  }
  fileMap.remove(source);
}
