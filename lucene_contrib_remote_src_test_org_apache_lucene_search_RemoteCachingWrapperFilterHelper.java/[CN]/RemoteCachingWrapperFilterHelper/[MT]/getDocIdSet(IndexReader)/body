{
  Filter cachedFilter=FilterManager.getInstance().getFilter(filter);
  Assert.assertNotNull("Filter should not be null",cachedFilter);
  if (!shouldHaveCache) {
    Assert.assertSame("First time filter should be the same ",filter,cachedFilter);
  }
 else {
    Assert.assertNotSame("We should have a cached version of the filter",filter,cachedFilter);
  }
  if (filter instanceof CachingWrapperFilterHelper) {
    ((CachingWrapperFilterHelper)cachedFilter).setShouldHaveCache(shouldHaveCache);
  }
  return cachedFilter.getDocIdSet(reader);
}
