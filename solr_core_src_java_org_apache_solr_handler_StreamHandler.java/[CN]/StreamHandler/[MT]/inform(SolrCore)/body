{
  String defaultCollection;
  String defaultZkhost;
  CoreContainer coreContainer=core.getCoreDescriptor().getCoreContainer();
  this.coreName=core.getName();
  if (coreContainer.isZooKeeperAware()) {
    defaultCollection=core.getCoreDescriptor().getCollectionName();
    defaultZkhost=core.getCoreDescriptor().getCoreContainer().getZkController().getZkServerAddress();
    streamFactory.withCollectionZkHost(defaultCollection,defaultZkhost);
    streamFactory.withDefaultZkHost(defaultZkhost);
    modelCache=new ModelCache(250,defaultZkhost,clientCache);
  }
  streamFactory.withFunctionName("search",CloudSolrStream.class).withFunctionName("facet",FacetStream.class).withFunctionName("update",UpdateStream.class).withFunctionName("jdbc",JDBCStream.class).withFunctionName("topic",TopicStream.class).withFunctionName("commit",CommitStream.class).withFunctionName("merge",MergeStream.class).withFunctionName("unique",UniqueStream.class).withFunctionName("top",RankStream.class).withFunctionName("group",GroupOperation.class).withFunctionName("reduce",ReducerStream.class).withFunctionName("parallel",ParallelStream.class).withFunctionName("rollup",RollupStream.class).withFunctionName("stats",StatsStream.class).withFunctionName("innerJoin",InnerJoinStream.class).withFunctionName("leftOuterJoin",LeftOuterJoinStream.class).withFunctionName("hashJoin",HashJoinStream.class).withFunctionName("outerHashJoin",OuterHashJoinStream.class).withFunctionName("intersect",IntersectStream.class).withFunctionName("complement",ComplementStream.class).withFunctionName("sort",SortStream.class).withFunctionName("train",TextLogitStream.class).withFunctionName("features",FeaturesSelectionStream.class).withFunctionName("daemon",DaemonStream.class).withFunctionName("shortestPath",ShortestPathStream.class).withFunctionName("gatherNodes",GatherNodesStream.class).withFunctionName("select",SelectStream.class).withFunctionName("scoreNodes",ScoreNodesStream.class).withFunctionName("model",ModelStream.class).withFunctionName("classify",ClassifyStream.class).withFunctionName("fetch",FetchStream.class).withFunctionName("min",MinMetric.class).withFunctionName("max",MaxMetric.class).withFunctionName("avg",MeanMetric.class).withFunctionName("sum",SumMetric.class).withFunctionName("count",CountMetric.class).withFunctionName("replace",ReplaceOperation.class).withFunctionName("concat",ConcatOperation.class).withFunctionName("group",GroupOperation.class).withFunctionName("distinct",DistinctOperation.class);
  List<PluginInfo> pluginInfos=core.getSolrConfig().getPluginInfos(Expressible.class.getName());
  for (  PluginInfo pluginInfo : pluginInfos) {
    Class<? extends Expressible> clazz=core.getResourceLoader().findClass(pluginInfo.className,Expressible.class);
    streamFactory.withFunctionName(pluginInfo.name,clazz);
  }
  core.addCloseHook(new CloseHook(){
    @Override public void preClose(    SolrCore core){
    }
    @Override public void postClose(    SolrCore core){
      clientCache.close();
    }
  }
);
}
