{
  final OpenBitSet bs=getBits();
  return new Filter(){
    @Override public DocIdSet getDocIdSet(    IndexReader reader) throws IOException {
      int offset=0;
      SolrIndexReader r=(SolrIndexReader)reader;
      while (r.getParent() != null) {
        offset+=r.getBase();
        r=r.getParent();
      }
      if (r == reader)       return bs;
      final int base=offset;
      final int maxDoc=reader.maxDoc();
      final int max=base + maxDoc;
      return new DocIdSet(){
        public DocIdSetIterator iterator() throws IOException {
          return new DocIdSetIterator(){
            int pos=base - 1;
            public int doc(){
              return pos - base;
            }
            public boolean next() throws IOException {
              pos=bs.nextSetBit(pos + 1);
              return pos >= 0 && pos < max;
            }
            public boolean skipTo(            int target) throws IOException {
              pos=bs.nextSetBit(target + base);
              return pos >= 0 && pos < max;
            }
          }
;
        }
      }
;
    }
  }
;
}
