{
  Directory dir=LuceneTestCase.newDirectory();
  Directory cdir=reduce(dir);
  cdir=reduce(cdir);
  cdir=reduce(cdir);
  if (cdir instanceof MockDirectoryWrapper) {
    MockDirectoryWrapper mockDirWrapper=(MockDirectoryWrapper)cdir;
    mockDirWrapper.setAssertNoUnrefencedFilesOnClose(false);
    mockDirWrapper.setCheckIndexOnClose(false);
    mockDirWrapper.setPreventDoubleWrite(false);
    if (allowReadingFilesStillOpenForWrite) {
      mockDirWrapper.setAllowReadingFilesStillOpenForWrite(true);
    }
  }
  return dir;
}
