{
  List<MBeanServer> servers=MBeanServerFactory.findMBeanServer(null);
  log.info("Servers in testJmxUpdate: " + servers);
  log.info(h.getCore().getInfoRegistry().toString());
  SolrInfoMBean bean=null;
  for (int i=0; i < 100; i++) {
    bean=h.getCore().getInfoRegistry().get("searcher");
    if (bean != null)     break;
    Thread.sleep(250);
  }
  if (bean == null)   throw new RuntimeException("searcher was never registered");
  ObjectName searcher=getObjectName("searcher",bean);
  MBeanServer mbeanServer=servers.get(0);
  log.info("Mbeans in server: " + mbeanServer.queryNames(null,null));
  assertFalse("No mbean found for SolrIndexSearcher",mbeanServer.queryMBeans(searcher,null).isEmpty());
  int oldNumDocs=Integer.valueOf((String)mbeanServer.getAttribute(searcher,"numDocs"));
  assertU(adoc("id","1"));
  assertU("commit",commit());
  int numDocs=Integer.valueOf((String)mbeanServer.getAttribute(searcher,"numDocs"));
  assertTrue("New numDocs is same as old numDocs as reported by JMX",numDocs > oldNumDocs);
}
