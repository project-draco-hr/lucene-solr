{
  final String resourceNameToBeUsed=IndexSchemaFactory.getResourceNameToBeUsed(cd.getSchemaName(),solrConfig);
  File schemaFile=new File(resourceNameToBeUsed);
  if (!schemaFile.isAbsolute()) {
    schemaFile=new File(solrConfig.getResourceLoader().getConfigDir(),schemaFile.getPath());
  }
  if (schemaFile.exists()) {
    try {
      return schemaCache.get(cacheName(schemaFile),new Callable<IndexSchema>(){
        @Override public IndexSchema call() throws Exception {
          logger.info("Creating new index schema for core {}",cd.getName());
          return IndexSchemaFactory.buildIndexSchema(cd.getSchemaName(),solrConfig);
        }
      }
);
    }
 catch (    ExecutionException e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Error creating index schema for core " + cd.getName(),e);
    }
  }
  return IndexSchemaFactory.buildIndexSchema(cd.getSchemaName(),solrConfig);
}
