{
  final Sort indexSort=segmentInfo.getIndexSort();
  int numReaders=originalReaders.size();
  leafDocMaps=new DocMap[numReaders];
  List<CodecReader> readers=maybeSortReaders(originalReaders,segmentInfo);
  maxDocs=new int[numReaders];
  fieldsProducers=new FieldsProducer[numReaders];
  normsProducers=new NormsProducer[numReaders];
  storedFieldsReaders=new StoredFieldsReader[numReaders];
  termVectorsReaders=new TermVectorsReader[numReaders];
  docValuesProducers=new DocValuesProducer[numReaders];
  pointsReaders=new PointsReader[numReaders];
  fieldInfos=new FieldInfos[numReaders];
  liveDocs=new Bits[numReaders];
  int numDocs=0;
  for (int i=0; i < numReaders; i++) {
    final CodecReader reader=readers.get(i);
    maxDocs[i]=reader.maxDoc();
    liveDocs[i]=reader.getLiveDocs();
    fieldInfos[i]=reader.getFieldInfos();
    normsProducers[i]=reader.getNormsReader();
    if (normsProducers[i] != null) {
      normsProducers[i]=normsProducers[i].getMergeInstance();
    }
    docValuesProducers[i]=reader.getDocValuesReader();
    if (docValuesProducers[i] != null) {
      docValuesProducers[i]=docValuesProducers[i].getMergeInstance();
    }
    storedFieldsReaders[i]=reader.getFieldsReader();
    if (storedFieldsReaders[i] != null) {
      storedFieldsReaders[i]=storedFieldsReaders[i].getMergeInstance();
    }
    termVectorsReaders[i]=reader.getTermVectorsReader();
    if (termVectorsReaders[i] != null) {
      termVectorsReaders[i]=termVectorsReaders[i].getMergeInstance();
    }
    fieldsProducers[i]=reader.getPostingsReader().getMergeInstance();
    pointsReaders[i]=reader.getPointsReader();
    if (pointsReaders[i] != null) {
      pointsReaders[i]=pointsReaders[i].getMergeInstance();
    }
    numDocs+=reader.numDocs();
  }
  segmentInfo.setMaxDoc(numDocs);
  this.segmentInfo=segmentInfo;
  this.infoStream=infoStream;
  this.docMaps=buildDocMaps(readers,indexSort);
}
