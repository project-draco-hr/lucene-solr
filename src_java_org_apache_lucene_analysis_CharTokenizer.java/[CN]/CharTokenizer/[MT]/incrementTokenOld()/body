{
  int length=0;
  int start=bufferIndex;
  char[] buffer=termAtt.termBuffer();
  final char[] oldIoBuffer=ioBuffer.getBuffer();
  while (true) {
    if (bufferIndex >= dataLen) {
      offset+=dataLen;
      dataLen=input.read(oldIoBuffer);
      if (dataLen == -1) {
        dataLen=0;
        if (length > 0)         break;
 else         return false;
      }
      bufferIndex=0;
    }
    final char c=oldIoBuffer[bufferIndex++];
    if (isTokenChar(c)) {
      if (length == 0)       start=offset + bufferIndex - 1;
 else       if (length == buffer.length)       buffer=termAtt.resizeTermBuffer(1 + length);
      buffer[length++]=normalize(c);
      if (length == MAX_WORD_LEN)       break;
    }
 else     if (length > 0)     break;
  }
  termAtt.setTermLength(length);
  offsetAtt.setOffset(correctOffset(start),correctOffset(start + length));
  return true;
}
