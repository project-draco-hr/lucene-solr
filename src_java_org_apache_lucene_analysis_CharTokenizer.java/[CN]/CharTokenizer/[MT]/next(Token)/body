{
  token.clear();
  int length=0;
  int start=bufferIndex;
  char[] buffer=token.termBuffer();
  while (true) {
    if (bufferIndex >= dataLen) {
      offset+=dataLen;
      dataLen=input.read(ioBuffer);
      if (dataLen == -1) {
        if (length > 0)         break;
 else         return null;
      }
      bufferIndex=0;
    }
    final char c=ioBuffer[bufferIndex++];
    if (isTokenChar(c)) {
      if (length == 0)       start=offset + bufferIndex - 1;
 else       if (length == buffer.length)       buffer=token.resizeTermBuffer(1 + length);
      buffer[length++]=normalize(c);
      if (length == MAX_WORD_LEN)       break;
    }
 else     if (length > 0)     break;
  }
  token.termLength=length;
  token.startOffset=start;
  token.endOffset=start + length;
  return token;
}
