{
  long timeoutAt=System.currentTimeMillis() + timeout;
  while (System.currentTimeMillis() < timeoutAt) {
    if (cloudState != null) {
      final ZkNodeProps nodeProps=cloudState.getLeader(collection,shard);
      if (nodeProps != null) {
        return nodeProps;
      }
    }
    Thread.sleep(50);
  }
  throw new RuntimeException("No registered leader was found, collection:" + collection + " slice:"+ shard);
}
