{
  long timeoutAt=System.nanoTime() + TimeUnit.NANOSECONDS.convert(timeout,TimeUnit.MILLISECONDS);
  while (true) {
    Replica leader=getLeader(collection,shard);
    if (leader != null)     return leader;
    if (System.nanoTime() >= timeoutAt || closed)     break;
    Thread.sleep(GET_LEADER_RETRY_INTERVAL_MS);
  }
  throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"No registered leader was found after waiting for " + timeout + "ms "+ ", collection: "+ collection+ " slice: "+ shard);
}
