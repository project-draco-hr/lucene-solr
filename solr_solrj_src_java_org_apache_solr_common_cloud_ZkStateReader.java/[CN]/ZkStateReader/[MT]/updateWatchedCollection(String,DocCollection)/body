{
  if (newState == null) {
    LOG.debug("Removing cached collection state for [{}]",coll);
    watchedCollectionStates.remove(coll);
    return true;
  }
  boolean updated=false;
  while (true) {
    if (!collectionWatches.containsKey(coll)) {
      break;
    }
    DocCollection oldState=watchedCollectionStates.get(coll);
    if (oldState == null) {
      if (watchedCollectionStates.putIfAbsent(coll,newState) == null) {
        LOG.debug("Add data for [{}] ver [{}]",coll,newState.getZNodeVersion());
        updated=true;
        break;
      }
    }
 else {
      if (oldState.getZNodeVersion() >= newState.getZNodeVersion()) {
        updated=true;
        break;
      }
      if (watchedCollectionStates.replace(coll,oldState,newState)) {
        LOG.debug("Updating data for [{}] from [{}] to [{}]",coll,oldState.getZNodeVersion(),newState.getZNodeVersion());
        updated=true;
        break;
      }
    }
  }
  if (!collectionWatches.containsKey(coll)) {
    watchedCollectionStates.remove(coll);
    LOG.debug("Removing uninteresting collection [{}]",coll);
  }
  return updated;
}
