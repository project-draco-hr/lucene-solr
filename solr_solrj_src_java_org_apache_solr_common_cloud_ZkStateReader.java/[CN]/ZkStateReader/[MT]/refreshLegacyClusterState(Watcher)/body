{
  try {
    final Stat stat=new Stat();
    final byte[] data=zkClient.getData(CLUSTER_STATE,watcher,stat,true);
    final ClusterState loadedData=ClusterState.load(stat.getVersion(),data,emptySet(),CLUSTER_STATE);
synchronized (getUpdateLock()) {
      if (this.legacyClusterStateVersion >= stat.getVersion()) {
        return;
      }
      Set<String> liveNodes=this.liveNodes;
      for (      Map.Entry<String,CollectionWatch> watchEntry : this.collectionWatches.entrySet()) {
        String coll=watchEntry.getKey();
        CollectionWatch collWatch=watchEntry.getValue();
        ClusterState.CollectionRef ref=this.legacyCollectionStates.get(coll);
        if (ref == null)         continue;
        DocCollection oldState=ref.get();
        ClusterState.CollectionRef newRef=loadedData.getCollectionStates().get(coll);
        DocCollection newState=newRef == null ? null : newRef.get();
        if (!collWatch.stateWatchers.isEmpty() && !Objects.equals(oldState,newState)) {
          notifyStateWatchers(liveNodes,coll,newState);
        }
      }
      this.legacyCollectionStates=loadedData.getCollectionStates();
      this.legacyClusterStateVersion=stat.getVersion();
    }
  }
 catch (  KeeperException.NoNodeException e) {
synchronized (getUpdateLock()) {
      this.legacyCollectionStates=emptyMap();
      this.legacyClusterStateVersion=0;
    }
  }
}
