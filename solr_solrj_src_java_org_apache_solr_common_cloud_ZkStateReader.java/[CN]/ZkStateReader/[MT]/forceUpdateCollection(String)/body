{
synchronized (getUpdateLock()) {
    if (clusterState == null) {
      return;
    }
    ClusterState.CollectionRef ref=clusterState.getCollectionRef(collection);
    if (ref == null || legacyCollectionStates.containsKey(collection)) {
      refreshLegacyClusterState(null);
      if (!legacyCollectionStates.containsKey(collection)) {
        LazyCollectionRef tryLazyCollection=new LazyCollectionRef(collection);
        if (tryLazyCollection.get() != null) {
          lazyCollectionStates.putIfAbsent(collection,tryLazyCollection);
        }
      }
    }
 else     if (ref.isLazilyLoaded()) {
      if (ref.get() != null) {
        return;
      }
      refreshLegacyClusterState(null);
    }
 else     if (watchedCollectionStates.containsKey(collection)) {
      DocCollection newState=fetchCollectionState(collection,null);
      if (updateWatchedCollection(collection,newState)) {
        constructState(Collections.singletonMap(collection,newState));
      }
    }
  }
}
