{
  TermStatsQueue tiq=null;
  if (field != null) {
    InvertedFields fields=MultiFields.getFields(reader);
    if (fields == null) {
      throw new RuntimeException("field " + field + " not found");
    }
    Terms terms=fields.terms(field);
    if (terms != null) {
      TermsEnum termsEnum=terms.iterator(null);
      tiq=new TermStatsQueue(numTerms);
      fillQueue(termsEnum,tiq,field);
    }
  }
 else {
    InvertedFields fields=MultiFields.getFields(reader);
    if (fields == null) {
      throw new RuntimeException("no fields found for this index");
    }
    tiq=new TermStatsQueue(numTerms);
    FieldsEnum fieldsEnum=fields.iterator();
    while (true) {
      field=fieldsEnum.next();
      if (field != null) {
        Terms terms=fieldsEnum.terms();
        if (terms != null) {
          fillQueue(terms.iterator(null),tiq,field);
        }
      }
 else {
        break;
      }
    }
  }
  TermStats[] result=new TermStats[tiq.size()];
  int count=tiq.size() - 1;
  while (tiq.size() != 0) {
    result[count]=tiq.pop();
    count--;
  }
  return result;
}
