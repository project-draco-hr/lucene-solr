{
  DuplicateFilter df=new DuplicateFilter(KEY_FIELD);
  df.setProcessingMode(DuplicateFilter.PM_FAST_INVALIDATION);
  HashSet results=new HashSet();
  ScoreDoc[] hits=searcher.search(tq,df,1000).scoreDocs;
  assertTrue("Filtered searching should have found some matches",hits.length > 0);
  for (int i=0; i < hits.length; i++) {
    Document d=searcher.doc(hits[i].doc);
    String url=d.get(KEY_FIELD);
    assertFalse("No duplicate urls should be returned",results.contains(url));
    results.add(url);
  }
  assertEquals("Two urls found",2,results.size());
}
