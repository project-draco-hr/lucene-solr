{
  DuplicateFilter df=new DuplicateFilter(KEY_FIELD);
  df.setKeepMode(DuplicateFilter.KM_USE_LAST_OCCURRENCE);
  Hits h=searcher.search(tq,df);
  assertTrue("Filtered searching should have found some matches",h.length() > 0);
  for (int i=0; i < h.length(); i++) {
    Document d=h.doc(i);
    String url=d.get(KEY_FIELD);
    TermDocs td=reader.termDocs(new Term(KEY_FIELD,url));
    int lastDoc=0;
    while (td.next()) {
      lastDoc=td.doc();
    }
    assertEquals("Duplicate urls should return last doc",lastDoc,h.id((i)));
  }
}
