{
  assertTrue(testDoc != null);
  MutableFieldInfos fieldInfos=new MutableFieldInfos(new MutableFieldInfos.FieldNumberBiMap());
  for (  IndexableField field : testDoc) {
    fieldInfos.addOrUpdate(field.name(),field.fieldType());
  }
  assertTrue(fieldInfos.size() == DocHelper.all.size());
  IndexOutput output=dir.createOutput(filename,newIOContext(random()));
  assertTrue(output != null);
  FieldInfosWriter writer=Codec.getDefault().fieldInfosFormat().getFieldInfosWriter();
  writer.write(dir,filename,fieldInfos,IOContext.DEFAULT);
  output.close();
  return fieldInfos;
}
