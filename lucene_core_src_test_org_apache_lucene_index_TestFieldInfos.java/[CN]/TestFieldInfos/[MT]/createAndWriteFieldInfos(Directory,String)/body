{
  assertTrue(testDoc != null);
  MutableFieldInfos fieldInfos=new MutableFieldInfos(new MutableFieldInfos.FieldNumberBiMap());
  _TestUtil.add(testDoc,fieldInfos);
  assertTrue(fieldInfos.size() == DocHelper.all.size());
  IndexOutput output=dir.createOutput(filename,newIOContext(random()));
  assertTrue(output != null);
  FieldInfosWriter writer=Codec.getDefault().fieldInfosFormat().getFieldInfosWriter();
  writer.write(dir,filename,fieldInfos,IOContext.DEFAULT);
  output.close();
  return fieldInfos;
}
