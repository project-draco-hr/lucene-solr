{
  assertTrue(testDoc != null);
  FieldInfos.Builder builder=new FieldInfos.Builder();
  for (  IndexableField field : testDoc) {
    builder.addOrUpdate(field.name(),field.fieldType());
  }
  FieldInfos fieldInfos=builder.finish();
  assertTrue(fieldInfos.size() == DocHelper.all.size());
  IndexOutput output=dir.createOutput(filename,newIOContext(random()));
  assertTrue(output != null);
  FieldInfosWriter writer=Codec.getDefault().fieldInfosFormat().getFieldInfosWriter();
  writer.write(dir,filename,fieldInfos,IOContext.DEFAULT);
  output.close();
  return fieldInfos;
}
