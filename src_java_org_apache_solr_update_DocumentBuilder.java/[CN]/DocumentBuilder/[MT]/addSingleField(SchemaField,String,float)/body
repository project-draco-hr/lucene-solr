{
  Field field=sfield.createField(val,boost);
  if (field != null) {
    if (!sfield.multiValued()) {
      String oldValue=map.put(sfield.getName(),val);
      if (oldValue != null) {
        throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"ERROR: multiple values encountered for non multiValued field " + sfield.getName() + ": first='"+ oldValue+ "' second='"+ val+ "'");
      }
    }
    if (doc == null) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"must call startDoc() before adding fields!");
    }
    doc.add(field);
  }
}
