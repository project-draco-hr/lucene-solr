{
  if (sorted == null) {
    closeWriter();
    sorted=File.createTempFile("RefSorter-",".sorted",OfflineSorter.defaultTempDir());
    boolean success=false;
    try {
      sort.sort(input,sorted);
      success=true;
    }
  finally {
      if (success) {
        Files.delete(input.toPath());
      }
 else {
        IOUtils.deleteFilesIgnoringExceptions(input);
      }
    }
    input=null;
  }
  return new ByteSequenceIterator(new OfflineSorter.ByteSequencesReader(sorted));
}
