{
  try {
    if (upto > 0) {
      flushBlock(pending,out);
    }
  }
  finally {
    out.close();
  }
}
