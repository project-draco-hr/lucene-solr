{
  this.readerContext=context;
  groupIndex=DocValues.getSorted(context.reader(),groupField);
  for (int i=0; i < fields.length; i++) {
    sortsIndex[i]=DocValues.getSorted(context.reader(),fields[i].getField());
  }
  ordSet.clear();
  segmentGroupHeads=new GroupHead[groupIndex.getValueCount() + 1];
  for (  GroupHead collectedGroup : collectedGroups) {
    int groupOrd;
    if (collectedGroup.groupValue == null) {
      groupOrd=-1;
    }
 else {
      groupOrd=groupIndex.lookupTerm(collectedGroup.groupValue);
    }
    if (collectedGroup.groupValue == null || groupOrd >= 0) {
      ordSet.put(groupOrd);
      segmentGroupHeads[groupOrd + 1]=collectedGroup;
      for (int i=0; i < sortsIndex.length; i++) {
        int sortOrd;
        if (collectedGroup.sortOrds[i] == -1) {
          sortOrd=-1;
        }
 else {
          sortOrd=sortsIndex[i].lookupTerm(collectedGroup.sortValues[i].get());
        }
        collectedGroup.sortOrds[i]=sortOrd;
      }
    }
  }
}
