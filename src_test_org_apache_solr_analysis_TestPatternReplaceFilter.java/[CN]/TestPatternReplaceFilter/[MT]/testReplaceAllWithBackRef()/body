{
  String input="aabfooaabfooabfoob ab caaaaaaaaab";
  TokenStream ts=new PatternReplaceFilter(new WhitespaceTokenizer(new StringReader(input)),Pattern.compile("(a*)b"),"$1\\$",true);
  Token token=ts.next();
  assertEquals("aa$fooaa$fooa$foo$",new String(token.termBuffer(),0,token.termLength()));
  token=ts.next();
  assertEquals("a$",new String(token.termBuffer(),0,token.termLength()));
  token=ts.next();
  assertEquals("caaaaaaaaa$",new String(token.termBuffer(),0,token.termLength()));
  token=ts.next();
  assertNull(token);
}
