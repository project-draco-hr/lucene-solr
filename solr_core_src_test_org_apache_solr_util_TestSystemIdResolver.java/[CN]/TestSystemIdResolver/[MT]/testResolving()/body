{
  final Path testHome=SolrTestCaseJ4.getFile("solr/collection1").getParentFile().toPath();
  final ResourceLoader loader=new SolrResourceLoader(testHome.resolve("collection1"),this.getClass().getClassLoader());
  final SystemIdResolver resolver=new SystemIdResolver(loader);
  final String fileUri=new File(testHome + "/crazy-path-to-config.xml").toURI().toASCIIString();
  assertEquals("solrres:/test.xml",SystemIdResolver.createSystemIdFromResourceName("test.xml"));
  assertEquals("solrres://@/usr/local/etc/test.xml",SystemIdResolver.createSystemIdFromResourceName("/usr/local/etc/test.xml"));
  assertEquals("solrres://@/test.xml",SystemIdResolver.createSystemIdFromResourceName(File.separatorChar + "test.xml"));
  assertEquals("solrres:/test.xml",resolver.resolveRelativeURI("solrres:/base.xml","test.xml").toASCIIString());
  assertEquals("solrres://@/etc/test.xml",resolver.resolveRelativeURI("solrres://@/usr/local/etc/base.xml","../../../etc/test.xml").toASCIIString());
  assertEquals("solrres://@/a/test.xml",resolver.resolveRelativeURI("solrres:/base.xml","/a/test.xml").toASCIIString());
  assertEquals(fileUri,resolver.resolveRelativeURI("solrres:/base.xml",fileUri).toASCIIString());
  assertEquals("solrres:/base.xml",resolver.resolveRelativeURI(fileUri,"solrres:/base.xml").toASCIIString());
  assertEntityResolving(resolver,"solrres:/schema.xml","solrres:/solrconfig.xml","schema.xml");
  assertEntityResolving(resolver,"solrres:/org/apache/solr/util/TestSystemIdResolver.class","solrres:/org/apache/solr/util/RTimer.class","TestSystemIdResolver.class");
  assertEntityResolving(resolver,SystemIdResolver.createSystemIdFromResourceName(testHome + "/collection1/conf/schema.xml"),SystemIdResolver.createSystemIdFromResourceName(testHome + "/collection1/conf/solrconfig.xml"),"schema.xml");
  assertEntityResolving(resolver,SystemIdResolver.createSystemIdFromResourceName(testHome + "/crazy-path-to-schema.xml"),SystemIdResolver.createSystemIdFromResourceName(testHome + "/crazy-path-to-config.xml"),"crazy-path-to-schema.xml");
  assertNull(resolver.resolveEntity(null,null,"solrres:/solrconfig.xml",fileUri));
}
