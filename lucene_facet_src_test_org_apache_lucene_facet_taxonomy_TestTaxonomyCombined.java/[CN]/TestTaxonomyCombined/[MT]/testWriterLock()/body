{
  Directory indexDir=new RAMDirectory();
  TaxonomyWriter tw=new DirectoryTaxonomyWriter(indexDir);
  tw.addCategory(new CategoryPath("hi","there"));
  tw.commit();
  TaxonomyReader tr=new DirectoryTaxonomyReader(indexDir);
  assertEquals(2,tr.getOrdinal(new CategoryPath("hi","there")));
  try {
    assertNull(new DirectoryTaxonomyWriter(indexDir));
    fail("should have failed to write in locked directory");
  }
 catch (  LockObtainFailedException e) {
  }
  DirectoryTaxonomyWriter.unlock(indexDir);
  TaxonomyWriter tw2=new DirectoryTaxonomyWriter(indexDir);
  tw2.addCategory(new CategoryPath("hey"));
  tw2.close();
  TaxonomyReader newtr=TaxonomyReader.openIfChanged(tr);
  assertNotNull(newtr);
  tr.close();
  tr=newtr;
  assertEquals(3,tr.getOrdinal(new CategoryPath("hey")));
  tr.close();
  tw.close();
  indexDir.close();
}
