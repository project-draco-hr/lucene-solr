{
  Directory indexDir=newDirectory();
  TaxonomyWriter tw=new DirectoryTaxonomyWriter(indexDir);
  tw.commit();
  TaxonomyReader tr=new DirectoryTaxonomyReader(indexDir);
  assertEquals(1,tr.getSize());
  tw.addCategory(new CategoryPath("Author"));
  assertEquals(1,tr.getSize());
  assertNull(TaxonomyReader.openIfChanged(tr));
  assertEquals(1,tr.getSize());
  tw.commit();
  assertEquals(1,tr.getSize());
  TaxonomyReader newTaxoReader=TaxonomyReader.openIfChanged(tr);
  assertNotNull(newTaxoReader);
  tr.close();
  tr=newTaxoReader;
  int author=1;
  try {
    assertEquals(TaxonomyReader.ROOT_ORDINAL,tr.getParallelTaxonomyArrays().parents()[author]);
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    fail("After category addition, commit() and refresh(), getParent for " + author + " should NOT throw exception");
  }
  assertEquals(2,tr.getSize());
  tw.addCategory(new CategoryPath("Author","Richard Dawkins"));
  int dawkins=2;
  tw.commit();
  newTaxoReader=TaxonomyReader.openIfChanged(tr);
  assertNotNull(newTaxoReader);
  tr.close();
  tr=newTaxoReader;
  int[] parents=tr.getParallelTaxonomyArrays().parents();
  assertEquals(author,parents[dawkins]);
  assertEquals(TaxonomyReader.ROOT_ORDINAL,parents[author]);
  assertEquals(TaxonomyReader.INVALID_ORDINAL,parents[TaxonomyReader.ROOT_ORDINAL]);
  assertEquals(3,tr.getSize());
  tw.close();
  tr.close();
  indexDir.close();
}
