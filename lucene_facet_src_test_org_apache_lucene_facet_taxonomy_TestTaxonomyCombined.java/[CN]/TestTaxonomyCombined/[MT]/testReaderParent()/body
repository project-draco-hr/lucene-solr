{
  Directory indexDir=newDirectory();
  TaxonomyWriter tw=new DirectoryTaxonomyWriter(indexDir);
  fillTaxonomy(tw);
  tw.close();
  TaxonomyReader tr=new DirectoryTaxonomyReader(indexDir);
  int[] parents=tr.getParallelTaxonomyArrays().parents();
  assertEquals(TaxonomyReader.INVALID_ORDINAL,parents[0]);
  for (int ordinal=1; ordinal < tr.getSize(); ordinal++) {
    CategoryPath me=tr.getPath(ordinal);
    int parentOrdinal=parents[ordinal];
    CategoryPath parent=tr.getPath(parentOrdinal);
    if (parent == null) {
      fail("Parent of " + ordinal + " is "+ parentOrdinal+ ", but this is not a valid category.");
    }
    if (!me.subpath(me.length - 1).equals(parent)) {
      fail("Got parent " + parentOrdinal + " for ordinal "+ ordinal+ " but categories are "+ showcat(parent)+ " and "+ showcat(me)+ " respectively.");
    }
  }
  tr.close();
  indexDir.close();
}
