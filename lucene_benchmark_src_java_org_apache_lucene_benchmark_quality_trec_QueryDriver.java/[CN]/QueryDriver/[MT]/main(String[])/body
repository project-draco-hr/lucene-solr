{
  if (args.length < 4 || args.length > 5) {
    System.err.println("Usage: QueryDriver <topicsFile> <qrelsFile> <submissionFile> <indexDir> [querySpec]");
    System.err.println("topicsFile: input file containing queries");
    System.err.println("qrelsFile: input file containing relevance judgements");
    System.err.println("submissionFile: output submission file for trec_eval");
    System.err.println("indexDir: index directory");
    System.err.println("querySpec: string composed of fields to use in query consisting of T=title,D=description,N=narrative:");
    System.err.println("\texample: TD (query on Title + Description). The default is T (title only)");
    System.exit(1);
  }
  File topicsFile=new File(args[0]);
  File qrelsFile=new File(args[1]);
  SubmissionReport submitLog=new SubmissionReport(new PrintWriter(args[2],"UTF-8"),"lucene");
  FSDirectory dir=FSDirectory.open(new File(args[3]));
  String fieldSpec=args.length == 5 ? args[4] : "T";
  IndexReader reader=DirectoryReader.open(dir);
  IndexSearcher searcher=new IndexSearcher(reader);
  int maxResults=1000;
  String docNameField="docname";
  PrintWriter logger=new PrintWriter(new OutputStreamWriter(System.out,Charset.defaultCharset()),true);
  TrecTopicsReader qReader=new TrecTopicsReader();
  QualityQuery qqs[]=qReader.readQueries(new BufferedReader(IOUtils.getDecodingReader(topicsFile,IOUtils.CHARSET_UTF_8)));
  Judge judge=new TrecJudge(new BufferedReader(IOUtils.getDecodingReader(qrelsFile,IOUtils.CHARSET_UTF_8)));
  judge.validateData(qqs,logger);
  Set<String> fieldSet=new HashSet<>();
  if (fieldSpec.indexOf('T') >= 0)   fieldSet.add("title");
  if (fieldSpec.indexOf('D') >= 0)   fieldSet.add("description");
  if (fieldSpec.indexOf('N') >= 0)   fieldSet.add("narrative");
  QualityQueryParser qqParser=new SimpleQQParser(fieldSet.toArray(new String[0]),"body");
  QualityBenchmark qrun=new QualityBenchmark(qqs,qqParser,searcher,docNameField);
  qrun.setMaxResults(maxResults);
  QualityStats stats[]=qrun.execute(judge,submitLog,logger);
  QualityStats avg=QualityStats.average(stats);
  avg.log("SUMMARY",2,logger,"  ");
  reader.close();
  dir.close();
}
