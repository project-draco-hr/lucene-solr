{
  if (rb.doHighlights && rb.stage == ResponseBuilder.STAGE_GET_FIELDS) {
    NamedList hlResult=new SimpleOrderedMap();
    Object[] arr=new Object[rb.resultIds.size() * 2];
    for (    ShardRequest sreq : rb.finished) {
      if ((sreq.purpose & ShardRequest.PURPOSE_GET_HIGHLIGHTS) == 0)       continue;
      for (      ShardResponse srsp : sreq.responses) {
        NamedList hl=(NamedList)srsp.rsp.getResponse().get("highlighting");
        for (int i=0; i < hl.size(); i++) {
          String id=hl.getName(i);
          ShardDoc sdoc=rb.resultIds.get(id);
          int idx=sdoc.positionInResponse;
          arr[idx << 1]=id;
          arr[(idx << 1) + 1]=hl.getVal(i);
        }
      }
    }
    rb.rsp.add("highlighting",removeNulls(new NamedList(Arrays.asList(arr))));
  }
}
