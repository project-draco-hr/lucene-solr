{
synchronized (bufferedDeletesStream) {
    if (infoStream != null) {
      message("publishFlushedSegment");
    }
    if (globalPacket != null && globalPacket.any()) {
      bufferedDeletesStream.push(globalPacket);
    }
    final long nextGen;
    if (packet != null && packet.any()) {
      nextGen=bufferedDeletesStream.push(packet);
    }
 else {
      nextGen=bufferedDeletesStream.getNextGen();
    }
    if (infoStream != null) {
      message("publish sets newSegment delGen=" + nextGen);
    }
    newSegment.setBufferedDeletesGen(nextGen);
    segmentInfos.add(newSegment);
    checkpoint();
  }
}
