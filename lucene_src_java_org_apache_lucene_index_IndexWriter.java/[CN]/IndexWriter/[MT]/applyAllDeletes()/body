{
  flushDeletesCount.incrementAndGet();
  final BufferedDeletesStream.ApplyDeletesResult result;
  result=bufferedDeletesStream.applyDeletes(readerPool,segmentInfos.asList());
  if (result.anyDeletes) {
    checkpoint();
  }
  if (!keepFullyDeletedSegments && result.allDeleted != null) {
    if (infoStream != null) {
      infoStream.message("IW","drop 100% deleted segments: " + segString(result.allDeleted));
    }
    for (    SegmentInfo info : result.allDeleted) {
      if (!mergingSegments.contains(info)) {
        segmentInfos.remove(info);
        if (readerPool != null) {
          readerPool.drop(info);
        }
      }
    }
    checkpoint();
  }
  bufferedDeletesStream.prune(segmentInfos);
}
