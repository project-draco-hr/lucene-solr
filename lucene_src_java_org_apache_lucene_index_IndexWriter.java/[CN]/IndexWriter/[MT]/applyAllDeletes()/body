{
  flushDeletesCount.incrementAndGet();
  final BufferedDeletesStream.ApplyDeletesResult result=bufferedDeletesStream.applyDeletes(readerPool,segmentInfos);
  if (result.anyDeletes) {
    checkpoint();
  }
  if (!keepFullyDeletedSegments && result.allDeleted != null) {
    if (infoStream != null) {
      message("drop 100% deleted segments: " + result.allDeleted);
    }
    for (    SegmentInfo info : result.allDeleted) {
      if (!mergingSegments.contains(info)) {
        segmentInfos.remove(info);
        if (readerPool != null) {
          readerPool.drop(info);
        }
      }
    }
    checkpoint();
  }
  bufferedDeletesStream.prune(segmentInfos);
}
