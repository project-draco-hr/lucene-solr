{
synchronized (bufferedDeletesStream) {
    final long nextGen;
    if (packet != null && packet.any()) {
      nextGen=bufferedDeletesStream.push(packet);
    }
 else {
      nextGen=bufferedDeletesStream.getNextGen();
    }
    newSegment.setBufferedDeletesGen(nextGen);
    segmentInfos.add(newSegment);
    checkpoint();
  }
}
