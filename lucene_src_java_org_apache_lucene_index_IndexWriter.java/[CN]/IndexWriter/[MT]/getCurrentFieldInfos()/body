{
  final FieldInfos fieldInfos;
  if (segmentInfos.size() > 0) {
    SegmentInfo info=segmentInfos.info(segmentInfos.size() - 1);
    Directory cfsDir;
    if (info.getUseCompoundFile()) {
      cfsDir=new CompoundFileReader(directory,IndexFileNames.segmentFileName(info.name,"",IndexFileNames.COMPOUND_FILE_EXTENSION));
    }
 else {
      cfsDir=directory;
    }
    fieldInfos=new FieldInfos(cfsDir,IndexFileNames.segmentFileName(info.name,"",IndexFileNames.FIELD_INFOS_EXTENSION));
    if (info.getUseCompoundFile()) {
      cfsDir.close();
    }
  }
 else {
    fieldInfos=new FieldInfos();
  }
  return fieldInfos;
}
