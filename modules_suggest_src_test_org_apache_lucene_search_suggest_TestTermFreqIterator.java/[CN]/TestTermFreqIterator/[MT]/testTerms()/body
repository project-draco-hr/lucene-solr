{
  int num=atLeast(10000);
  TreeMap<BytesRef,Float> sorted=new TreeMap<BytesRef,Float>();
  TermFreq[] unsorted=new TermFreq[num];
  for (int i=0; i < num; i++) {
    BytesRef key;
    do {
      key=new BytesRef(_TestUtil.randomUnicodeString(random));
    }
 while (sorted.containsKey(key));
    float value=random.nextFloat();
    sorted.put(key,value);
    unsorted[i]=new TermFreq(key,value);
  }
  TermFreqIterator wrapper=new SortedTermFreqIteratorWrapper(new TermFreqArrayIterator(unsorted),BytesRef.getUTF8SortedAsUnicodeComparator());
  Iterator<Map.Entry<BytesRef,Float>> expected=sorted.entrySet().iterator();
  while (expected.hasNext()) {
    Map.Entry<BytesRef,Float> entry=expected.next();
    assertEquals(entry.getKey(),wrapper.next());
    assertEquals(entry.getValue().floatValue(),wrapper.freq(),0F);
  }
  assertNull(wrapper.next());
  wrapper=new UnsortedTermFreqIteratorWrapper(new TermFreqArrayIterator(unsorted));
  TreeMap<BytesRef,Float> actual=new TreeMap<BytesRef,Float>();
  BytesRef key;
  while ((key=wrapper.next()) != null) {
    float value=wrapper.freq();
    actual.put(BytesRef.deepCopyOf(key),value);
  }
  assertEquals(sorted,actual);
}
