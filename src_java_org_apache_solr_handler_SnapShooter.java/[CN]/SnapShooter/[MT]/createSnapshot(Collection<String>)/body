{
  File lockFile=null;
  File snapShotDir=null;
  String directoryName=null;
  try {
    lockFile=new File(snapDir,directoryName + ".lock");
    if (lockFile.exists()) {
      return;
    }
    SimpleDateFormat fmt=new SimpleDateFormat(DATE_FMT);
    directoryName="snapshot." + fmt.format(new Date());
    snapShotDir=new File(snapDir,directoryName);
    lockFile.createNewFile();
    snapShotDir.mkdir();
    for (    String indexFile : files) {
      copyFile2Dir(new File(solrCore.getIndexDir(),indexFile),snapShotDir);
    }
  }
 catch (  Exception e) {
    SnapPuller.delTree(snapShotDir);
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,e);
  }
 finally {
    if (lockFile != null) {
      lockFile.delete();
    }
  }
}
