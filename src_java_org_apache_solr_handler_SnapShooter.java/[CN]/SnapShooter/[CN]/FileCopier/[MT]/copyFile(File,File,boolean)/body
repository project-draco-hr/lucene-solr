{
  if (!source.exists()) {
    String message="File " + source + " does not exist";
    throw new FileNotFoundException(message);
  }
  if (destination.getParentFile() != null && !destination.getParentFile().exists()) {
    destination.getParentFile().mkdirs();
  }
  if (destination.exists() && !destination.canWrite()) {
    String message="Unable to open file " + destination + " for writing.";
    throw new IOException(message);
  }
  FileInputStream input=null;
  FileOutputStream output=null;
  try {
    input=new FileInputStream(source);
    output=new FileOutputStream(destination);
    int count=0;
    int n=0;
    int rcnt=0;
    while (-1 != (n=input.read(buffer))) {
      output.write(buffer,0,n);
      count+=n;
      rcnt++;
    }
  }
  finally {
    try {
      IOUtils.closeQuietly(input);
    }
  finally {
      IOUtils.closeQuietly(output);
    }
  }
  if (source.length() != destination.length()) {
    String message="Failed to copy full contents from " + source + " to "+ destination;
    throw new IOException(message);
  }
  if (preserveFileDate) {
    destination.setLastModified(source.lastModified());
  }
}
