{
  SortedDocValues valuesIn=reader.getSortedDocValues(field);
  if (valuesIn != null) {
    return valuesIn;
  }
 else {
    final FieldInfo info=reader.getFieldInfos().fieldInfo(field);
    if (info != null && info.hasDocValues()) {
      throw new IllegalStateException("Type mismatch: " + field + " was indexed as "+ info.getDocValuesType());
    }
    if (info != null && !info.isIndexed()) {
      throw new IllegalArgumentException("Cannot get terms index for \"" + field + "\": it isn't indexed and doesn't have sorted doc values");
    }
    return (SortedDocValues)caches.get(SortedDocValues.class).get(reader,new CacheKey(field,acceptableOverheadRatio),false);
  }
}
