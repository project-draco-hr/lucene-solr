{
  int maxDoc=reader.maxDoc();
  final short[] values;
  NumericDocValues valuesIn=reader.getNumericDocValues(key.field);
  if (valuesIn != null) {
    values=new short[maxDoc];
    for (int docID=0; docID < maxDoc; docID++) {
      values[docID]=(short)valuesIn.get(docID);
    }
  }
 else {
    final ShortParser parser=(ShortParser)key.custom;
    if (parser == null) {
      return wrapper.getShorts(reader,key.field,DEFAULT_SHORT_PARSER,setDocsWithField);
    }
    values=new short[maxDoc];
    Uninvert u=new Uninvert(){
      private short currentValue;
      @Override public void visitTerm(      BytesRef term){
        currentValue=parser.parseShort(term);
      }
      @Override public void visitDoc(      int docID){
        values[docID]=currentValue;
      }
    }
;
    u.uninvert(reader,key.field,setDocsWithField);
    if (setDocsWithField) {
      wrapper.setDocsWithField(reader,key.field,u.docsWithField);
    }
  }
  return new ShortsFromArray(values);
}
