{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setRAMBufferSizeMB(0.1f).setMaxBufferedDocs(1000).setMergePolicy(NoMergePolicy.INSTANCE).setReaderPooling(false));
  int count=0;
  while (true) {
    Document doc=new Document();
    doc.add(new StringField("id",count + "",Field.Store.NO));
    final Term delTerm;
    if (count == 1010) {
      delTerm=new Term("id","" + 0);
    }
 else {
      delTerm=new Term("id","x" + count);
    }
    w.updateDocument(delTerm,doc);
    if (slowFileExists(dir,"_0_1.del") || slowFileExists(dir,"_0_1.liv")) {
      if (VERBOSE) {
        System.out.println("TEST: deletes created @ count=" + count);
      }
      break;
    }
    count++;
    if (count > 100000) {
      fail("delete's were not applied");
    }
  }
  w.shutdown();
  dir.close();
}
