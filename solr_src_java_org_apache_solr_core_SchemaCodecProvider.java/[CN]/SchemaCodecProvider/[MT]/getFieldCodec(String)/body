{
synchronized (delegate) {
    if (!delegate.hasFieldCodec(name)) {
      final SchemaField fieldOrNull=schema.getFieldOrNull(name);
      if (fieldOrNull == null) {
        throw new IllegalArgumentException("no such field " + name);
      }
      String codecName=fieldOrNull.getType().getCodec();
      if (codecName == null) {
        codecName=delegate.getDefaultFieldCodec();
      }
      delegate.setFieldCodec(name,codecName);
      return codecName;
    }
    return delegate.getFieldCodec(name);
  }
}
