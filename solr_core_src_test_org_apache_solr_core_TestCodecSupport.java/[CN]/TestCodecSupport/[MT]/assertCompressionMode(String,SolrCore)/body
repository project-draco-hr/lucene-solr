{
  RefCounted<SolrIndexSearcher> ref=null;
  SolrIndexSearcher searcher=null;
  try {
    ref=core.getSearcher();
    searcher=ref.get();
    SegmentInfos infos=SegmentInfos.readLatestCommit(searcher.getIndexReader().directory());
    SegmentInfo info=infos.info(infos.size() - 1).info;
    assertEquals("Expecting compression mode string to be " + expectedModeString + " but got: "+ info.getAttribute(Lucene50StoredFieldsFormat.MODE_KEY)+ "\n SegmentInfo: "+ info+ "\n SegmentInfos: "+ infos+ "\n Codec: "+ core.getCodec(),expectedModeString,info.getAttribute(Lucene50StoredFieldsFormat.MODE_KEY));
  }
  finally {
    if (ref != null)     ref.decref();
  }
}
