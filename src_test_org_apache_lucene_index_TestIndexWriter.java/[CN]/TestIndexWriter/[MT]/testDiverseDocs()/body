{
  RAMDirectory dir=new RAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setRAMBufferSizeMB(0.5);
  Random rand=newRandom();
  for (int i=0; i < 3; i++) {
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      for (int k=0; k < 100; k++) {
        doc.add(new Field("field",Integer.toString(rand.nextInt()),Field.Store.YES,Field.Index.ANALYZED));
      }
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      doc.add(new Field("field","aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa",Field.Store.YES,Field.Index.ANALYZED));
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      StringBuffer b=new StringBuffer();
      String x=Integer.toString(j) + ".";
      for (int k=0; k < 1000; k++)       b.append(x);
      String longTerm=b.toString();
      Document doc=new Document();
      doc.add(new Field("field",longTerm,Field.Store.YES,Field.Index.ANALYZED));
      writer.addDocument(doc);
    }
  }
  writer.close();
  IndexSearcher searcher=new IndexSearcher(dir);
  ScoreDoc[] hits=searcher.search(new TermQuery(new Term("field","aaa")),null,1000).scoreDocs;
  assertEquals(300,hits.length);
  searcher.close();
  dir.close();
}
