{
  char[] buffer=new char[20];
  char[] expected=new char[20];
  UnicodeUtil.UTF8Result utf8=new UnicodeUtil.UTF8Result();
  UnicodeUtil.UTF16Result utf16=new UnicodeUtil.UTF16Result();
  for (int iter=0; iter < 100000; iter++) {
    boolean hasIllegal=fillUnicode(buffer,expected,0,20);
    UnicodeUtil.UTF16toUTF8(buffer,0,20,utf8);
    if (!hasIllegal) {
      byte[] b=new String(buffer,0,20).getBytes("UTF-8");
      assertEquals(b.length,utf8.length);
      for (int i=0; i < b.length; i++)       assertEquals(b[i],utf8.result[i]);
    }
    UnicodeUtil.UTF8toUTF16(utf8.result,0,utf8.length,utf16);
    assertEquals(utf16.length,20);
    for (int i=0; i < 20; i++)     assertEquals(expected[i],utf16.result[i]);
  }
}
