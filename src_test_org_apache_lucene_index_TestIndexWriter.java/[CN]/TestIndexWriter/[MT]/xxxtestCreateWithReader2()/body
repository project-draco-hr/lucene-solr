{
  String tempDir=System.getProperty("java.io.tmpdir");
  if (tempDir == null)   throw new IOException("java.io.tmpdir undefined, cannot run test");
  File indexDir=new File(tempDir,"lucenetestindexwriter");
  try {
    IndexWriter writer=new IndexWriter(indexDir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    addDoc(writer);
    writer.close();
    IndexReader reader=IndexReader.open(indexDir);
    assertEquals("should be one document",reader.numDocs(),1);
    writer=new IndexWriter(indexDir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    assertEquals("should be zero documents",writer.docCount(),0);
    addDoc(writer);
    writer.close();
    assertEquals("should be one document",reader.numDocs(),1);
    IndexReader reader2=IndexReader.open(indexDir);
    assertEquals("should be one document",reader2.numDocs(),1);
    reader.close();
    reader2.close();
  }
  finally {
    rmDir(indexDir);
  }
}
