{
  Directory dir=new RAMDirectory();
  IndexWriter writer=null;
  writer=new IndexWriter(dir,new WhitespaceAnalyzer(TEST_VERSION_CURRENT),true,IndexWriter.MaxFieldLength.LIMITED);
  for (int i=0; i < 100; i++) {
    addDoc(writer);
  }
  writer.close();
  long gen=SegmentInfos.getCurrentSegmentGeneration(dir);
  assertTrue("segment generation should be > 1 but got " + gen,gen > 1);
  String fileNameIn=SegmentInfos.getCurrentSegmentFileName(dir);
  String fileNameOut=IndexFileNames.fileNameFromGeneration(IndexFileNames.SEGMENTS,"",1 + gen);
  IndexInput in=dir.openInput(fileNameIn);
  IndexOutput out=dir.createOutput(fileNameOut);
  long length=in.length();
  for (int i=0; i < length - 1; i++) {
    out.writeByte(in.readByte());
  }
  in.close();
  out.close();
  dir.deleteFile(fileNameIn);
  IndexReader reader=null;
  try {
    reader=IndexReader.open(dir,true);
    fail("reader did not hit IOException on opening a corrupt index");
  }
 catch (  Exception e) {
  }
  if (reader != null) {
    reader.close();
  }
}
