{
  Directory dir=new MockRAMDirectory();
  IndexWriter writer=null;
  writer=new IndexWriter(dir,new WhitespaceAnalyzer(Version.LUCENE_CURRENT),true,IndexWriter.MaxFieldLength.LIMITED);
  for (int i=0; i < 100; i++) {
    addDoc(writer);
  }
  writer.close();
  long gen=SegmentInfos.getCurrentSegmentGeneration(dir);
  assertTrue("segment generation should be > 1 but got " + gen,gen > 1);
  final String segmentsFileName=SegmentInfos.getCurrentSegmentFileName(dir);
  IndexInput in=dir.openInput(segmentsFileName);
  IndexOutput out=dir.createOutput(IndexFileNames.fileNameFromGeneration(IndexFileNames.SEGMENTS,"",1 + gen));
  out.copyBytes(in,in.length() - 1);
  byte b=in.readByte();
  out.writeByte((byte)(1 + b));
  out.close();
  in.close();
  IndexReader reader=null;
  try {
    reader=IndexReader.open(dir,true);
  }
 catch (  IOException e) {
    e.printStackTrace(System.out);
    fail("segmentInfos failed to retry fallback to correct segments_N file");
  }
  reader.close();
}
