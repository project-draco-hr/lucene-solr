{
  File indexDir=_TestUtil.getTempDir("lucenetestindexwriter");
  try {
    Directory dir=FSDirectory.open(indexDir);
    IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(Version.LUCENE_CURRENT),true,IndexWriter.MaxFieldLength.LIMITED);
    addDoc(writer);
    writer.close();
    IndexReader reader=IndexReader.open(dir,true);
    assertEquals("should be one document",reader.numDocs(),1);
    writer=new IndexWriter(dir,new WhitespaceAnalyzer(Version.LUCENE_CURRENT),true,IndexWriter.MaxFieldLength.LIMITED);
    assertEquals("should be zero documents",writer.maxDoc(),0);
    addDoc(writer);
    writer.close();
    assertEquals("should be one document",reader.numDocs(),1);
    IndexReader reader2=IndexReader.open(dir,true);
    assertEquals("should be one document",reader2.numDocs(),1);
    reader.close();
    reader2.close();
  }
  finally {
    rmDir(indexDir);
  }
}
