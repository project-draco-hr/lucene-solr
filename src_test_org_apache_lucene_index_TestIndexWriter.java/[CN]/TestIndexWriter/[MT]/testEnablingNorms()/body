{
  RAMDirectory dir=new RAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMaxBufferedDocs(10);
  for (int j=0; j < 10; j++) {
    Document doc=new Document();
    Field f=new Field("field","aaa",Field.Store.YES,Field.Index.ANALYZED);
    if (j != 8) {
      f.setOmitNorms(true);
    }
    doc.add(f);
    writer.addDocument(doc);
  }
  writer.close();
  Term searchTerm=new Term("field","aaa");
  IndexSearcher searcher=new IndexSearcher(dir);
  ScoreDoc[] hits=searcher.search(new TermQuery(searchTerm),null,1000).scoreDocs;
  assertEquals(10,hits.length);
  searcher.close();
  writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMaxBufferedDocs(10);
  for (int j=0; j < 27; j++) {
    Document doc=new Document();
    Field f=new Field("field","aaa",Field.Store.YES,Field.Index.ANALYZED);
    if (j != 26) {
      f.setOmitNorms(true);
    }
    doc.add(f);
    writer.addDocument(doc);
  }
  writer.close();
  searcher=new IndexSearcher(dir);
  hits=searcher.search(new TermQuery(searchTerm),null,1000).scoreDocs;
  assertEquals(27,hits.length);
  searcher.close();
  IndexReader reader=IndexReader.open(dir);
  reader.close();
  dir.close();
}
