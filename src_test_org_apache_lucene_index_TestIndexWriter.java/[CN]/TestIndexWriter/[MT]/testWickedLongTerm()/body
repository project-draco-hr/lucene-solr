{
  RAMDirectory dir=new RAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new StandardAnalyzer(),true);
  char[] chars=new char[16383];
  Arrays.fill(chars,'x');
  Document doc=new Document();
  final String bigTerm=new String(chars);
  String contents="abc xyz x" + bigTerm;
  doc.add(new Field("content",contents,Field.Store.NO,Field.Index.TOKENIZED));
  try {
    writer.addDocument(doc);
    fail("did not hit expected exception");
  }
 catch (  IllegalArgumentException e) {
  }
  doc=new Document();
  doc.add(new Field("content","abc bbb ccc",Field.Store.NO,Field.Index.TOKENIZED));
  writer.addDocument(doc);
  writer.close();
  IndexReader reader=IndexReader.open(dir);
  assertEquals(2,reader.docFreq(new Term("content","abc")));
  assertEquals(1,reader.docFreq(new Term("content","bbb")));
  reader.close();
  doc=new Document();
  doc.add(new Field("content",bigTerm,Field.Store.NO,Field.Index.TOKENIZED));
  writer=new IndexWriter(dir,new StandardAnalyzer());
  writer.addDocument(doc);
  writer.close();
  reader=IndexReader.open(dir);
  assertEquals(1,reader.docFreq(new Term("content",bigTerm)));
  reader.close();
  dir.close();
}
