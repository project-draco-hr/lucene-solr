{
  MockRAMDirectory dir=new MockRAMDirectory();
  int delID=0;
  for (int i=0; i < 20; i++) {
    IndexWriter writer=new IndexWriter(dir,false,new WhitespaceAnalyzer());
    writer.setMaxBufferedDocs(2);
    writer.setMergeFactor(2);
    writer.setUseCompoundFile(false);
    Document doc=new Document();
    String contents="aa bb cc dd ee ff gg hh ii jj kk";
    if (i == 7) {
      doc.add(new Field("content3","",Field.Store.NO,Field.Index.TOKENIZED));
    }
 else {
      Field.Store storeVal;
      if (i % 2 == 0) {
        doc.add(new Field("content4",contents,Field.Store.YES,Field.Index.TOKENIZED));
        storeVal=Field.Store.YES;
      }
 else       storeVal=Field.Store.NO;
      doc.add(new Field("content1",contents,storeVal,Field.Index.TOKENIZED));
      doc.add(new Field("content3","",Field.Store.YES,Field.Index.TOKENIZED));
      doc.add(new Field("content5","",storeVal,Field.Index.TOKENIZED));
    }
    for (int j=0; j < 4; j++)     writer.addDocument(doc);
    writer.close();
    IndexReader reader=IndexReader.open(dir);
    reader.deleteDocument(delID++);
    reader.close();
    if (0 == i % 4) {
      writer=new IndexWriter(dir,false,new WhitespaceAnalyzer());
      writer.setUseCompoundFile(false);
      writer.optimize();
      writer.close();
    }
  }
}
