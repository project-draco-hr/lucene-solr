{
  Directory dir=new MockRAMDirectory();
  IndexWriter w=new IndexWriter(dir,new WhitespaceAnalyzer(),IndexWriter.MaxFieldLength.LIMITED);
  w.setMaxBufferedDocs(2);
  for (int j=0; j < 17; j++)   addDoc(w);
  w.close();
  assertEquals(null,IndexReader.getCommitUserData(dir));
  IndexReader r=IndexReader.open(dir);
  assertEquals(null,r.getCommitUserData());
  r.close();
  w=new IndexWriter(dir,new WhitespaceAnalyzer(),IndexWriter.MaxFieldLength.LIMITED);
  w.setMaxBufferedDocs(2);
  for (int j=0; j < 17; j++)   addDoc(w);
  w.commit("test1");
  w.close();
  assertEquals("test1",IndexReader.getCommitUserData(dir));
  r=IndexReader.open(dir);
  assertEquals("test1",r.getCommitUserData());
  r.close();
  w=new IndexWriter(dir,new WhitespaceAnalyzer(),IndexWriter.MaxFieldLength.LIMITED);
  w.optimize();
  w.close();
  assertEquals("test1",IndexReader.getCommitUserData(dir));
  dir.close();
}
