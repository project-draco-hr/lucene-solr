{
  SinkTokenizer tokens=new SinkTokenizer();
  Token t=new Token();
  t.setTermBuffer("a");
  t.setPositionIncrement(0);
  tokens.add(t);
  t.setTermBuffer("b");
  t.setPositionIncrement(1);
  tokens.add(t);
  t.setTermBuffer("c");
  tokens.add(t);
  MockRAMDirectory dir=new MockRAMDirectory();
  IndexWriter w=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.UNLIMITED);
  Document doc=new Document();
  doc.add(new Field("field",tokens));
  w.addDocument(doc);
  w.commit();
  IndexSearcher s=new IndexSearcher(dir);
  PhraseQuery pq=new PhraseQuery();
  pq.add(new Term("field","a"));
  pq.add(new Term("field","b"));
  pq.add(new Term("field","c"));
  ScoreDoc[] hits=s.search(pq,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  Query q=new SpanTermQuery(new Term("field","a"));
  hits=s.search(q,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  TermPositions tps=s.getIndexReader().termPositions(new Term("field","a"));
  assertTrue(tps.next());
  assertEquals(1,tps.freq());
  assertEquals(0,tps.nextPosition());
  w.close();
  assertTrue(_TestUtil.checkIndex(dir));
  s.close();
  dir.close();
}
