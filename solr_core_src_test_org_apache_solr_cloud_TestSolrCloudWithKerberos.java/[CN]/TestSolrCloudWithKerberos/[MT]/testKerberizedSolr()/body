{
  CollectionAdminRequest.Create create=new CollectionAdminRequest.Create();
  create.setCollectionName("testcollection");
  create.setConfigName("conf1");
  create.setNumShards(1);
  create.setReplicationFactor(1);
  create.process(cloudClient);
  waitForCollection(cloudClient.getZkStateReader(),"testcollection",1);
  CollectionAdminRequest.List list=new CollectionAdminRequest.List();
  CollectionAdminResponse response=list.process(cloudClient);
  assertTrue("Expected to see testcollection but it doesn't exist",((ArrayList)response.getResponse().get("collections")).contains("testcollection"));
  cloudClient.setDefaultCollection("testcollection");
  indexDoc(cloudClient,params("commit","true"),getDoc("id",1));
  QueryResponse queryResponse=cloudClient.query(new SolrQuery("*:*"));
  assertEquals("Expected #docs and actual isn't the same",1,queryResponse.getResults().size());
}
