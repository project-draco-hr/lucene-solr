{
  final String INPUT="G&uuml;nther G&uuml;nther is here";
  List<String> mappingRules=new ArrayList<>();
  mappingRules.add("\"&uuml;\" => \"??\"");
  NormalizeCharMap.Builder builder=new NormalizeCharMap.Builder();
  builder.add("&uuml;","??");
  NormalizeCharMap normMap=builder.build();
  CharFilter charStream=new MappingCharFilter(normMap,new StringReader(INPUT));
  Tokenizer stream=new PatternTokenizer(newAttributeFactory(),Pattern.compile("[,;/\\s]+"),-1);
  stream.setReader(charStream);
  assertTokenStreamContents(stream,new String[]{"G??nther","G??nther","is","here"},new int[]{0,13,26,29},new int[]{12,25,28,33},INPUT.length());
  charStream=new MappingCharFilter(normMap,new StringReader(INPUT));
  stream=new PatternTokenizer(newAttributeFactory(),Pattern.compile("G??nther"),0);
  stream.setReader(charStream);
  assertTokenStreamContents(stream,new String[]{"G??nther","G??nther"},new int[]{0,13},new int[]{12,25},INPUT.length());
}
