{
  Thread thread=new Thread(){
    @Override public void run(){
      MDCLoggingContext.setCore(core);
      try {
        try {
          zkController.register(core.getName(),core.getCoreDescriptor());
        }
 catch (        InterruptedException e) {
          Thread.currentThread().interrupt();
          SolrException.log(log,"",e);
        }
catch (        Exception e) {
          try {
            zkController.publish(core.getCoreDescriptor(),Replica.State.DOWN);
          }
 catch (          InterruptedException e1) {
            Thread.currentThread().interrupt();
            log.error("",e1);
          }
catch (          Exception e1) {
            log.error("",e1);
          }
          SolrException.log(log,"",e);
        }
      }
  finally {
        MDCLoggingContext.clear();
      }
    }
  }
;
  if (zkController != null) {
    if (background) {
      coreZkRegister.execute(thread);
    }
 else {
      MDCLoggingContext.setCore(core);
      try {
        thread.run();
      }
  finally {
        MDCLoggingContext.clear();
      }
    }
  }
}
