{
  Thread thread=new Thread(){
    @Override public void run(){
      try {
        zkController.register(core.getName(),core.getCoreDescriptor());
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        SolrException.log(log,"",e);
      }
catch (      Exception e) {
        try {
          zkController.publish(core.getCoreDescriptor(),Replica.State.DOWN);
        }
 catch (        InterruptedException e1) {
          Thread.currentThread().interrupt();
          log.error("",e1);
        }
catch (        Exception e1) {
          log.error("",e1);
        }
        SolrException.log(log,"",e);
      }
    }
  }
;
  if (zkController != null) {
    MDCUtils.setCore(core.getName());
    try {
      if (background) {
        coreZkRegister.execute(thread);
      }
 else {
        thread.run();
      }
    }
  finally {
      MDC.remove(CORE_NAME_PROP);
    }
  }
}
