{
  IndexWriter iw=new IndexWriter(indexDir,new IndexWriterConfig(ExampleUtils.EXAMPLE_VER,SimpleUtils.analyzer));
  TaxonomyWriter taxo=new DirectoryTaxonomyWriter(taxoDir,OpenMode.CREATE);
  AssociationsFacetFields assocFacetFields=new AssociationsFacetFields(taxo);
  int nDocsAdded=0;
  int nFacetsAdded=0;
  for (int docNum=0; docNum < SimpleUtils.docTexts.length; docNum++) {
    ExampleUtils.log(" ++++ DOC ID: " + docNum);
    CategoryAssociationsContainer associations=new CategoryAssociationsContainer();
    for (    CategoryPath path : SimpleUtils.categories[docNum]) {
      associations.setAssociation(path,null);
      ExampleUtils.log("\t ++++ PATH: " + path);
      ++nFacetsAdded;
    }
    CategoryPath[] associationsPaths=AssociationUtils.categories[docNum];
    CategoryAssociation[] associationsValues=AssociationUtils.associations[docNum];
    for (int i=0; i < associationsPaths.length; i++) {
      associations.setAssociation(associationsPaths[i],associationsValues[i]);
      ExampleUtils.log("\t $$$$ Association: (" + associationsPaths[i] + ","+ associationsValues[i]+ ")");
      ++nFacetsAdded;
    }
    Document doc=new Document();
    doc.add(new TextField(SimpleUtils.TITLE,SimpleUtils.docTitles[docNum],Field.Store.YES));
    doc.add(new TextField(SimpleUtils.TEXT,SimpleUtils.docTexts[docNum],Field.Store.NO));
    assocFacetFields.addFields(doc,associations);
    iw.addDocument(doc);
    nDocsAdded++;
  }
  taxo.commit();
  iw.commit();
  taxo.close();
  iw.close();
  ExampleUtils.log("Indexed " + nDocsAdded + " documents with overall "+ nFacetsAdded+ " facets.");
}
