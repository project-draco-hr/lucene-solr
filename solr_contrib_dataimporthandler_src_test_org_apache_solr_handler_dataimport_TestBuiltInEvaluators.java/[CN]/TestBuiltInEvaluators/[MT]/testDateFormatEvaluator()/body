{
  Evaluator dateFormatEval=new DateFormatEvaluator();
  ContextImpl context=new ContextImpl(null,resolver,null,Context.FULL_DUMP,Collections.<String,Object>emptyMap(),null,null);
  Calendar calendar=new GregorianCalendar();
  calendar.add(Calendar.DAY_OF_YEAR,-2);
  String currentLocale=Locale.getDefault().toString();
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.ROOT).format(calendar.getTime()),dateFormatEval.evaluate("'NOW-2DAYS','yyyy-MM-dd HH:mm'",context));
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.getDefault()).format(calendar.getTime()),dateFormatEval.evaluate("'NOW-2DAYS','yyyy-MM-dd HH:mm','" + currentLocale + "'",context));
  calendar=new GregorianCalendar();
  Date date=calendar.getTime();
  Map<String,Object> map=new HashMap<String,Object>();
  map.put("key",date);
  resolver.addNamespace("A",map);
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.ROOT).format(date),dateFormatEval.evaluate("A.key, 'yyyy-MM-dd HH:mm'",context));
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.getDefault()).format(date),dateFormatEval.evaluate("A.key, 'yyyy-MM-dd HH:mm','" + currentLocale + "'",context));
}
