{
  Evaluator dateFormatEval=new DateFormatEvaluator();
  ContextImpl context=new ContextImpl(null,resolver,null,Context.FULL_DUMP,Collections.<String,Object>emptyMap(),null,null);
  String currentLocale=Locale.getDefault().toString();
{
    Calendar calendar=new GregorianCalendar(TimeZone.getTimeZone("GMT"),Locale.ROOT);
    calendar.add(Calendar.DAY_OF_YEAR,-2);
    Date d=calendar.getTime();
{
      String sdf=new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.ROOT).format(d);
      String dfe=dateFormatEval.evaluate("'NOW-2DAYS','yyyy-MM-dd HH:mm'",context);
      assertEquals(sdf,dfe);
    }
{
      String sdf=new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.getDefault()).format(d);
      String dfe=dateFormatEval.evaluate("'NOW-2DAYS','yyyy-MM-dd HH:mm','" + currentLocale + "'",context);
      assertEquals(sdf,dfe);
    }
  }
  Date d=new Date();
  Map<String,Object> map=new HashMap<String,Object>();
  map.put("key",d);
  resolver.addNamespace("A",map);
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.ROOT).format(d),dateFormatEval.evaluate("A.key, 'yyyy-MM-dd HH:mm'",context));
  assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm",Locale.getDefault()).format(d),dateFormatEval.evaluate("A.key, 'yyyy-MM-dd HH:mm','" + currentLocale + "'",context));
}
