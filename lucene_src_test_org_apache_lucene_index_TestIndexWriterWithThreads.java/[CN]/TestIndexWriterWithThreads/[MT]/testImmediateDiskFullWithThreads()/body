{
  int NUM_THREADS=3;
  for (int iter=0; iter < 10; iter++) {
    if (VERBOSE) {
      System.out.println("\nTEST: iter=" + iter);
    }
    MockDirectoryWrapper dir=newDirectory();
    IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMaxBufferedDocs(2).setMergeScheduler(new ConcurrentMergeScheduler()).setMergePolicy(newLogMergePolicy(4)));
    ((ConcurrentMergeScheduler)writer.getConfig().getMergeScheduler()).setSuppressExceptions();
    dir.setMaxSizeInBytes(4 * 1024 + 20 * iter);
    writer.setInfoStream(VERBOSE ? System.out : null);
    IndexerThread[] threads=new IndexerThread[NUM_THREADS];
    for (int i=0; i < NUM_THREADS; i++)     threads[i]=new IndexerThread(writer,true);
    for (int i=0; i < NUM_THREADS; i++)     threads[i].start();
    for (int i=0; i < NUM_THREADS; i++) {
      threads[i].join();
      assertTrue("hit unexpected Throwable",threads[i].error == null);
    }
    dir.setMaxSizeInBytes(0);
    writer.close(false);
    dir.close();
  }
}
