{
  Directory dir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  doc.add(newStringField("foo","bar",Field.Store.NO));
  writer.addDocument(doc);
  DirectoryReader reader=writer.getReader();
  AtomicReader r=getOnlySegmentReader(reader);
  DocsEnum disi=_TestUtil.docs(random(),r,"foo",new BytesRef("bar"),null,null,0);
  int docid=disi.docID();
  assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
  assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
  TermsEnum te=r.terms("foo").iterator(null);
  assertTrue(te.seekExact(new BytesRef("bar"),true));
  disi=_TestUtil.docs(random(),te,null,disi,0);
  docid=disi.docID();
  assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
  assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
  writer.close();
  r.close();
  dir.close();
}
