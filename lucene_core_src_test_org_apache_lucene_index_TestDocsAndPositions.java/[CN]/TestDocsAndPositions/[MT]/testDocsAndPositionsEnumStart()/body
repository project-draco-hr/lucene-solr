{
  Directory dir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  doc.add(newTextField("foo","bar",Field.Store.NO));
  writer.addDocument(doc);
  DirectoryReader reader=writer.getReader();
  AtomicReader r=getOnlySegmentReader(reader);
  DocsAndPositionsEnum disi=r.termPositionsEnum(null,"foo",new BytesRef("bar"));
  int docid=disi.docID();
  assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
  assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
  TermsEnum te=r.terms("foo").iterator(null);
  assertTrue(te.seekExact(new BytesRef("bar"),true));
  disi=te.docsAndPositions(null,disi);
  docid=disi.docID();
  assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
  assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
  writer.close();
  r.close();
  dir.close();
}
