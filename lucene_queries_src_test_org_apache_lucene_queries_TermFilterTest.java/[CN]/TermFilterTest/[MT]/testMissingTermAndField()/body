{
  String fieldName="field1";
  Directory rd=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),rd);
  Document doc=new Document();
  doc.add(newStringField(fieldName,"value1",Field.Store.NO));
  w.addDocument(doc);
  IndexReader reader=SlowCompositeReaderWrapper.wrap(w.getReader());
  assertTrue(reader.getContext() instanceof AtomicReaderContext);
  AtomicReaderContext context=(AtomicReaderContext)reader.getContext();
  w.close();
  DocIdSet idSet=termFilter(fieldName,"value1").getDocIdSet(context,context.reader().getLiveDocs());
  assertNotNull("must not be null",idSet);
  DocIdSetIterator iter=idSet.iterator();
  assertEquals(iter.nextDoc(),0);
  assertEquals(iter.nextDoc(),DocIdSetIterator.NO_MORE_DOCS);
  idSet=termFilter(fieldName,"value2").getDocIdSet(context,context.reader().getLiveDocs());
  assertNull("must be null",idSet);
  idSet=termFilter("field2","value1").getDocIdSet(context,context.reader().getLiveDocs());
  assertNull("must be null",idSet);
  reader.close();
  rd.close();
}
