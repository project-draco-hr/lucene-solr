{
  buf.append('"');
  buf.append(_buckets[level].toString());
  buf.append('"');
  buf.append(":{");
  buf.append("\"type\":\"terms\"");
  buf.append(",\"field\":\"" + _buckets[level].toString() + "\"");
  buf.append(",\"limit\":" + _limit);
  buf.append(",\"sort\":{\"" + getFacetSort(_sorts[level].getLeftFieldName(),_metrics) + "\":\""+ _sorts[level].getOrder()+ "\"}");
  buf.append(",\"facet\":{");
  int metricCount=0;
  for (  Metric metric : _metrics) {
    String identifier=metric.getIdentifier();
    if (!identifier.startsWith("count(")) {
      if (metricCount > 0) {
        buf.append(",");
      }
      buf.append("\"facet_" + metricCount + "\":\""+ identifier+ "\"");
      ++metricCount;
    }
  }
  ++level;
  if (level < _buckets.length) {
    if (metricCount > 0) {
      buf.append(",");
    }
    appendJson(buf,_buckets,_metrics,_sorts,_limit,level);
  }
  buf.append("}}");
}
