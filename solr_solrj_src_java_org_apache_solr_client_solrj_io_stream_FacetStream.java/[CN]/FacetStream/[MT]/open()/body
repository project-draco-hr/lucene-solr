{
  if (cache != null) {
    cloudSolrClient=cache.getCloudSolrClient(zkHost);
  }
 else {
    cloudSolrClient=new Builder().withZkHost(zkHost).build();
  }
  FieldComparator[] adjustedSorts=adjustSorts(buckets,bucketSorts);
  String json=getJsonFacetString(buckets,metrics,adjustedSorts,bucketSizeLimit);
  ModifiableSolrParams params=getParams(this.props);
  params.add("json.facet",json);
  params.add("rows","0");
  QueryRequest request=new QueryRequest(params);
  try {
    NamedList response=cloudSolrClient.request(request,collection);
    getTuples(response,buckets,metrics);
    Collections.sort(tuples,getStreamSort());
  }
 catch (  Exception e) {
    throw new IOException(e);
  }
}
