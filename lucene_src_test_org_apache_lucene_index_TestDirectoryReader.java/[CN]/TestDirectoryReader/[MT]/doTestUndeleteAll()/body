{
  sis.read(dir);
  IndexReader reader=openReader();
  assertTrue(reader != null);
  assertEquals(2,reader.numDocs());
  reader.deleteDocument(0);
  assertEquals(1,reader.numDocs());
  reader.undeleteAll();
  assertEquals(2,reader.numDocs());
  reader.commit();
  reader.close();
  if (reader instanceof MultiReader)   sis.commit(dir,sis.codecFormat());
  sis.read(dir);
  reader=openReader();
  assertEquals(2,reader.numDocs());
  reader.deleteDocument(0);
  assertEquals(1,reader.numDocs());
  reader.commit();
  reader.close();
  if (reader instanceof MultiReader)   sis.commit(dir,sis.codecFormat());
  sis.read(dir);
  reader=openReader();
  assertEquals(1,reader.numDocs());
  reader.close();
}
