{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,newIndexWriterConfig(null));
  Document doc=new Document();
  Token t1=new Token("foo",0,3);
  if (random().nextBoolean()) {
    t1.setPayload(new BytesRef(new byte[]{0x1}));
  }
  Token t2=new Token("foo",4,7);
  t2.setPositionIncrement(IndexWriter.MAX_POSITION);
  if (random().nextBoolean()) {
    t2.setPayload(new BytesRef(new byte[]{0x1}));
  }
  doc.add(new TextField("foo",new CannedTokenStream(new Token[]{t1,t2})));
  iw.addDocument(doc);
  IndexReader r=DirectoryReader.open(iw,true);
  assertEquals(1,r.numDocs());
  PostingsEnum postings=MultiFields.getTermPositionsEnum(r,null,"foo",new BytesRef("foo"));
  assertEquals(0,postings.nextDoc());
  assertEquals(2,postings.freq());
  assertEquals(0,postings.nextPosition());
  assertEquals(IndexWriter.MAX_POSITION,postings.nextPosition());
  r.close();
  iw.close();
  dir.close();
}
