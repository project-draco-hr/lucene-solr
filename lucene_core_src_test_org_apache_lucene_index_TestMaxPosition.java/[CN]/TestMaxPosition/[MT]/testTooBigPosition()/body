{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,newIndexWriterConfig(null));
  Document doc=new Document();
  Token t1=new Token("foo",0,3);
  t1.setPositionIncrement(2);
  if (random().nextBoolean()) {
    t1.setPayload(new BytesRef(new byte[]{0x1}));
  }
  Token t2=new Token("foo",4,7);
  t2.setPositionIncrement(IndexWriter.MAX_POSITION);
  if (random().nextBoolean()) {
    t2.setPayload(new BytesRef(new byte[]{0x1}));
  }
  doc.add(new TextField("foo",new CannedTokenStream(new Token[]{t1,t2})));
  try {
    iw.addDocument(doc);
    fail("did not hit exception");
  }
 catch (  IllegalArgumentException iae) {
  }
  IndexReader r=DirectoryReader.open(iw);
  assertEquals(0,r.numDocs());
  r.close();
  iw.close();
  dir.close();
}
