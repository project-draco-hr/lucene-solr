{
  boolean doPersist=false;
  SolrParams params=req.getParams();
  SolrParams required=params.required();
  String cname=required.get(CoreAdminParams.CORE);
  SolrCore core=coreContainer.getCore(cname);
  SolrQueryRequest wrappedReq=null;
  if (core != null) {
    try {
      doPersist=coreContainer.isPersistent();
      String[] dirNames=required.getParams(CoreAdminParams.INDEX_DIR);
      DirectoryFactory dirFactory=core.getDirectoryFactory();
      Directory[] dirs=new Directory[dirNames.length];
      for (int i=0; i < dirNames.length; i++) {
        dirs[i]=dirFactory.open(dirNames[i]);
      }
      UpdateRequestProcessorChain processorChain=core.getUpdateProcessingChain(params.get(UpdateParams.UPDATE_PROCESSOR));
      wrappedReq=new LocalSolrQueryRequest(core,req.getParams());
      UpdateRequestProcessor processor=processorChain.createProcessor(wrappedReq,rsp);
      processor.processMergeIndexes(new MergeIndexesCommand(dirs));
    }
  finally {
      core.close();
      wrappedReq.close();
    }
  }
  return doPersist;
}
