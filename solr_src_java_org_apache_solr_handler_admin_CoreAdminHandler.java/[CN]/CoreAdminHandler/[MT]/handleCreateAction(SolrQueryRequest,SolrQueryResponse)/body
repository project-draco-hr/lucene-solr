{
  try {
    SolrParams params=req.getParams();
    String name=params.get(CoreAdminParams.NAME);
    String instanceDir=params.get(CoreAdminParams.INSTANCE_DIR);
    if (instanceDir == null) {
      instanceDir=name;
    }
    CoreDescriptor dcore=new CoreDescriptor(coreContainer,name,instanceDir);
    String opts=params.get(CoreAdminParams.CONFIG);
    if (opts != null)     dcore.setConfigName(opts);
    opts=params.get(CoreAdminParams.SCHEMA);
    if (opts != null)     dcore.setSchemaName(opts);
    opts=params.get(CoreAdminParams.DATA_DIR);
    if (opts != null)     dcore.setDataDir(opts);
    CloudDescriptor cd=dcore.getCloudDescriptor();
    if (cd != null) {
      cd.setParams(req.getParams());
      opts=params.get(CoreAdminParams.COLLECTION);
      if (opts != null)       cd.setCollectionName(opts);
      opts=params.get(CoreAdminParams.SHARD);
      if (opts != null)       cd.setShardId(opts);
    }
    dcore.setCoreProperties(null);
    SolrCore core=coreContainer.create(dcore);
    coreContainer.register(name,core,false);
    rsp.add("core",core.getName());
    return coreContainer.isPersistent();
  }
 catch (  Exception ex) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Error executing default implementation of CREATE",ex);
  }
}
