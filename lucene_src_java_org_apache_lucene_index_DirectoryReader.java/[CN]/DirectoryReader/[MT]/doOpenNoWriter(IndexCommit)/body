{
  if (commit == null) {
    if (isCurrent()) {
      return null;
    }
  }
 else {
    if (directory != commit.getDirectory()) {
      throw new IOException("the specified commit does not match the specified Directory");
    }
    if (segmentInfos != null && commit.getSegmentsFileName().equals(segmentInfos.getCurrentSegmentFileName())) {
      return null;
    }
  }
  return (IndexReader)new SegmentInfos.FindSegmentsFile(directory){
    @Override protected Object doBody(    String segmentFileName) throws CorruptIndexException, IOException {
      final SegmentInfos infos=new SegmentInfos();
      infos.read(directory,segmentFileName);
      return doOpenIfChanged(infos,null);
    }
  }
.run(commit);
}
