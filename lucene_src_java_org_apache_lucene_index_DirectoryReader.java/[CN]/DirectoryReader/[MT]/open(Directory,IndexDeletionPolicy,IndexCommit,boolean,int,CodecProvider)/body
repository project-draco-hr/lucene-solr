{
  final CodecProvider codecs2;
  if (codecs == null) {
    codecs2=CodecProvider.getDefault();
  }
 else {
    codecs2=codecs;
  }
  return (IndexReader)new SegmentInfos.FindSegmentsFile(directory){
    @Override protected Object doBody(    String segmentFileName) throws CorruptIndexException, IOException {
      SegmentInfos infos=new SegmentInfos();
      infos.read(directory,segmentFileName,codecs2);
      if (readOnly)       return new ReadOnlyDirectoryReader(directory,infos,deletionPolicy,termInfosIndexDivisor,codecs2);
 else       return new DirectoryReader(directory,infos,deletionPolicy,false,termInfosIndexDivisor,codecs2);
    }
  }
.run(commit);
}
