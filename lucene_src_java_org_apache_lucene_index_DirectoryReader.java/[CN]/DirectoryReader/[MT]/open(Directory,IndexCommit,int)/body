{
  return (IndexReader)new SegmentInfos.FindSegmentsFile(directory){
    @Override protected Object doBody(    String segmentFileName) throws CorruptIndexException, IOException {
      SegmentInfos sis=new SegmentInfos();
      sis.read(directory,segmentFileName);
      final SegmentReader[] readers=new SegmentReader[sis.size()];
      for (int i=sis.size() - 1; i >= 0; i--) {
        IOException prior=null;
        boolean success=false;
        try {
          readers[i]=new SegmentReader(sis.info(i),termInfosIndexDivisor,IOContext.READ);
          success=true;
        }
 catch (        IOException ex) {
          prior=ex;
        }
 finally {
          if (!success)           IOUtils.closeWhileHandlingException(prior,readers);
        }
      }
      return new DirectoryReader(readers,directory,null,sis,termInfosIndexDivisor,false);
    }
  }
.run(commit);
}
