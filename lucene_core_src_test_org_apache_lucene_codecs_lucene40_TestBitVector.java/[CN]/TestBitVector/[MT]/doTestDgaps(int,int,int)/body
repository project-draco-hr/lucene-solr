{
  MockDirectoryWrapper d=new MockDirectoryWrapper(random(),new RAMDirectory());
  d.setPreventDoubleWrite(false);
  BitVector bv=new BitVector(size);
  bv.invertAll();
  for (int i=0; i < count1; i++) {
    bv.clear(i);
    assertEquals(i + 1,size - bv.count());
  }
  bv.write(d,"TESTBV",newIOContext(random()));
  for (int i=count1; i < count2; i++) {
    BitVector bv2=new BitVector(d,"TESTBV",newIOContext(random()));
    assertTrue(doCompare(bv,bv2));
    bv=bv2;
    bv.clear(i);
    assertEquals(i + 1,size - bv.count());
    bv.write(d,"TESTBV",newIOContext(random()));
  }
  for (int i=count2 - 1; i >= count1; i--) {
    BitVector bv2=new BitVector(d,"TESTBV",newIOContext(random()));
    assertTrue(doCompare(bv,bv2));
    bv=bv2;
    bv.set(i);
    assertEquals(i,size - bv.count());
    bv.write(d,"TESTBV",newIOContext(random()));
  }
}
