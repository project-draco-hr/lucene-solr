{
  MockDirectoryWrapper d=new MockDirectoryWrapper(random(),new RAMDirectory());
  d.setPreventDoubleWrite(false);
  BitVector bv=new BitVector(n);
  for (int i=0; i < bv.size(); i++) {
    assertFalse(bv.get(i));
    assertEquals(i,bv.count());
    bv.set(i);
    assertTrue(bv.get(i));
    assertEquals(i + 1,bv.count());
    bv.write(d,"TESTBV",newIOContext(random()));
    BitVector compare=new BitVector(d,"TESTBV",newIOContext(random()));
    assertTrue(doCompare(bv,compare));
  }
}
