{
  if (cell.getLevel() == detailLevel) {
    cell.setLeaf();
  }
  if (cell.isLeaf()) {
    result.add(cell);
    return true;
  }
  if (inclParents && cell.getLevel() != 0)   result.add(cell);
  Collection<Cell> subCells=cell.getSubCells(shape);
  int leaves=0;
  for (  Cell subCell : subCells) {
    if (recursiveGetCells(subCell,shape,detailLevel,inclParents,simplify,result))     leaves++;
  }
  if (simplify && leaves == cell.getSubCellsSize() && cell.getLevel() != 0) {
    do {
      result.remove(result.size() - 1);
    }
 while (--leaves > 0);
    cell.setLeaf();
    if (!inclParents)     result.add(cell);
    return true;
  }
  return false;
}
