{
  BufferedInputStream buffered=new BufferedInputStream(affix,8192);
  buffered.mark(8192);
  String encoding=getDictionaryEncoding(affix);
  buffered.reset();
  CharsetDecoder decoder=getJavaEncoding(encoding);
  readAffixFile(buffered,decoder);
  TreeMap<BytesRef,Integer> tempWords=new TreeMap<BytesRef,Integer>();
  flagLookup.add(new BytesRef());
  readDictionaryFile(dictionary,decoder,tempWords);
  PositiveIntOutputs o=PositiveIntOutputs.getSingleton();
  Builder<Long> b=new Builder<Long>(FST.INPUT_TYPE.BYTE4,o);
  IntsRef scratchInts=new IntsRef();
  for (  Map.Entry<BytesRef,Integer> e : tempWords.entrySet()) {
    UnicodeUtil.UTF8toUTF32(e.getKey(),scratchInts);
    b.add(scratchInts,e.getValue().longValue());
  }
  words=b.finish();
}
