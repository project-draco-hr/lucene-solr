{
  Iterable<ContentStream> streams=req.getContentStreams();
  if (streams == null) {
    if (!RequestHandlerUtils.handleCommit(req,rsp,false)) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"missing content stream");
    }
    return;
  }
  RequestHandlerUtils.addExperimentalFormatWarning(rsp);
  for (  ContentStream stream : req.getContentStreams()) {
    Reader reader=stream.getReader();
    try {
      NamedList out=this.update(req,req.getCore(),reader);
      rsp.add("update",out);
    }
  finally {
      IOUtils.closeQuietly(reader);
    }
  }
  RequestHandlerUtils.handleCommit(req,rsp,false);
}
