{
  String filename=null;
  boolean extract=false;
  String dirImpl=null;
  int j=0;
  while (j < args.length) {
    String arg=args[j];
    if ("-extract".equals(arg)) {
      extract=true;
    }
 else     if ("-dir-impl".equals(arg)) {
      if (j == args.length - 1) {
        System.out.println("ERROR: missing value for -dir-impl option");
        System.exit(1);
      }
      j++;
      dirImpl=args[j];
    }
 else     if (filename == null) {
      filename=arg;
    }
    j++;
  }
  if (filename == null) {
    System.out.println("Usage: org.apache.lucene.index.CompoundFileExtractor [-extract] [-dir-impl X] <cfsfile>");
    return;
  }
  Directory dir=null;
  CompoundFileDirectory cfr=null;
  IOContext context=IOContext.READ;
  try {
    Path file=Paths.get(filename);
    Path directory=file.toAbsolutePath().getParent();
    filename=file.getFileName().toString();
    if (dirImpl == null) {
      dir=FSDirectory.open(directory);
    }
 else {
      dir=CommandLineUtil.newFSDirectory(dirImpl,directory);
    }
    cfr=new CompoundFileDirectory(dir,filename,IOContext.DEFAULT,false);
    String[] files=cfr.listAll();
    ArrayUtil.timSort(files);
    for (int i=0; i < files.length; ++i) {
      long len=cfr.fileLength(files[i]);
      if (extract) {
        System.out.println("extract " + files[i] + " with "+ len+ " bytes to local directory...");
        IndexInput ii=cfr.openInput(files[i],context);
        OutputStream f=Files.newOutputStream(Paths.get(files[i]));
        byte[] buffer=new byte[1024];
        int chunk=buffer.length;
        while (len > 0) {
          final int bufLen=(int)Math.min(chunk,len);
          ii.readBytes(buffer,0,bufLen);
          f.write(buffer,0,bufLen);
          len-=bufLen;
        }
        f.close();
        ii.close();
      }
 else       System.out.println(files[i] + ": " + len+ " bytes");
    }
  }
 catch (  IOException ioe) {
    ioe.printStackTrace();
  }
 finally {
    try {
      if (dir != null)       dir.close();
      if (cfr != null)       cfr.close();
    }
 catch (    IOException ioe) {
      ioe.printStackTrace();
    }
  }
}
