{
  log.info("Persisting cores config to " + file.getAbsolutePath());
  File tmpFile=null;
  try {
    tmpFile=File.createTempFile("solr",".xml",file.getParentFile());
    java.io.FileOutputStream out=new java.io.FileOutputStream(tmpFile);
    Writer writer=new BufferedWriter(new OutputStreamWriter(out,StandardCharsets.UTF_8));
    try {
      persist(writer,solrXMLDef);
    }
  finally {
      writer.close();
      out.close();
    }
    if (tmpFile != null) {
      if (tmpFile.renameTo(file))       tmpFile=null;
 else       fileCopy(tmpFile,file);
    }
  }
 catch (  java.io.FileNotFoundException xnf) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,xnf);
  }
catch (  java.io.IOException xio) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,xio);
  }
 finally {
    if (tmpFile != null) {
      if (!tmpFile.delete())       tmpFile.deleteOnExit();
    }
  }
}
