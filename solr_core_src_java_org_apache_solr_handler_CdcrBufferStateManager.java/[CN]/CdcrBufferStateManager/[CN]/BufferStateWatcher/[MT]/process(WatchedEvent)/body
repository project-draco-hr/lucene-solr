{
  if (isCancelled)   return;
  String collectionName=core.getCoreDescriptor().getCloudDescriptor().getCollectionName();
  String shard=core.getCoreDescriptor().getCloudDescriptor().getShardId();
  log.info("The CDCR buffer state has changed: {} @ {}:{}",event,collectionName,shard);
  if (Event.EventType.None.equals(event.getType())) {
    return;
  }
  SolrZkClient zkClient=core.getCoreDescriptor().getCoreContainer().getZkController().getZkClient();
  try {
    CdcrParams.BufferState state=CdcrParams.BufferState.get(zkClient.getData(CdcrBufferStateManager.this.getZnodePath(),watcher,null,true));
    log.info("Received new CDCR buffer state from watcher: {} @ {}:{}",state,collectionName,shard);
    CdcrBufferStateManager.this.setState(state);
  }
 catch (  KeeperException|InterruptedException e) {
    log.warn("Failed synchronising new state @ " + collectionName + ":"+ shard,e);
  }
}
