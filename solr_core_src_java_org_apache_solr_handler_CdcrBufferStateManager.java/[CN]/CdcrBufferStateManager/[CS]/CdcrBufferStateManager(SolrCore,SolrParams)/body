{
  this.core=core;
  this.createStateNode();
  if (bufferConfiguration != null) {
    byte[] defaultState=bufferConfiguration.get(CdcrParams.DEFAULT_STATE_PARAM,DEFAULT_STATE.toLower()).getBytes(Charset.forName("UTF-8"));
    state=CdcrParams.BufferState.get(defaultState);
  }
  this.setState(state);
  try {
    SolrZkClient zkClient=core.getCoreDescriptor().getCoreContainer().getZkController().getZkClient();
    watcher=this.initWatcher(zkClient);
    this.setState(CdcrParams.BufferState.get(zkClient.getData(this.getZnodePath(),watcher,null,true)));
  }
 catch (  KeeperException|InterruptedException e) {
    log.warn("Failed fetching initial state",e);
  }
}
