{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setMaxBufferedDocs(2));
  writer.addDocument(createDocument("a"));
  writer.addDocument(createDocument("a"));
  writer.addDocument(createDocument("a"));
  writer.shutdown();
  Collection<IndexCommit> commits=DirectoryReader.listCommits(dir);
  for (  final IndexCommit commit : commits) {
    Collection<String> files=commit.getFileNames();
    HashSet<String> seen=new HashSet<>();
    for (    final String fileName : files) {
      assertTrue("file " + fileName + " was duplicated",!seen.contains(fileName));
      seen.add(fileName);
    }
  }
  dir.close();
}
