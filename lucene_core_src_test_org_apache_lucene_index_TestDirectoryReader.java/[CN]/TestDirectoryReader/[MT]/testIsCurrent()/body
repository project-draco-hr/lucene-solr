{
  Directory d=newDirectory();
  IndexWriter writer=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())));
  addDocumentWithFields(writer);
  writer.shutdown();
  DirectoryReader reader=DirectoryReader.open(d);
  assertTrue(reader.isCurrent());
  writer=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())).setOpenMode(OpenMode.APPEND));
  addDocumentWithFields(writer);
  writer.shutdown();
  assertFalse(reader.isCurrent());
  writer=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())).setOpenMode(OpenMode.CREATE));
  addDocumentWithFields(writer);
  writer.shutdown();
  assertFalse(reader.isCurrent());
  reader.close();
  d.close();
}
