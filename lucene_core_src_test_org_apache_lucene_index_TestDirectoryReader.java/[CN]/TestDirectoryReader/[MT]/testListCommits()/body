{
  Directory dir=newDirectory();
  SnapshotDeletionPolicy sdp=new SnapshotDeletionPolicy(new KeepOnlyLastCommitDeletionPolicy());
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,null).setIndexDeletionPolicy(sdp));
  writer.addDocument(new Document());
  writer.commit();
  sdp.snapshot("c1");
  writer.addDocument(new Document());
  writer.commit();
  sdp.snapshot("c2");
  writer.addDocument(new Document());
  writer.commit();
  sdp.snapshot("c3");
  writer.close();
  long currentGen=0;
  for (  IndexCommit ic : DirectoryReader.listCommits(dir)) {
    assertTrue("currentGen=" + currentGen + " commitGen="+ ic.getGeneration(),currentGen < ic.getGeneration());
    currentGen=ic.getGeneration();
  }
  dir.close();
}
