{
  Directory dir=newDirectory();
  IndexWriterConfig conf=new IndexWriterConfig(TEST_VERSION_CURRENT,null);
  conf.setIndexDeletionPolicy(new KeepOnlyLastCommitDeletionPolicy());
  IndexWriter writer=new IndexWriter(dir,conf);
  try {
    assertNotNull(new IndexRevision(writer));
    fail("should have failed when IndexDeletionPolicy is not Snapshot");
  }
 catch (  IllegalArgumentException e) {
  }
 finally {
    IOUtils.close(writer,dir);
  }
}
