{
  Directory dir=newDirectory();
  IndexWriterConfig conf=new IndexWriterConfig(null);
  conf.setIndexDeletionPolicy(new KeepOnlyLastCommitDeletionPolicy());
  IndexWriter writer=new IndexWriter(dir,conf);
  try {
    assertNotNull(new IndexRevision(writer));
    fail("should have failed when IndexDeletionPolicy is not Snapshot");
  }
 catch (  IllegalArgumentException e) {
  }
 finally {
    writer.close();
    IOUtils.close(dir);
  }
}
