{
  Directory dir=newDirectory();
  IndexWriterConfig conf=new IndexWriterConfig(null);
  conf.setIndexDeletionPolicy(new SnapshotDeletionPolicy(conf.getIndexDeletionPolicy()));
  IndexWriter writer=new IndexWriter(dir,conf);
  try {
    assertNotNull(new IndexRevision(writer));
    fail("should have failed when there are no commits to snapshot");
  }
 catch (  IllegalStateException e) {
  }
 finally {
    writer.close();
    IOUtils.close(dir);
  }
}
