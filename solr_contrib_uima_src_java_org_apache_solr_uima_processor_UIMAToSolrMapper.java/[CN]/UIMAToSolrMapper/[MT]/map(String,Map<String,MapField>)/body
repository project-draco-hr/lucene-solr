{
  try {
    Type type=cas.getTypeSystem().getType(typeName);
    for (FSIterator<FeatureStructure> iterator=cas.getFSIndexRepository().getAllIndexedFS(type); iterator.hasNext(); ) {
      FeatureStructure fs=iterator.next();
      for (      String featureName : featureFieldsmapping.keySet()) {
        MapField mapField=featureFieldsmapping.get(featureName);
        String fieldNameFeature=mapField.getFieldNameFeature();
        String fieldNameFeatureValue=fieldNameFeature == null ? null : fs.getFeatureValueAsString(type.getFeatureByBaseName(fieldNameFeature));
        String fieldName=mapField.getFieldName(fieldNameFeatureValue);
        log.info(new StringBuilder("mapping ").append(typeName).append("@").append(featureName).append(" to ").append(fieldName).toString());
        String featureValue;
        if (fs instanceof Annotation && "coveredText".equals(featureName)) {
          featureValue=((Annotation)fs).getCoveredText();
        }
 else {
          featureValue=fs.getFeatureValueAsString(type.getFeatureByBaseName(featureName));
        }
        log.info(new StringBuilder("writing ").append(featureValue).append(" in ").append(fieldName).toString());
        document.addField(fieldName,featureValue,1.0f);
      }
    }
  }
 catch (  Exception e) {
    throw new FieldMappingException(e);
  }
}
