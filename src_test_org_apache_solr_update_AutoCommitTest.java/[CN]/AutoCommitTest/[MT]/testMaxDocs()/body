{
  DirectUpdateHandler2 updater=(DirectUpdateHandler2)SolrCore.getSolrCore().getUpdateHandler();
  DirectUpdateHandler2.CommitTracker tracker=updater.tracker;
  tracker.timeUpperBound=100000;
  tracker.docsUpperBound=14;
  XmlUpdateRequestHandler handler=new XmlUpdateRequestHandler();
  handler.init(null);
  SolrCore core=SolrCore.getSolrCore();
  MapSolrParams params=new MapSolrParams(new HashMap<String,String>());
  SolrQueryResponse rsp=new SolrQueryResponse();
  SolrQueryRequestBase req=new SolrQueryRequestBase(core,params){
  }
;
  for (int i=0; i < 14; i++) {
    req.setContentStreams(toContentStreams(adoc("id","A" + i,"subject","info"),null));
    handler.handleRequest(req,rsp);
  }
  assertQ("shouldn't find any",req("id:A1"),"//result[@numFound=0]");
  assertEquals(0,tracker.autoCommitCount);
  req.setContentStreams(toContentStreams(adoc("id","A14","subject","info"),null));
  handler.handleRequest(req,rsp);
  Thread.sleep(500);
  req.setContentStreams(toContentStreams(adoc("id","A15","subject","info"),null));
  handler.handleRequest(req,rsp);
  assertQ("should find one",req("id:A14"),"//result[@numFound=1]");
  assertEquals(1,tracker.autoCommitCount);
  assertQ("should find one",req("id:A15"),"//result[@numFound=0]");
  assertEquals(1,tracker.autoCommitCount);
  for (int i=0; i < 14; i++) {
    req.setContentStreams(toContentStreams(adoc("id","B" + i,"subject","info"),null));
    handler.handleRequest(req,rsp);
  }
  assertQ("shouldn't find any",req("id:B1"),"//result[@numFound=0]");
  assertEquals(1,tracker.autoCommitCount);
  req.setContentStreams(toContentStreams(adoc("id","B14","subject","info"),null));
  handler.handleRequest(req,rsp);
  Thread.sleep(500);
  req.setContentStreams(toContentStreams(adoc("id","B15","subject","info"),null));
  handler.handleRequest(req,rsp);
  assertQ("should find one",req("id:B14"),"//result[@numFound=1]");
  assertEquals(2,tracker.autoCommitCount);
  assertQ("should find none",req("id:B15"),"//result[@numFound=0]");
  assertEquals(2,tracker.autoCommitCount);
}
