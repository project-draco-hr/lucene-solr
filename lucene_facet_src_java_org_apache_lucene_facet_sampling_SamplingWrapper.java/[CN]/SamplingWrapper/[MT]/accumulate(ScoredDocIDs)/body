{
  FacetSearchParams original=delegee.searchParams;
  boolean shouldOversample=sampler.samplingParams.shouldOverSample();
  if (shouldOversample) {
    delegee.searchParams=sampler.overSampledSearchParams(original);
  }
  SampleResult sampleSet=sampler.getSampleSet(docids);
  List<FacetResult> sampleRes=delegee.accumulate(sampleSet.docids);
  List<FacetResult> results=new ArrayList<FacetResult>();
  SampleFixer sampleFixer=sampler.samplingParams.getSampleFixer();
  for (  FacetResult fres : sampleRes) {
    FacetRequest fr=fres.getFacetRequest();
    PartitionsFacetResultsHandler frh=createFacetResultsHandler(fr,createOrdinalValueResolver(fr));
    if (sampleFixer != null) {
      sampleFixer.fixResult(docids,fres,sampleSet.actualSampleRatio);
      fres=frh.rearrangeFacetResult(fres);
    }
    if (shouldOversample) {
      fres=sampler.trimResult(fres);
    }
    if (fres.getFacetResultNode().ordinal == TaxonomyReader.INVALID_ORDINAL) {
      results.add(emptyResult(fres.getFacetResultNode().ordinal,fr));
    }
 else {
      frh.labelResult(fres);
      results.add(fres);
    }
  }
  if (shouldOversample) {
    delegee.searchParams=original;
  }
  return results;
}
