{
  double x1=lat1 * TO_RADIANS;
  double x2=lat2 * TO_RADIANS;
  double h1=1 - cos(x1 - x2);
  double h2=1 - cos((lon1 - lon2) * TO_RADIANS);
  double h=(h1 + cos(x1) * cos(x2) * h2) / 2;
  double avgLat=Math.abs((x1 + x2) / 2d);
  int index=(int)(avgLat * RADIUS_INDEXER + 0.5) % earthDiameterPerLatitude.length;
  double radius=earthDiameterPerLatitude[index];
  return radius * asin(Math.min(1,Math.sqrt(h)));
}
