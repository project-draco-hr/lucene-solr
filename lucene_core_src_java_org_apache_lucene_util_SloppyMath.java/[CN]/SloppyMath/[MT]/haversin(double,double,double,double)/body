{
  double x1=lat1 * TO_RADIANS;
  double x2=lat2 * TO_RADIANS;
  double h1=1 - cos(x1 - x2);
  double h2=1 - cos((lon1 - lon2) * TO_RADIANS);
  double h=(h1 + cos(x1) * cos(x2) * h2) / 2;
  double avgLat=(x1 + x2) / 2d;
  double diameter=earthDiameter(avgLat);
  return diameter * asin(Math.min(1,Math.sqrt(h)));
}
