{
  List rows=new ArrayList();
  rows.add(createMap("id","1","desc","one"));
  rows.add(createMap("id","2","desc","two"));
  rows.add(createMap("id","3","desc","two","$deleteDocById","2"));
  MockDataSource.setIterator("select * from x",rows.iterator());
  runFullImport(dataConfigForSkipTransform);
  assertQ(req("id:1"),"//*[@numFound='1']");
  assertQ(req("id:2"),"//*[@numFound='0']");
  assertQ(req("id:3"),"//*[@numFound='1']");
  assertTrue("Update request processor processDelete was not called",TestUpdateRequestProcessor.processDeleteCalled);
  assertTrue("Update request processor finish was not called",TestUpdateRequestProcessor.finishCalled);
  MockDataSource.clearCache();
  rows=new ArrayList();
  rows.add(createMap("id","1","desc","one"));
  rows.add(createMap("id","2","desc","one"));
  rows.add(createMap("id","3","desc","two","$deleteDocByQuery","desc:one"));
  MockDataSource.setIterator("select * from x",rows.iterator());
  runFullImport(dataConfigForSkipTransform);
  assertQ(req("id:1"),"//*[@numFound='0']");
  assertQ(req("id:2"),"//*[@numFound='0']");
  assertQ(req("id:3"),"//*[@numFound='1']");
  assertTrue("Update request processor processDelete was not called",TestUpdateRequestProcessor.processDeleteCalled);
  assertTrue("Update request processor finish was not called",TestUpdateRequestProcessor.finishCalled);
  MockDataSource.clearCache();
  rows=new ArrayList();
  rows.add(createMap("$deleteDocById","3"));
  MockDataSource.setIterator("select * from x",rows.iterator());
  runFullImport(dataConfigForSkipTransform,createMap("clean","false"));
  assertQ(req("id:3"),"//*[@numFound='0']");
  assertTrue("Update request processor processDelete was not called",TestUpdateRequestProcessor.processDeleteCalled);
  assertTrue("Update request processor finish was not called",TestUpdateRequestProcessor.finishCalled);
}
