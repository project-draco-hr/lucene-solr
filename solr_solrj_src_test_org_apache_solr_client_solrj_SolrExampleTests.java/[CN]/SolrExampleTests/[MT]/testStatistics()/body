{
  SolrClient client=getSolrClient();
  client.deleteByQuery("*:*");
  client.commit();
  assertNumFound("*:*",0);
  String f="val_i";
  int i=0;
  int[] nums=new int[]{23,26,38,46,55,63,77,84,92,94};
  for (  int num : nums) {
    SolrInputDocument doc=new SolrInputDocument();
    doc.setField("id","doc" + i++);
    doc.setField("name","doc: " + num);
    doc.setField(f,num);
    client.add(doc);
  }
  client.commit();
  assertNumFound("*:*",nums.length);
  SolrQuery query=new SolrQuery("*:*");
  query.setRows(0);
  query.setGetFieldStatistics(f);
  QueryResponse rsp=client.query(query);
  FieldStatsInfo stats=rsp.getFieldStatsInfo().get(f);
  assertNotNull(stats);
  assertEquals(23.0,((Double)stats.getMin()).doubleValue(),0);
  assertEquals(94.0,((Double)stats.getMax()).doubleValue(),0);
  assertEquals(new Long(nums.length),stats.getCount());
  assertEquals(new Long(0),stats.getMissing());
  assertEquals("26.4",stats.getStddev().toString().substring(0,4));
  client.deleteByQuery("*:*");
  client.commit();
  assertNumFound("*:*",0);
  nums=new int[]{5,7,10,19,20};
  for (  int num : nums) {
    SolrInputDocument doc=new SolrInputDocument();
    doc.setField("id","doc" + i++);
    doc.setField("name","doc: " + num);
    doc.setField(f,num);
    client.add(doc);
  }
  client.commit();
  assertNumFound("*:*",nums.length);
  rsp=client.query(query);
  stats=rsp.getFieldStatsInfo().get(f);
  assertNotNull(stats);
  assertEquals(5.0,((Double)stats.getMin()).doubleValue(),0);
  assertEquals(20.0,((Double)stats.getMax()).doubleValue(),0);
  assertEquals(new Long(nums.length),stats.getCount());
  assertEquals(new Long(0),stats.getMissing());
  client.deleteByQuery("*:*");
  client.commit();
  assertNumFound("*:*",0);
  nums=new int[]{1,2,3,4,5,10,11,12,13,14};
  for (i=0; i < nums.length; i++) {
    int num=nums[i];
    SolrInputDocument doc=new SolrInputDocument();
    doc.setField("id","doc" + i);
    doc.setField("name","doc: " + num);
    doc.setField(f,num);
    doc.setField("inStock",i < 5);
    client.add(doc);
  }
  client.commit();
  assertNumFound("inStock:true",5);
  assertNumFound("inStock:false",5);
  query.addStatsFieldFacets(f,"inStock");
  rsp=client.query(query);
  stats=rsp.getFieldStatsInfo().get(f);
  assertNotNull(stats);
  List<FieldStatsInfo> facets=stats.getFacets().get("inStock");
  assertNotNull(facets);
  assertEquals(2,facets.size());
  FieldStatsInfo inStockF=facets.get(0);
  FieldStatsInfo inStockT=facets.get(1);
  if ("true".equals(inStockF.getName())) {
    FieldStatsInfo tmp=inStockF;
    inStockF=inStockT;
    inStockT=tmp;
  }
  assertEquals(inStockF.getCount(),inStockT.getCount());
  assertEquals(stats.getCount().longValue(),inStockF.getCount() + inStockT.getCount());
  assertTrue("check that min max faceted ok",((Double)inStockF.getMin()).doubleValue() < ((Double)inStockF.getMax()).doubleValue());
  assertEquals("they have the same distribution",inStockF.getStddev(),inStockT.getStddev());
}
