{
  SolrServer server=getSolrServer();
  server.deleteByQuery("*:*");
  server.commit();
  QueryResponse rsp=server.query(new SolrQuery("*:*"));
  Assert.assertEquals(0,rsp.getResults().getNumFound());
  ContentStreamUpdateRequest up=new ContentStreamUpdateRequest("/update/csv");
  up.addFile(getFile("books.csv"));
  up.setAction(AbstractUpdateRequest.ACTION.COMMIT,true,true);
  NamedList<Object> result=server.request(up);
  assertNotNull("Couldn't upload books.csv",result);
  rsp=server.query(new SolrQuery("*:*"));
  Assert.assertEquals(10,rsp.getResults().getNumFound());
}
