{
  SolrServer solrServer=getSolrServer();
  SolrInputDocument doc=new SolrInputDocument();
  doc.addField("id","123");
  solrServer.add(doc);
  solrServer.commit(true,true);
  QueryResponse response=solrServer.query(new SolrQuery("id:123"));
  assertEquals("Failed to add doc to cloud server",1,response.getResults().getNumFound());
  Map<String,List<String>> operation=new HashMap<String,List<String>>();
  operation.put("set",Lists.asList("first","second",new String[]{"third"}));
  doc.addField("multi_ss",operation);
  solrServer.add(doc);
  solrServer.commit(true,true);
  response=solrServer.query(new SolrQuery("id:123"));
  assertTrue("Multi-valued field did not return a collection",response.getResults().get(0).get("multi_ss") instanceof List);
  List<String> values=(List<String>)response.getResults().get(0).get("multi_ss");
  assertEquals("Field values was not updated with all values via atomic update",3,values.size());
  operation.clear();
  operation.put("add",Lists.asList("fourth",new String[]{"fifth"}));
  doc.removeField("multi_ss");
  doc.addField("multi_ss",operation);
  solrServer.add(doc);
  solrServer.commit(true,true);
  response=solrServer.query(new SolrQuery("id:123"));
  values=(List<String>)response.getResults().get(0).get("multi_ss");
  assertEquals("Field values was not updated with all values via atomic update",5,values.size());
}
