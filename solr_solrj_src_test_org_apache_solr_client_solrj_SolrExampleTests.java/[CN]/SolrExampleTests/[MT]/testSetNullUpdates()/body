{
  SolrServer solrServer=getSolrServer();
  SolrInputDocument doc=new SolrInputDocument();
  doc.addField("id","testSetNullUpdates");
  doc.addField("single_s","test-value");
  doc.addField("multi_ss",Arrays.asList("first","second"));
  solrServer.add(doc);
  solrServer.commit(true,true);
  doc.removeField("single_s");
  doc.removeField("multi_ss");
  Map<String,Object> map=Maps.newHashMap();
  map.put("set",null);
  doc.addField("multi_ss",map);
  solrServer.add(doc);
  solrServer.commit(true,true);
  QueryResponse response=solrServer.query(new SolrQuery("id:testSetNullUpdates"));
  assertNotNull("Entire doc was replaced because null update was not written",response.getResults().get(0).getFieldValue("single_s"));
  assertNull("Null update failed. Value still exists in document",response.getResults().get(0).getFieldValue("multi_ss"));
}
