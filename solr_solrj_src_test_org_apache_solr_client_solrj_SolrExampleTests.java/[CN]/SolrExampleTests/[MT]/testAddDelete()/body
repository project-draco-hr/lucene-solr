{
  SolrServer server=getSolrServer();
  server.deleteByQuery("*:*");
  SolrInputDocument[] doc=new SolrInputDocument[3];
  for (int i=0; i < 3; i++) {
    doc[i]=new SolrInputDocument();
    doc[i].setField("id",i + " & 222",1.0f);
  }
  String id=(String)doc[0].getField("id").getFirstValue();
  server.add(doc[0]);
  server.commit();
  assertNumFound("*:*",1);
  server.deleteById(id);
  server.commit();
  assertNumFound("*:*",0);
  server.add(doc[0]);
  server.commit();
  assertNumFound("*:*",1);
  server.deleteByQuery("id:\"" + ClientUtils.escapeQueryChars(id) + "\"");
  server.commit();
  assertNumFound("*:*",0);
  for (  SolrInputDocument d : doc) {
    server.add(d);
  }
  server.commit();
  assertNumFound("*:*",3);
  StringWriter xml=new StringWriter();
  xml.append("<delete>");
  for (  SolrInputDocument d : doc) {
    xml.append("<id>");
    XML.escapeCharData((String)d.getField("id").getFirstValue(),xml);
    xml.append("</id>");
  }
  xml.append("</delete>");
  DirectXmlRequest up=new DirectXmlRequest("/update",xml.toString());
  server.request(up);
  server.commit();
  assertNumFound("*:*",0);
}
