{
  final Directory dir=newDirectory();
  final IndexWriterConfig config=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  config.setMergePolicy(newLogMergePolicy());
  config.setCodec(_TestUtil.alwaysPostingsFormat(new MockSepPostingsFormat()));
  final IndexWriter writer=new IndexWriter(dir,config);
  try {
    final PhraseQuery pq=new PhraseQuery();
    pq.add(new Term("content","bbb"));
    pq.add(new Term("content","ccc"));
    final Document doc=new Document();
    FieldType customType=new FieldType(TextField.TYPE_NOT_STORED);
    customType.setOmitNorms(true);
    doc.add(newField("content","aaa bbb ccc ddd",customType));
    writer.addDocument(doc);
    writer.commit();
    ScoreDoc[] results=this.search(writer,pq,5);
    assertEquals(1,results.length);
    assertEquals(0,results[0].doc);
    writer.addDocument(doc);
    writer.commit();
    results=this.search(writer,pq,5);
    assertEquals(2,results.length);
    assertEquals(0,results[0].doc);
    writer.forceMerge(1);
    results=this.search(writer,pq,5);
    assertEquals(2,results.length);
    assertEquals(0,results[0].doc);
  }
  finally {
    writer.close();
    dir.close();
  }
}
