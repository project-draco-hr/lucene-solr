{
  Directory dir=newDirectory();
  Random random=random();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(new MockAnalyzer(random)));
  int numDocs=atLeast(random,50);
  for (int i=0; i < numDocs; i++) {
    Document doc=new Document();
    doc.add(new StringField("f","doc",Store.NO));
    writer.addDocument(doc);
  }
  writer.close();
  Term term=new Term("f",new BytesRef("doc"));
  DirectoryReader reader=DirectoryReader.open(dir);
  for (  AtomicReaderContext ctx : reader.leaves()) {
    DocsEnum de=ctx.reader().termDocsEnum(term);
    while (de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS) {
      assertEquals("wrong freq for doc " + de.docID(),1,de.freq());
    }
  }
  reader.close();
  dir.close();
}
