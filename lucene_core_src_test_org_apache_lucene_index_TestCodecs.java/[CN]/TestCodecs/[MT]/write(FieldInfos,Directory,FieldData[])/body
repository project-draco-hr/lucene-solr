{
  final Codec codec=Codec.getDefault();
  final SegmentInfo si=new SegmentInfo(dir,Constants.LUCENE_MAIN_VERSION,SEGMENT,10000,false,codec,null);
  final SegmentWriteState state=new SegmentWriteState(InfoStream.getDefault(),dir,si,fieldInfos,null,newIOContext(random()));
  Arrays.sort(fields);
  codec.postingsFormat().fieldsConsumer(state).write(new DataFields(fields));
}
