{
  for (int n=1; n < maxTopN; n++) {
    final FakePassageFormatter f1=new FakePassageFormatter();
    PostingsHighlighter p1=new PostingsHighlighter(Integer.MAX_VALUE - 1){
      @Override protected PassageFormatter getFormatter(      String field){
        assertEquals("body",field);
        return f1;
      }
    }
;
    final FakePassageFormatter f2=new FakePassageFormatter();
    PostingsHighlighter p2=new PostingsHighlighter(Integer.MAX_VALUE - 1){
      @Override protected PassageFormatter getFormatter(      String field){
        assertEquals("body",field);
        return f2;
      }
    }
;
    BooleanQuery.Builder bq=new BooleanQuery.Builder();
    bq.add(query,BooleanClause.Occur.MUST);
    bq.add(new TermQuery(new Term("id",Integer.toString(doc))),BooleanClause.Occur.MUST);
    TopDocs td=is.search(bq.build(),1);
    p1.highlight("body",bq.build(),is,td,n);
    p2.highlight("body",bq.build(),is,td,n + 1);
    assertTrue(f2.seen.containsAll(f1.seen));
  }
}
