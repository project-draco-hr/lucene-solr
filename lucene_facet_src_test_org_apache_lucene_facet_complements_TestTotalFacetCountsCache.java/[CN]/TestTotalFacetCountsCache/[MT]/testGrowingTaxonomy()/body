{
  Directory indexDir=newDirectory();
  Directory taxoDir=newDirectory();
  IndexWriter indexWriter=new IndexWriter(indexDir,newIndexWriterConfig(TEST_VERSION_CURRENT,null));
  TaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(taxoDir);
  FacetIndexingParams iParams=new FacetIndexingParams(){
    @Override public int getPartitionSize(){
      return 2;
    }
  }
;
  addFacets(iParams,indexWriter,taxoWriter,"a","b");
  indexWriter.commit();
  taxoWriter.commit();
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  File outputFile=_TestUtil.createTempFile("test","tmp",TEMP_DIR);
  TFC.store(outputFile,indexReader,taxoReader,iParams);
  for (int i=0; i < 10; i++) {
    taxoWriter.addCategory(new FacetLabel("foo",Integer.toString(i)));
  }
  taxoWriter.commit();
  TaxonomyReader newTaxoReader=TaxonomyReader.openIfChanged(taxoReader);
  assertNotNull(newTaxoReader);
  taxoReader.close();
  taxoReader=newTaxoReader;
  initCache();
  TFC.load(outputFile,indexReader,taxoReader,iParams);
  TotalFacetCounts totalCounts=TFC.getTotalCounts(indexReader,taxoReader,iParams);
  assertReadFromDisc(totalCounts,0,"after reading from disk.");
  outputFile.delete();
  IOUtils.close(indexWriter,taxoWriter,indexReader,taxoReader);
  IOUtils.close(indexDir,taxoDir);
}
