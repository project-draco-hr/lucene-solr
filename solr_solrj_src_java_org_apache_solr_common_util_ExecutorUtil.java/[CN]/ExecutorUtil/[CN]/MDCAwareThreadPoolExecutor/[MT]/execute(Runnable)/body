{
  final Map<String,String> submitterContext=MDC.getCopyOfContextMap();
  String ctxStr=submitterContext != null && !submitterContext.isEmpty() ? submitterContext.toString().replace("/","//") : "";
  final String submitterContextStr=ctxStr.length() <= MAX_THREAD_NAME_LEN ? ctxStr : ctxStr.substring(0,MAX_THREAD_NAME_LEN);
  super.execute(new Runnable(){
    @Override public void run(){
      Map<String,String> threadContext=MDC.getCopyOfContextMap();
      final Thread currentThread=Thread.currentThread();
      final String oldName=currentThread.getName();
      if (submitterContext != null && !submitterContext.isEmpty()) {
        MDC.setContextMap(submitterContext);
        currentThread.setName(oldName + "-processing-" + submitterContextStr);
      }
 else {
        MDC.clear();
      }
      try {
        command.run();
      }
  finally {
        if (threadContext != null) {
          MDC.setContextMap(threadContext);
        }
 else {
          MDC.clear();
        }
        currentThread.setName(oldName);
      }
    }
  }
);
}
