{
  if (isFieldOpen())   throw new IllegalStateException("Field is still open while writing document");
  tvx.writeLong(currentDocPointer);
  final int size;
  tvd.writeVInt(size=fields.size());
  int lastFieldNumber=0;
  for (int i=0; i < size; i++) {
    TVField field=(TVField)fields.elementAt(i);
    tvd.writeVInt(field.number - lastFieldNumber);
    lastFieldNumber=field.number;
  }
  long lastFieldPointer=0;
  for (int i=0; i < size; i++) {
    TVField field=(TVField)fields.elementAt(i);
    tvd.writeVLong(field.tvfPointer - lastFieldPointer);
    lastFieldPointer=field.tvfPointer;
  }
}
