{
  if (user != null) {
    final Principal p=new BasicUserPrincipal(user);
    req=new HttpServletRequestWrapper((HttpServletRequest)req){
      @Override public Principal getUserPrincipal(){
        return p;
      }
    }
;
  }
  chain.doFilter(req,rsp);
}
