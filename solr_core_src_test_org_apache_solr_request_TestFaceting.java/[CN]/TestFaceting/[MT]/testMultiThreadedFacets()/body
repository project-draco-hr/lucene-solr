{
  add50ocs();
  assertQ("check no threading, threads == 0",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","0","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
  RefCounted<SolrIndexSearcher> currentSearcherRef=h.getCore().getSearcher();
  try {
    SolrIndexSearcher currentSearcher=currentSearcherRef.get();
    UnInvertedField ui0=UnInvertedField.getUnInvertedField("f0_ws",currentSearcher);
    UnInvertedField ui1=UnInvertedField.getUnInvertedField("f1_ws",currentSearcher);
    UnInvertedField ui2=UnInvertedField.getUnInvertedField("f2_ws",currentSearcher);
    UnInvertedField ui3=UnInvertedField.getUnInvertedField("f3_ws",currentSearcher);
    UnInvertedField ui4=UnInvertedField.getUnInvertedField("f4_ws",currentSearcher);
    UnInvertedField ui5=UnInvertedField.getUnInvertedField("f5_ws",currentSearcher);
    UnInvertedField ui6=UnInvertedField.getUnInvertedField("f6_ws",currentSearcher);
    UnInvertedField ui7=UnInvertedField.getUnInvertedField("f7_ws",currentSearcher);
    UnInvertedField ui8=UnInvertedField.getUnInvertedField("f8_ws",currentSearcher);
    UnInvertedField ui9=UnInvertedField.getUnInvertedField("f9_ws",currentSearcher);
    assertQ("check threading, more threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","1000","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
    assertQ("check threading, fewer threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","3","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
    assertQ("check threading, more threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.threads","1000","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=50]","*[count(//lst[@name='facet_fields']/lst/int)=100]");
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui0,UnInvertedField.getUnInvertedField("f0_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui1,UnInvertedField.getUnInvertedField("f1_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui2,UnInvertedField.getUnInvertedField("f2_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui3,UnInvertedField.getUnInvertedField("f3_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui4,UnInvertedField.getUnInvertedField("f4_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui5,UnInvertedField.getUnInvertedField("f5_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui6,UnInvertedField.getUnInvertedField("f6_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui7,UnInvertedField.getUnInvertedField("f7_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui8,UnInvertedField.getUnInvertedField("f8_ws",currentSearcher));
    assertEquals("UnInvertedField coming back from the seacher should not have changed! ",ui9,UnInvertedField.getUnInvertedField("f9_ws",currentSearcher));
  }
  finally {
    currentSearcherRef.decref();
  }
}
