{
  add50ocs();
  assertQ("check no threading, threads == 0",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","0","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
  RefCounted<SolrIndexSearcher> currentSearcherRef=h.getCore().getSearcher();
  try {
    SolrIndexSearcher currentSearcher=currentSearcherRef.get();
    SortedSetDocValues ui0=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f0_ws");
    SortedSetDocValues ui1=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f1_ws");
    SortedSetDocValues ui2=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f2_ws");
    SortedSetDocValues ui3=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f3_ws");
    SortedSetDocValues ui4=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f4_ws");
    SortedSetDocValues ui5=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f5_ws");
    SortedSetDocValues ui6=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f6_ws");
    SortedSetDocValues ui7=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f7_ws");
    SortedSetDocValues ui8=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f8_ws");
    SortedSetDocValues ui9=DocValues.getSortedSet(currentSearcher.getAtomicReader(),"f9_ws");
    assertQ("check threading, more threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","1000","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
    assertQ("check threading, fewer threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f9_ws","facet.threads","3","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]","//lst[@name='f0_ws']/int[@name='zero_1'][.='25']","//lst[@name='f0_ws']/int[@name='zero_2'][.='25']","//lst[@name='f1_ws']/int[@name='one_1'][.='33']","//lst[@name='f1_ws']/int[@name='one_3'][.='17']","//lst[@name='f2_ws']/int[@name='two_1'][.='37']","//lst[@name='f2_ws']/int[@name='two_4'][.='13']","//lst[@name='f3_ws']/int[@name='three_1'][.='40']","//lst[@name='f3_ws']/int[@name='three_5'][.='10']","//lst[@name='f4_ws']/int[@name='four_1'][.='41']","//lst[@name='f4_ws']/int[@name='four_6'][.='9']","//lst[@name='f5_ws']/int[@name='five_1'][.='42']","//lst[@name='f5_ws']/int[@name='five_7'][.='8']","//lst[@name='f6_ws']/int[@name='six_1'][.='43']","//lst[@name='f6_ws']/int[@name='six_8'][.='7']","//lst[@name='f7_ws']/int[@name='seven_1'][.='44']","//lst[@name='f7_ws']/int[@name='seven_9'][.='6']","//lst[@name='f8_ws']/int[@name='eight_1'][.='45']","//lst[@name='f8_ws']/int[@name='eight_10'][.='5']","//lst[@name='f9_ws']/int[@name='nine_1'][.='45']","//lst[@name='f9_ws']/int[@name='nine_11'][.='5']");
    assertQ("check threading, more threads than fields",req("q","id:*","indent","true","fl","id","rows","1","facet","true","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f0_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f1_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f2_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f3_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f4_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f5_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f6_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f7_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f8_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.field","f9_ws","facet.threads","1000","facet.limit","-1"),"*[count(//lst[@name='facet_fields']/lst)=10]","*[count(//lst[@name='facet_fields']/lst/int)=20]");
  }
  finally {
    currentSearcherRef.decref();
  }
}
