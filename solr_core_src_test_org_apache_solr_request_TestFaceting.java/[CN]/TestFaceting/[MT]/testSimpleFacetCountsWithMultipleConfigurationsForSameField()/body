{
  clearIndex();
  String fname="trait_ss";
  assertU(adoc("id","42",fname,"Tool",fname,"Obnoxious","name_s","Zapp Brannigan"));
  assertU(adoc("id","43","title_s","Democratic Order of Planets"));
  assertU(commit());
  assertU(adoc("id","44",fname,"Tool","name_s","The Zapper"));
  assertU(adoc("id","45",fname,"Chauvinist","title_s","25 star General"));
  assertU(adoc("id","46",fname,"Obnoxious","subject_s","Defeated the pacifists of the Gandhi nebula"));
  assertU(commit());
  assertU(adoc("id","47",fname,"Pig","text_t","line up and fly directly at the enemy death cannons, clogging them with wreckage!"));
  assertU(commit());
  assertQ("checking facets when one has missing=true&mincount=2 and the other has missing=false&mincount=0",req("q","id:[42 TO 47]","facet","true","facet.zeros","false","fq","id:[42 TO 45]","facet.field","{!key=foo " + "facet.mincount=0 " + "facet.missing=false "+ "}"+ fname,"facet.field","{!key=bar " + "facet.mincount=2 " + "facet.missing=true "+ "}"+ fname),"*[count(//doc)=4]","*[count(//lst[@name='foo']/int)=4]","*[count(//lst[@name='bar']/int)=2]","//lst[@name='foo']/int[@name='Tool'][.='2']","//lst[@name='foo']/int[@name='Obnoxious'][.='1']","//lst[@name='foo']/int[@name='Chauvinist'][.='1']","//lst[@name='foo']/int[@name='Pig'][.='0']","//lst[@name='foo']/int[@name='Tool'][.='2']","//lst[@name='bar']/int[not(@name)][.='1']");
  assertQ("checking facets when one has missing=true&mincount=2 and the other has missing=false&mincount=0",req("q","id:[42 TO 47]","facet","true","facet.zeros","false","fq","id:[42 TO 45]","facet.field","{!key=foo " + "facet.prefix=Too " + "}"+ fname,"facet.field","{!key=bar " + "facet.limit=2 " + "facet.sort=false "+ "}"+ fname),"*[count(//doc)=4]","*[count(//lst[@name='foo']/int)=1]","*[count(//lst[@name='bar']/int)=2]","//lst[@name='foo']/int[@name='Tool'][.='2']","//lst[@name='bar']/int[@name='Chauvinist'][.='1']","//lst[@name='bar']/int[@name='Obnoxious'][.='1']");
  clearIndex();
  assertU(commit());
}
