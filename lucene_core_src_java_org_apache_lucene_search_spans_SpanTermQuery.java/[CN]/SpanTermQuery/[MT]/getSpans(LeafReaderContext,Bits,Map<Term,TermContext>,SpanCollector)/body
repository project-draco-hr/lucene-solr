{
  TermContext termContext=termContexts.get(term);
  final TermState state;
  if (termContext == null) {
    final Terms terms=context.reader().terms(term.field());
    if (terms != null) {
      if (terms.hasPositions() == false) {
        throw new IllegalStateException("field \"" + term.field() + "\" was indexed without position data; cannot run SpanTermQuery (term="+ term.text()+ ")");
      }
      final TermsEnum termsEnum=terms.iterator();
      if (termsEnum.seekExact(term.bytes())) {
        state=termsEnum.termState();
      }
 else {
        state=null;
      }
    }
 else {
      state=null;
    }
  }
 else {
    state=termContext.get(context.ord);
  }
  if (state == null) {
    return null;
  }
  final TermsEnum termsEnum=context.reader().terms(term.field()).iterator();
  termsEnum.seekExact(term.bytes(),state);
  final PostingsEnum postings=termsEnum.postings(acceptDocs,null,collector.requiredPostings());
  return new TermSpans(postings,term);
}
