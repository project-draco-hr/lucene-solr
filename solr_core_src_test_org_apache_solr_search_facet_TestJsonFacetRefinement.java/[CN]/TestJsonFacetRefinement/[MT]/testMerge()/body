{
  doTestRefine("{x : {type:terms, field:X, limit:2, refine:true} }","{x: {buckets:[{val:x1, count:5}, {val:x2, count:3}] } }","{x: {buckets:[{val:x2, count:4}, {val:x3, count:2}] } }",null,"=={x:{_l:[x1]}}");
  doTestRefine("{x : {type:terms, field:X, limit:2} }","{x: {buckets:[{val:x1, count:5}, {val:x2, count:3}] } }","{x: {buckets:[{val:x2, count:4}, {val:x3, count:2}] } }",null,null);
  doTestRefine("{top:{type:query, q:'foo_s:myquery', facet:{x : {type:terms, field:X, limit:2, refine:true} } } }","{top: {x: {buckets:[{val:x1, count:5}, {val:x2, count:3}] } } }","{top: {x: {buckets:[{val:x2, count:4}, {val:x3, count:2}] } } }",null,"=={top:{x:{_l:[x1]}}}");
  doTestRefine("{top:{type:query, q:'foo_s:myquery', facet:{x : {type:terms, field:X, limit:2, refine:false} } } }","{top: {x: {buckets:[{val:x1, count:5}, {val:x2, count:3}] } } }","{top: {x: {buckets:[{val:x2, count:4}, {val:x3, count:2}] } } }",null,null);
  doTestRefine("{top:{type:terms, field:Afield, facet:{x : {type:terms, field:X, limit:2, refine:true} } } }","{top: {buckets:[{val:'A', count:2, x:{buckets:[{val:x1, count:5},{val:x2, count:3}]} } ] } }","{top: {buckets:[{val:'A', count:1, x:{buckets:[{val:x2, count:4},{val:x3, count:2}]} } ] } }",null,"=={top: {" + "_s:[  ['A' , {x:{_l:[x1]}} ]  ]" + "    }  "+ "}");
  doTestRefine("{top:{type:range, field:R, start:0, end:1, gap:1, facet:{x : {type:terms, field:X, limit:2, refine:true} } } }","{top: {buckets:[{val:0, count:2, x:{buckets:[{val:x1, count:5},{val:x2, count:3}]} } ] } }","{top: {buckets:[{val:0, count:1, x:{buckets:[{val:x2, count:4},{val:x3, count:2}]} } ] } }",null,"=={top: {" + "_s:[  [0 , {x:{_l:[x1]}} ]  ]" + "    }  "+ "}");
}
