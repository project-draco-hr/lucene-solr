{
  assertTrue("ensure your setUp() calls super.setUp()!!!",setup);
  setup=false;
  BooleanQuery.setMaxClauseCount(savedBoolMaxClauseCount);
  LuceneTestCaseJ4.removeTestCodecs(codec);
  Locale.setDefault(savedLocale);
  TimeZone.setDefault(savedTimeZone);
  try {
    Thread.setDefaultUncaughtExceptionHandler(savedUncaughtExceptionHandler);
    if (!uncaughtExceptions.isEmpty()) {
      System.err.println("The following exceptions were thrown by threads:");
      for (      UncaughtExceptionEntry entry : uncaughtExceptions) {
        System.err.println("*** Thread: " + entry.thread.getName() + " ***");
        entry.exception.printStackTrace(System.err);
      }
      fail("Some threads threw uncaught exceptions!");
    }
    assertSaneFieldCaches(getTestLabel());
    if (ConcurrentMergeScheduler.anyUnhandledExceptions()) {
      ConcurrentMergeScheduler.clearUnhandledExceptions();
      fail("ConcurrentMergeScheduler hit unhandled exceptions");
    }
  }
  finally {
    purgeFieldCache(FieldCache.DEFAULT);
  }
  for (  MockDirectoryWrapper d : stores.keySet()) {
    if (d.isOpen()) {
      StackTraceElement elements[]=stores.get(d);
      StackTraceElement element=(elements.length > 1) ? elements[1] : null;
      fail("directory of testcase " + getName() + " was not closed, opened from: "+ element);
    }
  }
  stores=null;
  super.tearDown();
}
