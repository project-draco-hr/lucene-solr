{
  assertTrue("ensure your setUp() calls super.setUp()!!!",setup);
  setup=false;
  BooleanQuery.setMaxClauseCount(savedBoolMaxClauseCount);
  if (codec.equals("PreFlex")) {
    CodecProvider.getDefault().unregister(new PreFlexRWCodec());
  }
  CodecProvider.setDefaultCodec(savedDefaultCodec);
  try {
    Thread.setDefaultUncaughtExceptionHandler(savedUncaughtExceptionHandler);
    if (!uncaughtExceptions.isEmpty()) {
      System.err.println("The following exceptions were thrown by threads:");
      for (      UncaughtExceptionEntry entry : uncaughtExceptions) {
        System.err.println("*** Thread: " + entry.thread.getName() + " ***");
        entry.exception.printStackTrace(System.err);
      }
      fail("Some threads threw uncaught exceptions!");
    }
    assertSaneFieldCaches(getTestLabel());
    if (ConcurrentMergeScheduler.anyUnhandledExceptions()) {
      ConcurrentMergeScheduler.clearUnhandledExceptions();
      fail("ConcurrentMergeScheduler hit unhandled exceptions");
    }
  }
  finally {
    purgeFieldCache(FieldCache.DEFAULT);
  }
  super.tearDown();
}
