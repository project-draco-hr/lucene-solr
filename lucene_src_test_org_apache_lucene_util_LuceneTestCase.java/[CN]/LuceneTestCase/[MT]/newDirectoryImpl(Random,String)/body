{
  if (clazzName.equals("random"))   clazzName=randomDirectory(random);
  if (clazzName.indexOf(".") == -1)   clazzName="org.apache.lucene.store." + clazzName;
  try {
    final Class<? extends Directory> clazz=Class.forName(clazzName).asSubclass(Directory.class);
    try {
      return clazz.newInstance();
    }
 catch (    Exception e) {
      final File tmpFile=File.createTempFile("test","tmp",TEMP_DIR);
      tmpFile.delete();
      tmpFile.mkdir();
      try {
        Constructor<? extends Directory> ctor=clazz.getConstructor(File.class);
        Directory d=ctor.newInstance(tmpFile);
        if (d instanceof MMapDirectory && Constants.WINDOWS && MMapDirectory.UNMAP_SUPPORTED)         ((MMapDirectory)d).setUseUnmap(true);
        return d;
      }
 catch (      Exception e2) {
        Method method=clazz.getMethod("open",new Class[]{File.class});
        return (Directory)method.invoke(null,tmpFile);
      }
    }
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
