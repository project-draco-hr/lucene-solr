{
  super.setUp();
  assertFalse("ensure your tearDown() calls super.tearDown()!!!",setup);
  setup=true;
  stores=new IdentityHashMap<MockDirectoryWrapper,StackTraceElement[]>();
  savedUncaughtExceptionHandler=Thread.getDefaultUncaughtExceptionHandler();
  Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler(){
    public void uncaughtException(    Thread t,    Throwable e){
      uncaughtExceptions.add(new UncaughtExceptionEntry(t,e));
      if (savedUncaughtExceptionHandler != null)       savedUncaughtExceptionHandler.uncaughtException(t,e);
    }
  }
);
  ConcurrentMergeScheduler.setTestMode();
  savedBoolMaxClauseCount=BooleanQuery.getMaxClauseCount();
  codec=LuceneTestCaseJ4.installTestCodecs();
  savedLocale=Locale.getDefault();
  locale=TEST_LOCALE.equals("random") ? LuceneTestCaseJ4.randomLocale(seedRnd) : LuceneTestCaseJ4.localeForName(TEST_LOCALE);
  Locale.setDefault(locale);
  savedTimeZone=TimeZone.getDefault();
  timeZone=TEST_TIMEZONE.equals("random") ? LuceneTestCaseJ4.randomTimeZone(seedRnd) : TimeZone.getTimeZone(TEST_TIMEZONE);
  TimeZone.setDefault(timeZone);
}
