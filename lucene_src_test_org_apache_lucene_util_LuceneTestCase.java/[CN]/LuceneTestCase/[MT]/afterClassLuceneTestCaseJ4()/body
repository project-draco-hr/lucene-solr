{
  String codecDescription;
  CodecProvider cp=CodecProvider.getDefault();
  if ("randomPerField".equals(TEST_CODEC)) {
    if (cp instanceof RandomCodecProvider)     codecDescription=cp.toString();
 else     codecDescription="PreFlex";
  }
 else {
    codecDescription=codec.toString();
  }
  if (CodecProvider.getDefault() == savedCodecProvider)   removeTestCodecs(codec,CodecProvider.getDefault());
  CodecProvider.setDefault(savedCodecProvider);
  Locale.setDefault(savedLocale);
  TimeZone.setDefault(savedTimeZone);
  System.clearProperty("solr.solr.home");
  System.clearProperty("solr.data.dir");
  if (!testsFailed)   for (  MockDirectoryWrapper d : stores.keySet()) {
    if (d.isOpen()) {
      StackTraceElement elements[]=stores.get(d);
      StackTraceElement element=(elements.length > 1) ? elements[1] : null;
      fail("directory of test was not closed, opened from: " + element);
    }
  }
  stores=null;
  if (VERBOSE || testsFailed)   System.out.println("NOTE: test params are: codec=" + codecDescription + ", locale="+ locale+ ", timezone="+ (timeZone == null ? "(null)" : timeZone.getID()));
  if (testsFailed) {
    System.err.println("NOTE: all tests run in this JVM:");
    System.err.println(Arrays.toString(testClassesRun.toArray()));
  }
}
