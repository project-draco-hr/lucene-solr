{
  IndexSearcher searcher=(IndexSearcher)context.get("searcher");
  Similarity sim=searcher.getSimilarityProvider().get(field);
  if (!(sim instanceof TFIDFSimilarity)) {
    throw new UnsupportedOperationException("requires a TFIDFSimilarity (such as DefaultSimilarity)");
  }
  final TFIDFSimilarity similarity=(TFIDFSimilarity)sim;
  DocValues dv=readerContext.reader.normValues(field);
  if (dv == null) {
    return new ConstDoubleDocValues(0.0,this);
  }
  final byte[] norms=(byte[])dv.getSource().getArray();
  return new FloatDocValues(this){
    @Override public float floatVal(    int doc){
      return similarity.decodeNormValue(norms[doc]);
    }
  }
;
}
