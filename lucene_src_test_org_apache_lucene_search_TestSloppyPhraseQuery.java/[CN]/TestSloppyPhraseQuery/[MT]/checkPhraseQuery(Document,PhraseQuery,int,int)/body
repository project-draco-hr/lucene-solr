{
  query.setSlop(slop);
  Directory ramDir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,ramDir,new MockAnalyzer(random,MockTokenizer.WHITESPACE,false));
  writer.addDocument(doc);
  IndexReader reader=writer.getReader();
  IndexSearcher searcher=newSearcher(reader);
  MaxFreqCollector c=new MaxFreqCollector();
  searcher.search(query,c);
  assertEquals("slop: " + slop + "  query: "+ query+ "  doc: "+ doc+ "  Wrong number of hits",expectedNumResults,c.totalHits);
  writer.close();
  reader.close();
  ramDir.close();
  return c.max;
}
