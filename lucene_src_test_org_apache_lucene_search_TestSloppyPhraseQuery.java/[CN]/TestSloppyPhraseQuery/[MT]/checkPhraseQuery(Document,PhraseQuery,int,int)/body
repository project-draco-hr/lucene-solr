{
  query.setSlop(slop);
  Directory ramDir=newDirectory(random);
  RandomIndexWriter writer=new RandomIndexWriter(random,ramDir,new MockAnalyzer(MockTokenizer.WHITESPACE,false));
  writer.addDocument(doc);
  IndexReader reader=writer.getReader();
  IndexSearcher searcher=new IndexSearcher(reader);
  TopDocs td=searcher.search(query,null,10);
  assertEquals("slop: " + slop + "  query: "+ query+ "  doc: "+ doc+ "  Wrong number of hits",expectedNumResults,td.totalHits);
  writer.close();
  searcher.close();
  reader.close();
  ramDir.close();
  return td.getMaxScore();
}
