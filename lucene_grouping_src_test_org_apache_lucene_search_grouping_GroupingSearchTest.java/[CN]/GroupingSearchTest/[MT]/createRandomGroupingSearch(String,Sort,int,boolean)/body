{
  GroupingSearch groupingSearch;
  if (random().nextBoolean()) {
    ValueSource vs=new BytesRefFieldSource(groupField);
    groupingSearch=new GroupingSearch(vs,new HashMap<Object,Object>());
  }
 else {
    if (canUseIDV && random().nextBoolean()) {
      boolean diskResident=random().nextBoolean();
      groupingSearch=new GroupingSearch(groupField,DocValues.Type.BYTES_VAR_SORTED,diskResident);
    }
 else {
      groupingSearch=new GroupingSearch(groupField);
    }
  }
  groupingSearch.setGroupSort(groupSort);
  groupingSearch.setGroupDocsLimit(docsInGroup);
  if (random().nextBoolean()) {
    groupingSearch.setCachingInMB(4.0,true);
  }
  return groupingSearch;
}
