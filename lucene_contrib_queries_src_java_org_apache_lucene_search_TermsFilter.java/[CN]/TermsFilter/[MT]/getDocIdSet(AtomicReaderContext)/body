{
  IndexReader reader=context.reader;
  OpenBitSet result=new OpenBitSet(reader.maxDoc());
  Fields fields=reader.fields();
  BytesRef br=new BytesRef();
  Bits liveDocs=reader.getLiveDocs();
  if (fields != null) {
    String lastField=null;
    Terms termsC=null;
    TermsEnum termsEnum=null;
    DocsEnum docs=null;
    for (Iterator<Term> iter=terms.iterator(); iter.hasNext(); ) {
      Term term=iter.next();
      if (!term.field().equals(lastField)) {
        termsC=fields.terms(term.field());
        termsEnum=termsC.iterator();
        lastField=term.field();
      }
      if (terms != null) {
        br.copy(term.bytes());
        if (termsEnum.seekCeil(br) == TermsEnum.SeekStatus.FOUND) {
          docs=termsEnum.docs(liveDocs,docs);
          while (docs.nextDoc() != DocsEnum.NO_MORE_DOCS) {
            result.set(docs.docID());
          }
        }
      }
    }
  }
  return result;
}
