{
  final int valueCount=hash.size();
  final PackedLongValues ords=pending.build();
  final int[] sortedValues=hash.sort();
  final int[] ordMap=new int[valueCount];
  for (int ord=0; ord < valueCount; ord++) {
    ordMap[sortedValues[ord]]=ord;
  }
  dvConsumer.addSortedField(fieldInfo,new EmptyDocValuesProducer(){
    @Override public SortedDocValues getSorted(    FieldInfo fieldInfoIn){
      if (fieldInfoIn != fieldInfo) {
        throw new IllegalArgumentException("wrong fieldInfo");
      }
      return new BufferedSortedDocValues(hash,valueCount,ords,sortedValues,ordMap,docsWithField);
    }
  }
);
}
