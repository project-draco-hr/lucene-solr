{
  try (Directory dir=getDirectory(createTempDir())){
    assumeFalse("we must be able to delete an open file",TestUtil.hasWindowsFS(dir));
    assumeFalse("we must be able to delete an open file",TestUtil.hasVirusChecker(dir));
    Lock lock=dir.obtainLock("test.lock");
    lock.ensureValid();
    dir.deleteFiles(Collections.singleton("test.lock"));
    try {
      lock.ensureValid();
      fail("no exception");
    }
 catch (    IOException expected) {
    }
 finally {
      IOUtils.closeWhileHandlingException(lock);
    }
  }
 }
