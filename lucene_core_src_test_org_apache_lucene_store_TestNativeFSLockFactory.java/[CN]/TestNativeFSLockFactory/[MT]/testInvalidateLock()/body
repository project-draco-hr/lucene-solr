{
  Directory dir=getDirectory(createTempDir());
  NativeFSLockFactory.NativeFSLock lock=(NativeFSLockFactory.NativeFSLock)dir.obtainLock("test.lock");
  lock.ensureValid();
  lock.lock.release();
  try {
    lock.ensureValid();
    fail("no exception");
  }
 catch (  AlreadyClosedException expected) {
  }
 finally {
    IOUtils.closeWhileHandlingException(lock);
  }
  dir.close();
}
