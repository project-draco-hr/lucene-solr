{
  if (BasicOperations.isEmpty(automaton)) {
    return TermsEnum.EMPTY;
  }
  TermsEnum tenum=terms.iterator();
  if (BasicOperations.isTotal(automaton)) {
    return tenum;
  }
  String singleton=automaton.getSingleton();
  if (singleton != null)   return new SingleTermsEnum(tenum,term.createTerm(singleton));
  final String commonPrefix=SpecialOperations.getCommonPrefix(automaton);
  if (commonPrefix.length() > 0) {
    if (BasicOperations.sameLanguage(automaton,BasicAutomata.makeString(commonPrefix))) {
      return new SingleTermsEnum(tenum,term.createTerm(commonPrefix));
    }
    Automaton prefixAutomaton=BasicOperations.concatenate(BasicAutomata.makeString(commonPrefix),BasicAutomata.makeAnyString());
    if (BasicOperations.sameLanguage(automaton,prefixAutomaton)) {
      return new PrefixTermsEnum(tenum,term.createTerm(commonPrefix));
    }
  }
  compileAutomaton();
  return new AutomatonTermsEnum(runAutomaton,tenum,isFinite,commonSuffixRef);
}
