{
  Directory d=newDirectory();
  final int DOC_COUNT=177;
  IndexWriter w=new IndexWriter(d,new IndexWriterConfig(Version.LUCENE_31,new MockAnalyzer(random)).setMaxBufferedDocs(7));
  for (int iter=0; iter < 2; iter++) {
    if (iter == 0) {
      Document doc=new Document();
      doc.add(newField("field1","this is field1",Field.Store.NO,Field.Index.ANALYZED));
      doc.add(newField("field2","this is field2",Field.Store.NO,Field.Index.ANALYZED));
      doc.add(newField("field3","aaa",Field.Store.NO,Field.Index.ANALYZED));
      doc.add(newField("field4","bbb",Field.Store.NO,Field.Index.ANALYZED));
      for (int i=0; i < DOC_COUNT; i++) {
        w.addDocument(doc);
      }
    }
 else {
      w.optimize();
    }
    IndexReader r=w.getReader();
    TermsEnum terms=MultiFields.getTerms(r,"field3").iterator();
    assertEquals(TermsEnum.SeekStatus.END,terms.seekCeil(new BytesRef("abc")));
    r.close();
  }
  w.close();
  d.close();
}
