{
  this.documentsWriter.set(documentsWriter);
  final CodecProvider codecs=config.getCodecProvider();
  this.codecProvider=codecs;
  this.globalFieldMap=globalFieldMap;
  for (int i=0; i < perThreads.length; i++) {
    final FieldInfos infos=globalFieldMap.newFieldInfos(SegmentCodecsBuilder.create(codecs));
    perThreads[i]=new ThreadState(new DocumentsWriterPerThread(documentsWriter.directory,documentsWriter,infos,documentsWriter.chain));
  }
}
