{
  codecProvider=config.getCodecProvider();
  this.globalFieldMap=globalFieldMap;
  for (int i=0; i < perThreads.length; i++) {
    final FieldInfos infos=globalFieldMap.newFieldInfos(SegmentCodecsBuilder.create(codecProvider));
    perThreads[i]=new ThreadState(new DocumentsWriterPerThread(documentsWriter.directory,documentsWriter,infos,documentsWriter.chain));
  }
}
