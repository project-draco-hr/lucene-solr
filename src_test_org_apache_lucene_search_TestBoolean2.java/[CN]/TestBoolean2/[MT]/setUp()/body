{
  super.setUp();
  RAMDirectory directory=new RAMDirectory();
  IndexWriter writer=new IndexWriter(directory,new IndexWriterConfig(TEST_VERSION_CURRENT));
  for (int i=0; i < docFields.length; i++) {
    Document doc=new Document();
    doc.add(new Field(field,docFields[i],Field.Store.NO,Field.Index.ANALYZED));
    writer.addDocument(doc);
  }
  writer.close();
  searcher=new IndexSearcher(directory,true);
  dir2=new MockRAMDirectory(directory);
  mulFactor=1;
  int docCount=0;
  do {
    final Directory copy=new RAMDirectory(dir2);
    IndexWriter w=new IndexWriter(dir2,new IndexWriterConfig(TEST_VERSION_CURRENT));
    w.addIndexesNoOptimize(new Directory[]{copy});
    docCount=w.maxDoc();
    w.close();
    mulFactor*=2;
  }
 while (docCount < 3000);
  IndexWriter w=new IndexWriter(dir2,new IndexWriterConfig(TEST_VERSION_CURRENT));
  Document doc=new Document();
  doc.add(new Field("field2","xxx",Field.Store.NO,Field.Index.ANALYZED));
  for (int i=0; i < NUM_EXTRA_DOCS / 2; i++) {
    w.addDocument(doc);
  }
  doc=new Document();
  doc.add(new Field("field2","big bad bug",Field.Store.NO,Field.Index.ANALYZED));
  for (int i=0; i < NUM_EXTRA_DOCS / 2; i++) {
    w.addDocument(doc);
  }
  w.optimize();
  reader=w.getReader();
  w.close();
  bigSearcher=new IndexSearcher(reader);
}
