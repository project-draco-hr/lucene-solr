{
  LongRange[] ranges=(LongRange[])this.ranges;
  long minIncl=Long.MAX_VALUE;
  long maxIncl=Long.MIN_VALUE;
  for (  LongRange range : ranges) {
    minIncl=Math.min(minIncl,range.minIncl);
    maxIncl=Math.max(maxIncl,range.maxIncl);
  }
  for (  MatchingDocs hits : matchingDocs) {
    FunctionValues fv=valueSource.getValues(Collections.emptyMap(),hits.context);
    final int length=hits.bits.length();
    int doc=0;
    totCount+=hits.totalHits;
    while (doc < length && (doc=hits.bits.nextSetBit(doc)) != -1) {
      if (fv.exists(doc)) {
        long v=fv.longVal(doc);
        if (v < minIncl || v > maxIncl) {
          doc++;
          continue;
        }
        for (int j=0; j < ranges.length; j++) {
          if (ranges[j].accept(v)) {
            counts[j]++;
          }
        }
      }
      doc++;
    }
  }
}
