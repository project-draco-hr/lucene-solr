{
  int termID=bytesHash.addByPoolOffset(textStart);
  if (termID >= 0) {
    if (numPostingInt + intPool.intUpto > DocumentsWriterPerThread.INT_BLOCK_SIZE)     intPool.nextBuffer();
    if (ByteBlockPool.BYTE_BLOCK_SIZE - bytePool.byteUpto < numPostingInt * ByteBlockPool.FIRST_LEVEL_SIZE) {
      bytePool.nextBuffer();
    }
    intUptos=intPool.buffer;
    intUptoStart=intPool.intUpto;
    intPool.intUpto+=streamCount;
    postingsArray.intStarts[termID]=intUptoStart + intPool.intOffset;
    for (int i=0; i < streamCount; i++) {
      final int upto=bytePool.newSlice(ByteBlockPool.FIRST_LEVEL_SIZE);
      intUptos[intUptoStart + i]=upto + bytePool.byteOffset;
    }
    postingsArray.byteStarts[termID]=intUptos[intUptoStart];
    consumer.newTerm(termID);
  }
 else {
    termID=(-termID) - 1;
    int intStart=postingsArray.intStarts[termID];
    intUptos=intPool.buffers[intStart >> DocumentsWriterPerThread.INT_BLOCK_SHIFT];
    intUptoStart=intStart & DocumentsWriterPerThread.INT_BLOCK_MASK;
    consumer.addTerm(termID);
  }
}
