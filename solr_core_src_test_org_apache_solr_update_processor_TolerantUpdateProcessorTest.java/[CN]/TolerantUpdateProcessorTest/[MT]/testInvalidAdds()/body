{
  SolrInputDocument invalidDoc=doc(field("text",1f,"the quick brown fox"));
  try {
    add("not-tolerant",null,invalidDoc);
    fail("Expecting exception");
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("Document is missing mandatory uniqueKey field"));
  }
  assertAddsSucceedWithErrors("tolerant-chain-max-errors-10",Arrays.asList(new SolrInputDocument[]{invalidDoc}),null,"(unknown)");
  SolrInputDocument validDoc=doc(field("id",1f,"1"),field("text",1f,"the quick brown fox"));
  try {
    add("not-tolerant",null,Arrays.asList(new SolrInputDocument[]{invalidDoc,validDoc}));
    fail("Expecting exception");
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("Document is missing mandatory uniqueKey field"));
  }
  assertU(commit());
  assertQ(req("q","id:1"),"//result[@numFound='0']");
  assertAddsSucceedWithErrors("tolerant-chain-max-errors-10",Arrays.asList(new SolrInputDocument[]{invalidDoc,validDoc}),null,"(unknown)");
  assertU(commit());
  assertQ(req("q","id:1"),"//result[@numFound='1']");
  invalidDoc=doc(field("id",1f,"2"),field("weight",1f,"aaa"));
  validDoc=doc(field("id",1f,"3"),field("weight",1f,"3"));
  try {
    add("not-tolerant",null,Arrays.asList(new SolrInputDocument[]{invalidDoc,validDoc}));
    fail("Expecting exception");
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("Error adding field"));
  }
  assertU(commit());
  assertQ(req("q","id:3"),"//result[@numFound='0']");
  assertAddsSucceedWithErrors("tolerant-chain-max-errors-10",Arrays.asList(new SolrInputDocument[]{invalidDoc,validDoc}),null,"2");
  assertU(commit());
  assertQ(req("q","id:3"),"//result[@numFound='1']");
  assertQ(req("q","id:2"),"//result[@numFound='0']");
}
