{
  if (req.synchronous) {
    blockAndDoRetries();
    HttpSolrServer server=new HttpSolrServer(req.node.getUrl(),servers.getHttpClient());
    try {
      server.request(req.uReq);
    }
 catch (    Exception e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Failed synchronous update on shard " + req.node + " update: "+ req.uReq,e);
    }
 finally {
      server.shutdown();
    }
    return;
  }
  if (log.isDebugEnabled()) {
    log.debug("sending update to " + req.node.getUrl() + " retry:"+ req.retries+ " "+ req.cmdString+ " params:"+ req.uReq.getParams());
  }
  if (isCommit) {
    pending.add(completionService.submit(new Callable<Object>(){
      @Override public Object call() throws Exception {
        doRequest(req);
        return null;
      }
    }
));
  }
 else {
    doRequest(req);
  }
}
