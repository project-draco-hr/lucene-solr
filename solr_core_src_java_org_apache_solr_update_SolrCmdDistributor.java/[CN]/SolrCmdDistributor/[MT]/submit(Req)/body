{
  if (req.synchronous) {
    servers.blockUntilFinished();
    doRetriesIfNeeded();
    HttpSolrServer server=new HttpSolrServer(req.node.getUrl(),servers.getHttpClient());
    try {
      server.request(req.uReq);
    }
 catch (    Exception e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Failed synchronous update on shard " + req.node + " update: "+ req.uReq,e);
    }
 finally {
      server.shutdown();
    }
    return;
  }
  try {
    SolrServer solrServer=servers.getSolrServer(req);
    NamedList<Object> rsp=solrServer.request(req.uReq);
  }
 catch (  Exception e) {
    SolrException.log(log,e);
    Error error=new Error();
    error.e=e;
    error.req=req;
    if (e instanceof SolrException) {
      error.statusCode=((SolrException)e).code();
    }
    errors.add(error);
  }
}
