{
  Set<Node> removeNodes=new HashSet<Node>();
  Set<Node> nodes=adds.keySet();
  for (  Node node : nodes) {
    List<AddRequest> alist=adds.get(node);
    if (alist == null || alist.size() < limit)     continue;
    UpdateRequestExt ureq=new UpdateRequestExt();
    ModifiableSolrParams combinedParams=new ModifiableSolrParams();
    for (    AddRequest aReq : alist) {
      AddUpdateCommand cmd=aReq.cmd;
      combinedParams.add(aReq.params);
      ureq.add(cmd.solrDoc,cmd.commitWithin,cmd.overwrite);
    }
    if (ureq.getParams() == null)     ureq.setParams(new ModifiableSolrParams());
    ureq.getParams().add(combinedParams);
    removeNodes.add(node);
    submit(ureq,node);
  }
  for (  Node node : removeNodes) {
    adds.remove(node);
  }
  return true;
}
