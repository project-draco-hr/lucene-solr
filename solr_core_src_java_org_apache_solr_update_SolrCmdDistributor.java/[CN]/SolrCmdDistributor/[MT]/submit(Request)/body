{
  if (completionService == null) {
    completionService=new ExecutorCompletionService<Request>(commExecutor);
    pending=new HashSet<Future<Request>>();
  }
  final String url=sreq.node.getUrl();
  Callable<Request> task=new Callable<Request>(){
    @Override public Request call() throws Exception {
      Request clonedRequest=new Request();
      clonedRequest.node=sreq.node;
      clonedRequest.ureq=sreq.ureq;
      clonedRequest.retries=sreq.retries;
      try {
        String fullUrl;
        if (!url.startsWith("http://") && !url.startsWith("https://")) {
          fullUrl="http://" + url;
        }
 else {
          fullUrl=url;
        }
        CommonsHttpSolrServer server=new CommonsHttpSolrServer(fullUrl,client);
        clonedRequest.ursp=server.request(clonedRequest.ureq);
      }
 catch (      Exception e) {
        clonedRequest.exception=e;
        if (e instanceof SolrException) {
          clonedRequest.rspCode=((SolrException)e).code();
        }
 else {
          clonedRequest.rspCode=-1;
        }
      }
      return clonedRequest;
    }
  }
;
  pending.add(completionService.submit(task));
}
