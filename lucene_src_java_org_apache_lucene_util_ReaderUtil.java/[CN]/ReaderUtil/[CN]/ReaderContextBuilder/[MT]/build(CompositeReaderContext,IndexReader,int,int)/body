{
  if (reader instanceof AtomicReader) {
    AtomicReaderContext atomic=new AtomicReaderContext(parent,(AtomicReader)reader,ord,docBase,leafOrd,leafDocBase);
    leaves[leafOrd++]=atomic;
    leafDocBase+=reader.maxDoc();
    return atomic;
  }
 else {
    CompositeReader cr=(CompositeReader)reader;
    IndexReader[] sequentialSubReaders=cr.getSequentialSubReaders();
    ReaderContext[] children=new ReaderContext[sequentialSubReaders.length];
    final CompositeReaderContext newParent;
    if (parent == null) {
      newParent=new CompositeReaderContext(cr,children,leaves);
    }
 else {
      newParent=new CompositeReaderContext(parent,cr,ord,docBase,children);
    }
    int newDocBase=0;
    for (int i=0; i < sequentialSubReaders.length; i++) {
      children[i]=build(newParent,sequentialSubReaders[i],i,newDocBase);
      newDocBase+=sequentialSubReaders[i].maxDoc();
    }
    return newParent;
  }
}
