{
  if (reader instanceof AtomicIndexReader) {
    AtomicReaderContext atomic=new AtomicReaderContext(parent,(AtomicIndexReader)reader,ord,docBase,leafOrd,leafDocBase);
    leaves[leafOrd++]=atomic;
    leafDocBase+=reader.maxDoc();
    return atomic;
  }
 else {
    CompositeIndexReader cr=(CompositeIndexReader)reader;
    IndexReader[] sequentialSubReaders=cr.getSequentialSubReaders();
    @SuppressWarnings({"unchecked","rawtypes"}) ReaderContext<? extends IndexReader>[] children=new ReaderContext[sequentialSubReaders.length];
    final CompositeReaderContext newParent;
    if (parent == null) {
      newParent=new CompositeReaderContext(cr,children,leaves);
    }
 else {
      newParent=new CompositeReaderContext(parent,cr,ord,docBase,children);
    }
    int newDocBase=0;
    for (int i=0; i < sequentialSubReaders.length; i++) {
      children[i]=build(newParent,sequentialSubReaders[i],i,newDocBase);
      newDocBase+=sequentialSubReaders[i].maxDoc();
    }
    return newParent;
  }
}
