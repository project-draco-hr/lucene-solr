{
  if (filter == null) {
    DocSetHitCollector hc=new DocSetHitCollector(maxDoc());
    searcher.search(query,null,hc);
    return hc.getDocSet();
  }
 else {
    final DocSetHitCollector hc=new DocSetHitCollector(maxDoc());
    final DocSet filt=filter;
    searcher.search(query,null,new HitCollector(){
      public void collect(      int doc,      float score){
        if (filt.exists(doc))         hc.collect(doc,score);
      }
    }
);
    return hc.getDocSet();
  }
}
