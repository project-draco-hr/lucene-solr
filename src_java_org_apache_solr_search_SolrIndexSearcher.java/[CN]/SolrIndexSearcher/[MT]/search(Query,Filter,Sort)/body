{
  if (optimizer == null || filter != null || !(query instanceof BooleanQuery)) {
    return searcher.search(query,filter,sort);
  }
 else {
    Query[] newQuery=new Query[1];
    Filter[] newFilter=new Filter[1];
    optimizer.optimize((BooleanQuery)query,searcher,0,newQuery,newFilter);
    return searcher.search(newQuery[0],newFilter[0],sort);
  }
}
