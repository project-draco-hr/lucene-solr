{
  TermVectorsWriter termVectorsWriter=new TermVectorsWriter(directory,segment,fieldInfos);
  try {
    for (int r=0; r < readers.size(); r++) {
      IndexReader reader=(IndexReader)readers.elementAt(r);
      int maxDoc=reader.maxDoc();
      for (int docNum=0; docNum < maxDoc; docNum++) {
        if (reader.isDeleted(docNum))         continue;
        termVectorsWriter.addAllDocVectors(reader.getTermFreqVectors(docNum));
      }
    }
  }
  finally {
    termVectorsWriter.close();
  }
}
