{
  for (int i=0; i < fieldInfos.size(); i++) {
    FieldInfo fi=fieldInfos.fieldInfo(i);
    if (fi.isIndexed) {
      OutputStream output=directory.createFile(segment + ".f" + i);
      try {
        for (int j=0; j < readers.size(); j++) {
          SegmentReader reader=(SegmentReader)readers.elementAt(j);
          BitVector deletedDocs=reader.deletedDocs;
          InputStream input=reader.normStream(fi.name);
          int maxDoc=reader.maxDoc();
          try {
            for (int k=0; k < maxDoc; k++) {
              byte norm=input != null ? input.readByte() : (byte)0;
              if (deletedDocs == null || !deletedDocs.get(k))               output.writeByte(norm);
            }
          }
  finally {
            if (input != null)             input.close();
          }
        }
      }
  finally {
        output.close();
      }
    }
  }
}
