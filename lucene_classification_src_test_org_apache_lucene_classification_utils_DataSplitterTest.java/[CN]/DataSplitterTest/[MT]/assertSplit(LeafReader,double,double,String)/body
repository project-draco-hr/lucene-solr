{
  BaseDirectoryWrapper trainingIndex=newDirectory();
  BaseDirectoryWrapper testIndex=newDirectory();
  BaseDirectoryWrapper crossValidationIndex=newDirectory();
  try {
    DatasetSplitter datasetSplitter=new DatasetSplitter(testRatio,crossValidationRatio);
    datasetSplitter.split(originalIndex,trainingIndex,testIndex,crossValidationIndex,new MockAnalyzer(random()),fieldNames);
    assertNotNull(trainingIndex);
    assertNotNull(testIndex);
    assertNotNull(crossValidationIndex);
    DirectoryReader trainingReader=DirectoryReader.open(trainingIndex);
    assertTrue((int)(originalIndex.maxDoc() * (1d - testRatio - crossValidationRatio)) == trainingReader.maxDoc());
    DirectoryReader testReader=DirectoryReader.open(testIndex);
    assertTrue((int)(originalIndex.maxDoc() * testRatio) == testReader.maxDoc());
    DirectoryReader cvReader=DirectoryReader.open(crossValidationIndex);
    assertTrue((int)(originalIndex.maxDoc() * crossValidationRatio) == cvReader.maxDoc());
    trainingReader.close();
    testReader.close();
    cvReader.close();
    closeQuietly(trainingReader);
    closeQuietly(testReader);
    closeQuietly(cvReader);
  }
  finally {
    if (trainingIndex != null) {
      trainingIndex.close();
    }
    if (testIndex != null) {
      testIndex.close();
    }
    if (crossValidationIndex != null) {
      crossValidationIndex.close();
    }
  }
}
