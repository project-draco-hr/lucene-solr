{
  Directory ram=new MockRAMDirectory();
  Analyzer analyzer=new StandardAnalyzer();
  IndexWriter writer=new IndexWriter(ram,analyzer,true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMaxBufferedDocs(3);
  writer.setMergeFactor(2);
  Document d=new Document();
  Field f1=new Field("f1","This field has term freqs",Field.Store.NO,Field.Index.TOKENIZED);
  d.add(f1);
  Field f2=new Field("f2","This field has NO Tf in all docs",Field.Store.NO,Field.Index.TOKENIZED);
  f2.setOmitTf(true);
  d.add(f2);
  for (int i=0; i < 30; i++)   writer.addDocument(d);
  d=new Document();
  f1.setOmitTf(true);
  d.add(f1);
  f2.setOmitTf(false);
  d.add(f2);
  for (int i=0; i < 30; i++)   writer.addDocument(d);
  writer.optimize();
  writer.close();
  _TestUtil.checkIndex(ram);
  SegmentReader reader=(SegmentReader)IndexReader.open(ram);
  FieldInfos fi=reader.fieldInfos();
  assertTrue("OmitTf field bit should be set.",fi.fieldInfo("f1").omitTf);
  assertTrue("OmitTf field bit should be set.",fi.fieldInfo("f2").omitTf);
  reader.close();
  ram.close();
}
