{
  Directory indexDir=new RAMDirectory();
  TaxonomyWriter tw=new LuceneTaxonomyWriter(indexDir);
  tw.addCategory(new CategoryPath("hi","there"));
  tw.commit();
  TaxonomyReader tr=new LuceneTaxonomyReader(indexDir);
  ChildrenArrays ca=tr.getChildrenArrays();
  assertEquals(3,tr.getSize());
  assertEquals(3,ca.getOlderSiblingArray().length);
  assertEquals(3,ca.getYoungestChildArray().length);
  assertTrue(Arrays.equals(new int[]{1,2,-1},ca.getYoungestChildArray()));
  assertTrue(Arrays.equals(new int[]{-1,-1,-1},ca.getOlderSiblingArray()));
  tw.addCategory(new CategoryPath("hi","ho"));
  tw.addCategory(new CategoryPath("hello"));
  tw.commit();
  ChildrenArrays newca=tr.getChildrenArrays();
  assertSame(newca,ca);
  assertEquals(3,tr.getSize());
  assertEquals(3,ca.getOlderSiblingArray().length);
  assertEquals(3,ca.getYoungestChildArray().length);
  tr.refresh();
  ca=tr.getChildrenArrays();
  assertEquals(5,tr.getSize());
  assertEquals(5,ca.getOlderSiblingArray().length);
  assertEquals(5,ca.getYoungestChildArray().length);
  assertTrue(Arrays.equals(new int[]{4,3,-1,-1,-1},ca.getYoungestChildArray()));
  assertTrue(Arrays.equals(new int[]{-1,-1,-1,2,1},ca.getOlderSiblingArray()));
  tw.close();
  tr.close();
}
