{
  Directory indexDirBase=new RAMDirectory();
  TaxonomyWriter twBase=new LuceneTaxonomyWriter(indexDirBase);
  twBase.addCategory(new CategoryPath("a","0"));
  final CategoryPath abPath=new CategoryPath("a","b");
  twBase.addCategory(abPath);
  twBase.commit();
  TaxonomyReader trBase=new LuceneTaxonomyReader(indexDirBase);
  final ChildrenArrays ca1=trBase.getChildrenArrays();
  final int abOrd=trBase.getOrdinal(abPath);
  final int abYoungChildBase1=ca1.getYoungestChildArray()[abOrd];
  for (int i=0; i < 1 << 10; i++) {
    twBase.addCategory(new CategoryPath("a","b",Integer.toString(i)));
  }
  twBase.commit();
  trBase.refresh();
  final ChildrenArrays ca2=trBase.getChildrenArrays();
  final int abYoungChildBase2=ca2.getYoungestChildArray()[abOrd];
  for (int retry=0; retry < 100; retry++) {
    assertConsistentYoungestChild(abPath,abOrd,abYoungChildBase1,abYoungChildBase2,retry);
  }
}
