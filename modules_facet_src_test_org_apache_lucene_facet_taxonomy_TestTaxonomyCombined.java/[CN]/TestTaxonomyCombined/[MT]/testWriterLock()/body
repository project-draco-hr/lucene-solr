{
  Directory indexDir=new RAMDirectory();
  TaxonomyWriter tw=new LuceneTaxonomyWriter(indexDir);
  tw.addCategory(new CategoryPath("hi","there"));
  tw.commit();
  TaxonomyReader tr=new LuceneTaxonomyReader(indexDir);
  assertEquals(2,tr.getOrdinal(new CategoryPath("hi","there")));
  try {
    new LuceneTaxonomyWriter(indexDir);
    fail("should have failed to write in locked directory");
  }
 catch (  LockObtainFailedException e) {
  }
  LuceneTaxonomyWriter.unlock(indexDir);
  TaxonomyWriter tw2=new LuceneTaxonomyWriter(indexDir);
  tw2.addCategory(new CategoryPath("hey"));
  tw2.close();
  tr.refresh();
  assertEquals(3,tr.getOrdinal(new CategoryPath("hey")));
  tr.close();
  tw.close();
  indexDir.close();
}
