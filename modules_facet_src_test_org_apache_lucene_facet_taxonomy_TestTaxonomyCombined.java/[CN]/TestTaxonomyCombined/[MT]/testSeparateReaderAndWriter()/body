{
  Directory indexDir=newDirectory();
  TaxonomyWriter tw=new LuceneTaxonomyWriter(indexDir);
  tw.commit();
  TaxonomyReader tr=new LuceneTaxonomyReader(indexDir);
  int author=1;
  try {
    tr.getParent(author);
    fail("Initially, getParent for " + author + " should throw exception");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  assertEquals(1,tr.getSize());
  tw.addCategory(new CategoryPath("Author"));
  try {
    tr.getParent(author);
    fail("Before commit() and refresh(), getParent for " + author + " should still throw exception");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  assertEquals(1,tr.getSize());
  tr.refresh();
  try {
    tr.getParent(author);
    fail("Before commit() and refresh(), getParent for " + author + " should still throw exception");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  assertEquals(1,tr.getSize());
  tw.commit();
  try {
    tr.getParent(author);
    fail("Before refresh(), getParent for " + author + " should still throw exception");
  }
 catch (  ArrayIndexOutOfBoundsException e) {
  }
  assertEquals(1,tr.getSize());
  tr.refresh();
  try {
    assertEquals(TaxonomyReader.ROOT_ORDINAL,tr.getParent(author));
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    fail("After category addition, commit() and refresh(), getParent for " + author + " should NOT throw exception");
  }
  assertEquals(2,tr.getSize());
  tw.addCategory(new CategoryPath("Author","Richard Dawkins"));
  int dawkins=2;
  tw.commit();
  tr.refresh();
  assertEquals(author,tr.getParent(dawkins));
  assertEquals(TaxonomyReader.ROOT_ORDINAL,tr.getParent(author));
  assertEquals(TaxonomyReader.INVALID_ORDINAL,tr.getParent(TaxonomyReader.ROOT_ORDINAL));
  assertEquals(3,tr.getSize());
  tw.close();
  tr.close();
  indexDir.close();
}
