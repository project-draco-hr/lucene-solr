{
  boolean needDocSet=freq.getFacetStats().size() > 0 || freq.getSubFacets().size() > 0;
  DocSet result=null;
  int count;
  if (needDocSet) {
    if (q == null) {
      result=fcontext.base;
    }
 else {
      result=fcontext.searcher.getDocSet(q,fcontext.base);
    }
    count=result.size();
  }
 else {
    if (q == null) {
      count=fcontext.base.size();
    }
 else {
      count=fcontext.searcher.numDocs(q,fcontext.base);
    }
  }
  try {
    processStats(bucket,result,(int)count);
    processSubs(bucket,q,result);
  }
  finally {
    if (result != null) {
      result=null;
    }
  }
}
