{
  if (params == null) {
    throw new IllegalStateException("Value of params not set");
  }
  String field=(String)params.get(FIELD);
  String payloadField=(String)params.get(PAYLOAD_FIELD);
  String weightExpression=(String)params.get(WEIGHT_EXPRESSION);
  Set<SortField> sortFields=new HashSet<SortField>();
  if (field == null) {
    throw new IllegalArgumentException(FIELD + " is a mandatory parameter");
  }
  if (weightExpression == null) {
    throw new IllegalArgumentException(WEIGHT_EXPRESSION + " is a mandatory parameter");
  }
  for (int i=0; i < params.size(); i++) {
    if (params.getName(i).equals(SORT_FIELD)) {
      String sortFieldName=(String)params.getVal(i);
      SortField.Type sortFieldType=getSortFieldType(core,sortFieldName);
      if (sortFieldType == null) {
        throw new IllegalArgumentException(sortFieldName + " could not be mapped to any appropriate type" + " [long, int, float, double]");
      }
      SortField sortField=new SortField(sortFieldName,sortFieldType);
      sortFields.add(sortField);
    }
  }
  return new DocumentExpressionDictionary(searcher.getIndexReader(),field,weightExpression,sortFields,payloadField);
}
