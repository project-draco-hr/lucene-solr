{
  final double minLon=GeoEncodingUtils.mortonUnhashLon(start);
  final double minLat=GeoEncodingUtils.mortonUnhashLat(start);
  final double maxLon=GeoEncodingUtils.mortonUnhashLon(end);
  final double maxLat=GeoEncodingUtils.mortonUnhashLat(end);
  final short level=(short)((GeoEncodingUtils.BITS << 1) - res >>> 1);
  final boolean within=res % GeoPointField.PRECISION_STEP == 0 && relationImpl.cellWithin(minLat,maxLat,minLon,maxLon);
  if (within || (level == DETAIL_LEVEL && relationImpl.cellIntersectsShape(minLat,maxLat,minLon,maxLon))) {
    final short nextRes=(short)(res - 1);
    if (nextRes % GeoPointField.PRECISION_STEP == 0) {
      rangeBounds.add(new Range(start,nextRes,!within));
      rangeBounds.add(new Range(start | (1L << nextRes),nextRes,!within));
    }
 else {
      rangeBounds.add(new Range(start,res,!within));
    }
  }
 else   if (level < DETAIL_LEVEL && relationImpl.cellIntersectsMBR(minLat,maxLat,minLon,maxLon)) {
    computeRange(start,(short)(res - 1));
  }
}
