{
  BooleanQuery booleanQuery=new BooleanQuery();
  booleanQuery.add(new TermQuery(new Term(F,"A")),Occur.MUST);
  booleanQuery.add(new TermQuery(new Term(F,"B")),Occur.MUST);
  booleanQuery.add(new TermQuery(new Term(F,"C")),Occur.SHOULD);
  BooleanQuery innerQuery=new BooleanQuery();
  innerQuery.add(new TermQuery(new Term(F,"D")),Occur.MUST);
  innerQuery.add(new TermQuery(new Term(F,"E")),Occur.MUST);
  booleanQuery.add(innerQuery,Occur.MUST_NOT);
  FieldQuery fq=new FieldQuery(booleanQuery,true,true);
  Set<Query> flatQueries=new HashSet<Query>();
  fq.flatten(booleanQuery,flatQueries);
  assertCollectionQueries(flatQueries,tq("A"),tq("B"),tq("C"));
}
