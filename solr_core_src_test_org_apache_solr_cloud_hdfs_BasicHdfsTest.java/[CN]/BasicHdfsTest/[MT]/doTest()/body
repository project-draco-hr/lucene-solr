{
  createCollection("delete_data_dir",1,1,1);
  waitForRecoveriesToFinish("delete_data_dir",false);
  cloudClient.setDefaultCollection("delete_data_dir");
  cloudClient.getZkStateReader().updateClusterState(true);
  NamedList<Object> response=cloudClient.query(new SolrQuery().setRequestHandler("/admin/system")).getResponse();
  NamedList<Object> coreInfo=(NamedList<Object>)response.get("core");
  String dataDir=(String)((NamedList<Object>)coreInfo.get("directory")).get("data");
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action",CollectionAction.DELETE.toString());
  params.set("name","delete_data_dir");
  QueryRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  cloudClient.request(request);
  Configuration conf=new Configuration();
  conf.setBoolean("fs.hdfs.impl.disable.cache",true);
  FileSystem fs=FileSystem.newInstance(new URI(dataDir),conf);
  assertFalse("Data directory exists after collection removal : " + dataDir,fs.exists(new Path(dataDir)));
  fs.close();
}
