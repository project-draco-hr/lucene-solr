{
  int numDocs=state.segmentInfo.getDocCount();
  if (numDocs > 0) {
    initFieldsWriter(state.context);
    fill(numDocs);
  }
  if (fieldsWriter != null) {
    try {
      fieldsWriter.finish(state.fieldInfos,numDocs);
    }
  finally {
      fieldsWriter.close();
      fieldsWriter=null;
      lastDocID=0;
    }
  }
}
