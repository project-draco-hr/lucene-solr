{
  if (after == null) {
    return super.searchAfter(after,query,numHits);
  }
  final TopDocs[] shardHits=new TopDocs[nodeVersions.length];
  ScoreDoc shardAfter=new ScoreDoc(after.doc,after.score);
  for (int nodeID=0; nodeID < nodeVersions.length; nodeID++) {
    if (nodeID < after.shardIndex) {
      final NodeState.ShardIndexSearcher s=nodes[nodeID].acquire(nodeVersions);
      try {
        shardAfter.doc=s.getIndexReader().maxDoc() - 1;
      }
  finally {
        nodes[nodeID].release(s);
      }
    }
 else     if (nodeID == after.shardIndex) {
      shardAfter.doc=after.doc;
    }
 else {
      shardAfter.doc=-1;
    }
    if (nodeID == myNodeID) {
      shardHits[nodeID]=localSearchAfter(shardAfter,query,numHits);
    }
 else {
      shardHits[nodeID]=searchNode(nodeID,nodeVersions,query,null,numHits,shardAfter);
    }
  }
  return TopDocs.merge(numHits,shardHits);
}
