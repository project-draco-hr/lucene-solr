{
  final VariableResolverImpl resolver=new VariableResolverImpl();
  ContextImpl context=new ContextImpl(null,resolver,null,Context.FULL_DUMP,Collections.EMPTY_MAP,null,null);
  resolver.context=context;
  final List<Map<String,String>> l=new ArrayList<Map<String,String>>();
  Map<String,String> m=new HashMap<String,String>();
  m.put("name","test");
  m.put("class",E.class.getName());
  l.add(m);
  resolver.addNamespace("dataimporter.functions",EvaluatorBag.getFunctionsNamespace(l,null));
  String s=resolver.replaceTokens("${dataimporter.functions.formatDate('NOW','yyyy-MM-dd HH:mm')}");
  Assert.assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm").format(new Date()),s);
  Assert.assertEquals("Hello World",resolver.replaceTokens("${dataimporter.functions.test('TEST')}"));
}
