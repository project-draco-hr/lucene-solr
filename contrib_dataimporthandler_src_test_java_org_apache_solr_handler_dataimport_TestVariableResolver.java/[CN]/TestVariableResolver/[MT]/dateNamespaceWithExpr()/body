{
  VariableResolverImpl vri=new VariableResolverImpl();
  ContextImpl context=new ContextImpl(null,vri,null,Context.FULL_DUMP,Collections.EMPTY_MAP,null,null);
  Context.CURRENT_CONTEXT.set(context);
  try {
    vri.addNamespace("dataimporter.functions",EvaluatorBag.getFunctionsNamespace(Collections.EMPTY_LIST,null));
    SimpleDateFormat format=new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'Z'");
    format.setTimeZone(TimeZone.getTimeZone("UTC"));
    DateMathParser dmp=new DateMathParser(TimeZone.getDefault(),Locale.getDefault());
    String s=vri.replaceTokens("${dataimporter.functions.formatDate('NOW/DAY','yyyy-MM-dd HH:mm')}");
    Assert.assertEquals(new SimpleDateFormat("yyyy-MM-dd HH:mm").format(dmp.parseMath("/DAY")),s);
  }
  finally {
    Context.CURRENT_CONTEXT.remove();
  }
}
