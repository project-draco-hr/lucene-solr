{
  for (  int partitionSize : partitionSizes) {
    initIndex(partitionSize);
    List<FacetResult> allFacetResults=countFacets(partitionSize,100000,false);
    HashMap<String,Integer> all=new HashMap<String,Integer>();
    int maxNumNodes=0;
    int k=0;
    for (    FacetResult fr : allFacetResults) {
      FacetResultNode topResNode=fr.getFacetResultNode();
      maxNumNodes=Math.max(maxNumNodes,topResNode.getNumSubResults());
      int prevCount=Integer.MAX_VALUE;
      int pos=0;
      for (      FacetResultNode frn : topResNode.getSubResults()) {
        assertTrue("wrong counts order: prev=" + prevCount + " curr="+ frn.getValue(),prevCount >= frn.getValue());
        prevCount=(int)frn.getValue();
        String key=k + "--" + frn.getLabel()+ "=="+ frn.getValue();
        if (VERBOSE) {
          System.out.println(frn.getLabel() + " - " + frn.getValue()+ "  "+ key+ "  "+ pos);
        }
        all.put(key,pos++);
      }
      k++;
    }
    for (int n=1; n < maxNumNodes; n++) {
      if (VERBOSE) {
        System.out.println("-------  verify for " + n + " top results");
      }
      List<FacetResult> someResults=countFacets(partitionSize,n,false);
      k=0;
      for (      FacetResult fr : someResults) {
        FacetResultNode topResNode=fr.getFacetResultNode();
        assertTrue("too many results: n=" + n + " but got "+ topResNode.getNumSubResults(),n >= topResNode.getNumSubResults());
        int pos=0;
        for (        FacetResultNode frn : topResNode.getSubResults()) {
          String key=k + "--" + frn.getLabel()+ "=="+ frn.getValue();
          if (VERBOSE) {
            System.out.println(frn.getLabel() + " - " + frn.getValue()+ "  "+ key+ "  "+ pos);
          }
          Integer origPos=all.get(key);
          assertNotNull("missing in all results: " + frn,origPos);
          assertEquals("wrong order of sub-results!",pos++,origPos.intValue());
        }
        k++;
      }
    }
    closeAll();
  }
}
