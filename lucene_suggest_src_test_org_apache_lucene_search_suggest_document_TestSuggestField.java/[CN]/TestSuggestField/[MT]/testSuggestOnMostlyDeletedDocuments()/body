{
  Analyzer analyzer=new MockAnalyzer(random());
  IndexWriter iw=new IndexWriter(dir,iwcWithSuggestField(analyzer,"suggest_field"));
  int num=Math.min(1000,atLeast(10));
  Document document=new Document();
  for (int i=1; i <= num; i++) {
    document.add(new SuggestField("suggest_field","abc_" + i,i));
    document.add(new IntField("weight_fld",i,Field.Store.YES));
    iw.addDocument(document);
    document.clear();
    if (usually()) {
      iw.commit();
    }
  }
  iw.deleteDocuments(NumericRangeQuery.newIntRange("weight_fld",2,null,true,false));
  DirectoryReader reader=DirectoryReader.open(iw,true);
  SuggestIndexSearcher indexSearcher=new SuggestIndexSearcher(reader);
  PrefixCompletionQuery query=new PrefixCompletionQuery(analyzer,new Term("suggest_field","abc_"));
  TopSuggestDocs suggest=indexSearcher.suggest(query,1);
  assertSuggestions(suggest,new Entry("abc_1",1));
  reader.close();
  iw.close();
}
