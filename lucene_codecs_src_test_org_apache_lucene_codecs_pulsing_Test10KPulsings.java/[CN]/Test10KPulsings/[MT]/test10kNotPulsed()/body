{
  int freqCutoff=TestUtil.nextInt(random(),1,10);
  Codec cp=TestUtil.alwaysPostingsFormat(new Pulsing41PostingsFormat(freqCutoff));
  File f=createTempDir("10knotpulsed");
  BaseDirectoryWrapper dir=newFSDirectory(f);
  dir.setCheckIndexOnClose(false);
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,newIndexWriterConfig(new MockAnalyzer(random())).setCodec(cp));
  Document document=new Document();
  FieldType ft=new FieldType(TextField.TYPE_STORED);
switch (TestUtil.nextInt(random(),0,2)) {
case 0:
    ft.setIndexOptions(IndexOptions.DOCS_ONLY);
  break;
case 1:
ft.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
break;
default :
ft.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS);
break;
}
Field field=newField("field","",ft);
document.add(field);
NumberFormat df=new DecimalFormat("00000",new DecimalFormatSymbols(Locale.ROOT));
final int freq=freqCutoff + 1;
for (int i=0; i < 10050; i++) {
StringBuilder sb=new StringBuilder();
for (int j=0; j < freq; j++) {
sb.append(df.format(i));
sb.append(' ');
}
field.setStringValue(sb.toString());
iw.addDocument(document);
}
IndexReader ir=iw.getReader();
iw.shutdown();
TermsEnum te=MultiFields.getTerms(ir,"field").iterator(null);
DocsEnum de=null;
for (int i=0; i < 10050; i++) {
String expected=df.format(i);
assertEquals(expected,te.next().utf8ToString());
de=TestUtil.docs(random(),te,null,de,DocsEnum.FLAG_NONE);
assertTrue(de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
assertEquals(DocIdSetIterator.NO_MORE_DOCS,de.nextDoc());
}
ir.close();
TestUtil.checkIndex(dir);
dir.close();
}
