{
  SpatialPrefixTree grid=SpatialPrefixTreeFactory.makeSPT(configMap,null,ctx);
  RecursivePrefixTreeStrategy strategy=new RecursivePrefixTreeStrategy(grid,spatialField);
  strategy.setPointsOnly(config.get("spatial.docPointsOnly",false));
  final boolean pruneLeafyBranches=config.get("spatial.pruneLeafyBranches",true);
  if (grid instanceof PackedQuadPrefixTree) {
    ((PackedQuadPrefixTree)grid).setPruneLeafyBranches(pruneLeafyBranches);
    strategy.setPruneLeafyBranches(false);
  }
 else {
    strategy.setPruneLeafyBranches(pruneLeafyBranches);
  }
  int prefixGridScanLevel=config.get("query.spatial.prefixGridScanLevel",-4);
  if (prefixGridScanLevel < 0)   prefixGridScanLevel=grid.getMaxLevels() + prefixGridScanLevel;
  strategy.setPrefixGridScanLevel(prefixGridScanLevel);
  double distErrPct=config.get("spatial.distErrPct",.025);
  strategy.setDistErrPct(distErrPct);
  return strategy;
}
