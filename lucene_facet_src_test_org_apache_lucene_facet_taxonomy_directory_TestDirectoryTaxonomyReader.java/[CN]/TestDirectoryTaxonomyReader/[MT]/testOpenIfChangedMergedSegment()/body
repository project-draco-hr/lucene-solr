{
  Directory dir=newDirectory();
  final IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(new MockAnalyzer(random())).setMergePolicy(new LogByteSizeMergePolicy()));
  DirectoryTaxonomyWriter writer=new DirectoryTaxonomyWriter(dir){
    @Override protected IndexWriter openIndexWriter(    Directory directory,    IndexWriterConfig config) throws IOException {
      return iw;
    }
  }
;
  TaxonomyReader reader=new DirectoryTaxonomyReader(writer);
  assertEquals(1,reader.getSize());
  assertEquals(1,reader.getParallelTaxonomyArrays().parents().length);
  writer.addCategory(new FacetLabel("1"));
  iw.forceMerge(1);
  TaxonomyReader newtr=TaxonomyReader.openIfChanged(reader);
  assertNotNull(newtr);
  reader.close();
  reader=newtr;
  assertEquals(2,reader.getSize());
  assertEquals(2,reader.getParallelTaxonomyArrays().parents().length);
  reader.close();
  writer.close();
  dir.close();
}
