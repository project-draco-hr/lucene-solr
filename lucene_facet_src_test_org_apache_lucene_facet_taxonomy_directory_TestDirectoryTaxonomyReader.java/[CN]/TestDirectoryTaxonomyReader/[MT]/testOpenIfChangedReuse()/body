{
  for (  boolean nrt : new boolean[]{false,true}) {
    Directory dir=newDirectory();
    DirectoryTaxonomyWriter writer=new DirectoryTaxonomyWriter(dir);
    FacetLabel cp_a=new FacetLabel("a");
    writer.addCategory(cp_a);
    if (!nrt)     writer.commit();
    DirectoryTaxonomyReader r1=nrt ? new DirectoryTaxonomyReader(writer) : new DirectoryTaxonomyReader(dir);
    assertEquals(1,r1.getOrdinal(cp_a));
    assertEquals(cp_a,r1.getPath(1));
    FacetLabel cp_b=new FacetLabel("b");
    writer.addCategory(cp_b);
    if (!nrt)     writer.commit();
    DirectoryTaxonomyReader r2=TaxonomyReader.openIfChanged(r1);
    assertNotNull(r2);
    assertEquals(2,r2.getOrdinal(cp_b));
    assertEquals(cp_b,r2.getPath(2));
    assertEquals(TaxonomyReader.INVALID_ORDINAL,r1.getOrdinal(cp_b));
    assertNull(r1.getPath(2));
    r1.close();
    r2.close();
    writer.close();
    dir.close();
  }
}
