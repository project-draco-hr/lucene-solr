{
  Directory dir=null;
  DirectoryTaxonomyWriter ltw=null;
  DirectoryTaxonomyReader ltr=null;
  try {
    dir=newDirectory();
    ltw=new DirectoryTaxonomyWriter(dir);
    ltw.addCategory(new CategoryPath("a"));
    ltw.commit();
    ltr=new DirectoryTaxonomyReader(dir);
    assertNull("Nothing has changed",TaxonomyReader.openIfChanged(ltr));
    ltw.addCategory(new CategoryPath("b"));
    ltw.commit();
    DirectoryTaxonomyReader newtr=TaxonomyReader.openIfChanged(ltr);
    assertNotNull("changes were committed",newtr);
    assertNull("Nothing has changed",TaxonomyReader.openIfChanged(newtr));
    newtr.close();
  }
  finally {
    IOUtils.close(ltw,ltr,dir);
  }
}
