{
  try {
    Stat stat=new Stat();
    byte[] data=zkClient.getData(path,null,stat,true);
    String dataStr=null;
    String dataStrErr=null;
    if (null != data) {
      try {
        dataStr=(new BytesRef(data)).utf8ToString();
      }
 catch (      Exception e) {
        dataStrErr="data is not parsable as a utf8 String: " + e.toString();
      }
    }
    if (ZkStateReader.CLUSTER_STATE.equals(path) && !isTreeView) {
      SortedMap<String,Object> collectionStates=null;
      List<String> children=zkClient.getChildren(ZkStateReader.COLLECTIONS_ZKNODE,null,true);
      java.util.Collections.sort(children);
      for (      String collection : children) {
        String collStatePath=ZkStateReader.getCollectionPath(collection);
        String childDataStr=null;
        try {
          byte[] childData=zkClient.getData(collStatePath,null,null,true);
          if (childData != null) {
            childDataStr=(new BytesRef(childData)).utf8ToString();
          }
        }
 catch (        KeeperException.NoNodeException nne) {
        }
catch (        Exception childErr) {
          log.error("Failed to get " + collStatePath + " due to: "+ childErr);
        }
        if (childDataStr != null) {
          if (collectionStates == null) {
            collectionStates=new TreeMap<>();
            if (dataStr != null)             collectionStates.putAll((Map<String,Object>)ObjectBuilder.fromJSON(dataStr));
          }
          Map<String,Object> extColl=(Map<String,Object>)ObjectBuilder.fromJSON(childDataStr);
          collectionStates.put(collection,extColl.get(collection));
        }
      }
      if (collectionStates != null) {
        CharArr out=new CharArr();
        new JSONWriter(out,2).write(collectionStates);
        dataStr=out.toString();
      }
    }
    json.writeString("znode");
    json.writeNameSeparator();
    json.startObject();
    writeKeyValue(json,"path",path,true);
    json.writeValueSeparator();
    json.writeString("prop");
    json.writeNameSeparator();
    json.startObject();
    writeKeyValue(json,"version",stat.getVersion(),true);
    writeKeyValue(json,"aversion",stat.getAversion(),false);
    writeKeyValue(json,"children_count",stat.getNumChildren(),false);
    writeKeyValue(json,"ctime",time(stat.getCtime()),false);
    writeKeyValue(json,"cversion",stat.getCversion(),false);
    writeKeyValue(json,"czxid",stat.getCzxid(),false);
    writeKeyValue(json,"ephemeralOwner",stat.getEphemeralOwner(),false);
    writeKeyValue(json,"mtime",time(stat.getMtime()),false);
    writeKeyValue(json,"mzxid",stat.getMzxid(),false);
    writeKeyValue(json,"pzxid",stat.getPzxid(),false);
    writeKeyValue(json,"dataLength",stat.getDataLength(),false);
    if (null != dataStrErr) {
      writeKeyValue(json,"dataNote",dataStrErr,false);
    }
    json.endObject();
    if (null != dataStr) {
      writeKeyValue(json,"data",dataStr,false);
    }
    json.endObject();
  }
 catch (  KeeperException e) {
    writeError(500,e.toString());
    return false;
  }
catch (  InterruptedException e) {
    writeError(500,e.toString());
    return false;
  }
  return true;
}
