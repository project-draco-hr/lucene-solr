{
  final String f="bday";
  final String pre="//lst[@name='facet_dates']/lst[@name='" + f + "']";
  assertU(adoc("id","1",f,"1976-07-04T12:08:56.235Z"));
  assertU(adoc("id","2",f,"1976-07-05T00:00:00.000Z"));
  assertU(adoc("id","3",f,"1976-07-15T00:07:67.890Z"));
  assertU(commit());
  assertU(adoc("id","4",f,"1976-07-21T00:07:67.890Z"));
  assertU(adoc("id","5",f,"1976-07-13T12:12:25.255Z"));
  assertU(adoc("id","6",f,"1976-07-03T17:01:23.456Z"));
  assertU(adoc("id","7",f,"1976-07-12T12:12:25.255Z"));
  assertU(adoc("id","8",f,"1976-07-15T15:15:15.155Z"));
  assertU(adoc("id","9",f,"1907-07-12T13:13:23.235Z"));
  assertU(adoc("id","10",f,"1976-07-03T11:02:45.678Z"));
  assertU(commit());
  assertU(adoc("id","11",f,"1907-07-12T12:12:25.255Z"));
  assertU(adoc("id","12",f,"2007-07-30T07:07:07.070Z"));
  assertU(adoc("id","13",f,"1976-07-30T22:22:22.222Z"));
  assertU(adoc("id","14",f,"1976-07-05T22:22:22.222Z"));
  assertU(commit());
  assertQ("check counts for month of facet by day",req("q","*:*","rows","0","facet","true","facet.date",f,"facet.date.start","1976-07-01T00:00:00.000Z","facet.date.end","1976-07-01T00:00:00.000Z+1MONTH","facet.date.gap","+1DAY","facet.date.other","all"),"*[count(" + pre + "/int)=34]",pre + "/int[@name='1976-07-01T00:00:00Z'][.='0'  ]",pre + "/int[@name='1976-07-02T00:00:00Z'][.='0'  ]",pre + "/int[@name='1976-07-03T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-04T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-05T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-06T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-07T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-08T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-09T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-10T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-11T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-12T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-13T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-14T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-15T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-16T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-17T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-18T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-19T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-21T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-22T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-23T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-24T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-25T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-26T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-27T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-28T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-29T00:00:00Z'][.='0']",pre + "/int[@name='1976-07-30T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-31T00:00:00Z'][.='0']",pre + "/int[@name='before' ][.='2']",pre + "/int[@name='after'  ][.='1']",pre + "/int[@name='between'][.='11']");
  assertQ("check counts for month of facet by day with global mincount = 1",req("q","*:*","rows","0","facet","true","facet.date",f,"facet.date.start","1976-07-01T00:00:00.000Z","facet.date.end","1976-07-01T00:00:00.000Z+1MONTH","facet.date.gap","+1DAY","facet.date.other","all","facet.mincount","1"),"*[count(" + pre + "/int)=11]",pre + "/int[@name='1976-07-03T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-04T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-05T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-12T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-13T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-15T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-21T00:00:00Z'][.='1'  ]",pre + "/int[@name='1976-07-30T00:00:00Z'][.='1'  ]",pre + "/int[@name='before' ][.='2']",pre + "/int[@name='after'  ][.='1']",pre + "/int[@name='between'][.='11']");
  assertQ("check counts for month of facet by day with field mincount = 1",req("q","*:*","rows","0","facet","true","facet.date",f,"facet.date.start","1976-07-01T00:00:00.000Z","facet.date.end","1976-07-01T00:00:00.000Z+1MONTH","facet.date.gap","+1DAY","facet.date.other","all","f." + f + ".facet.mincount","2"),"*[count(" + pre + "/int)=7]",pre + "/int[@name='1976-07-03T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-04T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-05T00:00:00Z'][.='2'  ]",pre + "/int[@name='1976-07-15T00:00:00Z'][.='2'  ]",pre + "/int[@name='before' ][.='2']",pre + "/int[@name='after'  ][.='1']",pre + "/int[@name='between'][.='11']");
  assertQ("check hardend=false",req("q","*:*","rows","0","facet","true","facet.date",f,"facet.date.start","1976-07-01T00:00:00.000Z","facet.date.end","1976-07-13T00:00:00.000Z","facet.date.gap","+5DAYS","facet.date.other","all","facet.date.hardend","false"),"*[count(" + pre + "/int)=6]",pre + "/int[@name='1976-07-01T00:00:00Z'][.='5'  ]",pre + "/int[@name='1976-07-06T00:00:00Z'][.='0'  ]",pre + "/int[@name='1976-07-11T00:00:00Z'][.='4'  ]",pre + "/int[@name='before' ][.='2']",pre + "/int[@name='after'  ][.='3']",pre + "/int[@name='between'][.='9']");
  assertQ("check hardend=true",req("q","*:*","rows","0","facet","true","facet.date",f,"facet.date.start","1976-07-01T00:00:00.000Z","facet.date.end","1976-07-13T00:00:00.000Z","facet.date.gap","+5DAYS","facet.date.other","all","facet.date.hardend","true"),"*[count(" + pre + "/int)=6]",pre + "/int[@name='1976-07-01T00:00:00Z'][.='5'  ]",pre + "/int[@name='1976-07-06T00:00:00Z'][.='0'  ]",pre + "/int[@name='1976-07-11T00:00:00Z'][.='1'  ]",pre + "/int[@name='before' ][.='2']",pre + "/int[@name='after'  ][.='6']",pre + "/int[@name='between'][.='6']");
}
