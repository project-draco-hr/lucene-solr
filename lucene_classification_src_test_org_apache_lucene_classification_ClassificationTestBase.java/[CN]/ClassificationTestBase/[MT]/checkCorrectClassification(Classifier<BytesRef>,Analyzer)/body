{
  SlowCompositeReaderWrapper compositeReaderWrapper=null;
  try {
    populateIndex(analyzer);
    compositeReaderWrapper=new SlowCompositeReaderWrapper(indexWriter.getReader());
    classifier.train(compositeReaderWrapper,textFieldName,classFieldName,analyzer);
    String newText="Much is made of what the likes of Facebook, Google and Apple know about users. Truth is, Amazon may know more.";
    ClassificationResult<BytesRef> classificationResult=classifier.assignClass(newText);
    assertNotNull(classificationResult.getAssignedClass());
    assertEquals(new BytesRef("technology"),classificationResult.getAssignedClass());
    assertTrue(classificationResult.getScore() > 0);
  }
  finally {
    if (compositeReaderWrapper != null)     compositeReaderWrapper.close();
  }
}
