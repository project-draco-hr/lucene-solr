{
  AtomicReader compositeReaderWrapper=null;
  try {
    populateIndex(analyzer);
    compositeReaderWrapper=SlowCompositeReaderWrapper.wrap(indexWriter.getReader());
    classifier.train(compositeReaderWrapper,textFieldName,classFieldName,analyzer);
    ClassificationResult<T> classificationResult=classifier.assignClass(inputDoc);
    assertNotNull(classificationResult.getAssignedClass());
    assertEquals("got an assigned class of " + classificationResult.getAssignedClass(),expectedResult,classificationResult.getAssignedClass());
    assertTrue("got a not positive score " + classificationResult.getScore(),classificationResult.getScore() > 0);
  }
  finally {
    if (compositeReaderWrapper != null)     compositeReaderWrapper.close();
  }
}
