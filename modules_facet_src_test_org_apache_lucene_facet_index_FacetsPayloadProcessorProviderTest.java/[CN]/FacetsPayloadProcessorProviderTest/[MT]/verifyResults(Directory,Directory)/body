{
  DirectoryReader reader1=DirectoryReader.open(dir);
  DirectoryTaxonomyReader taxReader=new DirectoryTaxonomyReader(taxDir);
  IndexSearcher searcher=newSearcher(reader1);
  FacetSearchParams fsp=new FacetSearchParams();
  fsp.addFacetRequest(new CountFacetRequest(new CategoryPath("tag"),NUM_DOCS));
  FacetsCollector collector=new FacetsCollector(fsp,reader1,taxReader);
  searcher.search(new MatchAllDocsQuery(),collector);
  FacetResult result=collector.getFacetResults().get(0);
  FacetResultNode node=result.getFacetResultNode();
  for (  FacetResultNode facet : node.getSubResults()) {
    int weight=(int)facet.getValue();
    int label=Integer.parseInt(facet.getLabel().getComponent(1));
    if (VERBOSE) {
      System.out.println(label + ": " + weight);
    }
    assertEquals(NUM_DOCS,weight);
  }
  reader1.close();
  taxReader.close();
}
