{
  BooleanQuery.Builder q=newBooleanQuery(false);
  BooleanQuery.Builder currentQuery=newBooleanQuery(true);
  TermToBytesRefAttribute termAtt=stream.getAttribute(TermToBytesRefAttribute.class);
  BytesRef bytes=termAtt.getBytesRef();
  PositionIncrementAttribute posIncrAtt=stream.getAttribute(PositionIncrementAttribute.class);
  stream.reset();
  while (stream.incrementToken()) {
    termAtt.fillBytesRef();
    if (posIncrAtt.getPositionIncrement() != 0) {
      add(q,currentQuery.build(),operator);
      currentQuery=newBooleanQuery(true);
    }
    currentQuery.add(newTermQuery(new Term(field,BytesRef.deepCopyOf(bytes))),BooleanClause.Occur.SHOULD);
  }
  add(q,currentQuery.build(),operator);
  return q.build();
}
