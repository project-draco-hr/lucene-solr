{
  BooleanQuery q=newBooleanQuery(false);
  Query currentQuery=null;
  TermToBytesRefAttribute termAtt=stream.getAttribute(TermToBytesRefAttribute.class);
  BytesRef bytes=termAtt.getBytesRef();
  PositionIncrementAttribute posIncrAtt=stream.getAttribute(PositionIncrementAttribute.class);
  stream.reset();
  while (stream.incrementToken()) {
    termAtt.fillBytesRef();
    if (posIncrAtt.getPositionIncrement() == 0) {
      if (!(currentQuery instanceof BooleanQuery)) {
        Query t=currentQuery;
        currentQuery=newBooleanQuery(true);
        ((BooleanQuery)currentQuery).add(t,BooleanClause.Occur.SHOULD);
      }
      ((BooleanQuery)currentQuery).add(newTermQuery(new Term(field,BytesRef.deepCopyOf(bytes))),BooleanClause.Occur.SHOULD);
    }
 else {
      if (currentQuery != null) {
        q.add(currentQuery,operator);
      }
      currentQuery=newTermQuery(new Term(field,BytesRef.deepCopyOf(bytes)));
    }
  }
  q.add(currentQuery,operator);
  return q;
}
