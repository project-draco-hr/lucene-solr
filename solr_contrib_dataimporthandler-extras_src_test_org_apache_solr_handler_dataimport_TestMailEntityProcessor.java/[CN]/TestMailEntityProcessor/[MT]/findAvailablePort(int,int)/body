{
  for (int port=min; port < max; port++) {
    try {
      new ServerSocket(port).close();
      return port;
    }
 catch (    IOException e) {
    }
  }
  throw new IllegalStateException("Could not find available port in range " + min + " to "+ max);
}
