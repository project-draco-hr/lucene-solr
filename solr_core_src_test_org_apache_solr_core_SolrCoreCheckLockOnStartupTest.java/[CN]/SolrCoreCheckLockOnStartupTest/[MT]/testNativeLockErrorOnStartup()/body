{
  File indexDir=new File(initCoreDataDir,"index");
  log.info("Acquiring lock on {}",indexDir.getAbsolutePath());
  Directory directory=newFSDirectory(indexDir,new NativeFSLockFactory());
  IndexWriter indexWriter=new IndexWriter(directory,new IndexWriterConfig(null));
  ignoreException("locked");
  try {
    System.setProperty("solr.tests.lockType","native");
    initCore("solrconfig-basic.xml","schema.xml");
    CoreContainer cc=h.getCoreContainer();
    if (checkForCoreInitException(LockObtainFailedException.class))     return;
    fail("Expected " + LockObtainFailedException.class.getSimpleName());
  }
  finally {
    System.clearProperty("solr.tests.lockType");
    unIgnoreException("locked");
    indexWriter.close();
    directory.close();
    deleteCore();
  }
}
