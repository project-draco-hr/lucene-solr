{
  Directory directory=newFSDirectory(new File(dataDir,"index"),new NativeFSLockFactory());
  IndexWriter indexWriter=new IndexWriter(directory,new IndexWriterConfig(Version.LUCENE_40,null));
  try {
    initCore("solrconfig-nativelock.xml","schema.xml");
    fail("Expected " + LockObtainFailedException.class.getSimpleName());
  }
 catch (  Throwable t) {
    assertTrue(t instanceof RuntimeException);
    assertNotNull(t.getCause());
    assertTrue(t.getCause() instanceof RuntimeException);
    assertNotNull(t.getCause().getCause());
    assertTrue(t.getCause().getCause() instanceof LockObtainFailedException);
  }
 finally {
    indexWriter.close();
    directory.close();
    deleteCore();
  }
}
