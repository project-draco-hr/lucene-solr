{
  HttpSolrClient client;
  if (httpSolrClientBuilder != null) {
synchronized (this) {
      client=httpSolrClientBuilder.withBaseSolrUrl(server).withHttpClient(httpClient).build();
    }
  }
 else {
    client=new HttpSolrClient.Builder(server).withHttpClient(httpClient).withResponseParser(parser).build();
  }
  if (requestWriter != null) {
    client.setRequestWriter(requestWriter);
  }
  if (queryParams != null) {
    client.setQueryParams(queryParams);
  }
  return client;
}
