{
  DocValueHolder valueHolder=new DocValueHolder();
  Directory dir=newDirectory();
  final Counter trackBytes=Counter.newCounter();
  DocValuesConsumer w=Floats.getWriter(dir,"test",trackBytes,newIOContext(random),type);
  final int NUM_VALUES=777 + random.nextInt(777);
  final double[] values=new double[NUM_VALUES];
  for (int i=0; i < NUM_VALUES; i++) {
    final double v=type == Type.FLOAT_32 ? random.nextFloat() : random.nextDouble();
    valueHolder.numberValue=values[i]=v;
    w.add(i,valueHolder);
  }
  final int additionalValues=1 + random.nextInt(10);
  w.finish(NUM_VALUES + additionalValues);
  assertEquals(0,trackBytes.get());
  DocValues r=Floats.getValues(dir,"test",NUM_VALUES + additionalValues,newIOContext(random),type);
  for (int iter=0; iter < 2; iter++) {
    Source s=getSource(r);
    for (int i=0; i < NUM_VALUES; i++) {
      assertEquals("" + i,values[i],s.getFloat(i),0.0f);
    }
  }
  r.close();
  dir.close();
}
