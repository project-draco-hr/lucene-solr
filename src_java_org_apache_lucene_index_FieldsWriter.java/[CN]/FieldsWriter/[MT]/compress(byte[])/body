{
  ByteArrayOutputStream bos=new ByteArrayOutputStream(input.length);
  Deflater compressor=new Deflater();
  try {
    compressor.setLevel(Deflater.BEST_COMPRESSION);
    compressor.setInput(input);
    compressor.finish();
    byte[] buf=new byte[1024];
    while (!compressor.finished()) {
      int count=compressor.deflate(buf);
      bos.write(buf,0,count);
    }
  }
  finally {
    compressor.end();
  }
  return bos.toByteArray();
}
