{
  Deflater compressor=new Deflater();
  compressor.setLevel(Deflater.BEST_COMPRESSION);
  compressor.setInput(input);
  compressor.finish();
  ByteArrayOutputStream bos=new ByteArrayOutputStream(input.length);
  byte[] buf=new byte[1024];
  while (!compressor.finished()) {
    int count=compressor.deflate(buf);
    bos.write(buf,0,count);
  }
  compressor.end();
  return bos.toByteArray();
}
