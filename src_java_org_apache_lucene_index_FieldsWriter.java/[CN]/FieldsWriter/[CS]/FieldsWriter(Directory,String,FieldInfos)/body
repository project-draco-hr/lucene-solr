{
  fieldInfos=fn;
  boolean success=false;
  final String fieldsName=segment + "." + IndexFileNames.FIELDS_EXTENSION;
  try {
    fieldsStream=d.createOutput(fieldsName);
    fieldsStream.writeInt(FORMAT_CURRENT);
    success=true;
  }
  finally {
    if (!success) {
      close();
      d.deleteFile(fieldsName);
    }
  }
  success=false;
  final String indexName=segment + "." + IndexFileNames.FIELDS_INDEX_EXTENSION;
  try {
    indexStream=d.createOutput(indexName);
    indexStream.writeInt(FORMAT_CURRENT);
    success=true;
  }
  finally {
    if (!success) {
      close();
      d.deleteFile(fieldsName);
      d.deleteFile(indexName);
    }
  }
  doClose=true;
}
