{
  Random random=random();
  MockDirectoryWrapper dir=newMockDirectory(random,NoLockFactory.INSTANCE);
  IndexWriter writer=initIndex(random,dir,false,false);
  try {
    writer.commit();
  }
  finally {
    writer.close();
  }
  dir.crash();
  IndexReader reader=DirectoryReader.open(dir);
  assertEquals(157,reader.numDocs());
  reader.close();
  dir.close();
}
