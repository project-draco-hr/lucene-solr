{
  Directory dir=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMergePolicy(new LogByteSizeMergePolicy(writer));
  writer.setMaxBufferedDocs(5);
  writer.setUseCompoundFile(false);
  writer.setMergeFactor(100);
  Document doc=new Document();
  doc.add(new Field("content","aaa bbb ccc ddd eee fff ggg hhh iii",Field.Store.YES,Field.Index.ANALYZED,Field.TermVector.WITH_POSITIONS_OFFSETS));
  for (int i=0; i < 60; i++)   writer.addDocument(doc);
  writer.setMaxBufferedDocs(200);
  Document doc2=new Document();
  doc2.add(new Field("content","aaa bbb ccc ddd eee fff ggg hhh iii",Field.Store.YES,Field.Index.NO));
  doc2.add(new Field("content","aaa bbb ccc ddd eee fff ggg hhh iii",Field.Store.YES,Field.Index.NO));
  doc2.add(new Field("content","aaa bbb ccc ddd eee fff ggg hhh iii",Field.Store.YES,Field.Index.NO));
  doc2.add(new Field("content","aaa bbb ccc ddd eee fff ggg hhh iii",Field.Store.YES,Field.Index.NO));
  for (int i=0; i < 10; i++)   writer.addDocument(doc2);
  writer.close();
  Directory dir2=new MockRAMDirectory();
  writer=new IndexWriter(dir2,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  LogByteSizeMergePolicy lmp=new LogByteSizeMergePolicy(writer);
  lmp.setMinMergeMB(0.0001);
  writer.setMergePolicy(lmp);
  writer.setMergeFactor(4);
  writer.setUseCompoundFile(false);
  writer.setMergeScheduler(new SerialMergeScheduler());
  writer.addIndexesNoOptimize(new Directory[]{dir});
  writer.close();
  dir.close();
  dir2.close();
}
