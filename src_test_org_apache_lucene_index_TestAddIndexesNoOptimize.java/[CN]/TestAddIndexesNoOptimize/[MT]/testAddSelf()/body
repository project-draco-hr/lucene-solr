{
  Directory dir=new RAMDirectory();
  Directory aux=new RAMDirectory();
  IndexWriter writer=null;
  writer=newWriter(dir,true);
  addDocs(writer,100);
  assertEquals(100,writer.docCount());
  writer.close();
  writer=newWriter(aux,true);
  writer.setUseCompoundFile(false);
  writer.setMaxBufferedDocs(1000);
  addDocs(writer,40);
  writer.close();
  writer=newWriter(aux,true);
  writer.setUseCompoundFile(false);
  writer.setMaxBufferedDocs(1000);
  addDocs(writer,100);
  writer.close();
  writer=newWriter(dir,false);
  int maxMergeDocs=writer.getMaxMergeDocs();
  writer.setMaxMergeDocs(99);
  try {
    writer.addIndexesNoOptimize(new Directory[]{aux});
    assertTrue(false);
  }
 catch (  IllegalArgumentException e) {
    assertEquals(100,writer.docCount());
  }
  writer.setMaxMergeDocs(maxMergeDocs);
  try {
    writer.addIndexesNoOptimize(new Directory[]{aux,dir});
    assertTrue(false);
  }
 catch (  IllegalArgumentException e) {
    assertEquals(100,writer.docCount());
  }
  writer.close();
  verifyNumDocs(dir,100);
}
