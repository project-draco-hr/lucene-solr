{
  Directory dir=new RAMDirectory();
  Directory aux=new RAMDirectory();
  setUpDirs(dir,aux);
  IndexWriter writer=newWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT).setOpenMode(OpenMode.APPEND).setMaxBufferedDocs(9));
  ((LogMergePolicy)writer.getMergePolicy()).setMergeFactor(4);
  addDocs(writer,2);
  writer.addIndexesNoOptimize(new Directory[]{aux});
  assertEquals(1032,writer.maxDoc());
  assertEquals(2,writer.getSegmentCount());
  assertEquals(1000,writer.getDocCount(0));
  writer.close();
  verifyNumDocs(dir,1032);
}
