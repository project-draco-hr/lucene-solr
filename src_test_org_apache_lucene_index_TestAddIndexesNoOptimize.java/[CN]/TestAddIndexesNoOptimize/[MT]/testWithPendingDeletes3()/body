{
  Directory dir=new RAMDirectory();
  Directory aux=new RAMDirectory();
  setUpDirs(dir,aux);
  IndexWriter writer=newWriter(dir,false);
  for (int i=0; i < 20; i++) {
    Document doc=new Document();
    doc.add(new Field("id","" + (i % 10),Field.Store.NO,Field.Index.UN_TOKENIZED));
    doc.add(new Field("content","bbb " + i,Field.Store.NO,Field.Index.TOKENIZED));
    writer.updateDocument(new Term("id","" + (i % 10)),doc);
  }
  PhraseQuery q=new PhraseQuery();
  q.add(new Term("content","bbb"));
  q.add(new Term("content","14"));
  writer.deleteDocuments(q);
  writer.addIndexesNoOptimize(new Directory[]{aux});
  writer.optimize();
  verifyNumDocs(dir,1039);
  verifyTermDocs(dir,new Term("content","aaa"),1030);
  verifyTermDocs(dir,new Term("content","bbb"),9);
  writer.close();
  dir.close();
  aux.close();
}
