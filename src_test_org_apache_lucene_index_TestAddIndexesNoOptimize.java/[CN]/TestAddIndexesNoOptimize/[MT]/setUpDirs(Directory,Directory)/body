{
  IndexWriter writer=null;
  writer=newWriter(dir,true);
  writer.setMaxBufferedDocs(1000);
  addDocs(writer,1000);
  assertEquals(1000,writer.docCount());
  assertEquals(1,writer.getSegmentCount());
  writer.close();
  writer=newWriter(aux,true);
  writer.setUseCompoundFile(false);
  writer.setMaxBufferedDocs(100);
  writer.setMergeFactor(10);
  for (int i=0; i < 3; i++) {
    addDocs(writer,10);
    writer.close();
    writer=newWriter(aux,false);
    writer.setUseCompoundFile(false);
    writer.setMaxBufferedDocs(100);
    writer.setMergeFactor(10);
  }
  assertEquals(30,writer.docCount());
  assertEquals(3,writer.getSegmentCount());
  writer.close();
}
