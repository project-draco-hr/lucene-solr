{
  Directory dir=newDirectory();
  MockIndexWriter4 w=new MockIndexWriter4(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
  addDoc(w);
  w.doFail=true;
  try {
    w.rollback();
    fail("did not hit intentional RuntimeException");
  }
 catch (  RuntimeException re) {
  }
  w.doFail=false;
  w.rollback();
  dir.close();
}
