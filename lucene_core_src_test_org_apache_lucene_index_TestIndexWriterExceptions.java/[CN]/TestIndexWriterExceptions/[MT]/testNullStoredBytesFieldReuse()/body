{
  Directory dir=newDirectory();
  Analyzer analyzer=new MockAnalyzer(random());
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(analyzer));
  Document doc=new Document();
  Field theField=new StoredField("foo",new BytesRef("hello").bytes);
  doc.add(theField);
  iw.addDocument(doc);
  try {
    byte v[]=null;
    theField.setBytesValue(v);
    iw.addDocument(doc);
    fail("didn't get expected exception");
  }
 catch (  NullPointerException expected) {
  }
  assertNull(iw.getTragicException());
  iw.close();
  DirectoryReader r=DirectoryReader.open(dir);
  assertEquals(1,r.numDocs());
  r.close();
  dir.close();
}
