{
  UOEDirectory uoe=new UOEDirectory();
  Directory d=new MockDirectoryWrapper(random(),uoe);
  IndexWriter iw=new IndexWriter(d,newIndexWriterConfig(null));
  iw.addDocument(new Document());
  iw.shutdown();
  uoe.doFail=true;
  try {
    new IndexWriter(d,newIndexWriterConfig(null));
    fail("should have gotten a UOE");
  }
 catch (  UnsupportedOperationException expected) {
  }
  uoe.doFail=false;
  d.close();
}
