{
  String method=req.getMethod().toUpperCase(Locale.ROOT);
  if ("GET".equals(method) || "HEAD".equals(method) || (("PUT".equals(method) || "DELETE".equals(method)) && (req.getRequestURI().contains("/schema") || req.getRequestURI().contains("/config")))) {
    return parseQueryString(req.getQueryString());
  }
  if ("POST".equals(method)) {
    if (formdata.isFormData(req)) {
      return formdata.parseParamsAndFillStreams(req,streams);
    }
    if (ServletFileUpload.isMultipartContent(req)) {
      return multipart.parseParamsAndFillStreams(req,streams);
    }
    if (req.getContentType() != null) {
      return raw.parseParamsAndFillStreams(req,streams);
    }
    throw new SolrException(ErrorCode.UNSUPPORTED_MEDIA_TYPE,"Must specify a Content-Type header with POST requests");
  }
  throw new SolrException(ErrorCode.BAD_REQUEST,"Unsupported method: " + method + " for request "+ req);
}
