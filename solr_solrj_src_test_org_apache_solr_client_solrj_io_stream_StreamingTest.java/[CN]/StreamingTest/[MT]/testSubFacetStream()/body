{
  indexr(id,"0","level1_s","hello0","level2_s","a","a_i","0","a_f","1");
  indexr(id,"2","level1_s","hello0","level2_s","a","a_i","2","a_f","2");
  indexr(id,"3","level1_s","hello3","level2_s","a","a_i","3","a_f","3");
  indexr(id,"4","level1_s","hello4","level2_s","a","a_i","4","a_f","4");
  indexr(id,"1","level1_s","hello0","level2_s","b","a_i","1","a_f","5");
  indexr(id,"5","level1_s","hello3","level2_s","b","a_i","10","a_f","6");
  indexr(id,"6","level1_s","hello4","level2_s","b","a_i","11","a_f","7");
  indexr(id,"7","level1_s","hello3","level2_s","b","a_i","12","a_f","8");
  indexr(id,"8","level1_s","hello3","level2_s","b","a_i","13","a_f","9");
  indexr(id,"9","level1_s","hello0","level2_s","b","a_i","14","a_f","10");
  commit();
  String zkHost=zkServer.getZkAddress();
  Map paramsA=mapParams("q","*:*","fl","a_i,a_f");
  Bucket[] buckets={new Bucket("level1_s"),new Bucket("level2_s")};
  Metric[] metrics={new SumMetric("a_i"),new CountMetric()};
  FieldComparator[] sorts={new FieldComparator("sum(a_i)",ComparatorOrder.DESCENDING),new FieldComparator("sum(a_i)",ComparatorOrder.DESCENDING)};
  FacetStream facetStream=new FacetStream(zkHost,"collection1",paramsA,buckets,metrics,sorts,100);
  List<Tuple> tuples=getTuples(facetStream);
  assert(tuples.size() == 6);
  Tuple tuple=tuples.get(0);
  String bucket1=tuple.getString("level1_s");
  String bucket2=tuple.getString("level2_s");
  Double sumi=tuple.getDouble("sum(a_i)");
  Double count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello3"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 35);
  assertTrue(count.doubleValue() == 3);
  tuple=tuples.get(1);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello0"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 15);
  assertTrue(count.doubleValue() == 2);
  tuple=tuples.get(2);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello4"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 11);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(3);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello4"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 4);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(4);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello3"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 3);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(5);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello0"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 2);
  assertTrue(count.doubleValue() == 2);
  sorts[0]=new FieldComparator("level1_s",ComparatorOrder.DESCENDING);
  sorts[1]=new FieldComparator("level2_s",ComparatorOrder.DESCENDING);
  facetStream=new FacetStream(zkHost,"collection1",paramsA,buckets,metrics,sorts,100);
  tuples=getTuples(facetStream);
  assert(tuples.size() == 6);
  tuple=tuples.get(0);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello4"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 11);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(1);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello4"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 4);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(2);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello3"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 35);
  assertTrue(count.doubleValue() == 3);
  tuple=tuples.get(3);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello3"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 3);
  assertTrue(count.doubleValue() == 1);
  tuple=tuples.get(4);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello0"));
  assertTrue(bucket2.equals("b"));
  assertTrue(sumi.longValue() == 15);
  assertTrue(count.doubleValue() == 2);
  tuple=tuples.get(5);
  bucket1=tuple.getString("level1_s");
  bucket2=tuple.getString("level2_s");
  sumi=tuple.getDouble("sum(a_i)");
  count=tuple.getDouble("count(*)");
  assertTrue(bucket1.equals("hello0"));
  assertTrue(bucket2.equals("a"));
  assertTrue(sumi.longValue() == 2);
  assertTrue(count.doubleValue() == 2);
  del("*:*");
  commit();
}
