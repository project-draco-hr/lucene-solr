{
  String zkHost=zkServer.getZkAddress();
  StreamContext context=new StreamContext();
  SolrClientCache cache=new SolrClientCache();
  context.setSolrClientCache(cache);
  Map params=new HashMap();
  params.put("q","a_s:hello0");
  params.put("rows","500");
  params.put("fl","id");
  TopicStream topicStream=new TopicStream(zkHost,"collection1","collection1","50000000",1000000,params);
  DaemonStream daemonStream=new DaemonStream(topicStream,"daemon1",1000,500);
  daemonStream.setStreamContext(context);
  daemonStream.open();
  CloudJettyRunner jetty=this.cloudJettys.get(0);
  Map params1=new HashMap();
  params1.put("qt","/get");
  params1.put("ids","50000000");
  params1.put("fl","id");
  int count=0;
  while (count == 0) {
    SolrStream solrStream=new SolrStream(jetty.url,params1);
    List<Tuple> tuples=getTuples(solrStream);
    count=tuples.size();
    if (count > 0) {
      Tuple t=tuples.get(0);
      assertTrue(t.getLong("id") == 50000000);
    }
 else {
      System.out.println("###### Waiting for checkpoint #######:" + count);
    }
  }
  indexr(id,"0","a_s","hello0","a_i","0","a_f","1");
  indexr(id,"2","a_s","hello0","a_i","2","a_f","2");
  indexr(id,"3","a_s","hello0","a_i","3","a_f","3");
  indexr(id,"4","a_s","hello0","a_i","4","a_f","4");
  indexr(id,"1","a_s","hello0","a_i","1","a_f","5");
  commit();
  for (int i=0; i < 5; i++) {
    daemonStream.read();
  }
  indexr(id,"5","a_s","hello0","a_i","4","a_f","4");
  indexr(id,"6","a_s","hello0","a_i","4","a_f","4");
  commit();
  for (int i=0; i < 2; i++) {
    daemonStream.read();
  }
  daemonStream.shutdown();
  Tuple tuple=daemonStream.read();
  assertTrue(tuple.EOF);
  daemonStream.close();
  cache.close();
  del("*:*");
  commit();
}
