{
  IndexReader reader=IndexReader.open(dir,true);
  LuceneTaxonomyReader taxo=new LuceneTaxonomyReader(taxoDir);
  FacetSearchParams fsp=new FacetSearchParams();
  fsp.addFacetRequest(new AssociationIntSumFacetRequest(aint,10));
  fsp.addFacetRequest(new AssociationIntSumFacetRequest(bint,10));
  Query q=new MatchAllDocsQuery();
  FacetsCollector fc=new FacetsCollector(fsp,reader,taxo);
  new IndexSearcher(reader).search(q,fc);
  List<FacetResult> res=fc.getFacetResults();
  assertNotNull("No results!",res);
  assertEquals("Wrong number of results!",2,res.size());
  assertEquals("Wrong count for category 'a'!",200,(int)res.get(0).getFacetResultNode().getValue());
  assertEquals("Wrong count for category 'b'!",150,(int)res.get(1).getFacetResultNode().getValue());
  taxo.close();
  reader.close();
}
