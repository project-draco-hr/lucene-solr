{
  this.root=root;
  indexDir=openDirectory(root.resolve("index"));
  segsPath=root.resolve("segs");
  Files.createDirectories(segsPath);
  IndexWriterConfig iwc=getIndexWriterConfig();
  iwc.setMergePolicy(new ReindexingMergePolicy(iwc.getMergePolicy()));
  if (DEBUG) {
    System.out.println("TEST: use IWC:\n" + iwc);
  }
  w=new IndexWriter(indexDir,iwc);
  w.getConfig().setMergedSegmentWarmer(new IndexWriter.IndexReaderWarmer(){
    @Override public void warm(    LeafReader reader) throws IOException {
      if (DEBUG)       System.out.println(Thread.currentThread().getName() + ": TEST: now warm " + reader);
      getParallelLeafReader(reader,false,getCurrentSchemaGen());
    }
  }
);
  w.commit();
  mgr=new ReaderManager(new ParallelLeafDirectoryReader(DirectoryReader.open(w)));
}
