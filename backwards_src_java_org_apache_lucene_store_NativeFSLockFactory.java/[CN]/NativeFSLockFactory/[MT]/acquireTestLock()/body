{
  if (tested)   return;
  tested=true;
  if (!lockDir.exists()) {
    if (!lockDir.mkdirs())     throw new RuntimeException("Cannot create directory: " + lockDir.getAbsolutePath());
  }
 else   if (!lockDir.isDirectory()) {
    throw new RuntimeException("Found regular file where directory expected: " + lockDir.getAbsolutePath());
  }
  String randomLockName="lucene-" + Long.toString(new Random().nextInt(),Character.MAX_RADIX) + "-test.lock";
  Lock l=makeLock(randomLockName);
  try {
    l.obtain();
    l.release();
  }
 catch (  IOException e) {
    RuntimeException e2=new RuntimeException("Failed to acquire random test lock; please verify filesystem for lock directory '" + lockDir + "' supports locking");
    e2.initCause(e);
    throw e2;
  }
}
