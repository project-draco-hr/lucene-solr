{
  byte[] lower=encode(minLatitude,minLongitude);
  byte[] upper=encode(maxLatitude,maxLongitude);
  if (maxLongitude < minLongitude) {
    BooleanQuery.Builder q=new BooleanQuery.Builder();
    q.setDisableCoord(true);
    byte[] leftOpen=lower.clone();
    NumericUtils.intToSortableBytes(Integer.MIN_VALUE,leftOpen,Integer.BYTES);
    Query left=newBoxInternal(field,leftOpen,upper);
    q.add(new BooleanClause(left,BooleanClause.Occur.SHOULD));
    byte[] rightOpen=upper.clone();
    NumericUtils.intToSortableBytes(Integer.MAX_VALUE,rightOpen,Integer.BYTES);
    Query right=newBoxInternal(field,lower,rightOpen);
    q.add(new BooleanClause(right,BooleanClause.Occur.SHOULD));
    return new ConstantScoreQuery(q.build());
  }
 else {
    return newBoxInternal(field,lower,upper);
  }
}
