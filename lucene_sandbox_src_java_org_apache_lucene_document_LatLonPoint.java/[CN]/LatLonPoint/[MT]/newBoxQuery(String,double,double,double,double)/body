{
  if (minLatitude == 90.0) {
    return new MatchNoDocsQuery("LatLonPoint.newBoxQuery with minLatitude=90.0");
  }
  if (minLongitude == 180.0) {
    if (maxLongitude == 180.0) {
      return new MatchNoDocsQuery("LatLonPoint.newBoxQuery with minLongitude=maxLongitude=180.0");
    }
 else     if (maxLongitude < minLongitude) {
      minLongitude=-180.0;
    }
  }
  byte[] lower=encodeCeil(minLatitude,minLongitude);
  byte[] upper=encode(maxLatitude,maxLongitude);
  if (maxLongitude < minLongitude) {
    BooleanQuery.Builder q=new BooleanQuery.Builder();
    byte[] leftOpen=lower.clone();
    NumericUtils.intToSortableBytes(Integer.MIN_VALUE,leftOpen,Integer.BYTES);
    Query left=newBoxInternal(field,leftOpen,upper);
    q.add(new BooleanClause(left,BooleanClause.Occur.SHOULD));
    byte[] rightOpen=upper.clone();
    NumericUtils.intToSortableBytes(Integer.MAX_VALUE,rightOpen,Integer.BYTES);
    Query right=newBoxInternal(field,lower,rightOpen);
    q.add(new BooleanClause(right,BooleanClause.Occur.SHOULD));
    return new ConstantScoreQuery(q.build());
  }
 else {
    return newBoxInternal(field,lower,upper);
  }
}
