{
  NamedList<NamedList<Object>> tokens=new NamedList<NamedList<Object>>();
  CharTermAttribute termAtt=null;
  TermToBytesRefAttribute bytesAtt=null;
  if (tstream.hasAttribute(CharTermAttribute.class)) {
    termAtt=tstream.getAttribute(CharTermAttribute.class);
  }
 else   if (tstream.hasAttribute(TermToBytesRefAttribute.class)) {
    bytesAtt=tstream.getAttribute(TermToBytesRefAttribute.class);
  }
  final OffsetAttribute offsetAtt=tstream.addAttribute(OffsetAttribute.class);
  final TypeAttribute typeAtt=tstream.addAttribute(TypeAttribute.class);
  final PositionIncrementAttribute posIncAtt=tstream.addAttribute(PositionIncrementAttribute.class);
  final BytesRef bytes=new BytesRef();
  while (tstream.incrementToken()) {
    NamedList<Object> token=new SimpleOrderedMap<Object>();
    tokens.add("token",token);
    if (termAtt != null) {
      token.add("value",termAtt.toString());
    }
    if (bytesAtt != null) {
      bytesAtt.toBytesRef(bytes);
      token.add("value",bytes.utf8ToString());
    }
    token.add("start",offsetAtt.startOffset());
    token.add("end",offsetAtt.endOffset());
    token.add("posInc",posIncAtt.getPositionIncrement());
    token.add("type",typeAtt.type());
  }
  return tokens;
}
