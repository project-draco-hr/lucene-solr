{
  SolrCore core=h.getCore();
  UpdateHandler updater=core.getUpdateHandler();
  AddUpdateCommand cmd=new AddUpdateCommand();
  cmd.overwriteCommitted=true;
  cmd.overwritePending=true;
  cmd.allowDups=false;
  cmd.doc=new Document();
  cmd.doc.add(new Field("id","AAA",Store.YES,Index.UN_TOKENIZED));
  cmd.doc.add(new Field("subject","xxxxx",Store.YES,Index.UN_TOKENIZED));
  updater.addDoc(cmd);
  cmd.indexedId=null;
  cmd.doc=new Document();
  cmd.doc.add(new Field("id","AAA",Store.YES,Index.UN_TOKENIZED));
  cmd.doc.add(new Field("id","BBB",Store.YES,Index.UN_TOKENIZED));
  cmd.doc.add(new Field("subject","xxxxx",Store.YES,Index.UN_TOKENIZED));
  try {
    updater.addDoc(cmd);
    fail("added a document with multiple ids");
  }
 catch (  SolrException ex) {
  }
  cmd.indexedId=null;
  cmd.doc=new Document();
  cmd.doc.add(new Field("subject","xxxxx",Store.YES,Index.UN_TOKENIZED));
  try {
    updater.addDoc(cmd);
    fail("added a document without an ids");
  }
 catch (  SolrException ex) {
  }
}
