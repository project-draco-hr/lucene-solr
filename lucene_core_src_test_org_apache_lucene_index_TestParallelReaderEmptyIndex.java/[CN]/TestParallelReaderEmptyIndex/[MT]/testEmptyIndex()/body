{
  Directory rd1=newDirectory();
  IndexWriter iw=new IndexWriter(rd1,newIndexWriterConfig(new MockAnalyzer(random())));
  iw.close();
  Directory rd2=newDirectory(rd1);
  Directory rdOut=newDirectory();
  IndexWriter iwOut=new IndexWriter(rdOut,newIndexWriterConfig(new MockAnalyzer(random())));
  ParallelLeafReader apr=new ParallelLeafReader(SlowCompositeReaderWrapper.wrap(DirectoryReader.open(rd1)),SlowCompositeReaderWrapper.wrap(DirectoryReader.open(rd2)));
  iwOut.addIndexes(apr);
  iwOut.forceMerge(1);
  iwOut.addIndexes(new ParallelLeafReader());
  iwOut.forceMerge(1);
  ParallelCompositeReader cpr=new ParallelCompositeReader(DirectoryReader.open(rd1),DirectoryReader.open(rd2));
  List<LeafReader> leaves=new ArrayList<>();
  for (  LeafReaderContext leaf : cpr.leaves()) {
    leaves.add(leaf.reader());
  }
  iwOut.addIndexes(leaves.toArray(new LeafReader[0]));
  iwOut.forceMerge(1);
  iwOut.close();
  rdOut.close();
  rd1.close();
  rd2.close();
}
