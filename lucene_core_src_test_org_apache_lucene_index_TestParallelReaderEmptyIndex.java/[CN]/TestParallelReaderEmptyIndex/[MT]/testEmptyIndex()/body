{
  Directory rd1=newDirectory();
  IndexWriter iw=new IndexWriter(rd1,newIndexWriterConfig(new MockAnalyzer(random())));
  iw.close();
  Directory rd2=newDirectory(rd1);
  Directory rdOut=newDirectory();
  IndexWriter iwOut=new IndexWriter(rdOut,newIndexWriterConfig(new MockAnalyzer(random())));
  ParallelLeafReader apr=new ParallelLeafReader(SlowCompositeReaderWrapper.wrap(DirectoryReader.open(rd1)),SlowCompositeReaderWrapper.wrap(DirectoryReader.open(rd2)));
  iwOut.addIndexes(SlowCodecReaderWrapper.wrap(apr));
  iwOut.forceMerge(1);
  iwOut.addIndexes(SlowCodecReaderWrapper.wrap(new ParallelLeafReader()));
  iwOut.forceMerge(1);
  ParallelCompositeReader cpr=new ParallelCompositeReader(DirectoryReader.open(rd1),DirectoryReader.open(rd2));
  List<CodecReader> leaves=new ArrayList<>();
  for (  LeafReaderContext leaf : cpr.leaves()) {
    leaves.add(SlowCodecReaderWrapper.wrap(leaf.reader()));
  }
  iwOut.addIndexes(leaves.toArray(new CodecReader[0]));
  iwOut.forceMerge(1);
  iwOut.close();
  rdOut.close();
  rd1.close();
  rd2.close();
}
