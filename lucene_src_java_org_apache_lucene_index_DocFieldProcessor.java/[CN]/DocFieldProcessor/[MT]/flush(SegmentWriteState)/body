{
  Map<FieldInfo,DocFieldConsumerPerField> childFields=new HashMap<FieldInfo,DocFieldConsumerPerField>();
  Collection<DocFieldConsumerPerField> fields=fields();
  for (  DocFieldConsumerPerField f : fields) {
    childFields.put(f.getFieldInfo(),f);
  }
  fieldsWriter.flush(state);
  consumer.flush(childFields,state);
  final String fileName=IndexFileNames.segmentFileName(state.segmentName,"",IndexFileNames.FIELD_INFOS_EXTENSION);
  if (!state.hasVectors) {
    state.fieldInfos.clearVectors();
  }
  state.fieldInfos.write(state.directory,fileName);
}
