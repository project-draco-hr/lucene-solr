{
  final int maxDoc=reader.maxDoc();
  int[][][] dpf=new int[maxDoc][][];
  int numPartitions=(int)Math.ceil(taxo.getSize() / (double)iparams.getPartitionSize());
  IntsRef ordinals=new IntsRef(32);
  for (int part=0; part < numPartitions; part++) {
    CategoryListIterator cli=clp.createCategoryListIterator(reader,part);
    if (cli.init()) {
      for (int doc=0; doc < maxDoc; doc++) {
        cli.getOrdinals(doc,ordinals);
        if (ordinals.length > 0) {
          if (dpf[doc] == null) {
            dpf[doc]=new int[numPartitions][];
          }
          dpf[doc][part]=new int[ordinals.length];
          for (int i=0; i < ordinals.length; i++) {
            dpf[doc][part][i]=ordinals.ints[i];
          }
        }
      }
    }
  }
  docPartitionCategories=dpf;
}
