{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,null));
  final AtomicBoolean afterRefreshCalled=new AtomicBoolean(false);
  SearcherManager sm=new SearcherManager(iw,false,new SearcherFactory());
  sm.addListener(new ReferenceManager.RefreshListener(){
    @Override public void afterRefresh(){
      afterRefreshCalled.set(true);
    }
  }
);
  iw.addDocument(new Document());
  iw.commit();
  assertFalse(afterRefreshCalled.get());
  sm.maybeRefreshBlocking();
  assertTrue(afterRefreshCalled.get());
  sm.close();
  iw.close();
  dir.close();
}
