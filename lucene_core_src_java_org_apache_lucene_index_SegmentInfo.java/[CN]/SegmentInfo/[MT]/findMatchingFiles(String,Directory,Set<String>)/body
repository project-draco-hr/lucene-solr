{
  List<String> files=new ArrayList<String>();
  final String[] existingFiles;
  try {
    existingFiles=dir.listAll();
  }
 catch (  IOException ioe) {
    throw new RuntimeException(ioe);
  }
  List<Pattern> compiledPatterns=new ArrayList<Pattern>();
  for (  String nameOrPattern : namesOrPatterns) {
    boolean exists=false;
    if (nameOrPattern == null) {
      continue;
    }
    try {
      exists=dir.fileExists(nameOrPattern);
    }
 catch (    IOException ioe) {
    }
    if (exists) {
      files.add(nameOrPattern);
    }
 else {
      compiledPatterns.add(Pattern.compile(nameOrPattern));
    }
  }
  for (  String file : existingFiles) {
    if (file.startsWith(segmentName)) {
      for (      Pattern pattern : compiledPatterns) {
        if (pattern.matcher(file).matches()) {
          files.add(file);
          break;
        }
      }
    }
  }
  return files;
}
