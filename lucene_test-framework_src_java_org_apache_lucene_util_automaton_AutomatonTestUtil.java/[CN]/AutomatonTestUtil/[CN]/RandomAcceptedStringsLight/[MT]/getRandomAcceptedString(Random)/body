{
  final List<Integer> soFar=new ArrayList<>();
  int s=0;
  while (true) {
    if (a.isAccept(s)) {
      if (a.getNumTransitions(s) == 0) {
        break;
      }
 else {
        if (r.nextBoolean()) {
          break;
        }
      }
    }
    if (a.getNumTransitions(s) == 0) {
      throw new RuntimeException("this automaton has dead states");
    }
    boolean cheat=r.nextBoolean();
    final Transition t;
    if (cheat) {
      List<Transition> toAccept=new ArrayList<>();
      for (      Transition t0 : transitions[s]) {
        if (leadsToAccept.containsKey(t0)) {
          toAccept.add(t0);
        }
      }
      if (toAccept.size() == 0) {
        t=transitions[s][r.nextInt(transitions[s].length)];
      }
 else {
        t=toAccept.get(r.nextInt(toAccept.size()));
      }
    }
 else {
      t=transitions[s][r.nextInt(transitions[s].length)];
    }
    soFar.add(getRandomCodePoint(r,t.min,t.max));
    s=t.dest;
  }
  return ArrayUtil.toIntArray(soFar);
}
