{
  final int numDims=TestUtil.nextInt(random(),1,8);
  final int bytesPerDim=TestUtil.nextInt(random(),1,16);
  final int maxDoc=TestUtil.nextInt(random(),1,1 << random().nextInt(30));
  Point[] points=createRandomPoints(numDims,bytesPerDim,maxDoc);
  int commonPrefixLength=TestUtil.nextInt(random(),0,bytesPerDim);
  final int splitDim=random().nextInt(numDims);
  BytesRef firstValue=points[0].packedValue;
  for (int i=1; i < points.length; ++i) {
    BytesRef packedValue=points[i].packedValue;
    int offset=splitDim * bytesPerDim;
    System.arraycopy(firstValue.bytes,firstValue.offset + offset,packedValue.bytes,packedValue.offset + offset,commonPrefixLength);
  }
  DummyPointsReader reader=new DummyPointsReader(points);
  final int pivot=TestUtil.nextInt(random(),0,points.length - 1);
  MutablePointsReaderUtils.partition(maxDoc,splitDim,bytesPerDim,commonPrefixLength,reader,0,points.length,pivot,new BytesRef(),new BytesRef());
  BytesRef pivotValue=reader.points[pivot].packedValue;
  int offset=splitDim * bytesPerDim;
  for (int i=0; i < points.length; ++i) {
    BytesRef value=reader.points[i].packedValue;
    int cmp=StringHelper.compare(bytesPerDim,value.bytes,value.offset + offset,pivotValue.bytes,pivotValue.offset + offset);
    if (cmp == 0) {
      cmp=reader.points[i].doc - reader.points[pivot].doc;
    }
    if (i < pivot) {
      assertTrue(cmp <= 0);
    }
 else     if (i > pivot) {
      assertTrue(cmp >= 0);
    }
 else {
      assertEquals(0,cmp);
    }
  }
}
