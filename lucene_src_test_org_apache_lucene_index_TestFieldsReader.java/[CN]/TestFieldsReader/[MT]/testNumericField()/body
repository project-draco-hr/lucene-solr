{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random,dir);
  final int numDocs=atLeast(500);
  final Number[] answers=new Number[numDocs];
  final NumericField.DataType[] typeAnswers=new NumericField.DataType[numDocs];
  for (int id=0; id < numDocs; id++) {
    Document doc=new Document();
    final NumericField nf;
    final Number answer;
    final NumericField.DataType typeAnswer;
    if (random.nextBoolean()) {
      if (random.nextBoolean()) {
        final float f=random.nextFloat();
        answer=Float.valueOf(f);
        nf=new NumericField("nf",answer,NumericField.getFieldType(NumericField.DataType.FLOAT,true));
        typeAnswer=NumericField.DataType.FLOAT;
      }
 else {
        final double d=random.nextDouble();
        answer=Double.valueOf(d);
        nf=new NumericField("nf",answer,NumericField.getFieldType(NumericField.DataType.DOUBLE,true));
        typeAnswer=NumericField.DataType.DOUBLE;
      }
    }
 else {
      if (random.nextBoolean()) {
        final int i=random.nextInt();
        answer=Integer.valueOf(i);
        nf=new NumericField("nf",answer,NumericField.getFieldType(NumericField.DataType.INT,true));
        typeAnswer=NumericField.DataType.INT;
      }
 else {
        final long l=random.nextLong();
        answer=Long.valueOf(l);
        nf=new NumericField("nf",answer,NumericField.getFieldType(NumericField.DataType.LONG,true));
        typeAnswer=NumericField.DataType.LONG;
      }
    }
    doc.add(nf);
    answers[id]=answer;
    typeAnswers[id]=typeAnswer;
    FieldType ft=new FieldType(NumericField.getFieldType(NumericField.DataType.INT,false));
    ft.setNumericPrecisionStep(Integer.MAX_VALUE);
    doc.add(new NumericField("id",id,ft));
    w.addDocument(doc);
  }
  final DirectoryReader r=w.getReader();
  w.close();
  assertEquals(numDocs,r.numDocs());
  for (  IndexReader sub : r.getSequentialSubReaders()) {
    final int[] ids=FieldCache.DEFAULT.getInts((AtomicReader)sub,"id",false);
    for (int docID=0; docID < sub.numDocs(); docID++) {
      final Document doc=sub.document(docID);
      final Field f=(Field)doc.getField("nf");
      assertTrue("got f=" + f,f instanceof StoredField);
      assertEquals(answers[ids[docID]],f.numericValue());
    }
  }
  r.close();
  dir.close();
}
