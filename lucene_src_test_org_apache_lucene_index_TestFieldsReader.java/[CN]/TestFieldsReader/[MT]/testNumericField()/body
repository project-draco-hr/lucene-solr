{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random,dir);
  final int numDocs=atLeast(500);
  final Number[] answers=new Number[numDocs];
  final NumericField.DataType[] typeAnswers=new NumericField.DataType[numDocs];
  for (int id=0; id < numDocs; id++) {
    Document doc=new Document();
    NumericField nf=new NumericField("nf",NumericField.TYPE_STORED);
    doc.add(nf);
    final Number answer;
    final NumericField.DataType typeAnswer;
    if (random.nextBoolean()) {
      if (random.nextBoolean()) {
        final float f=random.nextFloat();
        nf.setFloatValue(f);
        answer=Float.valueOf(f);
        typeAnswer=NumericField.DataType.FLOAT;
      }
 else {
        final double d=random.nextDouble();
        nf.setDoubleValue(d);
        answer=Double.valueOf(d);
        typeAnswer=NumericField.DataType.DOUBLE;
      }
    }
 else {
      if (random.nextBoolean()) {
        final int i=random.nextInt();
        nf.setIntValue(i);
        answer=Integer.valueOf(i);
        typeAnswer=NumericField.DataType.INT;
      }
 else {
        final long l=random.nextLong();
        nf.setLongValue(l);
        answer=Long.valueOf(l);
        typeAnswer=NumericField.DataType.LONG;
      }
    }
    answers[id]=answer;
    typeAnswers[id]=typeAnswer;
    doc.add(new NumericField("id",Integer.MAX_VALUE).setIntValue(id));
    w.addDocument(doc);
  }
  final IndexReader r=w.getReader();
  w.close();
  assertEquals(numDocs,r.numDocs());
  for (  IndexReader sub : r.getSequentialSubReaders()) {
    final int[] ids=FieldCache.DEFAULT.getInts(sub,"id");
    for (int docID=0; docID < sub.numDocs(); docID++) {
      final Document doc=sub.document(docID);
      final Field f=(Field)doc.getField("nf");
      assertTrue("got f=" + f,f instanceof NumericField);
      final NumericField nf=(NumericField)f;
      assertEquals(answers[ids[docID]],nf.numericValue());
      assertSame(typeAnswers[ids[docID]],nf.numericDataType());
    }
  }
  r.close();
  dir.close();
}
