{
  String ids="-" + id;
  IndexCommit last=null;
  Collection commits=IndexReader.listCommits(dir);
  for (Iterator iterator=commits.iterator(); iterator.hasNext(); ) {
    IndexCommit commit=(IndexCommit)iterator.next();
    Map ud=commit.getUserData();
    if (ud.size() > 0)     if (((String)ud.get("index")).endsWith(ids))     last=commit;
  }
  if (last == null)   throw new RuntimeException("Couldn't find commit point " + id);
  IndexWriter w=new IndexWriter(dir,new WhitespaceAnalyzer(),new RollbackDeletionPolicy(id),MaxFieldLength.UNLIMITED,last);
  Map data=new HashMap();
  data.put("index","Rolled back to 1-" + id);
  w.commit(data);
  w.close();
}
