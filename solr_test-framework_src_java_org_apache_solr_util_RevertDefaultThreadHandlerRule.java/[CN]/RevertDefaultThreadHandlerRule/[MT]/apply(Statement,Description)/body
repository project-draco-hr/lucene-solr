{
  return new StatementAdapter(s){
    @Override protected void before() throws Throwable {
      if (!applied.getAndSet(true)) {
        UncaughtExceptionHandler p=Thread.getDefaultUncaughtExceptionHandler();
        try {
          Class<?> cl=org.apache.zookeeper.server.NIOServerCnxn.Factory.class;
          Class.forName(cl.getName(),true,cl.getClassLoader());
        }
  finally {
          if (p == Thread.getDefaultUncaughtExceptionHandler()) {
            throw new RuntimeException("Zookeeper no longer resets default thread handler.");
          }
          Thread.setDefaultUncaughtExceptionHandler(p);
        }
      }
    }
  }
;
}
