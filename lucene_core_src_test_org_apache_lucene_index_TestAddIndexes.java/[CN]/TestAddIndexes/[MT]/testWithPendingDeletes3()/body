{
  Directory dir=newDirectory();
  Directory aux=newDirectory();
  setUpDirs(dir,aux);
  IndexWriter writer=newWriter(dir,newIndexWriterConfig(new MockAnalyzer(random())).setOpenMode(OpenMode.APPEND));
  for (int i=0; i < 20; i++) {
    Document doc=new Document();
    doc.add(newStringField("id","" + (i % 10),Field.Store.NO));
    doc.add(newTextField("content","bbb " + i,Field.Store.NO));
    writer.updateDocument(new Term("id","" + (i % 10)),doc);
  }
  PhraseQuery q=new PhraseQuery("content","bbb","14");
  writer.deleteDocuments(q);
  writer.addIndexes(aux);
  writer.forceMerge(1);
  writer.commit();
  verifyNumDocs(dir,1039);
  verifyTermDocs(dir,new Term("content","aaa"),1030);
  verifyTermDocs(dir,new Term("content","bbb"),9);
  writer.close();
  dir.close();
  aux.close();
}
