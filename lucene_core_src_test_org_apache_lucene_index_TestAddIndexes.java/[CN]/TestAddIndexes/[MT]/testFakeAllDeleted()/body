{
  Directory src=newDirectory(), dest=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),src);
  w.addDocument(new Document());
  IndexReader allDeletedReader=new AllDeletedFilterReader(w.getReader().leaves().get(0).reader());
  w.close();
  w=new RandomIndexWriter(random(),dest);
  w.addIndexes(allDeletedReader);
  w.close();
  DirectoryReader dr=DirectoryReader.open(src);
  for (  AtomicReaderContext ctx : dr.leaves()) {
    assertTrue("empty segments should be dropped by addIndexes",ctx.reader().maxDoc() > 0);
  }
  dr.close();
  allDeletedReader.close();
  src.close();
  dest.close();
}
