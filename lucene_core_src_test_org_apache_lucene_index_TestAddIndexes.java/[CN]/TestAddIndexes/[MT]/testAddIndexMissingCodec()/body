{
  BaseDirectoryWrapper toAdd=newDirectory();
  toAdd.setCheckIndexOnClose(false);
{
    IndexWriterConfig conf=newIndexWriterConfig(new MockAnalyzer(random()));
    conf.setCodec(new UnRegisteredCodec());
    IndexWriter w=new IndexWriter(toAdd,conf);
    Document doc=new Document();
    FieldType customType=new FieldType();
    customType.setIndexed(true);
    doc.add(newField("foo","bar",customType));
    w.addDocument(doc);
    w.shutdown();
  }
{
    Directory dir=newDirectory();
    IndexWriterConfig conf=newIndexWriterConfig(new MockAnalyzer(random()));
    conf.setCodec(TestUtil.alwaysPostingsFormat(new Pulsing41PostingsFormat(1 + random().nextInt(20))));
    IndexWriter w=new IndexWriter(dir,conf);
    try {
      w.addIndexes(toAdd);
      fail("no such codec");
    }
 catch (    IllegalArgumentException ex) {
    }
    w.shutdown();
    IndexReader open=DirectoryReader.open(dir);
    assertEquals(0,open.numDocs());
    open.close();
    dir.close();
  }
  try {
    DirectoryReader.open(toAdd);
    fail("no such codec");
  }
 catch (  IllegalArgumentException ex) {
  }
  toAdd.close();
}
