{
  Analyzer analyzer=new MockAnalyzer(random());
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwcWithSuggestField(analyzer,"suggest_field"));
  Document document=new Document();
  document.add(new IntField("filter_int_fld",9,Field.Store.NO));
  document.add(new SuggestField("suggest_field","apples",3));
  iw.addDocument(document);
  document=new Document();
  document.add(new IntField("filter_int_fld",10,Field.Store.NO));
  document.add(new SuggestField("suggest_field","applle",4));
  iw.addDocument(document);
  document=new Document();
  document.add(new IntField("filter_int_fld",4,Field.Store.NO));
  document.add(new SuggestField("suggest_field","apple",5));
  iw.addDocument(document);
  if (rarely()) {
    iw.commit();
  }
  DirectoryReader reader=iw.getReader();
  SuggestIndexSearcher indexSearcher=new SuggestIndexSearcher(reader);
  PrefixCompletionQuery query=new PrefixCompletionQuery(analyzer,new Term("suggest_field","app"));
  TopSuggestDocs suggest=indexSearcher.suggest(query,3);
  assertSuggestions(suggest,new Entry("apple",5),new Entry("applle",4),new Entry("apples",3));
  QueryWrapperFilter filterWrapper=new QueryWrapperFilter(NumericRangeQuery.newIntRange("filter_int_fld",5,12,true,true));
  Filter filter=randomAccessFilter(filterWrapper);
  query=new PrefixCompletionQuery(analyzer,new Term("suggest_field","app"),filter);
  suggest=indexSearcher.suggest(query,3);
  assertSuggestions(suggest,new Entry("applle",4),new Entry("apples",3));
  reader.close();
  iw.close();
}
