{
  if (!exists(directory))   throw new IOException("File does not exist: " + getName());
  Cursor cursor=null;
  try {
    try {
      byte[] bytes=getKey();
      int ulen=bytes.length + 8;
      byte[] cursorBytes=new byte[ulen];
      DatabaseEntry cursorKey=new DatabaseEntry(cursorBytes);
      DatabaseEntry cursorData=new DatabaseEntry(null);
      Database files=directory.files;
      Database blocks=directory.blocks;
      Transaction txn=directory.txn;
      System.arraycopy(bytes,0,cursorBytes,0,bytes.length);
      cursorData.setPartial(true);
      cursor=blocks.openCursor(txn,null);
      if (cursor.getSearchKey(cursorKey,cursorData,null) != OperationStatus.NOTFOUND) {
        cursor.delete();
        advance:         while (cursor.getNext(cursorKey,cursorData,null) != OperationStatus.NOTFOUND) {
          byte[] temp=cursorKey.getData();
          for (int i=0; i < bytes.length; i++)           if (bytes[i] != temp[i]) {
            break advance;
          }
          cursor.delete();
        }
      }
      files.delete(txn,key);
    }
  finally {
      if (cursor != null)       cursor.close();
    }
  }
 catch (  DatabaseException e) {
    throw new IOException(e.getMessage());
  }
}
