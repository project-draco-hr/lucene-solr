{
  if (explicitRefresh) {
    reader.updateClusterState();
    return reader.getClusterState().getZkClusterStateVersion();
  }
  for (int i=0; i < 100; ++i) {
    int newStateVersion=reader.getClusterState().getZkClusterStateVersion();
    if (newStateVersion > trackedStateVersion) {
      return newStateVersion;
    }
    Thread.sleep(100);
  }
  throw new AssertionError("Did not observe expected update");
}
