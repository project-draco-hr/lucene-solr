{
  IOException ioe=null;
  try {
    final long dirStart=out.getFilePointer();
    final long indexDirStart=indexOut.getFilePointer();
    out.writeVInt(fields.size());
    for (    FieldMetaData field : fields) {
      out.writeVInt(field.fieldInfo.number);
      out.writeVLong(field.numTerms);
      out.writeVInt(field.rootCode.length);
      out.writeBytes(field.rootCode.bytes,field.rootCode.offset,field.rootCode.length);
      if (field.fieldInfo.getIndexOptions() != IndexOptions.DOCS_ONLY) {
        out.writeVLong(field.sumTotalTermFreq);
      }
      out.writeVLong(field.sumDocFreq);
      out.writeVInt(field.docCount);
      if (TERMS_VERSION_CURRENT >= TERMS_VERSION_META_ARRAY) {
        out.writeVInt(field.longsSize);
      }
      indexOut.writeVLong(field.indexStartFP);
    }
    writeTrailer(out,dirStart);
    writeIndexTrailer(indexOut,indexDirStart);
  }
 catch (  IOException ioe2) {
    ioe=ioe2;
  }
 finally {
    IOUtils.closeWhileHandlingException(ioe,out,indexOut,postingsWriter);
  }
}
