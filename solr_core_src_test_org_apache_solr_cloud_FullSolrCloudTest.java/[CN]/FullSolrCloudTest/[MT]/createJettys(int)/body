{
  List<JettySolrRunner> jettys=new ArrayList<JettySolrRunner>();
  List<SolrServer> clients=new ArrayList<SolrServer>();
  StringBuilder sb=new StringBuilder();
  for (int i=1; i <= numJettys; i++) {
    if (sb.length() > 0)     sb.append(',');
    JettySolrRunner j=createJetty(testDir,testDir + "/jetty" + this.jettyIntCntr.incrementAndGet(),null,"solrconfig.xml",null);
    jettys.add(j);
    SolrServer client=createNewSolrServer(j.getLocalPort());
    clients.add(client);
  }
  initCloud();
  this.jettys.addAll(jettys);
  this.clients.addAll(clients);
  updateMappingsFromZk(this.jettys,this.clients);
  for (int i=1; i <= numJettys / 2; i++) {
    JettySolrRunner j=this.jettys.get(i);
    JettySolrRunner j2=this.jettys.get(i + (numJettys / 2 - 1));
    if (sb.length() > 0)     sb.append(',');
    sb.append("localhost:").append(j.getLocalPort()).append(context);
    sb.append("|localhost:").append(j2.getLocalPort()).append(context);
  }
  shards=sb.toString();
  return jettys;
}
