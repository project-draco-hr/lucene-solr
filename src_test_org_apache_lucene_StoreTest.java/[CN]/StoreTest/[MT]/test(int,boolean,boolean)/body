{
  Random gen=new Random(1251971);
  int i;
  Date veryStart=new Date();
  Date start=new Date();
  Directory store;
  if (ram)   store=new RAMDirectory();
 else {
    String dirName="test.store";
    _TestUtil.rmDir(dirName);
    store=FSDirectory.getDirectory(dirName);
  }
  final int LENGTH_MASK=0xFFF;
  final byte[] buffer=new byte[LENGTH_MASK];
  for (i=0; i < count; i++) {
    String name=i + ".dat";
    int length=gen.nextInt() & LENGTH_MASK;
    byte b=(byte)(gen.nextInt() & 0x7F);
    IndexOutput file=store.createOutput(name);
    if (buffered) {
      for (int j=0; j < length; j++)       buffer[j]=b;
      file.writeBytes(buffer,length);
    }
 else {
      for (int j=0; j < length; j++)       file.writeByte(b);
    }
    file.close();
  }
  store.close();
  Date end=new Date();
  System.out.print(end.getTime() - start.getTime());
  System.out.println(" total milliseconds to create");
  gen=new Random(1251971);
  start=new Date();
  if (!ram)   store=FSDirectory.getDirectory("test.store");
  for (i=0; i < count; i++) {
    String name=i + ".dat";
    int length=gen.nextInt() & LENGTH_MASK;
    byte b=(byte)(gen.nextInt() & 0x7F);
    IndexInput file=store.openInput(name);
    if (file.length() != length)     throw new Exception("length incorrect");
    byte[] content=new byte[length];
    if (buffered) {
      file.readBytes(content,0,length);
      for (int j=0; j < length; j++)       if (content[j] != b)       throw new Exception("contents incorrect");
    }
 else {
      for (int j=0; j < length; j++)       if (file.readByte() != b)       throw new Exception("contents incorrect");
    }
    file.close();
  }
  end=new Date();
  System.out.print(end.getTime() - start.getTime());
  System.out.println(" total milliseconds to read");
  gen=new Random(1251971);
  start=new Date();
  for (i=0; i < count; i++) {
    String name=i + ".dat";
    store.deleteFile(name);
  }
  end=new Date();
  System.out.print(end.getTime() - start.getTime());
  System.out.println(" total milliseconds to delete");
  System.out.print(end.getTime() - veryStart.getTime());
  System.out.println(" total milliseconds");
  store.close();
}
