{
  ModifiableSolrParams solrParams=new ModifiableSolrParams();
  if (params.containsKey("partitionKeys")) {
    if (!params.get("partitionKeys").equals("none")) {
      String partitionFilter=getPartitionFilter();
      solrParams.add("fq",partitionFilter);
    }
  }
 else {
    if (numWorkers > 1) {
      throw new IOException("When numWorkers > 1 partitionKeys must be set. Set partitionKeys=none to send the entire stream to each worker.");
    }
  }
  if (checkpoint > 0) {
    solrParams.add("fq","{!frange cost=100 incl=false l=" + checkpoint + "}_version_");
  }
  Iterator<Map.Entry> it=params.entrySet().iterator();
  while (it.hasNext()) {
    Map.Entry entry=it.next();
    solrParams.add((String)entry.getKey(),entry.getValue().toString());
  }
  return solrParams;
}
