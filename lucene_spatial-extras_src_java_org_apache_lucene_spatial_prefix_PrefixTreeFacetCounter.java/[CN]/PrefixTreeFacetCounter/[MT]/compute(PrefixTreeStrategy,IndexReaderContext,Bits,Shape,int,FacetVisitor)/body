{
  for (  final LeafReaderContext leafCtx : context.leaves()) {
    Bits leafAcceptDocs;
    if (topAcceptDocs == null) {
      leafAcceptDocs=leafCtx.reader().getLiveDocs();
    }
 else {
      leafAcceptDocs=new Bits(){
        @Override public boolean get(        int index){
          return topAcceptDocs.get(leafCtx.docBase + index);
        }
        @Override public int length(){
          return leafCtx.reader().maxDoc();
        }
      }
;
    }
    compute(strategy,leafCtx,leafAcceptDocs,queryShape,facetLevel,facetVisitor);
  }
}
