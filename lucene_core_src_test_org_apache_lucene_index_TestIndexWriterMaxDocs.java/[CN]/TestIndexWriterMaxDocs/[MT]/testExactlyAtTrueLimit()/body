{
  Directory dir=newFSDirectory(createTempDir("2BDocs3"));
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(null));
  Document doc=new Document();
  doc.add(newStringField("field","text",Field.Store.NO));
  for (int i=0; i < IndexWriter.MAX_DOCS; i++) {
    iw.addDocument(doc);
  }
  iw.commit();
  for (int i=0; i < 2; i++) {
    DirectoryReader ir=DirectoryReader.open(dir);
    assertEquals(IndexWriter.MAX_DOCS,ir.maxDoc());
    assertEquals(IndexWriter.MAX_DOCS,ir.numDocs());
    IndexSearcher searcher=new IndexSearcher(ir);
    TopDocs hits=searcher.search(new TermQuery(new Term("field","text")),10);
    assertEquals(IndexWriter.MAX_DOCS,hits.totalHits);
    hits=searcher.search(new TermQuery(new Term("field","text")),null,10,new Sort(new SortField(null,SortField.Type.DOC,true)));
    assertEquals(IndexWriter.MAX_DOCS,hits.totalHits);
    assertEquals(10,hits.scoreDocs.length);
    assertEquals(IndexWriter.MAX_DOCS - 1,hits.scoreDocs[0].doc);
    ir.close();
    iw.forceMerge(1);
  }
  iw.close();
  dir.close();
}
