{
  setIndexWriterMaxDocs(10);
  try {
    Directory dir=newDirectory();
    IndexWriterConfig iwc=new IndexWriterConfig(null);
    iwc.setMergePolicy(NoMergePolicy.INSTANCE);
    IndexWriter w=new IndexWriter(dir,iwc);
    for (int i=0; i < 10; i++) {
      Document doc=new Document();
      doc.add(newStringField("id","" + i,Field.Store.NO));
      w.addDocument(doc);
      if (i % 2 == 0) {
        w.commit();
      }
    }
    for (int i=0; i < 5; i++) {
      w.deleteDocuments(new Term("id","" + i));
    }
    w.forceMerge(1);
    assertEquals(5,w.maxDoc());
    for (int i=0; i < 5; i++) {
      w.addDocument(new Document());
    }
    try {
      w.addDocument(new Document());
      fail("didn't hit exception");
    }
 catch (    IllegalArgumentException iae) {
    }
    w.close();
    dir.close();
  }
  finally {
    restoreIndexWriterMaxDocs();
  }
}
