{
  setIndexWriterMaxDocs(2);
  try {
    Directory dir=newDirectory();
    IndexWriter w=new IndexWriter(dir,new IndexWriterConfig(null));
    w.addDocument(new Document());
    w.commit();
    w.addDocument(new Document());
    try {
      w.addDocument(new Document());
      fail("didn't hit exception");
    }
 catch (    IllegalArgumentException iae) {
    }
    w.deleteAll();
    w.addDocument(new Document());
    w.addDocument(new Document());
    try {
      w.addDocument(new Document());
      fail("didn't hit exception");
    }
 catch (    IllegalArgumentException iae) {
    }
    w.close();
    dir.close();
  }
  finally {
    restoreIndexWriterMaxDocs();
  }
}
