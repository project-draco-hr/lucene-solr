{
  setIndexWriterMaxDocs(10);
  try {
    Directory dir=newDirectory();
    IndexWriter w=new IndexWriter(dir,new IndexWriterConfig(null));
    for (int i=0; i < 10; i++) {
      w.addDocument(new Document());
    }
    w.close();
    Directory dir2=newDirectory();
    IndexWriter w2=new IndexWriter(dir2,new IndexWriterConfig(null));
    w2.addDocument(new Document());
    try {
      w2.addIndexes(new Directory[]{dir});
      fail("didn't hit exception");
    }
 catch (    IllegalArgumentException iae) {
    }
    assertEquals(1,w2.maxDoc());
    DirectoryReader ir=DirectoryReader.open(dir);
    try {
      TestUtil.addIndexesSlowly(w2,ir);
      fail("didn't hit exception");
    }
 catch (    IllegalArgumentException iae) {
    }
    w2.close();
    ir.close();
    dir.close();
    dir2.close();
  }
  finally {
    restoreIndexWriterMaxDocs();
  }
}
