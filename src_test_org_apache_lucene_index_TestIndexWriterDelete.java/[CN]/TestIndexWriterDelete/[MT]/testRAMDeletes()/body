{
  Directory dir=new RAMDirectory();
  IndexWriter modifier=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
  modifier.setMaxBufferedDocs(4);
  modifier.setMaxBufferedDeleteTerms(4);
  int id=0;
  int value=100;
  addDoc(modifier,++id,value);
  modifier.deleteDocuments(new Term("value",String.valueOf(value)));
  addDoc(modifier,++id,value);
  modifier.deleteDocuments(new Term("value",String.valueOf(value)));
  assertEquals(2,modifier.getNumBufferedDeleteTerms());
  assertEquals(1,modifier.getBufferedDeleteTermsSize());
  addDoc(modifier,++id,value);
  assertEquals(0,modifier.getSegmentCount());
  modifier.flush();
  IndexReader reader=IndexReader.open(dir);
  assertEquals(1,reader.numDocs());
  int hitCount=getHitCount(dir,new Term("id",String.valueOf(id)));
  assertEquals(1,hitCount);
  reader.close();
  modifier.close();
}
