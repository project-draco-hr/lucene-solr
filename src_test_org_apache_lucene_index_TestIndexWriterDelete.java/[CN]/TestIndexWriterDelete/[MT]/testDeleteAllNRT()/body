{
  Directory dir=new MockRAMDirectory();
  IndexWriter modifier=new IndexWriter(dir,false,new WhitespaceAnalyzer(),true);
  modifier.setMaxBufferedDocs(2);
  modifier.setMaxBufferedDeleteTerms(2);
  int id=0;
  int value=100;
  for (int i=0; i < 7; i++) {
    addDoc(modifier,++id,value);
  }
  modifier.commit();
  IndexReader reader=modifier.getReader();
  assertEquals(7,reader.numDocs());
  reader.close();
  addDoc(modifier,++id,value);
  addDoc(modifier,++id,value);
  modifier.deleteAll();
  reader=modifier.getReader();
  assertEquals(0,reader.numDocs());
  reader.close();
  modifier.rollback();
  modifier.close();
  reader=IndexReader.open(dir);
  assertEquals(7,reader.numDocs());
  reader.close();
  dir.close();
}
