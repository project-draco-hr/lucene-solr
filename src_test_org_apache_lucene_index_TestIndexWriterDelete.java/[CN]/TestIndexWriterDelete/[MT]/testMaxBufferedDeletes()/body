{
  for (int pass=0; pass < 2; pass++) {
    boolean autoCommit=(0 == pass);
    Directory dir=new MockRAMDirectory();
    IndexWriter writer=new IndexWriter(dir,autoCommit,new WhitespaceAnalyzer(),true);
    writer.setMaxBufferedDeleteTerms(1);
    writer.deleteDocuments(new Term("foobar","1"));
    writer.deleteDocuments(new Term("foobar","1"));
    writer.deleteDocuments(new Term("foobar","1"));
    assertEquals(3,writer.getFlushDeletesCount());
    writer.close();
    dir.close();
  }
}
