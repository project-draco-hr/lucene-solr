{
  SpatialArgs args=new SpatialArgs(operation,shape);
  if (!Double.isNaN(distErrPct))   args.setDistErrPct(distErrPct);
  if (score) {
    ValueSource valueSource=strategy.makeDistanceValueSource(shape.getCenter());
    return new CustomScoreQuery(strategy.makeQuery(args),new FunctionQuery(valueSource));
  }
 else {
    Filter filter=strategy.makeFilter(args);
    if (filter instanceof QueryWrapperFilter) {
      return ((QueryWrapperFilter)filter).getQuery();
    }
 else {
      return new ConstantScoreQuery(filter);
    }
  }
}
