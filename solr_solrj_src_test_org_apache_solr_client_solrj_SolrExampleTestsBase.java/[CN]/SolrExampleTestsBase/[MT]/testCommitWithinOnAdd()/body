{
  SolrClient client=getSolrClient();
  client.deleteByQuery("*:*");
  client.commit();
  QueryResponse rsp=client.query(new SolrQuery("*:*"));
  Assert.assertEquals(0,rsp.getResults().getNumFound());
  SolrInputDocument doc3=new SolrInputDocument();
  doc3.addField("id","id3",1.0f);
  doc3.addField("name","doc3",1.0f);
  doc3.addField("price",10);
  UpdateRequest up=new UpdateRequest();
  up.add(doc3);
  up.setCommitWithin(500);
  up.process(client);
  rsp=client.query(new SolrQuery("*:*"));
  Assert.assertEquals(0,rsp.getResults().getNumFound());
  Thread.sleep(1000);
  rsp=client.query(new SolrQuery("id:id3"));
  int cnt=0;
  while (rsp.getResults().getNumFound() == 0) {
    if (cnt++ == 10) {
      break;
    }
    Thread.sleep(2000);
    rsp=client.query(new SolrQuery("id:id3"));
  }
  Assert.assertEquals(1,rsp.getResults().getNumFound());
  SolrInputDocument doc4=new SolrInputDocument();
  doc4.addField("id","id4",1.0f);
  doc4.addField("name","doc4",1.0f);
  doc4.addField("price",10);
  client.add(doc4,500);
  Thread.sleep(1000);
  rsp=client.query(new SolrQuery("id:id4"));
  cnt=0;
  while (rsp.getResults().getNumFound() == 0) {
    if (cnt++ == 10) {
      break;
    }
    Thread.sleep(2000);
    rsp=client.query(new SolrQuery("id:id3"));
  }
  Assert.assertEquals(1,rsp.getResults().getNumFound());
}
