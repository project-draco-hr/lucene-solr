{
  String shapeStr=null;
  Shape shape=null;
  if (val instanceof Shape) {
    shape=((Shape)val);
  }
 else {
    shapeStr=val.toString();
    shape=parseShape(shapeStr);
  }
  if (shape == null) {
    log.debug("Field {}: null shape for input: {}",field,val);
    return Collections.emptyList();
  }
  List<StorableField> result=new ArrayList<>();
  if (field.indexed()) {
    T strategy=getStrategy(field.getName());
    result.addAll(Arrays.asList(strategy.createIndexableFields(shape)));
  }
  if (field.stored()) {
    if (shapeStr == null)     shapeStr=shapeToString(shape);
    result.add(new StoredField(field.getName(),shapeStr));
  }
  return result;
}
