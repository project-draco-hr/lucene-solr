{
  T strategy=getStrategy(field.getName());
  SolrParams localParams=parser.getLocalParams();
  String score=(localParams == null ? null : localParams.get(SCORE_PARAM));
  if (score == null || "none".equals(score) || "".equals(score)) {
    return strategy.makeQuery(spatialArgs);
  }
  ValueSource valueSource;
  if ("distance".equals(score))   valueSource=strategy.makeDistanceValueSource(spatialArgs.getShape().getCenter());
 else   if ("recipDistance".equals(score))   valueSource=strategy.makeRecipDistanceValueSource(spatialArgs.getShape());
 else   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"'score' local-param must be one of 'none', 'distance', or 'recipDistance'");
  Filter filter=strategy.makeFilter(spatialArgs);
  return new FilteredQuery(new FunctionQuery(valueSource),filter);
}
