{
  T strategy=getStrategy(field.getName());
  SolrParams localParams=parser.getLocalParams();
  String scoreParam=(localParams == null ? null : localParams.get(SCORE_PARAM));
  ValueSource valueSource=getValueSourceFromSpatialArgs(parser,field,spatialArgs,scoreParam,strategy);
  if (valueSource == null) {
    return strategy.makeQuery(spatialArgs);
  }
  FunctionQuery functionQuery=new FunctionQuery(valueSource);
  if (localParams != null && !localParams.getBool(FILTER_PARAM,true))   return functionQuery;
  Query filterQuery=strategy.makeQuery(spatialArgs);
  return new BooleanQuery.Builder().add(functionQuery,Occur.MUST).add(filterQuery,Occur.FILTER).build();
}
