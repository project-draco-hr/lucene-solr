{
  long size=NUM_BYTES_ARRAY_HEADER;
  final int len=Array.getLength(array);
  if (len > 0) {
    Class<?> arrayElementClazz=array.getClass().getComponentType();
    if (arrayElementClazz.isPrimitive()) {
      size+=(long)len * primitiveSizes.get(arrayElementClazz);
    }
 else {
      size+=(long)NUM_BYTES_OBJECT_REF * len;
      if (seen != null) {
        for (int i=0; i < len; i++) {
          size+=measureObjectSize(Array.get(array,i),seen);
        }
      }
    }
  }
  return alignObjectSize(size);
}
