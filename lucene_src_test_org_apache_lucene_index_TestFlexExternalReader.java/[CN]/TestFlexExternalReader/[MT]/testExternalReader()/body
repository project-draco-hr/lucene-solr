{
  Directory d=new MockRAMDirectory();
  final int DOC_COUNT=177;
  IndexWriter w=new IndexWriter(d,new MockAnalyzer(),IndexWriter.MaxFieldLength.UNLIMITED);
  w.setMaxBufferedDocs(7);
  Document doc=new Document();
  doc.add(new Field("field1","this is field1",Field.Store.NO,Field.Index.ANALYZED));
  doc.add(new Field("field2","this is field2",Field.Store.NO,Field.Index.ANALYZED));
  doc.add(new Field("field3","aaa",Field.Store.NO,Field.Index.ANALYZED));
  doc.add(new Field("field4","bbb",Field.Store.NO,Field.Index.ANALYZED));
  for (int i=0; i < DOC_COUNT; i++) {
    w.addDocument(doc);
  }
  IndexReader r=new FlexTestUtil.ForcedExternalReader(w.getReader());
  BytesRef field1Term=new BytesRef("field1");
  BytesRef field2Term=new BytesRef("field2");
  assertEquals(DOC_COUNT,r.maxDoc());
  assertEquals(DOC_COUNT,r.numDocs());
  assertEquals(DOC_COUNT,r.docFreq(new Term("field1","field1")));
  assertEquals(DOC_COUNT,r.docFreq("field1",field1Term));
  Fields fields=r.fields();
  Terms terms=fields.terms("field1");
  TermsEnum termsEnum=terms.iterator();
  assertEquals(TermsEnum.SeekStatus.FOUND,termsEnum.seek(field1Term));
  assertEquals(TermsEnum.SeekStatus.NOT_FOUND,termsEnum.seek(field2Term));
  assertTrue(new BytesRef("is").bytesEquals(termsEnum.term()));
  terms=fields.terms("field2");
  termsEnum=terms.iterator();
  assertEquals(TermsEnum.SeekStatus.NOT_FOUND,termsEnum.seek(field1Term));
  assertTrue(termsEnum.term().bytesEquals(field2Term));
  assertEquals(TermsEnum.SeekStatus.FOUND,termsEnum.seek(field2Term));
  termsEnum=fields.terms("field3").iterator();
  assertEquals(TermsEnum.SeekStatus.END,termsEnum.seek(new BytesRef("bbb")));
  assertEquals(TermsEnum.SeekStatus.FOUND,termsEnum.seek(new BytesRef("aaa")));
  assertNull(termsEnum.next());
  r.close();
  w.close();
  d.close();
}
