{
  ResponseBuilder builder=new ResponseBuilder();
  req.getContext().put(RESPONSE_BUILDER_CONTEXT_KEY,builder);
  if (components == null) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"SearchHandler not initialized properly.  No components registered.");
  }
  if (!req.getParams().getBool(CommonParams.DEBUG_QUERY,false)) {
    for (    SearchComponent c : components) {
      c.prepare(req,rsp);
    }
    for (    SearchComponent c : components) {
      c.process(req,rsp);
    }
  }
 else {
    builder.setDebug(true);
    RTimer timer=new RTimer();
    RTimer subt=timer.sub("prepare");
    for (    SearchComponent c : components) {
      builder.setTimer(subt.sub(c.getName()));
      c.prepare(req,rsp);
      builder.getTimer().stop();
    }
    subt.stop();
    subt=timer.sub("process");
    for (    SearchComponent c : components) {
      builder.setTimer(subt.sub(c.getName()));
      c.process(req,rsp);
      builder.getTimer().stop();
    }
    subt.stop();
    timer.stop();
    builder.addDebugInfo("timing",timer.asNamedList());
  }
}
