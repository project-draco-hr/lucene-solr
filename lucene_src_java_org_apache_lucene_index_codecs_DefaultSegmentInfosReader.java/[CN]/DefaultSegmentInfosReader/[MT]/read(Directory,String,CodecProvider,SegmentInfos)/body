{
  IndexInput input=null;
  try {
    input=openInput(directory,segmentsFileName);
    final int format=input.readInt();
    infos.setFormat(format);
    if (format > DefaultSegmentInfosWriter.FORMAT_MINIMUM)     throw new IndexFormatTooOldException(segmentsFileName,format,DefaultSegmentInfosWriter.FORMAT_MINIMUM,DefaultSegmentInfosWriter.FORMAT_CURRENT);
    if (format < DefaultSegmentInfosWriter.FORMAT_CURRENT)     throw new IndexFormatTooNewException(segmentsFileName,format,DefaultSegmentInfosWriter.FORMAT_MINIMUM,DefaultSegmentInfosWriter.FORMAT_CURRENT);
    infos.version=input.readLong();
    infos.counter=input.readInt();
    for (int i=input.readInt(); i > 0; i--) {
      infos.add(new SegmentInfo(directory,format,input,codecs));
    }
    infos.userData=input.readStringStringMap();
    finalizeInput(input);
  }
  finally {
    if (input != null) {
      input.close();
    }
  }
}
