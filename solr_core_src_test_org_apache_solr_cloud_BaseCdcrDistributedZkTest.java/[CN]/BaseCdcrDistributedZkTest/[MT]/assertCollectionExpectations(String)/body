{
  CloudSolrClient client=this.createCloudClient(null);
  try {
    client.connect();
    ClusterState clusterState=client.getZkStateReader().getClusterState();
    assertTrue("Could not find new collection " + collectionName,clusterState.hasCollection(collectionName));
    Map<String,Slice> shards=clusterState.getCollection(collectionName).getSlicesMap();
    assertEquals("Found new collection " + collectionName + ", but mismatch on number of shards.",shardCount,shards.size());
    int totalShards=0;
    for (    String shardName : shards.keySet()) {
      totalShards+=shards.get(shardName).getReplicas().size();
    }
    int expectedTotalShards=shardCount * replicationFactor;
    assertEquals("Found new collection " + collectionName + " with correct number of shards, but mismatch on number "+ "of shards.",expectedTotalShards,totalShards);
  }
  finally {
    client.close();
  }
}
