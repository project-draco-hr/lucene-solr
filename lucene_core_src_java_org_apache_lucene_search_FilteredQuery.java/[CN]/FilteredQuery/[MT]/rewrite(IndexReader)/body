{
  if (filter instanceof QueryWrapperFilter) {
    BooleanQuery rewritten=new BooleanQuery();
    rewritten.add(query,Occur.MUST);
    rewritten.add(((QueryWrapperFilter)filter).getQuery(),Occur.FILTER);
    rewritten.setBoost(getBoost());
    return rewritten;
  }
  final Query queryRewritten=query.rewrite(reader);
  if (queryRewritten != query) {
    final Query rewritten=new FilteredQuery(queryRewritten,filter,strategy);
    rewritten.setBoost(this.getBoost());
    return rewritten;
  }
 else {
    return this;
  }
}
