{
  final Query queryRewritten=query.rewrite(reader);
  final Query filterRewritten=filter.rewrite(reader);
  if (queryRewritten != query || filterRewritten != filter) {
    if (filterRewritten instanceof Filter) {
      final Query rewritten=new FilteredQuery(queryRewritten,(Filter)filterRewritten,strategy);
      rewritten.setBoost(this.getBoost());
      return rewritten;
    }
 else {
      BooleanQuery.Builder builder=new BooleanQuery.Builder();
      builder.add(queryRewritten,Occur.MUST);
      builder.add(filterRewritten,Occur.FILTER);
      BooleanQuery rewritten=builder.build();
      rewritten.setBoost(getBoost());
      return rewritten;
    }
  }
  return this;
}
