{
  final Query queryRewritten=query.rewrite(reader);
  final Query filterRewritten=filter.rewrite(reader);
  if (queryRewritten != query || filterRewritten != filter) {
    if (filterRewritten instanceof Filter) {
      final Query rewritten=new FilteredQuery(queryRewritten,(Filter)filterRewritten,strategy);
      rewritten.setBoost(this.getBoost());
      return rewritten;
    }
 else {
      BooleanQuery rewritten=new BooleanQuery();
      rewritten.add(queryRewritten,Occur.MUST);
      rewritten.add(filterRewritten,Occur.FILTER);
      rewritten.setBoost(getBoost());
      return rewritten;
    }
  }
  return this;
}
