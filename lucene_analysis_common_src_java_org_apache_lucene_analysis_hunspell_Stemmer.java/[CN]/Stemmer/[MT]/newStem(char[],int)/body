{
  if (dictionary.needsOutputCleaning) {
    scratchSegment.setLength(0);
    scratchSegment.append(buffer,0,length);
    try {
      Dictionary.applyMappings(dictionary.oconv,scratchSegment);
    }
 catch (    IOException bogus) {
      throw new RuntimeException(bogus);
    }
    char cleaned[]=new char[scratchSegment.length()];
    scratchSegment.getChars(0,cleaned.length,cleaned,0);
    return new CharsRef(cleaned,0,cleaned.length);
  }
 else {
    return new CharsRef(buffer,0,length);
  }
}
