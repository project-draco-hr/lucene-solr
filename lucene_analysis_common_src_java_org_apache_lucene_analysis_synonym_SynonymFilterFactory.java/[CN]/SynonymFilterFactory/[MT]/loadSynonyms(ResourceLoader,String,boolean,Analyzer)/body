{
  CharsetDecoder decoder=StandardCharsets.UTF_8.newDecoder().onMalformedInput(CodingErrorAction.REPORT).onUnmappableCharacter(CodingErrorAction.REPORT);
  SynonymMap.Parser parser;
  Class<? extends SynonymMap.Parser> clazz=loader.findClass(cname,SynonymMap.Parser.class);
  try {
    parser=clazz.getConstructor(boolean.class,boolean.class,Analyzer.class).newInstance(dedup,expand,analyzer);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  File synonymFile=new File(synonyms);
  if (synonymFile.exists()) {
    decoder.reset();
    parser.parse(new InputStreamReader(loader.openResource(synonyms),decoder));
  }
 else {
    List<String> files=splitFileNames(synonyms);
    for (    String file : files) {
      decoder.reset();
      parser.parse(new InputStreamReader(loader.openResource(file),decoder));
    }
  }
  return parser.build();
}
