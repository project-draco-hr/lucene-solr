{
  final TokenizerFactory factory=tokenizerFactory == null ? null : loadTokenizerFactory(loader,tokenizerFactory);
  Analyzer analyzer;
  if (analyzerName != null) {
    analyzer=loadAnalyzer(loader,analyzerName);
  }
 else {
    analyzer=new Analyzer(){
      @Override protected TokenStreamComponents createComponents(      String fieldName,      Reader reader){
        Tokenizer tokenizer=factory == null ? new WhitespaceTokenizer(Version.LUCENE_50,reader) : factory.create(reader);
        TokenStream stream=ignoreCase ? new LowerCaseFilter(Version.LUCENE_50,tokenizer) : tokenizer;
        return new TokenStreamComponents(tokenizer,stream);
      }
    }
;
  }
  try {
    String formatClass=format;
    if (format == null || format.equals("solr")) {
      formatClass=SolrSynonymParser.class.getName();
    }
 else     if (format.equals("wordnet")) {
      formatClass=WordnetSynonymParser.class.getName();
    }
    map=loadSynonyms(loader,formatClass,true,analyzer);
  }
 catch (  ParseException e) {
    throw new IOException("Error parsing synonyms file:",e);
  }
}
