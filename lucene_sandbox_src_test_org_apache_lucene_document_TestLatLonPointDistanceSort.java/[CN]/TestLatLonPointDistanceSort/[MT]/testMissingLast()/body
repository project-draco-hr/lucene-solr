{
  Directory dir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  iw.addDocument(doc);
  doc=new Document();
  doc.add(new LatLonPoint("location",40.718266,-74.007819));
  iw.addDocument(doc);
  doc=new Document();
  doc.add(new LatLonPoint("location",40.7051157,-74.0088305));
  iw.addDocument(doc);
  IndexReader reader=iw.getReader();
  IndexSearcher searcher=new IndexSearcher(reader);
  iw.close();
  Sort sort=new Sort(LatLonPoint.newDistanceSort("location",40.7143528,-74.0059731));
  TopDocs td=searcher.search(new MatchAllDocsQuery(),3,sort);
  FieldDoc d=(FieldDoc)td.scoreDocs[0];
  assertEquals(462.61748421408186D,(Double)d.fields[0],0.0D);
  d=(FieldDoc)td.scoreDocs[1];
  assertEquals(1056.1630445911035D,(Double)d.fields[0],0.0D);
  d=(FieldDoc)td.scoreDocs[2];
  assertEquals(Double.POSITIVE_INFINITY,(Double)d.fields[0],0.0D);
  reader.close();
  dir.close();
}
