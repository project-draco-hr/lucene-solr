{
  final BinaryDocValues docValues=readerContext.reader().getBinaryDocValues(fieldName);
  return new FunctionValues(){
    int bytesRefDoc=-1;
    BytesRefBuilder bytesRef=new BytesRefBuilder();
    boolean fillBytes(    int doc) throws IOException {
      if (bytesRefDoc != doc) {
        if (docValues.docID() < doc) {
          docValues.advance(doc);
        }
        if (docValues.docID() == doc) {
          bytesRef.copyBytes(docValues.binaryValue());
        }
 else {
          bytesRef.clear();
        }
        bytesRefDoc=doc;
      }
      return bytesRef.length() != 0;
    }
    @Override public boolean exists(    int doc) throws IOException {
      return fillBytes(doc);
    }
    @Override public boolean bytesVal(    int doc,    BytesRefBuilder target) throws IOException {
      target.clear();
      if (fillBytes(doc)) {
        target.copyBytes(bytesRef);
        return true;
      }
 else {
        return false;
      }
    }
    @Override public Object objectVal(    int docId) throws IOException {
      if (!fillBytes(docId))       return null;
      DataInputStream dataInput=new DataInputStream(new ByteArrayInputStream(bytesRef.bytes(),0,bytesRef.length()));
      try {
        return binaryCodec.readShape(dataInput);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
    @Override public Explanation explain(    int doc) throws IOException {
      return Explanation.match(Float.NaN,toString(doc));
    }
    @Override public String toString(    int doc) throws IOException {
      return description() + "=" + objectVal(doc);
    }
  }
;
}
