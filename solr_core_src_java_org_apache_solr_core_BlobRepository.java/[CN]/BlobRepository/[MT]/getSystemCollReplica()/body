{
  ZkStateReader zkStateReader=this.coreContainer.getZkController().getZkStateReader();
  ClusterState cs=zkStateReader.getClusterState();
  DocCollection coll=cs.getCollectionOrNull(CollectionsHandler.SYSTEM_COLL);
  if (coll == null)   throw new SolrException(SERVICE_UNAVAILABLE,".system collection not available");
  ArrayList<Slice> slices=new ArrayList<>(coll.getActiveSlices());
  if (slices.isEmpty())   throw new SolrException(SERVICE_UNAVAILABLE,"No active slices for .system collection");
  Collections.shuffle(slices,RANDOM);
  Replica replica=null;
  for (  Slice slice : slices) {
    List<Replica> replicas=new ArrayList<>(slice.getReplicasMap().values());
    Collections.shuffle(replicas,RANDOM);
    for (    Replica r : replicas) {
      if (r.getState() == Replica.State.ACTIVE) {
        if (zkStateReader.getClusterState().getLiveNodes().contains(r.get(ZkStateReader.NODE_NAME_PROP))) {
          replica=r;
          break;
        }
 else {
          log.info("replica {} says it is active but not a member of live nodes",r.get(ZkStateReader.NODE_NAME_PROP));
        }
      }
    }
  }
  if (replica == null) {
    throw new SolrException(SERVICE_UNAVAILABLE,".no active replica available for .system collection");
  }
  return replica;
}
