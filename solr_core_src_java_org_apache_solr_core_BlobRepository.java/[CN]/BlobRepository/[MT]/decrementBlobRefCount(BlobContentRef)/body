{
  if (ref == null)   return;
synchronized (ref.blob.references) {
    if (!ref.blob.references.remove(ref)) {
      log.error("Multiple releases for the same reference");
    }
    if (ref.blob.references.isEmpty()) {
      blobs.remove(ref.blob.key);
    }
  }
}
