{
  String fsdirClass=TEST_DIRECTORY;
  if (fsdirClass.equals("random")) {
    fsdirClass=FS_DIRECTORIES[random().nextInt(FS_DIRECTORIES.length)];
  }
  Class<? extends FSDirectory> clazz;
  try {
    try {
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
 catch (    ClassCastException e) {
      fsdirClass=FS_DIRECTORIES[random().nextInt(FS_DIRECTORIES.length)];
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
    Directory fsdir=newFSDirectoryImpl(clazz,f);
    MockDirectoryWrapper dir=new MockDirectoryWrapper(random(),maybeNRTWrap(random(),fsdir));
    if (lf != null) {
      dir.setLockFactory(lf);
    }
    stores.put(dir,Thread.currentThread().getStackTrace());
    dir.setThrottling(TEST_THROTTLING);
    return dir;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
