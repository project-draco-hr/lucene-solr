{
  String fsdirClass=TEST_DIRECTORY;
  if (fsdirClass.equals("random")) {
    fsdirClass=RandomPicks.randomFrom(random(),FS_DIRECTORIES);
  }
  Class<? extends FSDirectory> clazz;
  try {
    try {
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
 catch (    ClassCastException e) {
      fsdirClass=RandomPicks.randomFrom(random(),FS_DIRECTORIES);
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
    Directory fsdir=newFSDirectoryImpl(clazz,f);
    MockDirectoryWrapper dir=new MockDirectoryWrapper(random(),maybeNRTWrap(random(),fsdir));
    if (lf != null) {
      dir.setLockFactory(lf);
    }
    closeAfterSuite(new CloseableDirectory(dir,suiteFailureMarker));
    dir.setThrottling(TEST_THROTTLING);
    return dir;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
