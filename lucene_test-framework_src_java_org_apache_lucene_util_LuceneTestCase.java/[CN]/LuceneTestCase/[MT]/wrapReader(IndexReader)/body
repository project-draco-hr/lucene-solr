{
  Random random=random();
  for (int i=0, c=random.nextInt(6) + 1; i < c; i++) {
switch (random.nextInt(5)) {
case 0:
      if (VERBOSE) {
        System.out.println("NOTE: LuceneTestCase.wrapReader: wrapping previous reader=" + r + " with ParallelLeaf/CompositeReader");
      }
    r=(r instanceof LeafReader) ? new ParallelLeafReader((LeafReader)r) : new ParallelCompositeReader((CompositeReader)r);
  break;
case 1:
if (VERBOSE) {
  System.out.println("NOTE: LuceneTestCase.wrapReader: wrapping previous reader=" + r + " with FCInvisibleMultiReader");
}
r=new FCInvisibleMultiReader(r);
break;
case 2:
if (r instanceof LeafReader) {
final LeafReader ar=(LeafReader)r;
final List<String> allFields=new ArrayList<>();
for (FieldInfo fi : ar.getFieldInfos()) {
allFields.add(fi.name);
}
Collections.shuffle(allFields,random);
final int end=allFields.isEmpty() ? 0 : random.nextInt(allFields.size());
final Set<String> fields=new HashSet<>(allFields.subList(0,end));
if (VERBOSE) {
System.out.println("NOTE: LuceneTestCase.wrapReader: wrapping previous reader=" + r + " with ParallelLeafReader");
}
r=new ParallelLeafReader(new FieldFilterLeafReader(ar,fields,false),new FieldFilterLeafReader(ar,fields,true));
}
break;
case 3:
if (VERBOSE) {
System.out.println("NOTE: LuceneTestCase.wrapReader: wrapping previous reader=" + r + " with AssertingLeaf/DirectoryReader");
}
if (r instanceof LeafReader) {
r=new AssertingLeafReader((LeafReader)r);
}
 else if (r instanceof DirectoryReader) {
r=new AssertingDirectoryReader((DirectoryReader)r);
}
break;
case 4:
if (VERBOSE) {
System.out.println("NOTE: LuceneTestCase.wrapReader: wrapping previous reader=" + r + " with MismatchedLeaf/DirectoryReader");
}
if (r instanceof LeafReader) {
r=new MismatchedLeafReader((LeafReader)r,random);
}
 else if (r instanceof DirectoryReader) {
r=new MismatchedDirectoryReader((DirectoryReader)r,random);
}
break;
default :
fail("should not get here");
}
}
if ((r instanceof CompositeReader) && !(r instanceof FCInvisibleMultiReader)) {
r=new FCInvisibleMultiReader(r);
}
if (VERBOSE) {
System.out.println("wrapReader wrapped: " + r);
}
return r;
}
