{
  String fsdirClass=TEST_DIRECTORY;
  if (fsdirClass.equals("random")) {
    fsdirClass=RandomPicks.randomFrom(random(),FS_DIRECTORIES);
  }
  Class<? extends FSDirectory> clazz;
  try {
    try {
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
 catch (    ClassCastException e) {
      fsdirClass=RandomPicks.randomFrom(random(),FS_DIRECTORIES);
      clazz=CommandLineUtil.loadFSDirectoryClass(fsdirClass);
    }
    Directory fsdir=newFSDirectoryImpl(clazz,f);
    BaseDirectoryWrapper wrapped=wrapDirectory(random(),fsdir,bare);
    if (lf != null) {
      wrapped.setLockFactory(lf);
    }
    return wrapped;
  }
 catch (  Exception e) {
    Rethrow.rethrow(e);
    throw null;
  }
}
