{
  name=new String(name);
  if (usually(random) || !type.indexed()) {
    fieldNamesSeen.add(name);
    return new Field(name,value,type);
  }
  FieldType newType=new FieldType(type);
  if (!newType.stored() && random.nextBoolean()) {
    newType.setStored(true);
  }
  if (!newType.storeTermVectors() && fieldNamesSeen.contains(name) == false && random.nextBoolean()) {
    FieldType prev;
synchronized (fieldTermVectorOptions) {
      prev=fieldTermVectorOptions.get(name);
      if (prev == null) {
        newType.setStoreTermVectors(true);
        if (!newType.storeTermVectorPositions()) {
          newType.setStoreTermVectorPositions(random.nextBoolean());
          if (newType.storeTermVectorPositions()) {
            if (!newType.storeTermVectorPayloads()) {
              newType.setStoreTermVectorPayloads(random.nextBoolean());
            }
            if (!newType.storeTermVectorOffsets()) {
              newType.setStoreTermVectorOffsets(random.nextBoolean());
            }
          }
        }
        fieldTermVectorOptions.put(name,prev);
      }
    }
    if (prev != null) {
      newType.setStoreTermVectors(prev.storeTermVectors());
      newType.setStoreTermVectorOffsets(prev.storeTermVectorOffsets());
      newType.setStoreTermVectorPositions(prev.storeTermVectorPositions());
      newType.setStoreTermVectorPayloads(prev.storeTermVectorPayloads());
    }
    System.out.println("  LTC: upgrade name=" + name + " type="+ newType);
  }
  newType.freeze();
  return new Field(name,value,newType);
}
