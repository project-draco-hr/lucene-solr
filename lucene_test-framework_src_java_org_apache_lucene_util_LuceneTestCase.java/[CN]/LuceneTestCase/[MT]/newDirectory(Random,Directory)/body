{
  Directory impl=newDirectoryImpl(r,TEST_DIRECTORY);
  for (  String file : d.listAll()) {
    d.copy(impl,file,file,newIOContext(r));
  }
  MockDirectoryWrapper dir=new MockDirectoryWrapper(r,maybeNRTWrap(r,impl));
  closeAfterSuite(new CloseableDirectory(dir,suiteFailureMarker));
  dir.setThrottling(TEST_THROTTLING);
  return dir;
}
