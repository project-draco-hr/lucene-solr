{
  try {
    if (LuceneTestCase.suiteFailureMarker.wasSuccessful()) {
synchronized (cleanupQueue) {
        File[] everything=new File[cleanupQueue.size()];
        for (int i=0; !cleanupQueue.isEmpty(); i++) {
          everything[i]=cleanupQueue.removeLast();
        }
        try {
          TestUtil.rm(everything);
        }
 catch (        IOException e) {
          Class<?> suiteClass=RandomizedContext.current().getTargetClass();
          if (suiteClass.isAnnotationPresent(SuppressTempFileChecks.class)) {
            System.err.println("WARNING: Leftover undeleted temporary files (bugUrl: " + suiteClass.getAnnotation(SuppressTempFileChecks.class).bugUrl() + "): "+ e.getMessage());
            return;
          }
          throw e;
        }
      }
    }
 else {
synchronized (cleanupQueue) {
        if (tempDirBase != null) {
          System.err.println("NOTE: leaving temporary files on disk at: " + tempDirBase.getAbsolutePath());
        }
      }
    }
  }
  finally {
    tempDirBase=null;
  }
}
