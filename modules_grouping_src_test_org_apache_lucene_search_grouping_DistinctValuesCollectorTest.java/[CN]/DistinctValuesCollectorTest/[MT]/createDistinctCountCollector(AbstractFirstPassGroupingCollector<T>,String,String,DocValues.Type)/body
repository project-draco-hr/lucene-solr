{
  Random random=random();
  Collection<SearchGroup<T>> searchGroups=firstPassGroupingCollector.getTopGroups(0,false);
  if (DVFirstPassGroupingCollector.class.isAssignableFrom(firstPassGroupingCollector.getClass())) {
    boolean diskResident=random.nextBoolean();
    return DVDistinctValuesCollector.create(groupField,countField,searchGroups,diskResident,dvType);
  }
 else   if (FunctionFirstPassGroupingCollector.class.isAssignableFrom(firstPassGroupingCollector.getClass())) {
    return (AbstractDistinctValuesCollector)new FunctionDistinctValuesCollector(new HashMap<Object,Object>(),new BytesRefFieldSource(groupField),new BytesRefFieldSource(countField),(Collection)searchGroups);
  }
 else {
    return (AbstractDistinctValuesCollector)new TermDistinctValuesCollector(groupField,countField,(Collection)searchGroups);
  }
}
