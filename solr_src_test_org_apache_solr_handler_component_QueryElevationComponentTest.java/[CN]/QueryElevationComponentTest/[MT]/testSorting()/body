{
  assertU(adoc("id","a","title","ipod","str_s","a"));
  assertU(adoc("id","b","title","ipod ipod","str_s","b"));
  assertU(adoc("id","c","title","ipod ipod ipod","str_s","c"));
  assertU(adoc("id","x","title","boosted","str_s","x"));
  assertU(adoc("id","y","title","boosted boosted","str_s","y"));
  assertU(adoc("id","z","title","boosted boosted boosted","str_s","z"));
  assertU(commit());
  String query="title:ipod";
  Map<String,String> args=new HashMap<String,String>();
  args.put(CommonParams.Q,query);
  args.put(CommonParams.QT,"/elevate");
  args.put(CommonParams.FL,"id,score");
  args.put("indent","true");
  SolrQueryRequest req=new LocalSolrQueryRequest(h.getCore(),new MapSolrParams(args));
  IndexReader reader=req.getSearcher().getIndexReader();
  QueryElevationComponent booster=(QueryElevationComponent)req.getCore().getSearchComponent("elevate");
  assertQ("Make sure standard sort works as expected",req,"//*[@numFound='3']","//result/doc[1]/str[@name='id'][.='a']","//result/doc[2]/str[@name='id'][.='b']","//result/doc[3]/str[@name='id'][.='c']");
  booster.elevationCache.clear();
  booster.setTopQueryResults(reader,query,new String[]{"x","y","z"},null);
  assertQ("All six should make it",req,"//*[@numFound='6']","//result/doc[1]/str[@name='id'][.='x']","//result/doc[2]/str[@name='id'][.='y']","//result/doc[3]/str[@name='id'][.='z']","//result/doc[4]/str[@name='id'][.='a']","//result/doc[5]/str[@name='id'][.='b']","//result/doc[6]/str[@name='id'][.='c']");
  booster.elevationCache.clear();
  booster.setTopQueryResults(reader,query,new String[]{"a","x"},null);
  assertQ("All four should make it",req,"//*[@numFound='4']","//result/doc[1]/str[@name='id'][.='a']","//result/doc[2]/str[@name='id'][.='x']","//result/doc[3]/str[@name='id'][.='b']","//result/doc[4]/str[@name='id'][.='c']");
  args.put(CommonParams.SORT,"score asc");
  assertQ("All four should make it",req,"//*[@numFound='4']","//result/doc[4]/str[@name='id'][.='a']","//result/doc[3]/str[@name='id'][.='x']","//result/doc[2]/str[@name='id'][.='b']","//result/doc[1]/str[@name='id'][.='c']");
  assertEquals(false,booster.forceElevation);
  args.put(CommonParams.SORT,"str_s asc");
  assertQ(null,req,"//*[@numFound='4']","//result/doc[1]/str[@name='id'][.='a']","//result/doc[2]/str[@name='id'][.='b']","//result/doc[3]/str[@name='id'][.='c']","//result/doc[4]/str[@name='id'][.='x']");
  booster.forceElevation=true;
  assertQ(null,req,"//*[@numFound='4']","//result/doc[1]/str[@name='id'][.='a']","//result/doc[2]/str[@name='id'][.='x']","//result/doc[3]/str[@name='id'][.='b']","//result/doc[4]/str[@name='id'][.='c']");
  args.put(QueryElevationParams.EXCLUSIVE,"true");
  booster.setTopQueryResults(reader,query,new String[]{"x","a"},new String[]{});
  assertQ(null,req,"//*[@numFound='2']","//result/doc[1]/str[@name='id'][.='x']","//result/doc[2]/str[@name='id'][.='a']");
  booster.elevationCache.clear();
  args.remove(CommonParams.SORT);
  args.remove(QueryElevationParams.EXCLUSIVE);
  booster.setTopQueryResults(reader,query,new String[]{"x"},new String[]{"a"});
  assertQ(null,req,"//*[@numFound='3']","//result/doc[1]/str[@name='id'][.='x']","//result/doc[2]/str[@name='id'][.='b']","//result/doc[3]/str[@name='id'][.='c']");
  req.close();
}
