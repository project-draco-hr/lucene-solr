{
  if (blockOut != null) {
    boolean success=false;
    try {
      final long blockDirStart=blockOut.getFilePointer();
      blockOut.writeVInt(fields.size());
      for (      FieldMetaData field : fields) {
        blockOut.writeVInt(field.fieldInfo.number);
        blockOut.writeVLong(field.numTerms);
        if (field.fieldInfo.getIndexOptions() != IndexOptions.DOCS) {
          blockOut.writeVLong(field.sumTotalTermFreq);
        }
        blockOut.writeVLong(field.sumDocFreq);
        blockOut.writeVInt(field.docCount);
        blockOut.writeVInt(field.longsSize);
        blockOut.writeVLong(field.statsOut.getFilePointer());
        blockOut.writeVLong(field.metaLongsOut.getFilePointer());
        blockOut.writeVLong(field.metaBytesOut.getFilePointer());
        field.skipOut.writeTo(blockOut);
        field.statsOut.writeTo(blockOut);
        field.metaLongsOut.writeTo(blockOut);
        field.metaBytesOut.writeTo(blockOut);
        field.dict.save(indexOut);
      }
      writeTrailer(blockOut,blockDirStart);
      CodecUtil.writeFooter(indexOut);
      CodecUtil.writeFooter(blockOut);
      success=true;
    }
  finally {
      if (success) {
        IOUtils.close(blockOut,indexOut,postingsWriter);
      }
 else {
        IOUtils.closeWhileHandlingException(blockOut,indexOut,postingsWriter);
      }
      blockOut=null;
    }
  }
}
