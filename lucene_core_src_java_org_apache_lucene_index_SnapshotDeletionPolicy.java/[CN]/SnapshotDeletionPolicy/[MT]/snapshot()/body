{
  if (lastCommit == null) {
    throw new IllegalStateException("No index commit to snapshot");
  }
  long gen=lastCommit.getGeneration();
  Integer refCount=refCounts.get(gen);
  int refCountInt;
  if (refCount == null) {
    indexCommits.put(gen,lastCommit);
    refCountInt=0;
  }
 else {
    refCountInt=refCount.intValue();
  }
  refCounts.put(gen,refCountInt + 1);
  return lastCommit;
}
