{
  byte[] buf=new byte[n];
  int ntotal=0;
  int nread;
  while (ntotal < n) {
    nread=in.read(buf,ntotal,n - ntotal);
    if (nread < 0) {
      byte[] newbuf=new byte[ntotal];
      System.arraycopy(buf,0,newbuf,0,ntotal);
      return newbuf;
    }
    ntotal+=nread;
  }
  return buf;
}
