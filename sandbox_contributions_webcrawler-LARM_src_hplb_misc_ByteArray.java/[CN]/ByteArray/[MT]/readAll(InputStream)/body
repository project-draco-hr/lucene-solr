{
  byte[] buf=new byte[1024];
  int nread, ntotal=0;
  while ((nread=in.read(buf,ntotal,buf.length - ntotal)) > -1) {
    ntotal+=nread;
    if (ntotal == buf.length) {
      byte[] newbuf=new byte[buf.length * 2];
      System.arraycopy(buf,0,newbuf,0,buf.length);
      buf=newbuf;
    }
  }
  if (ntotal < buf.length) {
    byte[] newbuf=new byte[ntotal];
    System.arraycopy(buf,0,newbuf,0,ntotal);
    buf=newbuf;
  }
  return buf;
}
