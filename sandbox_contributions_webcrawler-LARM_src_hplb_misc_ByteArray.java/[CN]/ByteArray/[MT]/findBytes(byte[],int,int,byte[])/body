{
  int buf_len=off + len;
  int ptrn_len=ptrn.length;
  int i;
  int j;
  byte b=ptrn[0];
  for (i=off; i < buf_len; ) {
    j=0;
    while (i < buf_len && j < ptrn_len && buf[i] == ptrn[j]) {
      i++;
      j++;
    }
    if (i == buf_len || j == ptrn_len)     return i - j;
 else {
      i=i - j + 1;
    }
  }
  return -1;
}
