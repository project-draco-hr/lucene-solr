{
  String[] doc={"id","1","term_s","YYYY","group_s","group1","test_ti","5","test_tl","10","test_tf","2000"};
  assertU(adoc(doc));
  String[] doc1={"id","2","term_s","YYYY","group_s","group1","test_ti","50","test_tl","100","test_tf","200"};
  assertU(adoc(doc1));
  String[] doc2={"id","3","term_s","YYYY","test_ti","5000","test_tl","100","test_tf","200"};
  assertU(adoc(doc2));
  String[] doc3={"id","4","term_s","YYYY","test_ti","500","test_tl","1000","test_tf","2000"};
  assertU(adoc(doc3));
  assertU(commit());
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s}");
  params.add("defType","edismax");
  params.add("bf","field(test_ti)");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='50']");
  params=new ModifiableSolrParams();
  params.add("q","YYYY");
  params.add("fq","{!collapse field=group_s nullPolicy=collapse}");
  params.add("defType","edismax");
  params.add("bf","field(test_ti)");
  params.add("qf","term_s");
  params.add("qt","/elevate");
  assertQ(req(params),"*[count(//doc)=3]","//doc[./int[1][@name='test_ti']='5']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s min=test_ti}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='5']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s max=test_ti}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='50']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s min=test_tl}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='5']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s max=test_tl}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='50']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s min=test_tf}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='50']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s max=test_tf}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='5']");
  params=new ModifiableSolrParams();
  params.add("q","*:*");
  params.add("fq","{!collapse field=group_s max=test_tf nullPolicy=expand}");
  assertQ(req(params),"*[count(//doc)=3]");
  params=new ModifiableSolrParams();
  params.add("q","test_ti:(500 5000)");
  params.add("fq","{!collapse field=group_s max=test_tf nullPolicy=collapse}");
  assertQ(req(params),"*[count(//doc)=1]","//doc[./int[@name='test_ti']='500']");
}
