{
  IndexWriter writer=new IndexWriter(dir,new IndexWriterConfig(analyzer).setSimilarity(similarity == null ? IndexSearcher.getDefaultSimilarity() : similarity));
  writer.addDocument(doc);
  writer.commit();
  SegmentCommitInfo info=writer.newestSegment();
  writer.close();
  return info;
}
