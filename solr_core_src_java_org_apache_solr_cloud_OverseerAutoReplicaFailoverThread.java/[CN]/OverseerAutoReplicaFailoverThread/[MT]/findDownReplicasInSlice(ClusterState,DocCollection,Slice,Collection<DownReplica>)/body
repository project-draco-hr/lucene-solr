{
  int goodReplicas=0;
  Collection<Replica> replicas=slice.getReplicas();
  if (replicas != null) {
    for (    Replica replica : replicas) {
      boolean live=clusterState.liveNodesContain(replica.getNodeName());
      String state=replica.getStr(ZkStateReader.STATE_PROP);
      boolean okayState=(state.equals(ZkStateReader.DOWN) || state.equals(ZkStateReader.RECOVERING) || state.equals(ZkStateReader.ACTIVE));
      log.debug("Process replica name={} live={} state={}",replica.getName(),live,state);
      if (live && okayState) {
        goodReplicas++;
      }
 else {
        DownReplica badReplica=new DownReplica();
        badReplica.replica=replica;
        badReplica.slice=slice;
        badReplica.collection=collection;
        badReplicas.add(badReplica);
      }
    }
  }
  log.debug("bad replicas for slice {}",badReplicas);
  return goodReplicas;
}
