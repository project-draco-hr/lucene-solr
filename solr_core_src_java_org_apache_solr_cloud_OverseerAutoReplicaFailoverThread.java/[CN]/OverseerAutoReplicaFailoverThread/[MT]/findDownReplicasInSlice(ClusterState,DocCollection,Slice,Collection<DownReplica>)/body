{
  int goodReplicas=0;
  Collection<Replica> replicas=slice.getReplicas();
  if (replicas != null) {
    for (    Replica replica : replicas) {
      boolean live=clusterState.liveNodesContain(replica.getNodeName());
      final Replica.State state=replica.getState();
      final boolean okayState=state == Replica.State.DOWN || state == Replica.State.RECOVERING || state == Replica.State.ACTIVE;
      log.debug("Process replica name={} live={} state={}",replica.getName(),live,state.toString());
      if (live && okayState) {
        goodReplicas++;
      }
 else {
        DownReplica badReplica=new DownReplica();
        badReplica.replica=replica;
        badReplica.slice=slice;
        badReplica.collection=collection;
        badReplicas.add(badReplica);
      }
    }
  }
  log.debug("bad replicas for slice {}",badReplicas);
  return goodReplicas;
}
