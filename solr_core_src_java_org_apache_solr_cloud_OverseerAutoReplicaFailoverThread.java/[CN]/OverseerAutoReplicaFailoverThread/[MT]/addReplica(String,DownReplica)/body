{
  final String createUrl=getBestCreateUrl(zkStateReader,badReplica);
  if (createUrl == null) {
    log.warn("Could not find a node to create new replica on.");
    return false;
  }
  final String dataDir=badReplica.replica.getStr("dataDir");
  final String ulogDir=badReplica.replica.getStr("ulogDir");
  final String coreNodeName=badReplica.replica.getName();
  if (dataDir != null) {
    final String coreName=badReplica.replica.getStr(ZkStateReader.CORE_NAME_PROP);
    log.debug("submit call to {}",createUrl);
    updateExecutor.submit(new Callable<Boolean>(){
      @Override public Boolean call(){
        return createSolrCore(collection,createUrl,dataDir,ulogDir,coreNodeName,coreName);
      }
    }
);
    boolean success=ClusterStateUtil.waitToSeeLiveReplica(zkStateReader,collection,coreNodeName,createUrl,30000);
    if (!success) {
      log.error("Creating new replica appears to have failed, timed out waiting to see created SolrCore register in the clusterstate.");
      return false;
    }
    return true;
  }
  log.warn("Could not find dataDir or ulogDir in cluster state.");
  return false;
}
