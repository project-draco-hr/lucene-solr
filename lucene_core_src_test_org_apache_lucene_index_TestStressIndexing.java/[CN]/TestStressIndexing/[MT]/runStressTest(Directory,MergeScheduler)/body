{
  IndexWriter modifier=new IndexWriter(directory,newIndexWriterConfig(new MockAnalyzer(random())).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(10).setMergeScheduler(mergeScheduler));
  modifier.commit();
  TimedThread[] threads=new TimedThread[4];
  int numThread=0;
  IndexerThread indexerThread=new IndexerThread(modifier,threads);
  threads[numThread++]=indexerThread;
  indexerThread.start();
  IndexerThread indexerThread2=new IndexerThread(modifier,threads);
  threads[numThread++]=indexerThread2;
  indexerThread2.start();
  SearcherThread searcherThread1=new SearcherThread(directory,threads);
  threads[numThread++]=searcherThread1;
  searcherThread1.start();
  SearcherThread searcherThread2=new SearcherThread(directory,threads);
  threads[numThread++]=searcherThread2;
  searcherThread2.start();
  for (int i=0; i < numThread; i++)   threads[i].join();
  modifier.close();
  for (int i=0; i < numThread; i++)   assertTrue(!threads[i].failed);
}
