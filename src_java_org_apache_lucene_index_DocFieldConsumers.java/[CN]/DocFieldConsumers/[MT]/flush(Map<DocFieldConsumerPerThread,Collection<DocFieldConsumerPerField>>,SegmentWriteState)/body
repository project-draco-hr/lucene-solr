{
  Map oneThreadsAndFields=new HashMap();
  Map twoThreadsAndFields=new HashMap();
  Iterator it=threadsAndFields.entrySet().iterator();
  while (it.hasNext()) {
    Map.Entry entry=(Map.Entry)it.next();
    DocFieldConsumersPerThread perThread=(DocFieldConsumersPerThread)entry.getKey();
    Collection fields=(Collection)entry.getValue();
    Iterator fieldsIt=fields.iterator();
    Collection oneFields=new HashSet();
    Collection twoFields=new HashSet();
    while (fieldsIt.hasNext()) {
      DocFieldConsumersPerField perField=(DocFieldConsumersPerField)fieldsIt.next();
      oneFields.add(perField.one);
      twoFields.add(perField.two);
    }
    oneThreadsAndFields.put(perThread.one,oneFields);
    twoThreadsAndFields.put(perThread.two,twoFields);
  }
  one.flush(oneThreadsAndFields,state);
  two.flush(twoThreadsAndFields,state);
}
