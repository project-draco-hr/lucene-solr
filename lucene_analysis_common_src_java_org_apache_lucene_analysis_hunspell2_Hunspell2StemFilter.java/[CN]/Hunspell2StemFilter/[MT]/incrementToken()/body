{
  if (buffer != null && !buffer.isEmpty()) {
    CharsRef nextStem=buffer.remove(0);
    restoreState(savedState);
    posIncAtt.setPositionIncrement(0);
    termAtt.setEmpty().append(nextStem);
    return true;
  }
  if (!input.incrementToken()) {
    return false;
  }
  if (keywordAtt.isKeyword()) {
    return true;
  }
  buffer=dedup ? stemmer.uniqueStems(termAtt.buffer(),termAtt.length()) : stemmer.stem(termAtt.buffer(),termAtt.length());
  if (buffer.isEmpty()) {
    return true;
  }
  CharsRef stem=buffer.remove(0);
  termAtt.setEmpty().append(stem);
  if (!buffer.isEmpty()) {
    savedState=captureState();
  }
  return true;
}
