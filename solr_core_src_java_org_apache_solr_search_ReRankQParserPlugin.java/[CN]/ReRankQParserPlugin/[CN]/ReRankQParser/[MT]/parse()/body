{
  String reRankQueryString=localParams.get(RERANK_QUERY);
  if (reRankQueryString == null || reRankQueryString.trim().length() == 0) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,RERANK_QUERY + " parameter is mandatory");
  }
  QParser reRankParser=QParser.getParser(reRankQueryString,null,req);
  Query reRankQuery=reRankParser.parse();
  int reRankDocs=localParams.getInt(RERANK_DOCS,RERANK_DOCS_DEFAULT);
  reRankDocs=Math.max(1,reRankDocs);
  double reRankWeight=localParams.getDouble(RERANK_WEIGHT,RERANK_WEIGHT_DEFAULT);
  int start=params.getInt(CommonParams.START,CommonParams.START_DEFAULT);
  int rows=params.getInt(CommonParams.ROWS,CommonParams.ROWS_DEFAULT);
  int length=start + rows;
  return new ReRankQuery(reRankQuery,reRankDocs,reRankWeight,length);
}
