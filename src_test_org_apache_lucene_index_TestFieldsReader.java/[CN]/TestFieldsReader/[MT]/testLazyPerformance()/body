{
  String tmpIODir=System.getProperty("tempDir");
  String userName=System.getProperty("user.name");
  String path=tmpIODir + File.separator + "lazyDir"+ userName;
  File file=new File(path);
  _TestUtil.rmDir(file);
  FSDirectory tmpDir=FSDirectory.open(file);
  assertTrue(tmpDir != null);
  IndexWriter writer=new IndexWriter(tmpDir,new IndexWriterConfig(TEST_VERSION_CURRENT).setOpenMode(OpenMode.CREATE));
  ((LogMergePolicy)writer.getMergePolicy()).setUseCompoundFile(false);
  writer.addDocument(testDoc);
  writer.close();
  assertTrue(fieldInfos != null);
  FieldsReader reader;
  long lazyTime=0;
  long regularTime=0;
  int length=50;
  Set<String> lazyFieldNames=new HashSet<String>();
  lazyFieldNames.add(DocHelper.LARGE_LAZY_FIELD_KEY);
  SetBasedFieldSelector fieldSelector=new SetBasedFieldSelector(Collections.<String>emptySet(),lazyFieldNames);
  for (int i=0; i < length; i++) {
    reader=new FieldsReader(tmpDir,TEST_SEGMENT_NAME,fieldInfos);
    assertTrue(reader.size() == 1);
    Document doc;
    doc=reader.doc(0,null);
    assertTrue("doc is null and it shouldn't be",doc != null);
    Fieldable field=doc.getFieldable(DocHelper.LARGE_LAZY_FIELD_KEY);
    assertTrue("field is null and it shouldn't be",field != null);
    assertTrue("field is lazy",field.isLazy() == false);
    String value;
    long start;
    long finish;
    start=System.currentTimeMillis();
    value=field.stringValue();
    finish=System.currentTimeMillis();
    assertTrue("value is null and it shouldn't be",value != null);
    regularTime+=(finish - start);
    reader.close();
    reader=null;
    doc=null;
    System.gc();
    reader=new FieldsReader(tmpDir,TEST_SEGMENT_NAME,fieldInfos);
    doc=reader.doc(0,fieldSelector);
    field=doc.getFieldable(DocHelper.LARGE_LAZY_FIELD_KEY);
    assertTrue("field is not lazy",field.isLazy() == true);
    start=System.currentTimeMillis();
    value=field.stringValue();
    finish=System.currentTimeMillis();
    assertTrue("value is null and it shouldn't be",value != null);
    lazyTime+=(finish - start);
    reader.close();
  }
  System.out.println("Average Non-lazy time (should be very close to zero): " + regularTime / length + " ms for " + length + " reads");
  System.out.println("Average Lazy Time (should be greater than zero): " + lazyTime / length + " ms for " + length + " reads");
}
