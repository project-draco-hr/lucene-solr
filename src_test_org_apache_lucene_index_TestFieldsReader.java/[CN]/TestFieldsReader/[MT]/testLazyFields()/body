{
  assertTrue(dir != null);
  assertTrue(fieldInfos != null);
  FieldsReader reader=new FieldsReader(dir,TEST_SEGMENT_NAME,fieldInfos);
  assertTrue(reader != null);
  assertTrue(reader.size() == 1);
  Set loadFieldNames=new HashSet();
  loadFieldNames.add(DocHelper.TEXT_FIELD_1_KEY);
  loadFieldNames.add(DocHelper.TEXT_FIELD_UTF1_KEY);
  Set lazyFieldNames=new HashSet();
  lazyFieldNames.add(DocHelper.LARGE_LAZY_FIELD_KEY);
  lazyFieldNames.add(DocHelper.LAZY_FIELD_KEY);
  lazyFieldNames.add(DocHelper.LAZY_FIELD_BINARY_KEY);
  lazyFieldNames.add(DocHelper.TEXT_FIELD_UTF2_KEY);
  SetBasedFieldSelector fieldSelector=new SetBasedFieldSelector(loadFieldNames,lazyFieldNames);
  Document doc=reader.doc(0,fieldSelector);
  assertTrue("doc is null and it shouldn't be",doc != null);
  Fieldable field=doc.getFieldable(DocHelper.LAZY_FIELD_KEY);
  assertTrue("field is null and it shouldn't be",field != null);
  assertTrue("field is not lazy and it should be",field.isLazy());
  String value=field.stringValue();
  assertTrue("value is null and it shouldn't be",value != null);
  assertTrue(value + " is not equal to " + DocHelper.LAZY_FIELD_TEXT,value.equals(DocHelper.LAZY_FIELD_TEXT) == true);
  field=doc.getFieldable(DocHelper.TEXT_FIELD_1_KEY);
  assertTrue("field is null and it shouldn't be",field != null);
  assertTrue("Field is lazy and it should not be",field.isLazy() == false);
  field=doc.getFieldable(DocHelper.TEXT_FIELD_UTF1_KEY);
  assertTrue("field is null and it shouldn't be",field != null);
  assertTrue("Field is lazy and it should not be",field.isLazy() == false);
  assertTrue(field.stringValue() + " is not equal to " + DocHelper.FIELD_UTF1_TEXT,field.stringValue().equals(DocHelper.FIELD_UTF1_TEXT) == true);
  field=doc.getFieldable(DocHelper.TEXT_FIELD_UTF2_KEY);
  assertTrue("field is null and it shouldn't be",field != null);
  assertTrue("Field is lazy and it should not be",field.isLazy() == true);
  assertTrue(field.stringValue() + " is not equal to " + DocHelper.FIELD_UTF2_TEXT,field.stringValue().equals(DocHelper.FIELD_UTF2_TEXT) == true);
  field=doc.getFieldable(DocHelper.LAZY_FIELD_BINARY_KEY);
  assertTrue("field is null and it shouldn't be",field != null);
  assertTrue("stringValue isn't null for lazy binary field",field.stringValue() == null);
  byte[] bytes=field.binaryValue();
  assertTrue("bytes is null and it shouldn't be",bytes != null);
  assertTrue("",DocHelper.LAZY_FIELD_BINARY_BYTES.length == bytes.length);
  for (int i=0; i < bytes.length; i++) {
    assertTrue("byte[" + i + "] is mismatched",bytes[i] == DocHelper.LAZY_FIELD_BINARY_BYTES[i]);
  }
}
