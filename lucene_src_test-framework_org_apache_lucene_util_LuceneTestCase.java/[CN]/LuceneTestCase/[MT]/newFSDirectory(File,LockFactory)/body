{
  String fsdirClass=TEST_DIRECTORY;
  if (fsdirClass.equals("random")) {
    fsdirClass=FS_DIRECTORIES[random.nextInt(FS_DIRECTORIES.length)];
  }
  if (fsdirClass.indexOf(".") == -1) {
    fsdirClass="org.apache.lucene.store." + fsdirClass;
  }
  Class<? extends FSDirectory> clazz;
  try {
    try {
      clazz=Class.forName(fsdirClass).asSubclass(FSDirectory.class);
    }
 catch (    ClassCastException e) {
      fsdirClass=FS_DIRECTORIES[random.nextInt(FS_DIRECTORIES.length)];
      if (fsdirClass.indexOf(".") == -1) {
        fsdirClass="org.apache.lucene.store." + fsdirClass;
      }
      clazz=Class.forName(fsdirClass).asSubclass(FSDirectory.class);
    }
    MockDirectoryWrapper dir=new MockDirectoryWrapper(random,newFSDirectoryImpl(clazz,f));
    if (lf != null) {
      dir.setLockFactory(lf);
    }
    stores.put(dir,Thread.currentThread().getStackTrace());
    dir.setThrottling(TEST_THROTTLING);
    return dir;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
