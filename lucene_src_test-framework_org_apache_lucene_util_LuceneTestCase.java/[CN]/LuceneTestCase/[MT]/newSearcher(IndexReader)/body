{
  if (random.nextBoolean()) {
    return new IndexSearcher(r);
  }
 else {
    int threads=0;
    final ExecutorService ex=(random.nextBoolean()) ? null : Executors.newFixedThreadPool(threads=_TestUtil.nextInt(random,1,8),new NamedThreadFactory("LuceneTestCase"));
    if (ex != null && VERBOSE) {
      System.out.println("NOTE: newSearcher using ExecutorService with " + threads + " threads");
    }
    return new IndexSearcher(r.getTopReaderContext(),ex){
      @Override public void close() throws IOException {
        super.close();
        if (ex != null) {
          ex.shutdown();
          try {
            ex.awaitTermination(1000,TimeUnit.MILLISECONDS);
          }
 catch (          InterruptedException e) {
            e.printStackTrace();
          }
        }
      }
    }
;
  }
}
