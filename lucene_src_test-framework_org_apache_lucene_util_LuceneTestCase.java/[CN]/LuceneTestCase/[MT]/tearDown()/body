{
  State oldState=state;
  state=State.TEARDOWN;
  Throwable problem=null;
  try {
    if (!testsFailed) {
      assertTrue("ensure your setUp() calls super.setUp()!!!",oldState == State.RANTEST || oldState == State.SETUP);
    }
  }
 catch (  Throwable t) {
    if (problem == null)     problem=t;
  }
  BooleanQuery.setMaxClauseCount(savedBoolMaxClauseCount);
  checkRogueThreadsAfter();
  Thread.setDefaultUncaughtExceptionHandler(savedUncaughtExceptionHandler);
  try {
    checkUncaughtExceptionsAfter();
  }
 catch (  Throwable t) {
    if (problem == null)     problem=t;
  }
  try {
    assertSaneFieldCaches(getTestLabel());
  }
 catch (  Throwable t) {
    if (problem == null)     problem=t;
  }
  purgeFieldCache(FieldCache.DEFAULT);
  if (problem != null) {
    testsFailed=true;
    reportAdditionalFailureInfo();
    throw new RuntimeException(problem);
  }
}
