{
  final int maxDoc=1000000 + random().nextInt(1000000);
  DocIdSetBuilder builder=new DocIdSetBuilder(maxDoc);
  final int numIterators=1 + random().nextInt(10);
  final FixedBitSet ref=new FixedBitSet(maxDoc);
  if (random().nextBoolean()) {
    final int doc=random().nextInt(maxDoc);
    ref.set(doc);
    builder.or(new WAH8DocIdSet.Builder().add(doc).build().iterator());
  }
  for (int i=0; i < numIterators; ++i) {
    final int baseInc=2 + random().nextInt(10000);
    WAH8DocIdSet.Builder b=new WAH8DocIdSet.Builder();
    for (int doc=random().nextInt(10000); doc < maxDoc; doc+=baseInc + random().nextInt(2000)) {
      b.add(doc);
      ref.set(doc);
    }
    builder.or(b.build().iterator());
  }
  DocIdSet result=builder.build();
  assertTrue(result instanceof FixedBitSet);
  assertEquals(ref,result);
}
