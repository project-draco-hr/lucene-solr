{
  PointValues values=new DummyPointValues(42,42);
  DocIdSetBuilder builder=new DocIdSetBuilder(100,values,"foo");
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertFalse(builder.multivalued);
  DocIdSetBuilder.BulkAdder adder=builder.grow(2);
  adder.add(5);
  adder.add(7);
  DocIdSet set=builder.build();
  assertTrue(set instanceof BitDocIdSet);
  assertEquals(2,set.iterator().cost());
  values=new DummyPointValues(42,63);
  builder=new DocIdSetBuilder(100,values,"foo");
  assertEquals(1.5,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
  adder=builder.grow(2);
  adder.add(5);
  adder.add(7);
  set=builder.build();
  assertTrue(set instanceof BitDocIdSet);
  assertEquals(1,set.iterator().cost());
  values=new DummyPointValues(42,-1);
  builder=new DocIdSetBuilder(100,values,"foo");
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
  values=new DummyPointValues(-1,84);
  builder=new DocIdSetBuilder(100,values,"foo");
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
  Terms terms=new DummyTerms(42,42);
  builder=new DocIdSetBuilder(100,terms);
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertFalse(builder.multivalued);
  adder=builder.grow(2);
  adder.add(5);
  adder.add(7);
  set=builder.build();
  assertTrue(set instanceof BitDocIdSet);
  assertEquals(2,set.iterator().cost());
  terms=new DummyTerms(42,63);
  builder=new DocIdSetBuilder(100,terms);
  assertEquals(1.5,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
  adder=builder.grow(2);
  adder.add(5);
  adder.add(7);
  set=builder.build();
  assertTrue(set instanceof BitDocIdSet);
  assertEquals(1,set.iterator().cost());
  terms=new DummyTerms(42,-1);
  builder=new DocIdSetBuilder(100,terms);
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
  terms=new DummyTerms(-1,84);
  builder=new DocIdSetBuilder(100,terms);
  assertEquals(1d,builder.numValuesPerDoc,0d);
  assertTrue(builder.multivalued);
}
