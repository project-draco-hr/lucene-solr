{
  fromDocTermOrds.setDocument(doc);
  long ord;
  while ((ord=fromDocTermOrds.nextOrd()) != SortedSetDocValues.NO_MORE_ORDS) {
    fromDocTermOrds.lookupOrd(ord,scratch);
    int termID=collectedTerms.add(scratch);
    if (termID < 0) {
      termID=-termID - 1;
    }
 else {
      if (termID >= scoreSums.length) {
        scoreSums=ArrayUtil.grow(scoreSums);
      }
    }
switch (scoreMode) {
case Total:
      scoreSums[termID]+=scorer.score();
    break;
case Max:
  scoreSums[termID]=Math.max(scoreSums[termID],scorer.score());
}
}
}
