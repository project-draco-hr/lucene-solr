{
  Directory[][] dirs=getDirs();
  IndexWriter iw=new IndexWriter(dirs[0][0],new IndexWriterConfig(TEST_VERSION_CURRENT,new WhitespaceAnalyzer(TEST_VERSION_CURRENT)));
  TaxonomyWriter tw=new LuceneTaxonomyWriter(dirs[0][1],OpenMode.CREATE);
  PerDimensionIndexingParams iParams=new PerDimensionIndexingParams();
  seedIndex(iw,tw,iParams);
  iw.commit();
  tw.commit();
  TaxonomyReader tr=new LuceneTaxonomyReader(dirs[0][1]);
  IndexReader ir=IndexReader.open(dirs[0][0]);
  IndexSearcher searcher=new IndexSearcher(ir);
  FacetsCollector facetsCollector=performSearch(iParams,tr,ir,searcher);
  assertCorrectResults(facetsCollector);
  DocsEnum td=MultiFields.getTermDocsEnum(ir,MultiFields.getDeletedDocs(ir),"$facets",new BytesRef("$fulltree$"));
  assertTrue(td.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
  tr.close();
  ir.close();
  searcher.close();
  iw.close();
  tw.close();
}
