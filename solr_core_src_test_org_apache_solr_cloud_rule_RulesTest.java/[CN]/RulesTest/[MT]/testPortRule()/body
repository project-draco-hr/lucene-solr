{
  JettySolrRunner jetty=cluster.getRandomJetty(random());
  String port=Integer.toString(jetty.getLocalPort());
  String rulesColl="portRuleColl";
  CollectionAdminRequest.createCollectionWithImplicitRouter(rulesColl,"conf","shard1",2).setRule("port:" + port).setSnitch("class:ImplicitSnitch").process(cluster.getSolrClient());
  DocCollection rulesCollection=getCollectionState(rulesColl);
  List list=(List)rulesCollection.get("rule");
  assertEquals(1,list.size());
  assertEquals(port,((Map)list.get(0)).get("port"));
  list=(List)rulesCollection.get("snitch");
  assertEquals(1,list.size());
  assertEquals("ImplicitSnitch",((Map)list.get(0)).get("class"));
}
