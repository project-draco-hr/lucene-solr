{
  BooleanQuery q=new BooleanQuery();
  PhraseQuery phraseQuery=new PhraseQuery();
  phraseQuery.setSlop(1);
  phraseQuery.add(new Term(FIELD,"w1"));
  phraseQuery.add(new Term(FIELD,"w2"));
  q.add(phraseQuery,Occur.MUST);
  q.add(snear(st("w2"),sor("w5","zz"),4,true),Occur.SHOULD);
  q.add(snear(sf("w3",2),st("w2"),st("w3"),5,true),Occur.SHOULD);
  Query t=new FilteredQuery(new TermQuery(new Term(FIELD,"xx")),new QueryWrapperFilter(matchTheseItems(new int[]{1,3})));
  t.setBoost(1000);
  q.add(t,Occur.SHOULD);
  t=new ConstantScoreQuery(matchTheseItems(new int[]{0,2}));
  t.setBoost(30);
  q.add(t,Occur.SHOULD);
  DisjunctionMaxQuery dm=new DisjunctionMaxQuery(0.2f);
  dm.add(snear(st("w2"),sor("w5","zz"),4,true));
  dm.add(new TermQuery(new Term(FIELD,"QQ")));
  BooleanQuery xxYYZZ=new BooleanQuery();
  xxYYZZ.add(new TermQuery(new Term(FIELD,"xx")),Occur.SHOULD);
  xxYYZZ.add(new TermQuery(new Term(FIELD,"yy")),Occur.SHOULD);
  xxYYZZ.add(new TermQuery(new Term(FIELD,"zz")),Occur.MUST_NOT);
  dm.add(xxYYZZ);
  BooleanQuery xxW1=new BooleanQuery();
  xxW1.add(new TermQuery(new Term(FIELD,"xx")),Occur.MUST_NOT);
  xxW1.add(new TermQuery(new Term(FIELD,"w1")),Occur.MUST_NOT);
  dm.add(xxW1);
  DisjunctionMaxQuery dm2=new DisjunctionMaxQuery(0.5f);
  dm2.add(new TermQuery(new Term(FIELD,"w1")));
  dm2.add(new TermQuery(new Term(FIELD,"w2")));
  dm2.add(new TermQuery(new Term(FIELD,"w3")));
  dm.add(dm2);
  q.add(dm,Occur.SHOULD);
  BooleanQuery b=new BooleanQuery();
  b.setMinimumNumberShouldMatch(2);
  b.add(snear("w1","w2",1,true),Occur.SHOULD);
  b.add(snear("w2","w3",1,true),Occur.SHOULD);
  b.add(snear("w1","w3",3,true),Occur.SHOULD);
  q.add(b,Occur.SHOULD);
  qtest(q,new int[]{0,1,2});
}
