{
  Map childThreadsAndFields=new HashMap();
  Iterator it=threads.iterator();
  while (it.hasNext()) {
    DocFieldProcessorPerThread perThread=(DocFieldProcessorPerThread)it.next();
    childThreadsAndFields.put(perThread.consumer,perThread.fields());
    perThread.trimFields(state);
  }
  consumer.flush(childThreadsAndFields,state);
  fieldInfos.write(state.directory,state.segmentName + ".fnm");
}
