{
  String field="field" + precisionStep;
  int count=3000;
  int lower=(distance * 3 / 2) + startOffset, upper=lower + count * distance + (distance / 3);
  NumericRangeQuery<Integer> q=NumericRangeQuery.newIntRange(field,precisionStep,lower,upper,true,true);
  NumericRangeFilter<Integer> f=NumericRangeFilter.newIntRange(field,precisionStep,lower,upper,true,true);
  for (byte i=0; i < 3; i++) {
    TopDocs topDocs;
    String type;
switch (i) {
case 0:
      type=" (constant score filter rewrite)";
    q.setRewriteMethod(MultiTermQuery.CONSTANT_SCORE_FILTER_REWRITE);
  topDocs=searcher.search(q,noDocs,Sort.INDEXORDER);
break;
case 1:
type=" (constant score boolean rewrite)";
q.setRewriteMethod(MultiTermQuery.CONSTANT_SCORE_BOOLEAN_QUERY_REWRITE);
topDocs=searcher.search(q,noDocs,Sort.INDEXORDER);
break;
case 2:
type=" (filter)";
topDocs=searcher.search(new FilteredQuery(new MatchAllDocsQuery(),f),noDocs,Sort.INDEXORDER);
break;
default :
return;
}
ScoreDoc[] sd=topDocs.scoreDocs;
assertNotNull(sd);
assertEquals("Score doc count" + type,count,sd.length);
StoredDocument doc=searcher.doc(sd[0].doc);
assertEquals("First doc" + type,2 * distance + startOffset,doc.getField(field).numericValue().intValue());
doc=searcher.doc(sd[sd.length - 1].doc);
assertEquals("Last doc" + type,(1 + count) * distance + startOffset,doc.getField(field).numericValue().intValue());
}
}
