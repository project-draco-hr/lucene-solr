{
  final Directory directory=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),directory,new MockAnalyzer(random(),MockTokenizer.WHITESPACE,false));
  Document doc=new Document();
  FieldType withVectors=new FieldType(TextField.TYPE_STORED);
  withVectors.setStoreTermVectors(true);
  withVectors.setStoreTermVectorPositions(true);
  withVectors.setStoreTermVectorOffsets(true);
  doc.add(new Field(FIELD,"a b c",withVectors));
  iw.addDocument(doc);
  DirectoryReader ir=iw.getReader();
  final PhraseQuery pq=new PhraseQuery();
  pq.add(new Term(FIELD,"c"),2);
  pq.add(new Term(FIELD,"a"),0);
  assertEquals(1,new IndexSearcher(ir).search(pq,1).totalHits);
  FastVectorHighlighter highlighter=new FastVectorHighlighter();
  FieldQuery fieldQuery=highlighter.getFieldQuery(pq,ir);
  String[] bestFragments=highlighter.getBestFragments(fieldQuery,ir,0,FIELD,1000,1);
  assertEquals("<b>a</b> b <b>c</b>",bestFragments[0]);
  ir.close();
  iw.close();
  directory.close();
}
