{
  SolrParams p=req.getParams();
  String words=p.get("q");
  String cmd=p.get("cmd");
  if (cmd != null && cmd.equals("rebuild"))   rebuild(req);
  Float accuracy;
  int numSug;
  try {
    accuracy=p.getFloat("accuracy",DEFAULT_ACCURACY);
    spellChecker.setAccuracy(accuracy);
  }
 catch (  NumberFormatException e) {
    throw new RuntimeException("Accuracy must be a valid positive float",e);
  }
  try {
    numSug=p.getInt("suggestionCount",DEFAULT_NUM_SUGGESTIONS);
  }
 catch (  NumberFormatException e) {
    throw new RuntimeException("Spelling suggestion count must be a valid positive integer",e);
  }
  String[] suggestions=spellChecker.suggestSimilar(words,numSug,reader,restrictToField,onlyMorePopular);
  rsp.add("suggestions",Arrays.asList(suggestions));
}
