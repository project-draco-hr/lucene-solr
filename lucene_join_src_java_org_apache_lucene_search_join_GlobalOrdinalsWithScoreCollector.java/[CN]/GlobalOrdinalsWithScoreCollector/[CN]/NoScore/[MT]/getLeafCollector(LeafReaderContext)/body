{
  SortedDocValues docTermOrds=DocValues.getSorted(context.reader(),field);
  if (ordinalMap != null) {
    LongValues segmentOrdToGlobalOrdLookup=ordinalMap.getGlobalOrds(context.ord);
    return new LeafCollector(){
      @Override public void setScorer(      Scorer scorer) throws IOException {
      }
      @Override public void collect(      int doc) throws IOException {
        final long segmentOrd=docTermOrds.getOrd(doc);
        if (segmentOrd != -1) {
          final int globalOrd=(int)segmentOrdToGlobalOrdLookup.get(segmentOrd);
          collectedOrds.set(globalOrd);
          occurrences.increment(globalOrd);
        }
      }
    }
;
  }
 else {
    return new LeafCollector(){
      @Override public void setScorer(      Scorer scorer) throws IOException {
      }
      @Override public void collect(      int doc) throws IOException {
        final int segmentOrd=docTermOrds.getOrd(doc);
        if (segmentOrd != -1) {
          collectedOrds.set(segmentOrd);
          occurrences.increment(segmentOrd);
        }
      }
    }
;
  }
}
