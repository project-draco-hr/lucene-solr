{
  ModifiableSolrParams params=new ModifiableSolrParams(super.getParams());
  if (shardName == null || shardName.isEmpty()) {
    params.remove("shard");
    if (routeKey == null) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Either shard or routeKey must be provided");
    }
    params.add(ShardParams._ROUTE_,routeKey);
  }
  params.set("async",asyncId);
  if (node != null) {
    params.add("node",node);
  }
  if (instanceDir != null) {
    params.add("instanceDir",instanceDir);
  }
  if (dataDir != null) {
    params.add("dataDir",dataDir);
  }
  if (properties != null) {
    addProperties(params,properties);
  }
  return params;
}
