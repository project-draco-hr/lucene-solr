{
  meta.writeVInt(field.number);
  meta.writeByte(NUMBER);
  meta.writeLong(data.getFilePointer());
  long minValue=Long.MAX_VALUE;
  long maxValue=Long.MIN_VALUE;
  HashSet<Long> uniqueValues=new HashSet<Long>();
  for (  Number nv : values) {
    long v=nv.longValue();
    minValue=Math.min(minValue,v);
    maxValue=Math.max(maxValue,v);
    if (uniqueValues != null) {
      if (uniqueValues.add(v)) {
        if (uniqueValues.size() > 256) {
          uniqueValues=null;
        }
      }
    }
  }
  if (uniqueValues != null) {
    final int bitsPerValue=PackedInts.bitsRequired(uniqueValues.size() - 1);
    FormatAndBits formatAndBits=PackedInts.fastestFormatAndBits(maxDoc,bitsPerValue,acceptableOverheadRatio);
    if (formatAndBits.bitsPerValue == 8 && minValue >= Byte.MIN_VALUE && maxValue <= Byte.MAX_VALUE) {
      meta.writeByte(UNCOMPRESSED);
      for (      Number nv : values) {
        data.writeByte((byte)nv.longValue());
      }
    }
 else {
      meta.writeByte(TABLE_COMPRESSED);
      Long[] decode=uniqueValues.toArray(new Long[uniqueValues.size()]);
      final HashMap<Long,Integer> encode=new HashMap<Long,Integer>();
      data.writeVInt(decode.length);
      for (int i=0; i < decode.length; i++) {
        data.writeLong(decode[i]);
        encode.put(decode[i],i);
      }
      meta.writeVInt(PackedInts.VERSION_CURRENT);
      data.writeVInt(formatAndBits.format.getId());
      data.writeVInt(formatAndBits.bitsPerValue);
      final PackedInts.Writer writer=PackedInts.getWriterNoHeader(data,formatAndBits.format,maxDoc,formatAndBits.bitsPerValue,PackedInts.DEFAULT_BUFFER_SIZE);
      for (      Number nv : values) {
        writer.add(encode.get(nv.longValue()));
      }
      writer.finish();
    }
  }
 else {
    meta.writeByte(DELTA_COMPRESSED);
    meta.writeVInt(PackedInts.VERSION_CURRENT);
    data.writeVInt(BLOCK_SIZE);
    final BlockPackedWriter writer=new BlockPackedWriter(data,BLOCK_SIZE);
    for (    Number nv : values) {
      writer.add(nv.longValue());
    }
    writer.finish();
  }
}
