{
  if (!LuceneTestCase.OLD_FORMAT_IMPERSONATION_IS_ACTIVE) {
    return super.fieldsConsumer(state);
  }
 else {
    String filename=IndexFileNames.segmentFileName(state.segmentInfo.name,"dv",IndexFileNames.COMPOUND_FILE_EXTENSION);
    return new Lucene40DocValuesWriter(state,filename,Lucene40FieldInfosReader.LEGACY_DV_TYPE_KEY);
  }
}
