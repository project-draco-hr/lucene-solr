{
  StringBuilder artifactId=new StringBuilder();
  Matcher matcher=COMPILATION_OUTPUT_DIRECTORY_PATTERN.matcher(dependency);
  if (matcher.matches()) {
    String artifact=matcher.group(2);
    artifact=artifact.replace('/','-');
    artifact=artifact.replace("analysis-","analyzers-");
    if ("lucene".equals(matcher.group(1))) {
      artifactId.append("lucene-");
    }
    artifactId.append(artifact);
  }
 else {
    matcher=internalJarPattern.matcher(dependency);
    if (matcher.matches()) {
      artifactId.append(matcher.group(1));
      artifactId.append(matcher.group(2));
    }
 else {
      throw new BuildException("Malformed module dependency from '" + newPropertyKey + "': '"+ dependency+ "'");
    }
  }
  return artifactId.toString();
}
