{
  final InputStream stream;
  try {
    stream=new FileInputStream(file);
  }
 catch (  FileNotFoundException e) {
    throw new BuildException("Properties file does not exist: " + file.getPath());
  }
  final Reader reader=new InputStreamReader(stream,StandardCharsets.ISO_8859_1);
  final Properties properties=new Properties();
  try {
    properties.load(reader);
  }
 catch (  IOException e) {
    throw new BuildException("Exception reading properties file " + file,e);
  }
 finally {
    try {
      reader.close();
    }
 catch (    IOException e) {
    }
  }
  StringBuffer buffer=new StringBuffer();
  for (  Map.Entry entry : properties.entrySet()) {
    buffer.setLength(0);
    Matcher matcher=PROPERTY_REFERENCE_PATTERN.matcher((String)entry.getValue());
    while (matcher.find()) {
      String interpolatedValue=properties.getProperty(matcher.group(1));
      if (null != interpolatedValue) {
        matcher.appendReplacement(buffer,interpolatedValue);
      }
    }
    matcher.appendTail(buffer);
    properties.setProperty((String)entry.getKey(),buffer.toString());
  }
  return properties;
}
