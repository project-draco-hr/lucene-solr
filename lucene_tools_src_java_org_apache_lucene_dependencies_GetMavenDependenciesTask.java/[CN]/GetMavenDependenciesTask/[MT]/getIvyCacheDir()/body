{
  String ivyUserDirName=getProject().getUserProperty(IVY_USER_DIR_PROPERTY);
  if (null == ivyUserDirName) {
    ivyUserDirName=getProject().getProperty(IVY_USER_DIR_PROPERTY);
    if (null == ivyUserDirName) {
      ivyUserDirName=System.getProperty("user.home") + System.getProperty("file.separator") + ".ivy2";
    }
  }
  File ivyUserDir=new File(ivyUserDirName);
  if (!ivyUserDir.exists()) {
    throw new BuildException("Ivy user dir does not exist: '" + ivyUserDir.getPath() + "'");
  }
  File dir=new File(ivyUserDir,"cache");
  if (!dir.exists()) {
    throw new BuildException("Ivy cache dir does not exist: '" + ivyCacheDir.getPath() + "'");
  }
  return dir;
}
