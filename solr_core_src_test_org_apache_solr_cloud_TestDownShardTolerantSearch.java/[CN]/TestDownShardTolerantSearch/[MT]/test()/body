{
  waitForRecoveriesToFinish(true);
  indexAbunchOfDocs();
  commit();
  QueryResponse response=cloudClient.query(new SolrQuery("*:*").setRows(1));
  assertThat(response.getStatus(),is(0));
  assertThat(response.getResults().getNumFound(),is(66L));
  ChaosMonkey.kill(shardToJetty.get(SHARD1).get(0));
  response=cloudClient.query(new SolrQuery("*:*").setRows(1).setParam(ShardParams.SHARDS_TOLERANT,true));
  assertThat(response.getStatus(),is(0));
  assertTrue(response.getResults().getNumFound() > 0);
  try {
    response=cloudClient.query(new SolrQuery("*:*").setRows(1).setParam(ShardParams.SHARDS_TOLERANT,false));
    fail("Request should have failed because we killed shard1 jetty");
  }
 catch (  SolrServerException e) {
    log.info("error from server",e);
    assertNotNull(e.getCause());
    assertTrue("Error message from server should have the name of the down shard",e.getCause().getMessage().contains("shard1"));
  }
catch (  IOException e) {
    e.printStackTrace();
  }
}
