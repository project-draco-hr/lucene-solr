{
  if (fr instanceof CountFacetRequest) {
    int[] a=facetArrays.getIntArray();
    if (isUsingComplements) {
      return new ComplementCountingAggregator(a);
    }
 else {
      return new CountingAggregator(a);
    }
  }
 else   if (fr instanceof SumScoreFacetRequest) {
    if (isUsingComplements) {
      throw new IllegalArgumentException("complements are not supported by this SumScoreFacetRequest");
    }
 else {
      return new ScoringAggregator(facetArrays.getFloatArray());
    }
  }
 else   if (fr instanceof OverSampledFacetRequest) {
    return createAggregator(((OverSampledFacetRequest)fr).orig,facetArrays);
  }
 else {
    throw new IllegalArgumentException("unknown Aggregator implementation for request " + fr.getClass());
  }
}
