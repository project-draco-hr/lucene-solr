{
  if (fr.getResultMode() == ResultMode.PER_NODE_IN_TREE) {
    return new TopKInEachNodeHandler(taxonomyReader,fr,resolver,facetArrays);
  }
 else {
    return new TopKFacetResultsHandler(taxonomyReader,fr,resolver,facetArrays);
  }
}
