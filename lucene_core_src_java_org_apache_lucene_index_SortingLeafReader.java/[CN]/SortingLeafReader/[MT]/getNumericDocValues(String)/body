{
  final NumericDocValues oldDocValues=in.getNumericDocValues(field);
  if (oldDocValues == null)   return null;
  CachedNumericDVs dvs;
synchronized (cachedNumericDVs) {
    dvs=cachedNumericDVs.get(field);
    if (dvs == null) {
      FixedBitSet docsWithField=new FixedBitSet(maxDoc());
      long[] values=new long[maxDoc()];
      while (true) {
        int docID=oldDocValues.nextDoc();
        if (docID == NO_MORE_DOCS) {
          break;
        }
        int newDocID=docMap.oldToNew(docID);
        docsWithField.set(newDocID);
        values[newDocID]=oldDocValues.longValue();
      }
      dvs=new CachedNumericDVs(values,docsWithField);
      cachedNumericDVs.put(field,dvs);
    }
  }
  return new SortingNumericDocValues(dvs);
}
