{
  String fieldName="user_name";
  assertFalse("foobar".equals(getFoobarWithNonChars()));
  Metadata metadata=new Metadata();
  metadata.set(fieldName,getFoobarWithNonChars());
  StripNonCharSolrContentHandlerFactory contentHandlerFactory=new StripNonCharSolrContentHandlerFactory(ExtractionDateUtil.DEFAULT_DATE_FORMATS);
  IndexSchema schema=h.getCore().getLatestSchema();
  SolrContentHandler contentHandler=contentHandlerFactory.createSolrContentHandler(metadata,new MapSolrParams(new HashMap()),schema);
  SolrInputDocument doc=contentHandler.newDocument();
  String foobar=doc.getFieldValue(fieldName).toString();
  assertTrue("foobar".equals(foobar));
}
