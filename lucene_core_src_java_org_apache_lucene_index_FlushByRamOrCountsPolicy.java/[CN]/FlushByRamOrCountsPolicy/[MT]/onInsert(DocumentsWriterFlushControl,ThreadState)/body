{
  if (flushOnDocCount() && state.dwpt.getNumDocsInRAM() >= indexWriterConfig.getMaxBufferedDocs()) {
    control.setFlushPending(state);
  }
 else   if (flushOnRAM()) {
    final long limit=(long)(indexWriterConfig.getRAMBufferSizeMB() * 1024.d * 1024.d);
    final long totalRam=control.activeBytes() + control.getDeleteBytesUsed();
    if (totalRam >= limit) {
      if (infoStream.isEnabled("FP")) {
        infoStream.message("FP","trigger flush: activeBytes=" + control.activeBytes() + " deleteBytes="+ control.getDeleteBytesUsed()+ " vs limit="+ limit);
      }
      markLargestWriterPending(control,state,totalRam);
    }
  }
}
