{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig(new MockAnalyzer(random())));
  w.addDocument(new Document());
  final Map<String,String> commitData=new HashMap<>();
  commitData.put("foo","bar");
  w.setLiveCommitData(commitData.entrySet());
  commitData.clear();
  commitData.put("boo","baz");
  w.close();
  List<IndexCommit> commits=DirectoryReader.listCommits(dir);
  assertEquals(1,commits.size());
  IndexCommit commit=commits.get(0);
  Map<String,String> data=commit.getUserData();
  assertEquals(1,data.size());
  assertEquals("baz",data.get("boo"));
  dir.close();
}
