{
  String tempDir=System.getProperty("java.io.tmpdir");
  if (tempDir == null) {
    throw new IOException("java.io.tmpdir undefined, cannot run test");
  }
  File indexDir1=new File(tempDir,"lucenetestindex1");
  Directory dir1=FSDirectory.open(indexDir1);
  IndexWriter.unlock(dir1);
  norms=new ArrayList();
  modifiedNorms=new ArrayList();
  createIndex(dir1);
  doTestNorms(dir1);
  ArrayList norms1=norms;
  ArrayList modifiedNorms1=modifiedNorms;
  int numDocNorms1=numDocNorms;
  norms=new ArrayList();
  modifiedNorms=new ArrayList();
  numDocNorms=0;
  File indexDir2=new File(tempDir,"lucenetestindex2");
  Directory dir2=FSDirectory.open(indexDir2);
  createIndex(dir2);
  doTestNorms(dir2);
  File indexDir3=new File(tempDir,"lucenetestindex3");
  Directory dir3=FSDirectory.open(indexDir3);
  createIndex(dir3);
  IndexWriter iw=new IndexWriter(dir3,anlzr,false,IndexWriter.MaxFieldLength.LIMITED);
  iw.setMaxBufferedDocs(5);
  iw.setMergeFactor(3);
  iw.addIndexes(new Directory[]{dir1,dir2});
  iw.close();
  norms1.addAll(norms);
  norms=norms1;
  modifiedNorms1.addAll(modifiedNorms);
  modifiedNorms=modifiedNorms1;
  numDocNorms+=numDocNorms1;
  verifyIndex(dir3);
  doTestNorms(dir3);
  iw=new IndexWriter(dir3,anlzr,false,IndexWriter.MaxFieldLength.LIMITED);
  iw.setMaxBufferedDocs(5);
  iw.setMergeFactor(3);
  iw.optimize();
  iw.close();
  verifyIndex(dir3);
  dir1.close();
  dir2.close();
  dir3.close();
}
