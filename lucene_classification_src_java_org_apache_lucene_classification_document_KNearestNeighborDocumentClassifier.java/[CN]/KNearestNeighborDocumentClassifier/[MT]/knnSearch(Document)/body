{
  BooleanQuery.Builder mltQuery=new BooleanQuery.Builder();
  for (  String fieldName : textFieldNames) {
    String boost=null;
    if (fieldName.contains("^")) {
      String[] field2boost=fieldName.split("\\^");
      fieldName=field2boost[0];
      boost=field2boost[1];
    }
    String[] fieldValues=document.getValues(fieldName);
    if (boost != null) {
      mlt.setBoost(true);
      mlt.setBoostFactor(Float.parseFloat(boost));
    }
    mlt.setAnalyzer(field2analyzer.get(fieldName));
    for (    String fieldContent : fieldValues) {
      mltQuery.add(new BooleanClause(mlt.like(fieldName,new StringReader(fieldContent)),BooleanClause.Occur.SHOULD));
    }
    mlt.setBoost(false);
  }
  Query classFieldQuery=new WildcardQuery(new Term(classFieldName,"*"));
  mltQuery.add(new BooleanClause(classFieldQuery,BooleanClause.Occur.MUST));
  if (query != null) {
    mltQuery.add(query,BooleanClause.Occur.MUST);
  }
  return indexSearcher.search(mltQuery.build(),k);
}
