{
  Path dir=FilterPath.unwrap(createTempDir());
  FileSystem fs=new LeakFS(dir.getFileSystem()).getFileSystem(URI.create("file:///"));
  Path wrapped=new FilterPath(dir,fs);
  OutputStream file=Files.newOutputStream(wrapped.resolve("stillopen"));
  file.write(5);
  file.close();
  AsynchronousFileChannel leak=AsynchronousFileChannel.open(wrapped.resolve("stillopen"));
  try {
    fs.close();
    fail("should have gotten exception");
  }
 catch (  Exception e) {
    assertTrue(e.getMessage().contains("file handle leaks"));
  }
  leak.close();
}
