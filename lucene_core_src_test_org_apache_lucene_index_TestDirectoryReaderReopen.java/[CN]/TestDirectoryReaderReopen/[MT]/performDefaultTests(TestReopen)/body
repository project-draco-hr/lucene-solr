{
  DirectoryReader index1=test.openReader();
  DirectoryReader index2=test.openReader();
  TestDirectoryReader.assertIndexEquals(index1,index2);
  ReaderCouple couple=refreshReader(index2,false);
  assertTrue(couple.refreshedReader == index2);
  couple=refreshReader(index2,test,0,true);
  index1.close();
  index1=couple.newReader;
  DirectoryReader index2_refreshed=couple.refreshedReader;
  index2.close();
  TestDirectoryReader.assertIndexEquals(index1,index2_refreshed);
  index2_refreshed.close();
  assertReaderClosed(index2,true,true);
  assertReaderClosed(index2_refreshed,true,true);
  index2=test.openReader();
  for (int i=1; i < 4; i++) {
    index1.close();
    couple=refreshReader(index2,test,i,true);
    index2.close();
    index2=couple.refreshedReader;
    index1=couple.newReader;
    TestDirectoryReader.assertIndexEquals(index1,index2);
  }
  index1.close();
  index2.close();
  assertReaderClosed(index1,true,true);
  assertReaderClosed(index2,true,true);
}
