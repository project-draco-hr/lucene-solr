{
  Replica replica=cloudClient.getZkStateReader().getLeaderRetry(DEFAULT_COLLECTION,SHARD1);
  CollectionAdminRequest.AddReplicaProp addReplicaPropRequest=new CollectionAdminRequest.AddReplicaProp();
  addReplicaPropRequest.setCollectionName(DEFAULT_COLLECTION);
  addReplicaPropRequest.setShardName(SHARD1);
  addReplicaPropRequest.setReplica(replica.getName());
  addReplicaPropRequest.setPropertyName("preferredleader");
  addReplicaPropRequest.setPropertyValue("true");
  CollectionAdminResponse response=addReplicaPropRequest.process(cloudClient);
  assertEquals(0,response.getStatus());
  long timeout=System.currentTimeMillis() + 20000;
  String propertyValue=null;
  String replicaName=replica.getName();
  while (System.currentTimeMillis() < timeout) {
    ClusterState clusterState=cloudClient.getZkStateReader().getClusterState();
    replica=clusterState.getReplica(DEFAULT_COLLECTION,replicaName);
    propertyValue=replica.getStr("property.preferredleader");
    if (StringUtils.equals("true",propertyValue))     break;
    Thread.sleep(50);
  }
  assertEquals("Replica property was not updated, Latest value: " + cloudClient.getZkStateReader().getClusterState().getReplica(DEFAULT_COLLECTION,replicaName),"true",propertyValue);
  CollectionAdminRequest.DeleteReplicaProp deleteReplicaPropRequest=new CollectionAdminRequest.DeleteReplicaProp();
  deleteReplicaPropRequest.setCollectionName(DEFAULT_COLLECTION);
  deleteReplicaPropRequest.setShardName(SHARD1);
  deleteReplicaPropRequest.setReplica(replicaName);
  deleteReplicaPropRequest.setPropertyName("property.preferredleader");
  response=deleteReplicaPropRequest.process(cloudClient);
  assertEquals(0,response.getStatus());
  timeout=System.currentTimeMillis() + 20000;
  boolean updated=false;
  while (System.currentTimeMillis() < timeout) {
    ClusterState clusterState=cloudClient.getZkStateReader().getClusterState();
    replica=clusterState.getReplica(DEFAULT_COLLECTION,replicaName);
    updated=replica.getStr("property.preferredleader") == null;
    if (updated)     break;
    Thread.sleep(50);
  }
  assertTrue("Replica property was not removed",updated);
}
