{
  if (!dbHome.exists())   dbHome.mkdir();
 else {
    File[] files=dbHome.listFiles();
    for (int i=0; i < files.length; i++) {
      String name=files[i].getName();
      if (name.startsWith("__") || name.startsWith("log."))       files[i].delete();
    }
  }
  EnvironmentConfig envConfig=new EnvironmentConfig();
  DatabaseConfig dbConfig=new DatabaseConfig();
  envConfig.setTransactional(true);
  envConfig.setInitializeCache(true);
  envConfig.setInitializeLocking(true);
  envConfig.setInitializeLogging(true);
  envConfig.setAllowCreate(true);
  envConfig.setThreaded(true);
  dbConfig.setAllowCreate(true);
  dbConfig.setType(DatabaseType.BTREE);
  env=new Environment(dbHome,envConfig);
  Transaction txn=null;
  try {
    txn=env.beginTransaction(null,null);
    index=env.openDatabase(txn,"__index__",null,dbConfig);
    blocks=env.openDatabase(txn,"__blocks__",null,dbConfig);
  }
 catch (  DatabaseException e) {
    if (txn != null) {
      txn.abort();
      txn=null;
    }
    index=null;
    blocks=null;
    throw e;
  }
 finally {
    if (txn != null)     txn.commit();
    txn=null;
  }
}
