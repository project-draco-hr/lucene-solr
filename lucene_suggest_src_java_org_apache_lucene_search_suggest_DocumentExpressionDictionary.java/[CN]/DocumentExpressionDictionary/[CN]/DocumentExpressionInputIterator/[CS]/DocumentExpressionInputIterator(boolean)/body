{
  super(hasPayloads);
  leaves=reader.leaves();
  if (leaves.size() == 0) {
    throw new IllegalArgumentException("Reader has to have at least one leaf");
  }
  starts=new int[leaves.size() + 1];
  for (int i=0; i < leaves.size(); i++) {
    starts[i]=leaves.get(i).docBase;
  }
  starts[leaves.size()]=reader.maxDoc();
  currentLeafIndex=0;
  currentWeightValues=weightsValueSource.getValues(new HashMap<String,Object>(),leaves.get(currentLeafIndex));
}
