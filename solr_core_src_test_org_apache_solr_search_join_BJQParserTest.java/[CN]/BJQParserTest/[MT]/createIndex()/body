{
  int i=0;
  List<List<String[]>> blocks=createBlocks();
  for (  List<String[]> block : blocks) {
    for (    String[] doc : block) {
      String[] idDoc=Arrays.copyOf(doc,doc.length + 2);
      idDoc[doc.length]="id";
      idDoc[doc.length + 1]=Integer.toString(i);
      assertU(add(doc(idDoc)));
      i++;
    }
    if (random().nextBoolean()) {
      assertU(commit());
      if (random().nextBoolean()) {
        assertU(commit());
      }
    }
  }
  assertU(commit());
  assertQ(req("q","*:*"),"//*[@numFound='" + i + "']");
}
