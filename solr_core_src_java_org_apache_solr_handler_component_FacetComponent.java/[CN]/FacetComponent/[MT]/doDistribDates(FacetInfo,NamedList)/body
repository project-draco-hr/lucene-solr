{
  @SuppressWarnings("unchecked") SimpleOrderedMap<SimpleOrderedMap<Object>> facet_dates=(SimpleOrderedMap<SimpleOrderedMap<Object>>)facet_counts.get("facet_dates");
  if (facet_dates != null) {
    for (    Map.Entry<String,SimpleOrderedMap<Object>> entry : facet_dates) {
      final String field=entry.getKey();
      if (fi.dateFacets.get(field) == null) {
        fi.dateFacets.add(field,entry.getValue());
      }
 else {
        SimpleOrderedMap<Object> shardFieldValues=entry.getValue();
        SimpleOrderedMap<Object> existFieldValues=fi.dateFacets.get(field);
        for (        Map.Entry<String,Object> existPair : existFieldValues) {
          final String key=existPair.getKey();
          if (key.equals("gap") || key.equals("end") || key.equals("start")) {
            continue;
          }
          Integer newValue=(Integer)shardFieldValues.get(key);
          if (null != newValue) {
            Integer oldValue=((Integer)existPair.getValue());
            existPair.setValue(oldValue + newValue);
          }
        }
      }
    }
  }
}
