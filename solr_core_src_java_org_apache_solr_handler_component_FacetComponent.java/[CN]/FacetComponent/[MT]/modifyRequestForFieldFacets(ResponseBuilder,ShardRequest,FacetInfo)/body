{
  for (  DistribFieldFacet dff : fi.facets.values()) {
    String paramStart="f." + dff.field + '.';
    sreq.params.remove(paramStart + FacetParams.FACET_MINCOUNT);
    sreq.params.remove(paramStart + FacetParams.FACET_OFFSET);
    dff.initialLimit=dff.limit <= 0 ? dff.limit : dff.offset + dff.limit;
    if (dff.sort.equals(FacetParams.FACET_SORT_COUNT)) {
      if (dff.limit > 0) {
        dff.initialLimit=doOverRequestMath(dff.initialLimit,dff.overrequestRatio,dff.overrequestCount);
        dff.initialMincount=0;
      }
 else {
        dff.initialMincount=Math.min(dff.minCount,1);
      }
    }
 else {
      if (dff.minCount <= 1) {
        dff.initialMincount=dff.minCount;
      }
 else {
        dff.initialMincount=(int)Math.ceil((double)dff.minCount / rb.slices.length);
      }
    }
    dff.initialLimit=rb.req.getParams().getInt("facet.shard.limit",dff.initialLimit);
    sreq.params.set(paramStart + FacetParams.FACET_LIMIT,dff.initialLimit);
    sreq.params.set(paramStart + FacetParams.FACET_MINCOUNT,dff.initialMincount);
  }
}
