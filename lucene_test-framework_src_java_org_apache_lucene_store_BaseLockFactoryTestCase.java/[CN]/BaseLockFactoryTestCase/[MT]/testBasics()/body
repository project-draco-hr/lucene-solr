{
  Path tempPath=createTempDir();
  assumeFalse("test works with lock files",TestUtil.hasVirusChecker(tempPath));
  Directory dir=getDirectory(tempPath);
  Lock l=dir.obtainLock("commit");
  try {
    dir.obtainLock("commit");
    fail("succeeded in obtaining lock twice, didn't get exception");
  }
 catch (  LockObtainFailedException expected) {
  }
  l.close();
  l=dir.obtainLock("commit");
  l.close();
  dir.close();
}
