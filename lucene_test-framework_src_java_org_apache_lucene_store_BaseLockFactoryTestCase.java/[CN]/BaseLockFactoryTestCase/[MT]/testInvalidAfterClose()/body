{
  Path tempPath=createTempDir();
  assumeFalse("test works with lock files",TestUtil.hasVirusChecker(tempPath));
  Directory dir=getDirectory(tempPath);
  Lock l=dir.obtainLock("commit");
  l.close();
  try {
    l.ensureValid();
    fail("didn't get exception");
  }
 catch (  AlreadyClosedException expected) {
  }
  dir.close();
}
