{
  IndexWriter writer=null;
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  for (int i=0; i < this.numIteration; i++) {
    if (VERBOSE) {
      System.out.println("TEST: WriterThread iter=" + i);
    }
    IndexWriterConfig iwc=new IndexWriterConfig(new MockAnalyzer(random()));
    PrintStream printStream;
    try {
      printStream=new PrintStream(baos,true,"UTF8");
    }
 catch (    UnsupportedEncodingException uee) {
      throw new RuntimeException(uee);
    }
    iwc.setInfoStream(new PrintStreamInfoStream(printStream));
    printStream.println("\nTEST: WriterThread iter=" + i);
    iwc.setOpenMode(OpenMode.APPEND);
    try {
      writer=new IndexWriter(dir,iwc);
    }
 catch (    LockObtainFailedException e) {
    }
catch (    Throwable t) {
      if (Constants.WINDOWS && t instanceof AccessDeniedException) {
      }
 else {
        hitException=true;
        System.out.println("Stress Test Index Writer: creation hit unexpected exception: " + t.toString());
        t.printStackTrace(System.out);
        System.out.println(toString(baos));
      }
      break;
    }
    if (writer != null) {
      try {
        addDoc(writer);
      }
 catch (      Throwable t) {
        hitException=true;
        System.out.println("Stress Test Index Writer: addDoc hit unexpected exception: " + t.toString());
        t.printStackTrace(System.out);
        System.out.println(toString(baos));
        break;
      }
      try {
        writer.close();
      }
 catch (      Throwable t) {
        hitException=true;
        System.out.println("Stress Test Index Writer: close hit unexpected exception: " + t.toString());
        t.printStackTrace(System.out);
        System.out.println(toString(baos));
        break;
      }
      writer=null;
    }
  }
}
