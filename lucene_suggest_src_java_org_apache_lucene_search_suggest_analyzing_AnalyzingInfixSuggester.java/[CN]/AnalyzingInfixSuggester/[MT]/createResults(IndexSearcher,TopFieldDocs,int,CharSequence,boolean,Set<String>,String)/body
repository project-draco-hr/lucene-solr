{
  List<LeafReaderContext> leaves=searcher.getIndexReader().leaves();
  List<LookupResult> results=new ArrayList<>();
  for (int i=0; i < hits.scoreDocs.length; i++) {
    FieldDoc fd=(FieldDoc)hits.scoreDocs[i];
    BinaryDocValues textDV=MultiDocValues.getBinaryValues(searcher.getIndexReader(),TEXT_FIELD_NAME);
    textDV.advance(fd.doc);
    BytesRef term=textDV.binaryValue();
    String text=term.utf8ToString();
    long score=(Long)fd.fields[0];
    BinaryDocValues payloadsDV=MultiDocValues.getBinaryValues(searcher.getIndexReader(),"payloads");
    BytesRef payload;
    if (payloadsDV != null) {
      if (payloadsDV.advance(fd.doc) == fd.doc) {
        payload=BytesRef.deepCopyOf(payloadsDV.binaryValue());
      }
 else {
        payload=new BytesRef(BytesRef.EMPTY_BYTES);
      }
    }
 else {
      payload=null;
    }
    int segment=ReaderUtil.subIndex(fd.doc,leaves);
    SortedSetDocValues contextsDV=leaves.get(segment).reader().getSortedSetDocValues(CONTEXTS_FIELD_NAME);
    Set<BytesRef> contexts;
    if (contextsDV != null) {
      contexts=new HashSet<BytesRef>();
      int targetDocID=fd.doc - leaves.get(segment).docBase;
      if (contextsDV.advance(targetDocID) == targetDocID) {
        long ord;
        while ((ord=contextsDV.nextOrd()) != SortedSetDocValues.NO_MORE_ORDS) {
          BytesRef context=BytesRef.deepCopyOf(contextsDV.lookupOrd(ord));
          contexts.add(context);
        }
      }
    }
 else {
      contexts=null;
    }
    LookupResult result;
    if (doHighlight) {
      result=new LookupResult(text,highlight(text,matchedTokens,prefixToken),score,payload,contexts);
    }
 else {
      result=new LookupResult(text,score,payload,contexts);
    }
    results.add(result);
  }
  return results;
}
