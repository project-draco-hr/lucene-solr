{
  Directory dir=new RAMDirectory();
  dir.setLockFactory(NoLockFactory.getNoLockFactory());
  assertTrue("RAMDirectory.setLockFactory did not take",NoLockFactory.class.isInstance(dir.getLockFactory()));
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
  IndexWriter writer2=null;
  try {
    writer2=new IndexWriter(dir,new WhitespaceAnalyzer(),false);
  }
 catch (  Exception e) {
    fail("Should not have hit an IOException with no locking");
  }
  writer.close();
  if (writer2 != null) {
    writer2.close();
  }
}
