{
  NativeFSLockFactory f=NativeFSLockFactory.getLockFactory();
  NativeFSLockFactory f2=NativeFSLockFactory.getLockFactory();
  assertTrue("got different NativeFSLockFactory instances for same directory",f == f2);
  f.setLockPrefix("test");
  Lock l=f.makeLock("commit");
  Lock l2=f.makeLock("commit");
  assertTrue("got different Lock instances for same lock name",l == l2);
  assertTrue("failed to obtain lock",l.obtain());
  assertTrue("succeeded in obtaining lock twice",!l.obtain());
  l.release();
  assertTrue("failed to obtain lock",l.obtain());
  l.release();
}
