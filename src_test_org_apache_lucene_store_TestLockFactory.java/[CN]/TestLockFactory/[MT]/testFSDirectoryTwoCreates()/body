{
  String indexDirName="index.TestLockFactory2";
  IndexWriter writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true);
  assertTrue("FSDirectory did not use correct LockFactory: got " + writer.getDirectory().getLockFactory(),SimpleFSLockFactory.class.isInstance(writer.getDirectory().getLockFactory()) || NativeFSLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
  IndexWriter writer2=null;
  try {
    writer2=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true);
  }
 catch (  IOException e) {
    e.printStackTrace(System.out);
    fail("Should not have hit an IOException with two IndexWriters with create=true, on default SimpleFSLockFactory");
  }
  writer.close();
  if (writer2 != null) {
    try {
      writer2.close();
      fail("writer2.close() should have hit LockReleaseFailedException");
    }
 catch (    LockReleaseFailedException e) {
    }
  }
  rmDir(indexDirName);
}
