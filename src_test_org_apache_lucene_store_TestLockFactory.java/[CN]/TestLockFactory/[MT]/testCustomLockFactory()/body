{
  Directory dir=new RAMDirectory();
  MockLockFactory lf=new MockLockFactory();
  dir.setLockFactory(lf);
  assertTrue("lock prefix was not set by the RAMDirectory",lf.lockPrefixSet);
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
  for (int i=0; i < 100; i++) {
    addDoc(writer);
  }
  assertEquals("# of unique locks created (after instantiating IndexWriter)",2,lf.locksCreated.size());
  assertTrue("# calls to makeLock <= 2 (after instantiating IndexWriter)",lf.makeLockCount > 2);
  for (Enumeration e=lf.locksCreated.keys(); e.hasMoreElements(); ) {
    String lockName=(String)e.nextElement();
    MockLockFactory.MockLock lock=(MockLockFactory.MockLock)lf.locksCreated.get(lockName);
    assertTrue("# calls to Lock.obtain is 0 (after instantiating IndexWriter)",lock.lockAttempts > 0);
  }
  writer.close();
}
