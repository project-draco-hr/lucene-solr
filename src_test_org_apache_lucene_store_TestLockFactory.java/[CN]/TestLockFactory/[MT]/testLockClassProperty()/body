{
  File indexDirName=_TestUtil.getTempDir("index.TestLockFactory3");
  String prpName="org.apache.lucene.store.FSDirectoryLockFactoryClass";
  try {
    System.setProperty(prpName,"org.apache.lucene.store.NoLockFactory");
    IndexWriter writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    assertTrue("FSDirectory did not use correct LockFactory: got " + writer.getDirectory().getLockFactory(),NoLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
    writer.close();
    System.setProperty(prpName,"org.apache.lucene.store.SingleInstanceLockFactory");
    writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    assertTrue("FSDirectory did not use correct LockFactory: got " + writer.getDirectory().getLockFactory(),SingleInstanceLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
    writer.close();
    System.setProperty(prpName,"org.apache.lucene.store.NativeFSLockFactory");
    writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    assertTrue("FSDirectory did not use correct LockFactory: got " + writer.getDirectory().getLockFactory(),NativeFSLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
    writer.close();
    System.setProperty(prpName,"org.apache.lucene.store.SimpleFSLockFactory");
    writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    assertTrue("FSDirectory did not use correct LockFactory: got " + writer.getDirectory().getLockFactory(),SimpleFSLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
    writer.close();
  }
  finally {
    System.setProperty("org.apache.lucene.store.FSDirectoryLockFactoryClass","");
  }
  _TestUtil.rmDir(indexDirName);
}
