{
  File indexDirName=_TestUtil.getTempDir("index.TestLockFactory4");
  assertTrue("Locks are already disabled",!FSDirectory.getDisableLocks());
  FSDirectory.setDisableLocks(true);
  IndexWriter writer=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  assertTrue("FSDirectory did not use correct default LockFactory: got " + writer.getDirectory().getLockFactory(),NoLockFactory.class.isInstance(writer.getDirectory().getLockFactory()));
  IndexWriter writer2=null;
  try {
    writer2=new IndexWriter(indexDirName,new WhitespaceAnalyzer(),false,IndexWriter.MaxFieldLength.LIMITED);
  }
 catch (  IOException e) {
    e.printStackTrace(System.out);
    fail("Should not have hit an IOException with locking disabled");
  }
  FSDirectory.setDisableLocks(false);
  writer.close();
  if (writer2 != null) {
    writer2.close();
  }
  _TestUtil.rmDir(indexDirName);
}
