{
  TermVectorsReader reader=Codec.getDefault().termVectorsFormat().vectorsReader(dir,seg.info,fieldInfos,newIOContext(random()));
  BytesRef[] terms;
  Terms vector=reader.get(0).terms(testFields[0]);
  assertNotNull(vector);
  assertEquals(testTerms.length,vector.size());
  TermsEnum termsEnum=vector.iterator(null);
  DocsAndPositionsEnum dpEnum=null;
  for (int i=0; i < testTerms.length; i++) {
    final BytesRef text=termsEnum.next();
    assertNotNull(text);
    String term=text.utf8ToString();
    assertEquals(testTerms[i],term);
    dpEnum=termsEnum.docsAndPositions(null,dpEnum);
    assertNotNull(dpEnum);
    int doc=dpEnum.docID();
    assertTrue(doc == -1 || doc == DocIdSetIterator.NO_MORE_DOCS);
    assertTrue(dpEnum.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
    assertEquals(dpEnum.freq(),positions[i].length);
    for (int j=0; j < positions[i].length; j++) {
      assertEquals(positions[i][j],dpEnum.nextPosition());
    }
    assertEquals(DocIdSetIterator.NO_MORE_DOCS,dpEnum.nextDoc());
    dpEnum=termsEnum.docsAndPositions(null,dpEnum);
    doc=dpEnum.docID();
    assertTrue(doc == -1 || doc == DocIdSetIterator.NO_MORE_DOCS);
    assertTrue(dpEnum.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
    assertNotNull(dpEnum);
    assertEquals(dpEnum.freq(),positions[i].length);
    for (int j=0; j < positions[i].length; j++) {
      assertEquals(positions[i][j],dpEnum.nextPosition());
      assertEquals(j * 10,dpEnum.startOffset());
      assertEquals(j * 10 + testTerms[i].length(),dpEnum.endOffset());
    }
    assertEquals(DocIdSetIterator.NO_MORE_DOCS,dpEnum.nextDoc());
  }
  Terms freqVector=reader.get(0).terms(testFields[1]);
  assertNotNull(freqVector);
  assertEquals(testTerms.length,freqVector.size());
  termsEnum=freqVector.iterator(null);
  assertNotNull(termsEnum);
  for (int i=0; i < testTerms.length; i++) {
    final BytesRef text=termsEnum.next();
    assertNotNull(text);
    String term=text.utf8ToString();
    assertEquals(testTerms[i],term);
  }
  reader.close();
}
