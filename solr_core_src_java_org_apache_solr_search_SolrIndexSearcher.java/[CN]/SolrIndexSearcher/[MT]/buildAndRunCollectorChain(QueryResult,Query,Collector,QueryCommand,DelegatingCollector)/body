{
  final boolean terminateEarly=(cmd.getFlags() & TERMINATE_EARLY) == TERMINATE_EARLY;
  if (terminateEarly) {
    collector=new EarlyTerminatingCollector(collector,cmd.len);
  }
  final long timeAllowed=cmd.getTimeAllowed();
  if (timeAllowed > 0) {
    collector=new TimeLimitingCollector(collector,TimeLimitingCollector.getGlobalCounter(),timeAllowed);
  }
  if (postFilter != null) {
    postFilter.setLastDelegate(collector);
    collector=postFilter;
  }
  try {
    super.search(query,collector);
    if (collector instanceof DelegatingCollector) {
      ((DelegatingCollector)collector).finish();
    }
  }
 catch (  TimeLimitingCollector.TimeExceededException|ExitableDirectoryReader.ExitingReaderException x) {
    log.warn("Query: " + query + "; "+ x.getMessage());
    qr.setPartialResults(true);
  }
}
