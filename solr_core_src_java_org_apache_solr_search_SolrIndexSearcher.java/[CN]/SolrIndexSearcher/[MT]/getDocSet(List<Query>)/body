{
  if (queries != null) {
    for (    Query q : queries) {
      if (q instanceof ScoreFilter) {
        return getDocSetScore(queries);
      }
    }
  }
  ProcessedFilter pf=getProcessedFilter(null,queries);
  if (pf.answer != null)   return pf.answer;
  DocSetCollector setCollector=new DocSetCollector(maxDoc());
  Collector collector=setCollector;
  if (pf.postFilter != null) {
    pf.postFilter.setLastDelegate(collector);
    collector=pf.postFilter;
  }
  for (  final LeafReaderContext leaf : leafContexts) {
    final LeafReader reader=leaf.reader();
    Bits liveDocs=reader.getLiveDocs();
    DocIdSet idSet=null;
    if (pf.filter != null) {
      idSet=pf.filter.getDocIdSet(leaf,liveDocs);
      if (idSet == null)       continue;
    }
    DocIdSetIterator idIter=null;
    if (idSet != null) {
      idIter=idSet.iterator();
      if (idIter == null)       continue;
      if (!pf.hasDeletedDocs)       liveDocs=null;
    }
    final LeafCollector leafCollector=collector.getLeafCollector(leaf);
    int max=reader.maxDoc();
    if (idIter == null) {
      for (int docid=0; docid < max; docid++) {
        if (liveDocs != null && !liveDocs.get(docid))         continue;
        leafCollector.collect(docid);
      }
    }
 else {
      if (liveDocs != null) {
        for (int docid=-1; (docid=idIter.advance(docid + 1)) < max; ) {
          if (liveDocs.get(docid))           leafCollector.collect(docid);
        }
      }
 else {
        for (int docid=-1; (docid=idIter.advance(docid + 1)) < max; ) {
          leafCollector.collect(docid);
        }
      }
    }
  }
  if (collector instanceof DelegatingCollector) {
    ((DelegatingCollector)collector).finish();
  }
  return setCollector.getDocSet();
}
