{
  ProcessedFilter pf=getProcessedFilter(null,queries);
  if (pf.answer != null)   return pf.answer;
  DocSetCollector setCollector=new DocSetCollector(maxDoc() >> 6,maxDoc());
  Collector collector=setCollector;
  if (pf.postFilter != null) {
    pf.postFilter.setLastDelegate(collector);
    collector=pf.postFilter;
  }
  for (  final AtomicReaderContext leaf : leafContexts) {
    final AtomicReader reader=leaf.reader();
    final Bits liveDocs=reader.getLiveDocs();
    DocIdSet idSet=null;
    if (pf.filter != null) {
      idSet=pf.filter.getDocIdSet(leaf,liveDocs);
      if (idSet == null)       continue;
    }
    DocIdSetIterator idIter=null;
    if (idSet != null) {
      idIter=idSet.iterator();
      if (idIter == null)       continue;
    }
    collector.setNextReader(leaf);
    int max=reader.maxDoc();
    if (idIter == null) {
      for (int docid=0; docid < max; docid++) {
        if (liveDocs != null && !liveDocs.get(docid))         continue;
        collector.collect(docid);
      }
    }
 else {
      for (int docid=-1; (docid=idIter.advance(docid + 1)) < max; ) {
        collector.collect(docid);
      }
    }
  }
  return setCollector.getDocSet();
}
