{
  IndexReader r=getRunData().getIndexReader();
  int maxDoc=r.maxDoc();
  int numDeleted=0;
  int numToDelete=((int)(maxDoc * percent)) - r.numDeletedDocs();
  if (numToDelete < 0) {
    r.undeleteAll();
    numToDelete=(int)(maxDoc * percent);
  }
  while (numDeleted < numToDelete) {
    double delRate=((double)(numToDelete - numDeleted)) / r.numDocs();
    TermDocs termDocs=r.termDocs(null);
    while (termDocs.next() && numDeleted < numToDelete) {
      if (random.nextDouble() <= delRate) {
        r.deleteDocument(termDocs.doc());
        numDeleted++;
      }
    }
    termDocs.close();
  }
  System.out.println("--> processed (delete) " + numDeleted + " docs");
  r.decRef();
  return numDeleted;
}
