{
  if (analyzer == null) {
    return query;
  }
  StringBuilder norm=new StringBuilder();
  try (TokenStream tokens=analyzer.tokenStream("",query)){
    tokens.reset();
    CharTermAttribute termAtt=tokens.addAttribute(CharTermAttribute.class);
    while (tokens.incrementToken()) {
      norm.append(termAtt.buffer(),0,termAtt.length());
    }
    tokens.end();
    return norm.toString();
  }
 }
