{
  SolrDocument solrDoc=new SolrDocument();
  for (  IndexableField f : doc) {
    String fieldName=f.name();
    if (!returnFields.wantsField(fieldName))     continue;
    SchemaField sf=schema.getFieldOrNull(fieldName);
    Object val=null;
    try {
      val=getValue(sf,f);
    }
 catch (    Exception e) {
      LOG.warn("Error reading a field from document : " + solrDoc,e);
      continue;
    }
    if (sf != null && sf.multiValued() && !solrDoc.containsKey(fieldName)) {
      ArrayList l=new ArrayList();
      l.add(val);
      solrDoc.addField(fieldName,l);
    }
 else {
      solrDoc.addField(fieldName,val);
    }
  }
  return solrDoc;
}
