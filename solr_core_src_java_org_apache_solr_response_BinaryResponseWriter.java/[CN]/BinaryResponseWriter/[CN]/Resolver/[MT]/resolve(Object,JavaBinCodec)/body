{
  if (o instanceof ResultContext) {
    writeResults((ResultContext)o,codec);
    return null;
  }
  if (o instanceof DocList) {
    ResultContext ctx=new ResultContext();
    ctx.docs=(DocList)o;
    writeResults(ctx,codec);
    return null;
  }
  if (o instanceof StorableField) {
    if (schema == null)     schema=solrQueryRequest.getSchema();
    StorableField f=(StorableField)o;
    SchemaField sf=schema.getFieldOrNull(f.name());
    try {
      o=getValue(sf,f);
    }
 catch (    Exception e) {
      LOG.warn("Error reading a field : " + o,e);
    }
  }
  if (o instanceof SolrDocument) {
    SolrDocument doc=(SolrDocument)o;
    Iterator<Map.Entry<String,Object>> i=doc.iterator();
    while (i.hasNext()) {
      String fname=i.next().getKey();
      if (!returnFields.wantsField(fname)) {
        i.remove();
      }
    }
    return doc;
  }
  return o;
}
