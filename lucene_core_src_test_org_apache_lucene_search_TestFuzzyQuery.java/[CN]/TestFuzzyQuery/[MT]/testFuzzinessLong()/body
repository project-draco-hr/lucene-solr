{
  Directory directory=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,directory);
  addDoc("aaaaaaa",writer);
  addDoc("segment",writer);
  IndexReader reader=writer.getReader();
  IndexSearcher searcher=newSearcher(reader);
  writer.close();
  FuzzyQuery query;
  query=new FuzzyQuery(new Term("field","xxxxx"),0.5f,0);
  ScoreDoc[] hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","aaaaccc"),0.5f,0);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals(searcher.doc(hits[0].doc).get("field"),("aaaaaaa"));
  query=new FuzzyQuery(new Term("field","aaaaccc"),0.5f,1);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals(searcher.doc(hits[0].doc).get("field"),("aaaaaaa"));
  query=new FuzzyQuery(new Term("field","aaaaccc"),0.5f,4);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  assertEquals(searcher.doc(hits[0].doc).get("field"),("aaaaaaa"));
  query=new FuzzyQuery(new Term("field","aaaaccc"),0.5f,5);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","aaacccc"),0.5f,0);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","aaacccc"),0.5f,2);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","student"),0.5f,0);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  query=new FuzzyQuery(new Term("field","stellent"),0.5f,0);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  query=new FuzzyQuery(new Term("field","student"),0.5f,1);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  query=new FuzzyQuery(new Term("field","stellent"),0.5f,1);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  query=new FuzzyQuery(new Term("field","student"),0.5f,2);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","stellent"),0.5f,2);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  query=new FuzzyQuery(new Term("field","student"),0.6f,0);
  hits=searcher.search(query,null,1000).scoreDocs;
  assertEquals(0,hits.length);
  try {
    query=new FuzzyQuery(new Term("field","student"),1.1f);
    fail("Expected IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
  }
  try {
    query=new FuzzyQuery(new Term("field","student"),-0.1f);
    fail("Expected IllegalArgumentException");
  }
 catch (  IllegalArgumentException e) {
  }
  reader.close();
  directory.close();
}
