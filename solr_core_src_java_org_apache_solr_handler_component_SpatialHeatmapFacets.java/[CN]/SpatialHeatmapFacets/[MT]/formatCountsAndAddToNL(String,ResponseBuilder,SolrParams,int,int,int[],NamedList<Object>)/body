{
  final String format=params.getFieldParam(fieldKey,FacetParams.FACET_HEATMAP_FORMAT,FORMAT_INTS2D);
  final Object countsVal;
switch (format) {
case FORMAT_INTS2D:
    countsVal=counts != null ? asInts2D(columns,rows,counts) : null;
  break;
case FORMAT_PNG:
countsVal=counts != null ? asPngBytes(columns,rows,counts,rb) : null;
break;
default :
throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"format should be " + FORMAT_INTS2D + " or "+ FORMAT_PNG);
}
result.add("counts_" + format,countsVal);
}
