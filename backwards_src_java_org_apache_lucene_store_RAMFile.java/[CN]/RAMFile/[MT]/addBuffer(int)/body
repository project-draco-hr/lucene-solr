{
  byte[] buffer=newBuffer(size);
  if (directory != null) synchronized (directory) {
    buffers.add(buffer);
    directory.sizeInBytes.getAndAdd(size);
    sizeInBytes+=size;
  }
 else   buffers.add(buffer);
  return buffer;
}
