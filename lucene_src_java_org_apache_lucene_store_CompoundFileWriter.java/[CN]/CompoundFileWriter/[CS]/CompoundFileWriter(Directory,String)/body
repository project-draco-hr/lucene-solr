{
  if (dir == null)   throw new NullPointerException("directory cannot be null");
  if (name == null)   throw new NullPointerException("name cannot be null");
  directory=dir;
  entryTableName=IndexFileNames.segmentFileName(IndexFileNames.stripExtension(name),"",IndexFileNames.COMPOUND_FILE_ENTRIES_EXTENSION);
  dataFileName=name;
  boolean success=false;
  try {
    dataOut=directory.createOutput(dataFileName,IOContext.DEFAULT);
    dataOut.writeVInt(FORMAT_CURRENT);
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.closeWhileHandlingException(dataOut);
    }
  }
}
