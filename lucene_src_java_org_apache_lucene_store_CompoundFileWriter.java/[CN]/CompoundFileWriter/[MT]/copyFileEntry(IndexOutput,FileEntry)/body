{
  final IndexInput is=fileEntry.dir.openInput(fileEntry.file,IOContext.READONCE);
  try {
    final long startPtr=dataOut.getFilePointer();
    final long length=fileEntry.length;
    dataOut.copyBytes(is,length);
    long endPtr=dataOut.getFilePointer();
    long diff=endPtr - startPtr;
    if (diff != length)     throw new IOException("Difference in the output file offsets " + diff + " does not match the original file length "+ length);
    fileEntry.offset=startPtr;
    fileEntry.dir.deleteFile(fileEntry.file);
    return length;
  }
  finally {
    is.close();
  }
}
