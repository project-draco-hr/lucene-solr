{
  super.setUp();
  System.setProperty("zkClientTimeout","3000");
  zkDir=dataDir.getAbsolutePath() + File.separator + "zookeeper/server1/data";
  zkServer=new ZkTestServer(zkDir);
  zkServer.run();
  System.setProperty("zkHost",zkServer.getZkAddress());
  AbstractZkTestCase.buildZooKeeper(zkServer.getZkHost(),zkServer.getZkAddress(),"solrconfig.xml","schema.xml");
  log.info("####SETUP_START " + getTestName());
  Map<String,Object> props2=new HashMap<>();
  props2.put("configName","conf1");
  ZkNodeProps zkProps2=new ZkNodeProps(props2);
  SolrZkClient zkClient=new SolrZkClient(zkServer.getZkAddress(),AbstractZkTestCase.TIMEOUT);
  zkClient.makePath(ZkStateReader.COLLECTIONS_ZKNODE + "/testcore",ZkStateReader.toJSON(zkProps2),CreateMode.PERSISTENT,true);
  zkClient.makePath(ZkStateReader.COLLECTIONS_ZKNODE + "/testcore/shards",CreateMode.PERSISTENT,true);
  zkClient.close();
  dataDir1=new File(dataDir + File.separator + "data1");
  dataDir1.mkdirs();
  dataDir2=new File(dataDir + File.separator + "data2");
  dataDir2.mkdirs();
  System.setProperty("solr.test.sys.prop1","propone");
  System.setProperty("solr.test.sys.prop2","proptwo");
  System.setProperty("solr.solr.home",TEST_HOME());
  System.setProperty("hostPort","1661");
  System.setProperty("solr.data.dir",SliceStateUpdateTest.this.dataDir1.getAbsolutePath());
  container1=new CoreContainer();
  container1.load();
  System.clearProperty("hostPort");
  System.setProperty("hostPort","1662");
  System.setProperty("solr.data.dir",SliceStateUpdateTest.this.dataDir2.getAbsolutePath());
  container2=new CoreContainer();
  container2.load();
  System.clearProperty("hostPort");
  System.clearProperty("solr.solr.home");
  log.info("####SETUP_END " + getTestName());
}
