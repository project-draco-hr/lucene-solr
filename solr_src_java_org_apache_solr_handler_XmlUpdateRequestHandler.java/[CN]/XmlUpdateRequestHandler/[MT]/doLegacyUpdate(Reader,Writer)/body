{
  try {
    SolrCore core=SolrCore.getSolrCore();
    UpdateRequestProcessorChain processorFactory=core.getUpdateProcessingChain(null);
    SolrParams params=new MapSolrParams(new HashMap<String,String>());
    SolrQueryRequestBase req=new SolrQueryRequestBase(core,params){
    }
;
    SolrQueryResponse rsp=new SolrQueryResponse();
    XMLStreamReader parser=inputFactory.createXMLStreamReader(input);
    UpdateRequestProcessor processor=processorFactory.createProcessor(req,rsp);
    XMLLoader loader=(XMLLoader)newLoader(req,processor);
    loader.processUpdate(processor,parser);
    processor.finish();
    output.write("<result status=\"0\"></result>");
  }
 catch (  Exception ex) {
    try {
      SolrException.logOnce(log,"Error processing \"legacy\" update command",ex);
      XML.writeXML(output,"result",SolrException.toStr(ex),"status","1");
    }
 catch (    Exception ee) {
      log.error("Error writing to output stream: " + ee);
    }
  }
}
