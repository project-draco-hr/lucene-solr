{
  SolrCore core=SolrCore.getSolrCore();
  SolrQueryRequest req=new LocalSolrQueryRequest(core,new HashMap<String,String[]>());
  try {
    UpdateRequestProcessorChain processorFactory=core.getUpdateProcessingChain(null);
    SolrQueryResponse rsp=new SolrQueryResponse();
    XMLStreamReader parser=inputFactory.createXMLStreamReader(input);
    UpdateRequestProcessor processor=processorFactory.createProcessor(req,rsp);
    XMLLoader loader=(XMLLoader)newLoader(req,processor);
    loader.processUpdate(req,processor,parser);
    processor.finish();
    output.write("<result status=\"0\"></result>");
  }
 catch (  Exception ex) {
    try {
      SolrException.logOnce(log,"Error processing \"legacy\" update command",ex);
      XML.writeXML(output,"result",SolrException.toStr(ex),"status","1");
    }
 catch (    Exception ee) {
      log.error("Error writing to output stream: " + ee);
    }
  }
 finally {
    req.close();
  }
}
