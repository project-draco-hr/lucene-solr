{
  SolrQueryRequest req=req("commit","true");
  SolrQueryResponse rsp=new SolrQueryResponse();
  BufferingRequestProcessor p=new BufferingRequestProcessor(null);
  JsonLoader loader=new JsonLoader();
  loader.load(req,rsp,new ContentStreamBase.StringStream(rawJsonStr),p);
  assertEquals(1,p.addCommands.size());
  AddUpdateCommand add=p.addCommands.get(0);
  SolrInputDocument d=add.solrDoc;
  SolrInputField f=d.getField("id");
  assertEquals("1",f.getValue());
  SolrInputDocument cd=d.getChildDocuments().get(0);
  SolrInputField cf=cd.getField("id");
  assertEquals("2",cf.getValue());
  cd=d.getChildDocuments().get(1);
  cf=cd.getField("id");
  assertEquals("3",cf.getValue());
  cf=cd.getField("foo_i");
  assertEquals(2,cf.getValueCount());
  assertEquals(new Object[]{666L,777L},cf.getValues().toArray());
  req.close();
}
