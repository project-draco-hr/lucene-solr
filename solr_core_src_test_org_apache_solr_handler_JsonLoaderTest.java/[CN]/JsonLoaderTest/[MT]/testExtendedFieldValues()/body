{
  String str="[{'id':'1', 'val_s':{'add':'foo'}}]".replace('\'','"');
  SolrQueryRequest req=req();
  SolrQueryResponse rsp=new SolrQueryResponse();
  BufferingRequestProcessor p=new BufferingRequestProcessor(null);
  JsonLoader loader=new JsonLoader();
  loader.load(req,rsp,new ContentStreamBase.StringStream(str),p);
  assertEquals(1,p.addCommands.size());
  AddUpdateCommand add=p.addCommands.get(0);
  assertEquals(add.commitWithin,-1);
  assertEquals(add.overwrite,true);
  SolrInputDocument d=add.solrDoc;
  SolrInputField f=d.getField("id");
  assertEquals("1",f.getValue());
  f=d.getField("val_s");
  Map<String,Object> map=(Map<String,Object>)f.getValue();
  assertEquals("foo",map.get("add"));
  req.close();
}
