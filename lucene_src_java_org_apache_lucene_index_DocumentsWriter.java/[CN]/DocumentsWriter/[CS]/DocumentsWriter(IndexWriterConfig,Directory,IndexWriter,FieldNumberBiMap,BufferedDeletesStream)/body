{
  this.directory=directory;
  this.indexWriter=writer;
  this.similarityProvider=config.getSimilarityProvider();
  this.perThreadPool=config.getIndexerThreadPool();
  this.chain=config.getIndexingChain();
  this.perThreadPool.initialize(this,globalFieldNumbers,config);
  final FlushPolicy configuredPolicy=config.getFlushPolicy();
  if (configuredPolicy == null) {
    flushPolicy=new FlushByRamOrCountsPolicy();
  }
 else {
    flushPolicy=configuredPolicy;
  }
  flushPolicy.init(this);
  flushControl=new DocumentsWriterFlushControl(this,config);
}
