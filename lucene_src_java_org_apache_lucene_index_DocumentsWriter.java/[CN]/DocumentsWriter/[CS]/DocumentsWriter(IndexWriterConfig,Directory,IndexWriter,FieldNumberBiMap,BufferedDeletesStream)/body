{
  this.directory=directory;
  this.indexWriter=writer;
  this.similarityProvider=config.getSimilarityProvider();
  this.bufferedDeletesStream=bufferedDeletesStream;
  this.perThreadPool=config.getIndexerThreadPool();
  this.chain=config.getIndexingChain();
  this.perThreadPool.initialize(this,globalFieldNumbers,config);
  final FlushPolicy configuredPolicy=config.getFlushPolicy();
  if (configuredPolicy == null) {
    flushPolicy=new FlushByRamOrCountsPolicy();
  }
 else {
    flushPolicy=configuredPolicy;
  }
  flushPolicy.init(this);
  healthiness=new Healthiness();
  final long maxRamPerDWPT=config.getRAMPerThreadHardLimitMB() * 1024 * 1024;
  flushControl=new DocumentsWriterFlushControl(flushPolicy,perThreadPool,healthiness,pendingDeletes,maxRamPerDWPT);
}
