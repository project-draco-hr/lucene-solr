{
  maybePushPendingDeletes();
  if (flushedSegment != null) {
    BufferedDeletes deletes=flushedSegment.segmentDeletes;
    final long delGen=bufferedDeletesStream.getNextGen();
    if (deletes != null && deletes.any()) {
      final FrozenBufferedDeletes packet=new FrozenBufferedDeletes(deletes,delGen);
      if (infoStream != null) {
        message("flush: push buffered deletes");
      }
      bufferedDeletesStream.push(packet);
      if (infoStream != null) {
        message("flush: delGen=" + packet.gen);
      }
    }
    flushedSegment.segmentInfo.setBufferedDeletesGen(delGen);
  }
}
