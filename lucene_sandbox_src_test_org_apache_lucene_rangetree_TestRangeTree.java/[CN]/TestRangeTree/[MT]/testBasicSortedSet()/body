{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig();
  Codec codec=TestUtil.alwaysDocValuesFormat(new RangeTreeDocValuesFormat());
  iwc.setCodec(codec);
  RandomIndexWriter w=new RandomIndexWriter(random(),dir,iwc);
  Document doc=new Document();
  doc.add(new SortedSetDocValuesField("value",new BytesRef("abc")));
  w.addDocument(doc);
  doc=new Document();
  doc.add(new SortedSetDocValuesField("value",new BytesRef("def")));
  w.addDocument(doc);
  IndexReader r=w.getReader();
  IndexSearcher s=newSearcher(r,false);
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("aaa"),true,new BytesRef("bbb"),true)));
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("c"),true,new BytesRef("e"),true)));
  assertEquals(2,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("a"),true,new BytesRef("z"),true)));
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",null,true,new BytesRef("abc"),true)));
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("a"),true,new BytesRef("abc"),true)));
  assertEquals(0,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("a"),true,new BytesRef("abc"),false)));
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("def"),true,null,false)));
  assertEquals(1,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("def"),true,new BytesRef("z"),true)));
  assertEquals(0,s.count(new SortedSetRangeTreeQuery("value",new BytesRef("def"),false,new BytesRef("z"),true)));
  IOUtils.close(r,w,dir);
}
