{
  expected.clear();
  for (  Map.Entry<String,List<Replica>> ent : initial.entrySet()) {
    List<Replica> replicas=ent.getValue();
    Replica rep=replicas.get(Math.abs(random().nextInt()) % replicas.size());
    expected.put(ent.getKey(),rep);
    issuePreferred(ent.getKey(),rep);
  }
  if (waitForAllPreferreds() == false) {
    fail("Waited for timeout for preferredLeader assignments to be made and they werent.");
  }
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("action",CollectionParams.CollectionAction.REBALANCELEADERS.toString());
  params.set("collection",COLLECTION_NAME);
  params.set("maxAtOnce","10");
  SolrRequest request=new QueryRequest(params);
  request.setPath("/admin/collections");
  cloudClient.request(request);
}
