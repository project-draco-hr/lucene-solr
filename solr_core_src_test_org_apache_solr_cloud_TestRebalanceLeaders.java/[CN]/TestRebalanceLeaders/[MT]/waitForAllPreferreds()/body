{
  boolean goAgain=true;
  long start=System.currentTimeMillis();
  while (System.currentTimeMillis() - start < timeoutMs) {
    goAgain=false;
    cloudClient.getZkStateReader().updateClusterState(true);
    Map<String,Slice> slices=cloudClient.getZkStateReader().getClusterState().getCollection(COLLECTION_NAME).getSlicesMap();
    for (    Map.Entry<String,Replica> ent : expected.entrySet()) {
      Replica me=slices.get(ent.getKey()).getReplica(ent.getValue().getName());
      if (me.getBool("property.preferredleader",false) == false) {
        goAgain=true;
        break;
      }
    }
    if (goAgain) {
      Thread.sleep(250);
    }
 else {
      return true;
    }
  }
  return false;
}
