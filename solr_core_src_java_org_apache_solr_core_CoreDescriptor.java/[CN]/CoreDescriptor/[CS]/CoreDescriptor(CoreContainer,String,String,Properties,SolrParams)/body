{
  this.coreContainer=container;
  originalCoreProperties.setProperty(CORE_NAME,name);
  originalCoreProperties.setProperty(CORE_INSTDIR,instanceDir);
  Properties containerProperties=container.getContainerProperties();
  name=PropertiesUtil.substituteProperty(checkPropertyIsNotEmpty(name,CORE_NAME),containerProperties);
  instanceDir=PropertiesUtil.substituteProperty(checkPropertyIsNotEmpty(instanceDir,CORE_INSTDIR),containerProperties);
  coreProperties.putAll(defaultProperties);
  coreProperties.put(CORE_NAME,name);
  coreProperties.put(CORE_INSTDIR,instanceDir);
  coreProperties.put(CORE_ABS_INSTDIR,convertToAbsolute(instanceDir,container.getCoreRootDirectory()));
  for (  String propname : coreProps.stringPropertyNames()) {
    String propvalue=coreProps.getProperty(propname);
    if (isUserDefinedProperty(propname))     originalExtraProperties.put(propname,propvalue);
 else     originalCoreProperties.put(propname,propvalue);
    if (!requiredProperties.contains(propname))     coreProperties.setProperty(propname,PropertiesUtil.substituteProperty(propvalue,containerProperties));
  }
  loadExtraProperties();
  buildSubstitutableProperties();
  if (container.isZooKeeperAware()) {
    cloudDesc=new CloudDescriptor(name,coreProperties,this);
    if (params != null) {
      cloudDesc.setParams(params);
    }
  }
 else {
    cloudDesc=null;
  }
  SolrCore.log.info("CORE DESCRIPTOR: " + coreProperties);
}
