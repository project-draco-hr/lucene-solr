{
  OutputStream freq=null, prox=null;
  TermInfosWriter tis=null;
  try {
    freq=directory.createFile(segment + ".frq");
    prox=directory.createFile(segment + ".prx");
    tis=new TermInfosWriter(directory,segment,fieldInfos);
    TermInfo ti=new TermInfo();
    for (int i=0; i < postings.length; i++) {
      Posting posting=postings[i];
      ti.set(1,freq.getFilePointer(),prox.getFilePointer());
      tis.add(posting.term,ti);
      int f=posting.freq;
      if (f == 1)       freq.writeVInt(1);
 else {
        freq.writeVInt(0);
        freq.writeVInt(f);
      }
      int lastPosition=0;
      int[] positions=posting.positions;
      for (int j=0; j < f; j++) {
        int position=positions[j];
        prox.writeVInt(position - lastPosition);
        lastPosition=position;
      }
    }
  }
  finally {
    if (freq != null)     freq.close();
    if (prox != null)     prox.close();
    if (tis != null)     tis.close();
  }
}
