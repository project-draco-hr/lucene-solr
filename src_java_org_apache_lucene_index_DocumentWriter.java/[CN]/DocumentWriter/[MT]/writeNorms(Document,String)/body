{
  Enumeration fields=doc.fields();
  while (fields.hasMoreElements()) {
    Field field=(Field)fields.nextElement();
    if (field.isIndexed()) {
      int n=fieldInfos.fieldNumber(field.name());
      float norm=fieldBoosts[n] * similarity.lengthNorm(field.name(),fieldLengths[n]);
      OutputStream norms=directory.createFile(segment + ".f" + n);
      try {
        norms.writeByte(similarity.encodeNorm(norm));
      }
  finally {
        norms.close();
      }
    }
  }
}
