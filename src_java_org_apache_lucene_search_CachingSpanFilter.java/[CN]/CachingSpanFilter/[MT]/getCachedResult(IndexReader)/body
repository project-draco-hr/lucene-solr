{
  lock.lock();
  try {
    if (cache == null) {
      cache=new WeakHashMap<IndexReader,SpanFilterResult>();
    }
    final SpanFilterResult cached=cache.get(reader);
    if (cached != null)     return cached;
  }
  finally {
    lock.unlock();
  }
  final SpanFilterResult result=filter.bitSpans(reader);
  lock.lock();
  try {
    cache.put(reader,result);
  }
  finally {
    lock.unlock();
  }
  return result;
}
