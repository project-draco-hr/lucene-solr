{
  if (doDocValues && doc instanceof Document) {
    randomPerDocFieldValues((Document)doc);
  }
  if (r.nextInt(5) == 3) {
    w.addDocuments(new Iterable<IndexDocument>(){
      @Override public Iterator<IndexDocument> iterator(){
        return new Iterator<IndexDocument>(){
          boolean done;
          @Override public boolean hasNext(){
            return !done;
          }
          @Override public void remove(){
            throw new UnsupportedOperationException();
          }
          @Override public IndexDocument next(){
            if (done) {
              throw new IllegalStateException();
            }
            done=true;
            return doc;
          }
        }
;
      }
    }
,a);
  }
 else {
    w.addDocument(doc,a);
  }
  maybeCommit();
}
