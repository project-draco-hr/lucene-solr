{
  RAMDirectory dir=new RAMDirectory();
  IndexWriter iw=new IndexWriter(dir,analyzer,true,IndexWriter.MaxFieldLength.LIMITED);
  iw.setMaxBufferedDocs(2);
  addDoc("one",iw,1f);
  addDoc("two",iw,20f);
  addDoc("three four",iw,300f);
  iw.close();
  IndexReader ir=IndexReader.open(dir,true);
  IndexSearcher is=new IndexSearcher(ir);
  ScoreDoc[] hits;
  hits=is.search(new MatchAllDocsQuery(),null,1000).scoreDocs;
  assertEquals(3,hits.length);
  assertEquals("one",ir.document(hits[0].doc).get("key"));
  assertEquals("two",ir.document(hits[1].doc).get("key"));
  assertEquals("three four",ir.document(hits[2].doc).get("key"));
  MatchAllDocsQuery normsQuery=new MatchAllDocsQuery("key");
  hits=is.search(normsQuery,null,1000).scoreDocs;
  assertEquals(3,hits.length);
  assertEquals("three four",ir.document(hits[0].doc).get("key"));
  assertEquals("two",ir.document(hits[1].doc).get("key"));
  assertEquals("one",ir.document(hits[2].doc).get("key"));
  ir.setNorm(0,"key",400f);
  normsQuery=new MatchAllDocsQuery("key");
  hits=is.search(normsQuery,null,1000).scoreDocs;
  assertEquals(3,hits.length);
  assertEquals("one",ir.document(hits[0].doc).get("key"));
  assertEquals("three four",ir.document(hits[1].doc).get("key"));
  assertEquals("two",ir.document(hits[2].doc).get("key"));
  BooleanQuery bq=new BooleanQuery();
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  hits=is.search(bq,null,1000).scoreDocs;
  assertEquals(3,hits.length);
  bq=new BooleanQuery();
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  bq.add(new TermQuery(new Term("key","three")),BooleanClause.Occur.MUST);
  hits=is.search(bq,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  is.getIndexReader().deleteDocument(0);
  hits=is.search(new MatchAllDocsQuery(),null,1000).scoreDocs;
  assertEquals(2,hits.length);
  QueryParser qp=new QueryParser("key",analyzer);
  hits=is.search(qp.parse(new MatchAllDocsQuery().toString()),null,1000).scoreDocs;
  assertEquals(2,hits.length);
  Query maq=new MatchAllDocsQuery();
  maq.setBoost(2.3f);
  Query pq=qp.parse(maq.toString());
  hits=is.search(pq,null,1000).scoreDocs;
  assertEquals(2,hits.length);
  is.close();
  ir.close();
  dir.close();
}
