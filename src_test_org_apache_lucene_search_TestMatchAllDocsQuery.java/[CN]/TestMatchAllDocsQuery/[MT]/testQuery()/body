{
  RAMDirectory dir=new RAMDirectory();
  IndexWriter iw=new IndexWriter(dir,new StandardAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  iw.setMaxBufferedDocs(2);
  addDoc("one",iw);
  addDoc("two",iw);
  addDoc("three four",iw);
  iw.close();
  IndexSearcher is=new IndexSearcher(dir);
  ScoreDoc[] hits=is.search(new MatchAllDocsQuery(),null,1000).scoreDocs;
  assertEquals(3,hits.length);
  BooleanQuery bq=new BooleanQuery();
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  hits=is.search(bq,null,1000).scoreDocs;
  assertEquals(3,hits.length);
  bq=new BooleanQuery();
  bq.add(new MatchAllDocsQuery(),BooleanClause.Occur.MUST);
  bq.add(new TermQuery(new Term("key","three")),BooleanClause.Occur.MUST);
  hits=is.search(bq,null,1000).scoreDocs;
  assertEquals(1,hits.length);
  is.getIndexReader().deleteDocument(0);
  hits=is.search(new MatchAllDocsQuery(),null,1000).scoreDocs;
  assertEquals(2,hits.length);
  is.close();
}
