{
  SolrCore core=h.getCore();
  IndexSchema schema=core.getSchema();
  SchemaField amount=schema.getField("amount");
  assertNotNull(amount);
  assertTrue("amount is not a poly field",amount.isPolyField());
  FieldType tmp=amount.getType();
  assertTrue(tmp instanceof CurrencyField);
  String currencyValue="1.50,EUR";
  IndexableField[] fields=amount.createFields(currencyValue,2);
  assertEquals(fields.length,3);
  for (int i=0; i < 3; i++) {
    boolean hasValue=fields[i].readerValue() != null || fields[i].numericValue() != null || fields[i].stringValue() != null;
    assertTrue("Doesn't have a value: " + fields[i],hasValue);
  }
  assertEquals(schema.getFieldTypeByName("string").toExternal(fields[2]),"1.50,EUR");
  ExchangeRateProvider p=((CurrencyField)tmp).getProvider();
  String[] available=p.listAvailableCurrencies();
  assert(available.length == 5);
  assert(p.reload() == true);
  assert(p.getExchangeRate("USD","EUR") == 2.5);
}
