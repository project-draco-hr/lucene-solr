{
  Directory rd1=newDirectory();
{
    IndexWriter iw=new IndexWriter(rd1,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
    Document doc=new Document();
    FieldType customType=new FieldType(TextField.TYPE_UNSTORED);
    customType.setStoreTermVectors(true);
    doc.add(newField("test","",customType));
    iw.addDocument(doc);
    doc.add(newField("test","",TextField.TYPE_UNSTORED));
    iw.addDocument(doc);
    iw.close();
    IndexReader ir=IndexReader.open(rd1,false);
    ir.deleteDocument(0);
    ir.close();
    iw=new IndexWriter(rd1,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setOpenMode(OpenMode.APPEND));
    iw.forceMerge(1);
    iw.close();
  }
  Directory rd2=newDirectory();
{
    IndexWriter iw=new IndexWriter(rd2,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
    Document doc=new Document();
    iw.addDocument(doc);
    iw.close();
  }
  Directory rdOut=newDirectory();
  IndexWriter iwOut=new IndexWriter(rdOut,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
  ParallelReader pr=new ParallelReader();
  pr.add(IndexReader.open(rd1,true));
  pr.add(IndexReader.open(rd2,true));
  iwOut.addIndexes(pr);
  pr.close();
  rd1.close();
  rd2.close();
  iwOut.forceMerge(1);
  iwOut.close();
  rdOut.close();
}
