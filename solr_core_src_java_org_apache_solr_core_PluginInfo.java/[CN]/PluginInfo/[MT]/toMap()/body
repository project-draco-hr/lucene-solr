{
  LinkedHashMap m=new LinkedHashMap(attributes);
  if (initArgs != null)   m.putAll(initArgs.asMap(3));
  if (children != null) {
    for (    PluginInfo child : children) {
      Object old=m.get(child.name);
      if (old == null) {
        m.put(child.name,child.toMap());
      }
 else       if (old instanceof List) {
        List list=(List)old;
        list.add(child.toMap());
      }
 else {
        ArrayList l=new ArrayList();
        l.add(old);
        l.add(child.toMap());
        m.put(child.name,l);
      }
    }
  }
  return m;
}
