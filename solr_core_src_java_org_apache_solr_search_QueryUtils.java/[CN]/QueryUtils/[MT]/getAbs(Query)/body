{
  if (q instanceof BoostQuery) {
    BoostQuery bq=(BoostQuery)q;
    Query subQ=bq.getQuery();
    Query absSubQ=getAbs(subQ);
    if (absSubQ == subQ)     return q;
    return new BoostQuery(absSubQ,bq.getBoost());
  }
  if (q instanceof WrappedQuery) {
    Query subQ=((WrappedQuery)q).getWrappedQuery();
    Query absSubQ=getAbs(subQ);
    if (absSubQ == subQ)     return q;
    return new WrappedQuery(absSubQ);
  }
  if (!(q instanceof BooleanQuery))   return q;
  BooleanQuery bq=(BooleanQuery)q;
  Collection<BooleanClause> clauses=bq.clauses();
  if (clauses.size() == 0)   return q;
  for (  BooleanClause clause : clauses) {
    if (!clause.isProhibited())     return q;
  }
  if (clauses.size() == 1) {
    Query negClause=clauses.iterator().next().getQuery();
    return negClause;
  }
 else {
    BooleanQuery.Builder newBqB=new BooleanQuery.Builder();
    newBqB.setDisableCoord(bq.isCoordDisabled());
    for (    BooleanClause clause : clauses) {
      newBqB.add(clause.getQuery(),BooleanClause.Occur.SHOULD);
    }
    return newBqB.build();
  }
}
