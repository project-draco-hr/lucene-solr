{
  this.name=checkName(name);
  this.solrConfig=config;
  if (this.name == null)   SolrConfig.config=config;
  if (dataDir == null)   dataDir=solrConfig.get("dataDir",solrConfig.getInstanceDir() + "data");
  if (schema == null)   this.schema=new IndexSchema(config,"schema.xml");
 else   this.schema=schema;
  this.dataDir=dataDir;
  if (name == null)   this.index_path=dataDir + "/index";
 else   this.index_path=dataDir + "/index-" + name;
  log.info("Opening new SolrCore at " + solrConfig.getInstanceDir() + ", dataDir="+ dataDir+ ", indexPath="+ index_path);
  booleanQueryMaxClauseCount();
  this.maxWarmingSearchers=solrConfig.getInt("query/maxWarmingSearchers",Integer.MAX_VALUE);
  parseListeners();
  initIndex();
  initWriters();
  updateProcessors=loadUpdateProcessors();
  reqHandlers=new RequestHandlers(this);
  reqHandlers.initHandlersFromConfig(solrConfig);
  highlighter=new SolrHighlighter();
  highlighter.initalize(solrConfig);
  try {
    getSearcher(false,false,null);
    updateHandler=createUpdateHandler(solrConfig.get("updateHandler/@class",DirectUpdateHandler.class.getName()));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
synchronized (cores) {
    SolrCore previous=cores.get(name);
    if (previous != null) {
      previous.close();
    }
    cores.put(name,this);
  }
}
