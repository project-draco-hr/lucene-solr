{
  if (handler == null) {
    log.warn(logid + "Null Request Handler '" + req.getParams().get(CommonParams.QT)+ "' :"+ req);
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Null Request Handler '" + req.getParams().get(CommonParams.QT) + "'",true);
  }
  final NamedList<Object> responseHeader=new SimpleOrderedMap<Object>();
  rsp.add("responseHeader",responseHeader);
  NamedList toLog=rsp.getToLog();
  toLog.add("webapp",req.getContext().get("webapp"));
  toLog.add("path",req.getContext().get("path"));
  toLog.add("params","{" + req.getParamString() + "}");
  handler.handleRequest(req,rsp);
  setResponseHeaderValues(handler,req,rsp);
  StringBuilder sb=new StringBuilder();
  for (int i=0; i < toLog.size(); i++) {
    String name=toLog.getName(i);
    Object val=toLog.getVal(i);
    sb.append(name).append("=").append(val).append(" ");
  }
  log.info(logid + sb.toString());
}
