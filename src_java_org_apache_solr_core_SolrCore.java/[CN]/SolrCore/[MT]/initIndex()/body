{
  try {
    File dirFile=new File(getDir());
    boolean indexExists=dirFile.canRead();
    boolean removeLocks=SolrConfig.config.getBool("mainIndex/unlockOnStartup",false);
    if (removeLocks) {
      Directory dir=FSDirectory.getDirectory(dirFile,!indexExists);
      if (IndexReader.isLocked(dir)) {
        log.warning("WARNING: Solr index directory '" + getDir() + "' is locked.  Unlocking...");
        IndexReader.unlock(dir);
      }
    }
    if (!indexExists) {
      log.warning("Solr index directory '" + dirFile + "' doesn't exist."+ " Creating new index...");
      SolrIndexWriter writer=new SolrIndexWriter("SolrCore.initIndex",getDir(),true,schema,mainIndexConfig);
      writer.close();
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
