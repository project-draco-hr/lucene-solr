{
  IndexerThreadInterrupt t1=new IndexerThreadInterrupt(1);
  t1.setDaemon(true);
  t1.start();
  IndexerThreadInterrupt t2=new IndexerThreadInterrupt(2);
  t2.setDaemon(true);
  t2.start();
  assertTrue(new ThreadInterruptedException(new InterruptedException()).getCause() instanceof InterruptedException);
  final int numInterrupts=atLeast(300);
  int i=0;
  while (i < numInterrupts) {
    Thread.sleep(10);
    IndexerThreadInterrupt t=random().nextBoolean() ? t1 : t2;
    if (t.allowInterrupt) {
      i++;
      t.interrupt();
    }
    if (!t1.isAlive() && !t2.isAlive()) {
      break;
    }
  }
  t1.finish=true;
  t2.finish=true;
  t1.join();
  t2.join();
  if (t1.failed) {
    System.out.println("Thread1 failed:\n" + new String(t1.bytesLog.toString("UTF-8")));
  }
  if (t2.failed) {
    System.out.println("Thread2 failed:\n" + new String(t2.bytesLog.toString("UTF-8")));
  }
  assertFalse(t1.failed || t2.failed);
}
