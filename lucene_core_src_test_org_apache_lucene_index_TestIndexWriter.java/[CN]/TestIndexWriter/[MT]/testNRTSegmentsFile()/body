{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=new IndexWriterConfig(new MockAnalyzer(random()));
  IndexWriter w=new IndexWriter(dir,iwc);
  w.commit();
  DirectoryReader r=DirectoryReader.open(w);
  assertEquals(1,r.getIndexCommit().getGeneration());
  assertEquals("segments_1",r.getIndexCommit().getSegmentsFileName());
  DirectoryReader r2=DirectoryReader.open(dir);
  assertEquals(1,r2.getIndexCommit().getGeneration());
  assertEquals("segments_1",r2.getIndexCommit().getSegmentsFileName());
  r2.close();
  w.addDocument(new Document());
  w.commit();
  DirectoryReader r3=DirectoryReader.openIfChanged(r);
  r.close();
  assertNotNull(r3);
  assertEquals(2,r3.getIndexCommit().getGeneration());
  assertEquals("segments_2",r3.getIndexCommit().getSegmentsFileName());
  r3.close();
  DirectoryReader r4=DirectoryReader.open(dir);
  assertEquals(2,r4.getIndexCommit().getGeneration());
  assertEquals("segments_2",r4.getIndexCommit().getSegmentsFileName());
  r4.close();
  w.close();
  dir.close();
}
