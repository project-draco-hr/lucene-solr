{
  if (dir instanceof MockDirectoryWrapper) {
    assertFalse("test is broken: should disable virus scanner",((MockDirectoryWrapper)dir).getEnableVirusScanner());
  }
  String[] startFiles=dir.listAll();
  new IndexWriter(dir,new IndexWriterConfig(new MockAnalyzer(random()))).rollback();
  String[] endFiles=dir.listAll();
  Arrays.sort(startFiles);
  Arrays.sort(endFiles);
  if (!Arrays.equals(startFiles,endFiles)) {
    fail(message + ": before delete:\n    " + arrayToString(startFiles)+ "\n  after delete:\n    "+ arrayToString(endFiles));
  }
}
