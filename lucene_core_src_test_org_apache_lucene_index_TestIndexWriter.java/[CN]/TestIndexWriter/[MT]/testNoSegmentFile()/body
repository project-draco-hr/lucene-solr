{
  BaseDirectoryWrapper dir=newDirectory();
  dir.setLockFactory(NoLockFactory.getNoLockFactory());
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig(new MockAnalyzer(random())).setMaxBufferedDocs(2));
  Document doc=new Document();
  FieldType customType=new FieldType(TextField.TYPE_STORED);
  customType.setStoreTermVectors(true);
  customType.setStoreTermVectorPositions(true);
  customType.setStoreTermVectorOffsets(true);
  doc.add(newField("c","val",customType));
  w.addDocument(doc);
  w.addDocument(doc);
  IndexWriter w2=new IndexWriter(dir,newIndexWriterConfig(new MockAnalyzer(random())).setMaxBufferedDocs(2).setOpenMode(OpenMode.CREATE));
  w2.close();
  w.rollback();
  dir.setCheckIndexOnClose(false);
  dir.close();
}
