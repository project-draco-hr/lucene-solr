{
  Directory d=newDirectory();
  IndexWriter w=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())));
  w.addDocument(new Document());
  w.close();
  SegmentInfos sis=new SegmentInfos();
  sis.read(d);
  String id1=sis.getId();
  assertNotNull(id1);
  String id2=sis.info(0).info.getId();
  assertNotNull(id2);
  ByteArrayOutputStream bos=new ByteArrayOutputStream(1024);
  CheckIndex checker=new CheckIndex(d);
  checker.setCrossCheckTermVectors(false);
  checker.setInfoStream(new PrintStream(bos,false,IOUtils.UTF_8),false);
  CheckIndex.Status indexStatus=checker.checkIndex(null);
  String s=bos.toString(IOUtils.UTF_8);
  assertTrue(s,indexStatus != null && indexStatus.clean);
  assertTrue("missing id=" + id1 + " in:\n"+ s,s.contains("id=" + id1));
  assertTrue("missing id=" + id2 + " in:\n"+ s,s.contains("id=" + id2));
  d.close();
  Set<String> ids=new HashSet<>();
  for (int i=0; i < 100000; i++) {
    String id=StringHelper.randomId();
    assertFalse("id=" + id + " i="+ i,ids.contains(id));
    ids.add(id);
  }
}
