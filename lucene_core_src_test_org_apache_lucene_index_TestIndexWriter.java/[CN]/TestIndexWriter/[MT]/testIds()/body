{
  Directory d=newDirectory();
  IndexWriter w=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())));
  w.addDocument(new Document());
  w.close();
  SegmentInfos sis=SegmentInfos.readLatestCommit(d);
  byte[] id1=sis.getId();
  assertNotNull(id1);
  assertEquals(StringHelper.ID_LENGTH,id1.length);
  byte[] id2=sis.info(0).info.getId();
  assertNotNull(id2);
  assertEquals(StringHelper.ID_LENGTH,id2.length);
  ByteArrayOutputStream bos=new ByteArrayOutputStream(1024);
  CheckIndex checker=new CheckIndex(d);
  checker.setCrossCheckTermVectors(false);
  checker.setInfoStream(new PrintStream(bos,false,IOUtils.UTF_8),false);
  CheckIndex.Status indexStatus=checker.checkIndex(null);
  String s=bos.toString(IOUtils.UTF_8);
  checker.close();
  assertTrue(s,indexStatus != null && indexStatus.clean);
  assertTrue("missing id=" + StringHelper.idToString(id1) + " in:\n"+ s,s.contains("id=" + StringHelper.idToString(id1)));
  assertTrue("missing id=" + StringHelper.idToString(id1) + " in:\n"+ s,s.contains("id=" + StringHelper.idToString(id1)));
  d.close();
  Set<String> ids=new HashSet<>();
  for (int i=0; i < 100000; i++) {
    String id=StringHelper.idToString(StringHelper.randomId());
    assertFalse("id=" + id + " i="+ i,ids.contains(id));
    ids.add(id);
  }
}
