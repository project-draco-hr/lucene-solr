{
  Directory dir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir);
  for (int i=0; i < 3; i++) {
    Document doc=new Document();
    doc.add(new StringField("id",Integer.toString(i),Field.Store.NO));
    iw.addDocument(doc);
  }
  try {
    iw.addDocument(new IndexDocument(){
      @Override public Iterable<IndexableField> indexableFields(){
        return null;
      }
      @Override public Iterable<StorableField> storableFields(){
        return Collections.emptyList();
      }
    }
);
    fail();
  }
 catch (  NullPointerException expected) {
  }
  IndexReader ir=iw.getReader();
  assertEquals(3,ir.numDocs());
  ir.close();
  iw.close();
  dir.close();
}
