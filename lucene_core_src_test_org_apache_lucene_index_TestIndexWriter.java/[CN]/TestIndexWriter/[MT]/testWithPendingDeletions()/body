{
  assumeFalse("windows is not supported",Constants.WINDOWS);
  Path path=createTempDir();
  FileSystem fs=new WindowsFS(path.getFileSystem()).getFileSystem(URI.create("file:///"));
  Path root=new FilterPath(path,fs);
  try (FSDirectory dir=new SimpleFSDirectory(root)){
    IndexWriterConfig iwc=new IndexWriterConfig(new MockAnalyzer(random()));
    IndexWriter w=new IndexWriter(dir,iwc);
    w.commit();
    IndexInput in=dir.openInput("segments_1",IOContext.DEFAULT);
    w.addDocument(new Document());
    w.close();
    assertTrue(dir.checkPendingDeletions());
    try {
      dir.deleteFile("segments_1");
      fail("didn't hit exception");
    }
 catch (    NoSuchFileException nfse) {
    }
    iwc=new IndexWriterConfig(new MockAnalyzer(random()));
    try {
      w=new IndexWriter(dir,iwc);
    }
 catch (    IllegalArgumentException iae) {
      assertTrue(iae.getMessage().contains("still has pending deleted files; cannot initialize IndexWriter"));
    }
    in.close();
  }
 }
