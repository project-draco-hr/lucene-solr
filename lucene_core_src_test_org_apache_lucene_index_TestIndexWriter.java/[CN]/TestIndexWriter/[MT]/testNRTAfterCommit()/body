{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=new IndexWriterConfig(new MockAnalyzer(random()));
  IndexWriter w=new IndexWriter(dir,iwc);
  w.commit();
  w.addDocument(new Document());
  DirectoryReader r=DirectoryReader.open(w,true);
  w.commit();
  DirectoryReader r2=DirectoryReader.open(dir);
  assertNotNull(r2);
  assertEquals(2,r2.getIndexCommit().getGeneration());
  assertEquals("segments_2",r2.getIndexCommit().getSegmentsFileName());
  IOUtils.close(r,r2,w,dir);
}
