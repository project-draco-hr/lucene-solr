{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=new IndexWriterConfig(new MockAnalyzer(random()));
  IndexWriter w=new IndexWriter(dir,iwc);
  w.commit();
  DirectoryReader r=DirectoryReader.open(w,true);
  Map<String,String> m=new HashMap<>();
  m.put("foo","bar");
  w.setCommitData(m);
  w.commit();
  DirectoryReader r2=DirectoryReader.openIfChanged(r);
  assertNotNull(r2);
  IOUtils.close(r,r2,w,dir);
}
