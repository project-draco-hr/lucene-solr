{
  if (!cmd.fromPending && !cmd.fromCommitted)   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"meaningless command: " + cmd);
  if (!cmd.fromPending || !cmd.fromCommitted)   throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"operation not supported: " + cmd);
  Query q=QueryParsing.parseQuery(cmd.query,schema);
  int totDeleted=0;
synchronized (this) {
    closeWriter();
    openSearcher();
    final DeleteHitCollector deleter=new DeleteHitCollector(searcher);
    searcher.search(q,null,deleter);
    totDeleted=deleter.deleted;
  }
  if (core.log.isDebugEnabled()) {
    core.log.debug(core.getLogId() + "docs deleted:" + totDeleted);
  }
}
