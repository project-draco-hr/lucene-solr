{
  SolrInputDocument solrDoc=new SolrInputDocument();
  for (  Map.Entry<String,Object> e : doc.entrySet())   solrDoc.addField(e.getKey(),e.getValue());
  UpdateRequestProcessorChain processorChain=req.getCore().getUpdateProcessingChain(req.getParams().get(UpdateParams.UPDATE_CHAIN));
  UpdateRequestProcessor processor=processorChain.createProcessor(req,rsp);
  AddUpdateCommand cmd=new AddUpdateCommand(req);
  cmd.solrDoc=solrDoc;
  log.info("Adding doc: " + doc);
  processor.processAdd(cmd);
  log.info("committing doc: " + doc);
  processor.processCommit(new CommitUpdateCommand(req,false));
  processor.finish();
}
