{
  SolrInputDocument solrDoc=new SolrInputDocument();
  for (  Map.Entry<String,Object> e : doc.entrySet())   solrDoc.addField(e.getKey(),e.getValue());
  UpdateRequestProcessorChain processorChain=req.getCore().getUpdateProcessingChain(req.getParams().get(UpdateParams.UPDATE_CHAIN));
  UpdateRequestProcessor processor=processorChain.createProcessor(req,null);
  AddUpdateCommand cmd=new AddUpdateCommand(req);
  cmd.solrDoc=solrDoc;
  processor.processAdd(cmd);
  processorChain.createProcessor(req,null).processCommit(new CommitUpdateCommand(req,false));
}
