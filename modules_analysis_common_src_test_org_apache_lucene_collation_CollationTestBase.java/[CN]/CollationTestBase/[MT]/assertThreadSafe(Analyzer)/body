{
  int numTestPoints=1000 * RANDOM_MULTIPLIER;
  int numThreads=_TestUtil.nextInt(random,4,8);
  final HashMap<String,BytesRef> map=new HashMap<String,BytesRef>();
  BytesRef spare=new BytesRef();
  for (int i=0; i < numTestPoints; i++) {
    String term=randomString();
    TokenStream ts=analyzer.reusableTokenStream("fake",new StringReader(term));
    TermToBytesRefAttribute bytes=ts.addAttribute(TermToBytesRefAttribute.class);
    ts.reset();
    assertTrue(ts.incrementToken());
    bytes.toBytesRef(spare);
    map.put(term,new BytesRef(spare));
  }
  Thread threads[]=new Thread[numThreads];
  for (int i=0; i < numThreads; i++) {
    threads[i]=new Thread(){
      @Override public void run(){
        try {
          BytesRef spare=new BytesRef();
          for (          Map.Entry<String,BytesRef> mapping : map.entrySet()) {
            String term=mapping.getKey();
            BytesRef expected=mapping.getValue();
            TokenStream ts=analyzer.reusableTokenStream("fake",new StringReader(term));
            TermToBytesRefAttribute bytes=ts.addAttribute(TermToBytesRefAttribute.class);
            ts.reset();
            assertTrue(ts.incrementToken());
            bytes.toBytesRef(spare);
            assertEquals(expected,spare);
          }
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
;
  }
  for (int i=0; i < numThreads; i++) {
    threads[i].start();
  }
  for (int i=0; i < numThreads; i++) {
    threads[i].join();
  }
}
