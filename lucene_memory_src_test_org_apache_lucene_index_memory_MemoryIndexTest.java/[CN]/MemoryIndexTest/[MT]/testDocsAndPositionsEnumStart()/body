{
  Analyzer analyzer=new MockAnalyzer(random());
  int numIters=atLeast(3);
  MemoryIndex memory=new MemoryIndex(true,random().nextInt(50) * 1024 * 1024);
  for (int i=0; i < numIters; i++) {
    memory.addField("foo","bar",analyzer);
    AtomicReader reader=(AtomicReader)memory.createSearcher().getIndexReader();
    assertEquals(1,reader.terms("foo").getSumTotalTermFreq());
    DocsAndPositionsEnum disi=reader.termPositionsEnum(new Term("foo","bar"));
    int docid=disi.docID();
    assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
    assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
    assertEquals(0,disi.nextPosition());
    assertEquals(0,disi.startOffset());
    assertEquals(3,disi.endOffset());
    TermsEnum te=reader.terms("foo").iterator(null);
    assertTrue(te.seekExact(new BytesRef("bar"),true));
    disi=te.docsAndPositions(null,disi);
    docid=disi.docID();
    assertTrue(docid == -1 || docid == DocIdSetIterator.NO_MORE_DOCS);
    assertTrue(disi.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
    reader.close();
    memory.reset();
  }
}
