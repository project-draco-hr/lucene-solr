{
  Map<String,Object> r=null;
  while (true) {
    if (rowcache != null)     return getFromRowCache();
    if (rowIterator == null)     initQuery(resolver.replaceTokens(context.getEntityAttribute(URL)));
    r=getNext();
    if (r == null) {
      Object hasMore=getSessionAttribute(HAS_MORE);
      if ("true".equals(hasMore) || Boolean.TRUE.equals(hasMore)) {
        String url=(String)getSessionAttribute(NEXT_URL);
        if (url == null)         url=context.getEntityAttribute(URL);
        Map namespace=(Map)getSessionAttribute(entityName);
        if (namespace != null)         resolver.addNamespace(entityName,namespace);
        clearSession();
        initQuery(resolver.replaceTokens(url));
        r=getNext();
        if (r == null)         return null;
      }
 else {
        return null;
      }
    }
    r=applyTransformer(r);
    if (r != null)     return readUsefulVars(r);
  }
}
