{
  Map<String,Object> r=null;
  while (true) {
    if (rowcache != null)     return getFromRowCache();
    if (rowIterator == null)     initQuery(resolver.replaceTokens(context.getEntityAttribute(URL)));
    r=getNext();
    if (r == null) {
      Object hasMore=context.getSessionAttribute(HAS_MORE,Context.SCOPE_ENTITY);
      if ("true".equals(hasMore) || Boolean.TRUE.equals(hasMore)) {
        String url=(String)context.getSessionAttribute(NEXT_URL,Context.SCOPE_ENTITY);
        if (url == null)         url=context.getEntityAttribute(URL);
        addNamespace();
        initQuery(resolver.replaceTokens(url));
        r=getNext();
        if (r == null)         return null;
      }
 else {
        return null;
      }
    }
    addCommonFields(r);
    r=applyTransformer(r);
    if (r != null)     return readUsefulVars(r);
  }
}
