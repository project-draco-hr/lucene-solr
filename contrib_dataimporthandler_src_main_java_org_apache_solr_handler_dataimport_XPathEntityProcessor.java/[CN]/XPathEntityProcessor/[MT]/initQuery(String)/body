{
  Reader data=null;
  try {
    final List<Map<String,Object>> rows=new ArrayList<Map<String,Object>>();
    data=dataSource.getData(s);
    if (xslTransformer != null) {
      try {
        SimpleCharArrayReader caw=new SimpleCharArrayReader();
        xslTransformer.transform(new StreamSource(data),new StreamResult(caw));
        data=caw.getReader();
      }
 catch (      TransformerException e) {
        throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"Exception in applying XSL Transformeation",e);
      }
    }
    if (streamRows) {
      rowIterator=getRowIterator(data);
    }
 else {
      xpathReader.streamRecords(data,new XPathRecordReader.Handler(){
        @SuppressWarnings("unchecked") public void handle(        Map<String,Object> record,        String xpath){
          rows.add(readRow(record,xpath));
        }
      }
);
      rowIterator=rows.iterator();
    }
  }
  finally {
    if (!streamRows) {
      closeIt(data);
    }
  }
}
