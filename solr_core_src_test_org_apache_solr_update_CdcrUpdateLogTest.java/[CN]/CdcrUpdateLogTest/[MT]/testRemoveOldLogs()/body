{
  this.clearCore();
  UpdateLog ulog=h.getCore().getUpdateHandler().getUpdateLog();
  File logDir=new File(h.getCore().getUpdateHandler().getUpdateLog().getLogDir());
  int start=0;
  int maxReq=50;
  LinkedList<Long> versions=new LinkedList<>();
  addDocs(10,start,versions);
  start+=10;
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertU(commit());
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  addDocs(10,start,versions);
  start+=10;
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertU(commit());
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertEquals(2,ulog.getLogList(logDir).length);
  CdcrUpdateLog.CdcrLogReader reader=((CdcrUpdateLog)ulog).newLogReader();
  addDocs(105,start,versions);
  start+=105;
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertU(commit());
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertEquals(3,ulog.getLogList(logDir).length);
  for (int i=0; i <= 11; i++) {
    assertNotNull(reader.next());
  }
  addDocs(10,start,versions);
  start+=10;
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertU(commit());
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertEquals(3,ulog.getLogList(logDir).length);
  h.close();
  createCore();
  ulog=h.getCore().getUpdateHandler().getUpdateLog();
  addDocs(105,start,versions);
  start+=105;
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertU(commit());
  assertJQ(req("qt","/get","getVersions","" + maxReq),"/versions==" + versions.subList(0,Math.min(maxReq,start)));
  assertEquals(1,ulog.getLogList(logDir).length);
}
