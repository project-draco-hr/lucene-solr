{
  String method=req.getMethod().toUpperCase();
  if ("GET".equals(method)) {
    return new ServletSolrParams(req);
  }
  if ("POST".equals(method)) {
    String contentType=req.getContentType();
    if (contentType != null) {
      if ("application/x-www-form-urlencoded".equals(contentType.toLowerCase())) {
        return new ServletSolrParams(req);
      }
      if (ServletFileUpload.isMultipartContent(req)) {
        return multipart.parseParamsAndFillStreams(req,streams);
      }
    }
    return raw.parseParamsAndFillStreams(req,streams);
  }
  throw new SolrException(400,"Unsuported method: " + method);
}
