{
  Connection conn=null;
  try {
    if (dbToUse == Database.DERBY) {
      conn=DriverManager.getConnection("jdbc:derby:memory:derbyDB;create=true");
    }
 else     if (dbToUse == Database.HSQLDB) {
      conn=DriverManager.getConnection("jdbc:hsqldb:mem:.");
    }
 else {
      throw new AssertionError("Invalid database to use: " + dbToUse);
    }
    populateData(conn);
  }
 catch (  SQLException sqe) {
    Throwable cause=sqe;
    while (cause.getCause() != null) {
      cause=cause.getCause();
    }
    String message=cause.getMessage();
    if (cause instanceof StandardException) {
      message=((StandardException)cause).getMessageId();
    }
    if ("XBM0X.D".equals(message)) {
      log.warn("Skipping test because Database " + dbToUse + " does not support the locale "+ Locale.getDefault());
      skipThisTest=true;
      Assume.assumeNoException(sqe);
      throw sqe;
    }
  }
 finally {
    try {
      conn.close();
    }
 catch (    Exception e1) {
    }
  }
}
