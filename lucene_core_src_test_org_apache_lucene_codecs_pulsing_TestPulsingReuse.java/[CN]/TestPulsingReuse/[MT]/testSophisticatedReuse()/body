{
  Codec cp=_TestUtil.alwaysPostingsFormat(new Pulsing40PostingsFormat(1));
  Directory dir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setCodec(cp));
  Document doc=new Document();
  doc.add(new TextField("foo","a b b c c c d e f g g h i i j j k",Field.Store.NO));
  iw.addDocument(doc);
  DirectoryReader ir=iw.getReader();
  iw.close();
  AtomicReader segment=getOnlySegmentReader(ir);
  DocsEnum reuse=null;
  Map<DocsEnum,Boolean> allEnums=new IdentityHashMap<DocsEnum,Boolean>();
  TermsEnum te=segment.terms("foo").iterator(null);
  while (te.next() != null) {
    reuse=te.docs(null,reuse,false);
    allEnums.put(reuse,true);
  }
  assertEquals(2,allEnums.size());
  allEnums.clear();
  DocsAndPositionsEnum posReuse=null;
  te=segment.terms("foo").iterator(null);
  while (te.next() != null) {
    posReuse=te.docsAndPositions(null,posReuse,false);
    allEnums.put(posReuse,true);
  }
  assertEquals(2,allEnums.size());
  ir.close();
  dir.close();
}
