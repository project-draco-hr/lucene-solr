{
  int docsToCollect=getMax(groupOffset,docsPerGroup,maxDoc);
  TopDocs topDocs=collector.topDocs(0,docsToCollect);
  int ids[]=new int[topDocs.scoreDocs.length];
  float[] scores=needScores ? new float[topDocs.scoreDocs.length] : null;
  for (int i=0; i < ids.length; i++) {
    ids[i]=topDocs.scoreDocs[i].doc;
    if (scores != null)     scores[i]=topDocs.scoreDocs[i].score;
  }
  float score=topDocs.getMaxScore();
  maxScore=Math.max(maxScore,score);
  DocSlice docs=new DocSlice(groupOffset,Math.max(0,ids.length - groupOffset),ids,scores,topDocs.totalHits,score);
  if (getDocList) {
    DocIterator iter=docs.iterator();
    while (iter.hasNext())     idSet.add(iter.nextDoc());
  }
  return docs;
}
