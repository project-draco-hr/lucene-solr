{
  if (numGroups == 0)   return null;
  int docsToCollect=getMax(groupOffset,docsPerGroup,maxDoc);
  docsToCollect=Math.max(docsToCollect,1);
  int collectorOffset=main ? 0 : offset;
  if (groupBy instanceof StrFieldSource) {
    collector2=new Phase2StringGroupCollector(collector,groupBy,context,groupSort,docsToCollect,needScores,collectorOffset);
  }
 else {
    collector2=new Phase2GroupCollector(collector,groupBy,context,groupSort,docsToCollect,needScores,collectorOffset);
  }
  return collector2;
}
