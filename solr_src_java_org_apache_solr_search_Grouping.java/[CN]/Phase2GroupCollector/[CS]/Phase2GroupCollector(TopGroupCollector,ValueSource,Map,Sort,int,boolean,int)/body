{
  boolean getSortFields=false;
  if (topGroups.orderedGroups == null)   topGroups.buildSet();
  groupMap=new HashMap<MutableValue,SearchGroupDocs>(topGroups.groupMap.size());
  for (  SearchGroup group : topGroups.orderedGroups) {
    if (offset > 0) {
      offset--;
      continue;
    }
    SearchGroupDocs groupDocs=new SearchGroupDocs();
    groupDocs.groupValue=group.groupValue;
    if (weightedSort == null)     groupDocs.collector=TopScoreDocCollector.create(docsPerGroup,true);
 else     groupDocs.collector=TopFieldCollector.create(weightedSort,docsPerGroup,getSortFields,getScores,getScores,true);
    groupMap.put(groupDocs.groupValue,groupDocs);
  }
  this.vs=groupByVS;
  this.context=vsContext;
}
