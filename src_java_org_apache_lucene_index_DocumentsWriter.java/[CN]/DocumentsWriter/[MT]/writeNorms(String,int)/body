{
  IndexOutput normsOut=directory.createOutput(segmentName + "." + IndexFileNames.NORMS_EXTENSION);
  try {
    normsOut.writeBytes(SegmentMerger.NORMS_HEADER,0,SegmentMerger.NORMS_HEADER.length);
    final int numField=fieldInfos.size();
    for (int fieldIdx=0; fieldIdx < numField; fieldIdx++) {
      FieldInfo fi=fieldInfos.fieldInfo(fieldIdx);
      if (fi.isIndexed && !fi.omitNorms) {
        BufferedNorms n=norms[fieldIdx];
        final long v;
        if (n == null)         v=0;
 else {
          v=n.out.getFilePointer();
          n.out.writeTo(normsOut);
          n.reset();
        }
        if (v < totalNumDoc)         fillBytes(normsOut,defaultNorm,(int)(totalNumDoc - v));
      }
    }
  }
  finally {
    normsOut.close();
  }
}
