{
  final ThreadState state=getThreadState(doc,delTerm);
  boolean success=false;
  try {
    try {
      state.processDocument(analyzer);
    }
  finally {
      finishDocument(state);
    }
    success=true;
  }
  finally {
    if (!success) {
synchronized (this) {
        state.isIdle=true;
        if (state.abortOnExc)         abort();
 else         addDeleteDocID(state.docID);
        notifyAll();
      }
    }
  }
  return state.doFlushAfter || timeToFlushDeletes();
}
