{
  length=0;
  position=0;
  offset=0;
  boost=docBoost;
  final int maxFieldLength=writer.getMaxFieldLength();
  final int limit=fieldCount;
  final Fieldable[] docFieldsFinal=docFields;
  try {
    for (int j=0; j < limit; j++) {
      Fieldable field=docFieldsFinal[j];
      if (field.isIndexed())       invertField(field,analyzer,maxFieldLength);
      if (field.isStored()) {
        numStoredFields++;
        boolean success=false;
        try {
          localFieldsWriter.writeField(fieldInfo,field);
          success=true;
        }
  finally {
          if (!success)           fdtLocal.reset();
        }
      }
      docFieldsFinal[j]=null;
    }
  }
  finally {
    if (postingsVectorsUpto > 0) {
      boolean success=false;
      try {
        writeVectors(fieldInfo);
        success=true;
      }
  finally {
        if (!success) {
          numVectorFields=0;
          tvfLocal.reset();
        }
        if (postingsVectorsUpto > maxPostingsVectors)         maxPostingsVectors=postingsVectorsUpto;
        postingsVectorsUpto=0;
        vectorsPool.reset();
      }
    }
  }
}
