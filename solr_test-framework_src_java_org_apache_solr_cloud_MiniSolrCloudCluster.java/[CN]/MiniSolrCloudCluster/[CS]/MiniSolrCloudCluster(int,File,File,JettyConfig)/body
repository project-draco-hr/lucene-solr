{
  this.testDir=baseDir;
  this.jettyConfig=jettyConfig;
  String zkDir=testDir.getAbsolutePath() + File.separator + "zookeeper/server1/data";
  zkServer=new ZkTestServer(zkDir);
  zkServer.run();
  try (SolrZkClient zkClient=new SolrZkClient(zkServer.getZkHost(),AbstractZkTestCase.TIMEOUT,45000,null)){
    zkClient.makePath("/solr/solr.xml",solrXml,false,true);
    if (jettyConfig.sslConfig != null && jettyConfig.sslConfig.isSSLMode()) {
      zkClient.makePath("/solr" + ZkStateReader.CLUSTER_PROPS,"{'urlScheme':'https'}".getBytes(Charsets.UTF_8),true);
    }
  }
   System.setProperty("solr.solrxml.location","zookeeper");
  System.setProperty("zkHost",zkServer.getZkAddress());
  jettys=new LinkedList<>();
  for (int i=0; i < numServers; ++i) {
    startJettySolrRunner(jettyConfig);
  }
  solrClient=buildSolrClient();
}
