{
  DirectoryStream<Path> stream=super.newDirectoryStream(dir,filter);
  if (stream instanceof SecureDirectoryStream) {
    stream=new TrackingSecureDirectoryStream((SecureDirectoryStream<Path>)stream,dir);
  }
 else {
    stream=new FilterDirectoryStream<Path>(stream){
      boolean closed;
      @Override public void close() throws IOException {
        if (!closed) {
          closed=true;
          onClose(dir,this);
        }
        super.close();
      }
      @Override public String toString(){
        return "DirectoryStream(" + dir + ")";
      }
      @Override public int hashCode(){
        return System.identityHashCode(this);
      }
      @Override public boolean equals(      Object obj){
        return this == obj;
      }
    }
;
  }
  callOpenHook(dir,stream);
  return stream;
}
