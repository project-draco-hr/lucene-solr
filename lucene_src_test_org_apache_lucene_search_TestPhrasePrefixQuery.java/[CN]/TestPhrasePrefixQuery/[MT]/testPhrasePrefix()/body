{
  Random random=newRandom();
  MockRAMDirectory indexStore=newDirectory(random);
  RandomIndexWriter writer=new RandomIndexWriter(random,indexStore);
  Document doc1=new Document();
  Document doc2=new Document();
  Document doc3=new Document();
  Document doc4=new Document();
  Document doc5=new Document();
  doc1.add(new Field("body","blueberry pie",Field.Store.YES,Field.Index.ANALYZED));
  doc2.add(new Field("body","blueberry strudel",Field.Store.YES,Field.Index.ANALYZED));
  doc3.add(new Field("body","blueberry pizza",Field.Store.YES,Field.Index.ANALYZED));
  doc4.add(new Field("body","blueberry chewing gum",Field.Store.YES,Field.Index.ANALYZED));
  doc5.add(new Field("body","piccadilly circus",Field.Store.YES,Field.Index.ANALYZED));
  writer.addDocument(doc1);
  writer.addDocument(doc2);
  writer.addDocument(doc3);
  writer.addDocument(doc4);
  writer.addDocument(doc5);
  IndexReader reader=writer.getReader();
  writer.close();
  IndexSearcher searcher=new IndexSearcher(reader);
  MultiPhraseQuery query1=new MultiPhraseQuery();
  MultiPhraseQuery query2=new MultiPhraseQuery();
  query1.add(new Term("body","blueberry"));
  query2.add(new Term("body","strawberry"));
  LinkedList<Term> termsWithPrefix=new LinkedList<Term>();
  String prefix="pi";
  TermsEnum te=MultiFields.getFields(reader).terms("body").iterator();
  te.seek(new BytesRef(prefix));
  do {
    String s=te.term().utf8ToString();
    if (s.startsWith(prefix)) {
      termsWithPrefix.add(new Term("body",s));
    }
 else {
      break;
    }
  }
 while (te.next() != null);
  query1.add(termsWithPrefix.toArray(new Term[0]));
  query2.add(termsWithPrefix.toArray(new Term[0]));
  ScoreDoc[] result;
  result=searcher.search(query1,null,1000).scoreDocs;
  assertEquals(2,result.length);
  result=searcher.search(query2,null,1000).scoreDocs;
  assertEquals(0,result.length);
  searcher.close();
  reader.close();
  indexStore.close();
}
