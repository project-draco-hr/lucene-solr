{
  Mode mode=getMode(args);
  String userDictionaryPath=args.get(USER_DICT_PATH);
  try {
    if (userDictionaryPath != null) {
      InputStream stream=loader.openResource(userDictionaryPath);
      String encoding=args.get(USER_DICT_ENCODING);
      if (encoding == null) {
        encoding=IOUtils.UTF_8;
      }
      CharsetDecoder decoder=Charset.forName(encoding).newDecoder().onMalformedInput(CodingErrorAction.REPORT).onUnmappableCharacter(CodingErrorAction.REPORT);
      Reader reader=new InputStreamReader(stream,decoder);
      this.segmenter=new Segmenter(new UserDictionary(reader),mode);
    }
 else {
      this.segmenter=new Segmenter(mode);
    }
  }
 catch (  Exception e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,e);
  }
}
