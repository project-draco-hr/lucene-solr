{
  IndexReader reader=IndexReader.open(dir);
  try {
    int numPayloads=0;
    DocsAndPositionsEnum tpe=MultiFields.getTermPositionsEnum(reader,null,field,text);
    while (tpe.nextDoc() != DocIdSetIterator.NO_MORE_DOCS) {
      tpe.nextPosition();
      if (tpe.hasPayload()) {
        BytesRef payload=tpe.getPayload();
        assertEquals(1,payload.length);
        assertEquals(1,payload.bytes[0]);
        ++numPayloads;
      }
    }
    assertEquals(numExpected,numPayloads);
  }
  finally {
    reader.close();
  }
}
