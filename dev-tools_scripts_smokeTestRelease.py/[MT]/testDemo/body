def testDemo(isSrc):
    print '    test demo...'
    if isSrc:
        cp = 'build/lucene-core-3.2-SNAPSHOT.jar:build/contrib/demo/lucene-demo-3.2-SNAPSHOT.jar'
        docsDir = 'src'
    else:
        cp = 'lucene-core-3.2.0.jar:contrib/demo/lucene-demo-3.2.0.jar'
        docsDir = 'docs'
    run(('export JAVA_HOME=/usr/local/src/jdk1.5.0_22; java -cp %s org.apache.lucene.demo.IndexFiles -index index -docs %s' % (cp, docsDir)), 'index.log')
    run(('export JAVA_HOME=/usr/local/src/jdk1.5.0_22; java -cp %s org.apache.lucene.demo.SearchFiles -index index -query lucene' % cp), 'search.log')
    reMatchingDocs = re.compile('(\\d+) total matching documents')
    m = reMatchingDocs.search(open('search.log', 'rb').read())
    if (m is None):
        raise RuntimeError("lucene demo's SearchFiles found no results")
    else:
        numHits = int(m.group(1))
        if (numHits < 100):
            raise RuntimeError(("lucene demo's SearchFiles found too few results: %s" % numHits))
        print ('      got %d hits for query "lucene"' % numHits)
