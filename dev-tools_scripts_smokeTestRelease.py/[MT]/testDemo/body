def testDemo(isSrc, version):
    print '    test demo...'
    sep = (';' if cygwin else ':')
    if isSrc:
        if version.endswith('.0'):
            cp = 'build/core/lucene-core-{0}-SNAPSHOT.jar{1}build/demo/classes/java'.format(version, sep)
            cp += '{1}build/core/lucene-core-{0}-SNAPSHOT.jar{1}build/demo/classes/java'.format(version[:(-2)], sep)
        else:
            cp = 'build/core/lucene-core-{0}-SNAPSHOT.jar{1}build/demo/classes/java'.format(version, sep)
        docsDir = 'core/src'
    else:
        cp = 'core/lucene-core-{0}.jar{1}demo/lucene-demo-{0}.jar{1}analysis/common/lucene-analyzers-common-{0}.jar{1}queryparser/lucene-queryparser-{0}.jar'.format(version, sep)
        docsDir = 'docs'
    run(('%s; java -cp "%s" org.apache.lucene.demo.IndexFiles -index index -docs %s' % (javaExe('1.6'), cp, docsDir)), 'index.log')
    run(('%s; java -cp "%s" org.apache.lucene.demo.SearchFiles -index index -query lucene' % (javaExe('1.6'), cp)), 'search.log')
    reMatchingDocs = re.compile('(\\d+) total matching documents')
    m = reMatchingDocs.search(open('search.log', 'rb').read())
    if (m is None):
        raise RuntimeError("lucene demo's SearchFiles found no results")
    else:
        numHits = int(m.group(1))
        if (numHits < 100):
            raise RuntimeError(("lucene demo's SearchFiles found too few results: %s" % numHits))
        print ('      got %d hits for query "lucene"' % numHits)
