def testDemo(isSrc, version):
    print '    test demo...'
    if isSrc:
        if version.endswith('.0'):
            cp = ('build/lucene-core-%s-SNAPSHOT.jar:build/contrib/demo/lucene-demo-%s-SNAPSHOT.jar' % (version, version))
            cp += (':build/lucene-core-%s-SNAPSHOT.jar:build/contrib/demo/lucene-demo-%s-SNAPSHOT.jar' % (version[:(-2)], version[:(-2)]))
        else:
            cp = ('build/lucene-core-%s-SNAPSHOT.jar:build/contrib/demo/lucene-demo-%s-SNAPSHOT.jar' % (version, version))
        docsDir = 'src'
    else:
        cp = ('lucene-core-%s.jar:contrib/demo/lucene-demo-%s.jar' % (version, version))
        docsDir = 'docs'
    run(('export JAVA_HOME=%s; %s/bin/java -cp %s org.apache.lucene.demo.IndexFiles -index index -docs %s' % (JAVA5_HOME, JAVA5_HOME, cp, docsDir)), 'index.log')
    run(('export JAVA_HOME=%s; %s/bin/java -cp %s org.apache.lucene.demo.SearchFiles -index index -query lucene' % (JAVA5_HOME, JAVA5_HOME, cp)), 'search.log')
    reMatchingDocs = re.compile('(\\d+) total matching documents')
    m = reMatchingDocs.search(open('search.log', 'rb').read())
    if (m is None):
        raise RuntimeError("lucene demo's SearchFiles found no results")
    else:
        numHits = int(m.group(1))
        if (numHits < 100):
            raise RuntimeError(("lucene demo's SearchFiles found too few results: %s" % numHits))
        print ('      got %d hits for query "lucene"' % numHits)
