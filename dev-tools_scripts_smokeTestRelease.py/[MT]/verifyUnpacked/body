def verifyUnpacked(project, artifact, unpackPath, version):
    os.chdir(unpackPath)
    isSrc = (artifact.find('-src') != (-1))
    l = os.listdir(unpackPath)
    textFiles = ['LICENSE', 'NOTICE', 'README']
    if (project == 'lucene'):
        textFiles.extend(('JRE_VERSION_MIGRATION', 'CHANGES'))
        if isSrc:
            textFiles.append('BUILD')
    for fileName in textFiles:
        fileName += '.txt'
        if (fileName not in l):
            raise RuntimeError(('file "%s" is missing from artifact %s' % (fileName, artifact)))
        l.remove(fileName)
    if (not isSrc):
        if (project == 'lucene'):
            expectedJARs = (('lucene-core-%s' % version), ('lucene-core-%s-javadoc' % version), ('lucene-test-framework-%s' % version), ('lucene-test-framework-%s-javadoc' % version))
        else:
            expectedJARs = ()
        for fileName in expectedJARs:
            fileName += '.jar'
            if (fileName not in l):
                raise RuntimeError(('%s: file "%s" is missing from artifact %s' % (project, fileName, artifact)))
            l.remove(fileName)
    if (project == 'lucene'):
        extras = ('lib', 'docs', 'contrib')
        if isSrc:
            extras += ('build.xml', 'index.html', 'common-build.xml', 'src', 'backwards')
    else:
        extras = ()
    for e in extras:
        if (e not in l):
            raise RuntimeError(('%s: %s missing from artifact %s' % (project, e, artifact)))
        l.remove(e)
    if (project == 'lucene'):
        if (len(l) > 0):
            raise RuntimeError(('%s: unexpected files/dirs in artifact %s: %s' % (project, artifact, l)))
    if isSrc:
        if (project == 'lucene'):
            print '    run tests w/ Java 5...'
            run('export JAVA_HOME=/usr/local/src/jdk1.5.0_22; ant test', ('%s/test.log' % unpackPath))
            run('export JAVA_HOME=/usr/local/src/jdk1.5.0_22; ant jar', ('%s/compile.log' % unpackPath))
            testDemo(isSrc)
        else:
            print '    run tests w/ Java 6...'
            run('export JAVA_HOME=/usr/local/src/jdk1.6.0_21; ant test', ('%s/test.log' % unpackPath))
    elif (project == 'lucene'):
        testDemo(isSrc)
