{
  File tmpdir=createTempDir().toFile();
  AbstractDataImportHandlerTestCase.createFile(tmpdir,"x.xsl",xsl.getBytes(StandardCharsets.UTF_8),false);
  Map entityAttrs=createMap("name","e",XPathEntityProcessor.USE_SOLR_ADD_SCHEMA,"true","xsl","" + new File(tmpdir,"x.xsl").toURI(),"url","cd.xml");
  Context c=getContext(null,new VariableResolver(),getDataSource(cdData),Context.FULL_DUMP,null,entityAttrs);
  XPathEntityProcessor xPathEntityProcessor=new XPathEntityProcessor();
  xPathEntityProcessor.init(c);
  List<Map<String,Object>> result=new ArrayList<>();
  while (true) {
    Map<String,Object> row=xPathEntityProcessor.nextRow();
    if (row == null)     break;
    result.add(row);
  }
  assertEquals(3,result.size());
  assertEquals("Empire Burlesque",result.get(0).get("title"));
  assertEquals("Bonnie Tyler",result.get(1).get("artist"));
  assertEquals("1982",result.get(2).get("year"));
}
