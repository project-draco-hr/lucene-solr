{
  CodecUtil.checkHeader(input,Lucene3xSegmentInfoFormat.UPGRADED_SI_CODEC_NAME,Lucene3xSegmentInfoFormat.UPGRADED_SI_VERSION_START,Lucene3xSegmentInfoFormat.UPGRADED_SI_VERSION_CURRENT);
  final String version=input.readString();
  final int docCount=input.readInt();
  final Map<String,String> attributes=input.readStringStringMap();
  final boolean isCompoundFile=input.readByte() == SegmentInfo.YES;
  final Map<String,String> diagnostics=input.readStringStringMap();
  final Set<String> files=input.readStringSet();
  SegmentInfo info=new SegmentInfo(dir,version,name,docCount,isCompoundFile,null,diagnostics,Collections.unmodifiableMap(attributes));
  info.setFiles(files);
  return info;
}
