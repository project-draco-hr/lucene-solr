{
  final String field="data";
  final String[] vals={"1","2","3","4","5","6","A","Z","B","Y","Z","X","foo"};
  int maxLev=4;
  TestBoolean2.Callback minNrCB=new TestBoolean2.Callback(){
    @Override public void postCreate(    BooleanQuery.Builder q){
      int opt=0;
      for (      BooleanClause clause : q.build().clauses()) {
        if (clause.getOccur() == BooleanClause.Occur.SHOULD)         opt++;
      }
      q.setMinimumNumberShouldMatch(random().nextInt(opt + 2));
      if (random().nextBoolean()) {
        Term randomTerm=new Term(field,vals[random().nextInt(vals.length)]);
        q.add(new TermQuery(randomTerm),BooleanClause.Occur.MUST_NOT);
      }
    }
  }
;
  int num=atLeast(20);
  for (int i=0; i < num; i++) {
    int lev=random().nextInt(maxLev);
    final long seed=random().nextLong();
    BooleanQuery.Builder q1=TestBoolean2.randBoolQuery(new Random(seed),true,lev,field,vals,null);
    BooleanQuery.Builder q2=TestBoolean2.randBoolQuery(new Random(seed),true,lev,field,vals,null);
    minNrCB.postCreate(q2);
    TopDocs top1=s.search(q1.build(),100);
    TopDocs top2=s.search(q2.build(),100);
    if (i < 100) {
      QueryUtils.check(random(),q1.build(),s);
      QueryUtils.check(random(),q2.build(),s);
    }
    assertSubsetOfSameScores(q2.build(),top1,top2);
  }
}
