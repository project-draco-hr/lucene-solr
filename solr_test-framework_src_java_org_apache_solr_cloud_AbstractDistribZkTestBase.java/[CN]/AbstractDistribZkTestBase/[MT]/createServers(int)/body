{
  File controlHome=new File(new File(getSolrHome()).getParentFile(),"control" + homeCount.incrementAndGet());
  FileUtils.copyDirectory(new File(getSolrHome()),controlHome);
  System.setProperty("collection","control_collection");
  controlJetty=createJetty(controlHome,null,"control_shard");
  System.clearProperty("collection");
  controlClient=createNewSolrServer(controlJetty.getLocalPort());
  StringBuilder sb=new StringBuilder();
  for (int i=1; i <= numShards; i++) {
    if (sb.length() > 0)     sb.append(',');
    File jettyHome=new File(new File(getSolrHome()).getParentFile(),"jetty" + homeCount.incrementAndGet());
    FileUtils.copyDirectory(new File(getSolrHome()),jettyHome);
    JettySolrRunner j=createJetty(jettyHome,null,"shard" + (i + 2));
    jettys.add(j);
    clients.add(createNewSolrServer(j.getLocalPort()));
    sb.append("localhost:").append(j.getLocalPort()).append(context);
  }
  shards=sb.toString();
  for (int i=1; i <= numShards; i++) {
    ZkStateReader zkStateReader=((SolrDispatchFilter)jettys.get(0).getDispatchFilter().getFilter()).getCores().getZkController().getZkStateReader();
    zkStateReader.getLeaderProps("collection1","shard" + (i + 2),15000);
  }
}
