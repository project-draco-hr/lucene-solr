{
  log.info("Will wait for a node to become leader for {} secs",maxWaitInSecs);
  boolean waitForLeader=true;
  int i=0;
  ZkStateReader zkStateReader=cloudClient.getZkStateReader();
  zkStateReader.forceUpdateCollection(DEFAULT_COLLECTION);
  while (waitForLeader) {
    ClusterState clusterState=zkStateReader.getClusterState();
    DocCollection coll=clusterState.getCollection("collection1");
    Slice slice=coll.getSlice(shardName);
    if (slice.getLeader() != oldLeader && slice.getState() == State.ACTIVE) {
      log.info("New leader got elected in {} secs",i);
      break;
    }
    if (i == maxWaitInSecs) {
      Diagnostics.logThreadDumps("Could not find new leader in specified timeout");
      zkStateReader.getZkClient().printLayoutToStdOut();
      fail("Could not find new leader even after waiting for " + maxWaitInSecs + "secs");
    }
    i++;
    Thread.sleep(1000);
  }
}
