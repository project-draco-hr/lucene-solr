{
  final String TEXT="the fox did not jump";
  final Directory directory=newDirectory();
  final IndexWriter indexWriter=new IndexWriter(directory,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(MockTokenizer.WHITESPACE,false)));
  try {
    final Document document=new Document();
    document.add(new Field(FIELD,TEXT,Store.YES,Index.ANALYZED,TermVector.WITH_OFFSETS));
    indexWriter.addDocument(document);
  }
  finally {
    indexWriter.close();
  }
  final IndexReader indexReader=IndexReader.open(directory,true);
  try {
    assertEquals(1,indexReader.numDocs());
    final IndexSearcher indexSearcher=new IndexSearcher(indexReader);
    try {
      final PhraseQuery phraseQuery=new PhraseQuery();
      phraseQuery.add(new Term(FIELD,"did"));
      phraseQuery.add(new Term(FIELD,"jump"));
      phraseQuery.setSlop(1);
      TopDocs hits=indexSearcher.search(phraseQuery,1);
      assertEquals(1,hits.totalHits);
      final Highlighter highlighter=new Highlighter(new SimpleHTMLFormatter(),new SimpleHTMLEncoder(),new QueryScorer(phraseQuery));
      final TokenStream tokenStream=TokenSources.getTokenStream((TermPositionVector)indexReader.getTermFreqVector(0,FIELD),true);
      assertEquals("the fox <B>did</B> not <B>jump</B>",highlighter.getBestFragment(tokenStream,TEXT));
    }
  finally {
      indexSearcher.close();
    }
  }
  finally {
    indexReader.close();
    directory.close();
  }
}
