{
  maybeYield();
  if (openFiles == null) {
    openFiles=new HashMap<String,Integer>();
    openFilesDeleted=new HashSet<String>();
  }
  if (noDeleteOpenFile && openFiles.size() > 0) {
    Exception cause=null;
    Iterator<Exception> stacktraces=openFileHandles.values().iterator();
    if (stacktraces.hasNext())     cause=stacktraces.next();
    throw new RuntimeException("MockDirectoryWrapper: cannot close: there are still open files: " + openFiles,cause);
  }
  open=false;
  delegate.close();
}
