{
  CoreDescriptor cd=req.getCore().getCoreDescriptor();
  String collection=cd.getCollectionName();
  if (collection != null) {
    ZkSolrResourceLoader zkLoader=(ZkSolrResourceLoader)managedIndexSchema.getResourceLoader();
    if (timeOut.hasTimedOut()) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Not enough time left to update replicas. However, the schema is updated already.");
    }
    ManagedIndexSchema.waitForSchemaZkVersionAgreement(collection,cd.getCloudDescriptor().getCoreNodeName(),(managedIndexSchema).getSchemaZkVersion(),zkLoader.getZkController(),(int)timeOut.timeLeft(TimeUnit.SECONDS));
  }
}
