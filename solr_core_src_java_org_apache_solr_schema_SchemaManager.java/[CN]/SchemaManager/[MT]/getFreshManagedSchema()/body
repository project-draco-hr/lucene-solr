{
  SolrResourceLoader resourceLoader=req.getCore().getResourceLoader();
  if (resourceLoader instanceof ZkSolrResourceLoader) {
    ZkSolrResourceLoader loader=(ZkSolrResourceLoader)resourceLoader;
    InputStream in=resourceLoader.openResource(req.getSchema().getResourceName());
    if (in instanceof ZkSolrResourceLoader.ZkByteArrayInputStream) {
      int version=((ZkSolrResourceLoader.ZkByteArrayInputStream)in).getStat().getVersion();
      log.info("managed schema loaded . version : {} ",version);
      return new ManagedIndexSchema(req.getCore().getSolrConfig(),req.getSchema().getResourceName(),new InputSource(in),true,req.getSchema().getResourceName(),version,new Object());
    }
 else {
      return (ManagedIndexSchema)req.getCore().getLatestSchema();
    }
  }
 else {
    return (ManagedIndexSchema)req.getCore().getLatestSchema();
  }
}
