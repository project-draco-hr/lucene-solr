{
  if (positions && (offsets || payloads)) {
    writePosition(position - lastPosition,payload);
    lastPosition=position;
    if (offsets) {
      offsetStartBuffer[bufferedIndex]=startOffset;
      offsetEndBuffer[bufferedIndex]=endOffset;
    }
    bufferedIndex++;
    if (bufferedIndex == bufferedFreq) {
      if (payloads) {
        tvf.writeBytes(payloadData.bytes,payloadData.offset,payloadData.length);
      }
      for (int i=0; i < bufferedIndex; i++) {
        if (offsets) {
          tvf.writeVInt(offsetStartBuffer[i] - lastOffset);
          tvf.writeVInt(offsetEndBuffer[i] - offsetStartBuffer[i]);
          lastOffset=offsetEndBuffer[i];
        }
      }
    }
  }
 else   if (positions) {
    writePosition(position - lastPosition,payload);
    lastPosition=position;
  }
 else   if (offsets) {
    tvf.writeVInt(startOffset - lastOffset);
    tvf.writeVInt(endOffset - startOffset);
    lastOffset=endOffset;
  }
}
