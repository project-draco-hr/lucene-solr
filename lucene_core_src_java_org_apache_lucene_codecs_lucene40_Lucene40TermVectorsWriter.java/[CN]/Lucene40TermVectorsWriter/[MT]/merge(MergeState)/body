{
  int rawDocLengths[]=new int[MAX_RAW_MERGE_DOCS];
  int rawDocLengths2[]=new int[MAX_RAW_MERGE_DOCS];
  int idx=0;
  int numDocs=0;
  for (  final AtomicReader reader : mergeState.readers) {
    final SegmentReader matchingSegmentReader=mergeState.matchingSegmentReaders[idx++];
    Lucene40TermVectorsReader matchingVectorsReader=null;
    if (matchingSegmentReader != null) {
      TermVectorsReader vectorsReader=matchingSegmentReader.getTermVectorsReader();
      if (vectorsReader != null && vectorsReader instanceof Lucene40TermVectorsReader) {
        matchingVectorsReader=(Lucene40TermVectorsReader)vectorsReader;
      }
    }
    if (reader.getLiveDocs() != null) {
      numDocs+=copyVectorsWithDeletions(mergeState,matchingVectorsReader,reader,rawDocLengths,rawDocLengths2);
    }
 else {
      numDocs+=copyVectorsNoDeletions(mergeState,matchingVectorsReader,reader,rawDocLengths,rawDocLengths2);
    }
  }
  finish(mergeState.fieldInfos,numDocs);
  return numDocs;
}
