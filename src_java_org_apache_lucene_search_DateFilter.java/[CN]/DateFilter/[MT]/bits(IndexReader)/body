{
  BitSet bits=new BitSet(reader.maxDoc());
  TermEnum enumerator=reader.terms(new Term(field,start));
  TermDocs termDocs=reader.termDocs();
  if (enumerator.term() == null) {
    return bits;
  }
  try {
    Term stop=new Term(field,end);
    while (enumerator.term().compareTo(stop) <= 0) {
      termDocs.seek(enumerator.term());
      while (termDocs.next()) {
        bits.set(termDocs.doc());
      }
      if (!enumerator.next()) {
        break;
      }
    }
  }
  finally {
    enumerator.close();
    termDocs.close();
  }
  return bits;
}
