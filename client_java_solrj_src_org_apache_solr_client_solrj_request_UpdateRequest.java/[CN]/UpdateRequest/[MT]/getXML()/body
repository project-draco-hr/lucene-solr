{
  StringWriter writer=new StringWriter();
  if (documents != null && documents.size() > 0) {
    writer.write("<add ");
    writer.write("allowDups=\"" + allowDups + "\" ");
    writer.write("overwriteCommitted=\"" + overwriteCommitted + "\" ");
    writer.write("overwritePending=\"" + overwritePending + "\">");
    for (    SolrInputDocument doc : documents) {
      if (doc != null) {
        ClientUtils.writeXML(doc,writer);
      }
    }
    writer.write("</add>");
  }
  boolean deleteI=deleteById != null && deleteById.size() > 0;
  boolean deleteQ=deleteQuery != null && deleteQuery.size() > 0;
  if (deleteI || deleteQ) {
    writer.append("<delete>");
    if (deleteI) {
      for (      String id : deleteById) {
        writer.append("<id>");
        XML.escapeCharData(id,writer);
        writer.append("</id>");
      }
    }
    if (deleteQ) {
      for (      String q : deleteQuery) {
        writer.append("<query>");
        XML.escapeCharData(q,writer);
        writer.append("</query>");
      }
    }
    writer.append("</delete>");
  }
  String xml=writer.toString();
  return (xml.length() > 0) ? xml : null;
}
