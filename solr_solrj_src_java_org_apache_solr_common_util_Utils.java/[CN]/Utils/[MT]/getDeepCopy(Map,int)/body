{
  Map copy=new LinkedHashMap<>();
  for (  Object o : map.entrySet()) {
    Map.Entry e=(Map.Entry)o;
    Object v=e.getValue();
    if (v instanceof Map && maxDepth > 0) {
      v=getDeepCopy((Map)v,maxDepth - 1);
    }
 else     if (v instanceof Set) {
      v=new HashSet((Set)v);
    }
 else     if (v instanceof List) {
      v=new ArrayList((List)v);
    }
    copy.put(e.getKey(),v);
  }
  return copy;
}
