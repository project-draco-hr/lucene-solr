{
  final Set<Long> genNumbers=new HashSet<>();
  for (  SnapshotMetaData m : snapshots) {
    genNumbers.add(m.getGenerationNumber());
  }
  deleteSnapshotIndexFiles(core,dir,new IndexDeletionPolicy(){
    @Override public void onInit(    List<? extends IndexCommit> commits) throws IOException {
      for (      IndexCommit ic : commits) {
        if (!genNumbers.contains(ic.getGeneration())) {
          log.info("Deleting non-snapshotted index commit with generation {}",ic.getGeneration());
          ic.delete();
        }
      }
    }
    @Override public void onCommit(    List<? extends IndexCommit> commits) throws IOException {
    }
  }
);
}
