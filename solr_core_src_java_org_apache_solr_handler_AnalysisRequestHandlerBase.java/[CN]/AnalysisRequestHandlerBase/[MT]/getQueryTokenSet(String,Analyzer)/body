{
  TokenStream tokenStream=null;
  try {
    final Set<BytesRef> tokens=new HashSet<BytesRef>();
    tokenStream=analyzer.tokenStream("",query);
    final TermToBytesRefAttribute bytesAtt=tokenStream.getAttribute(TermToBytesRefAttribute.class);
    final BytesRef bytes=bytesAtt.getBytesRef();
    tokenStream.reset();
    while (tokenStream.incrementToken()) {
      bytesAtt.fillBytesRef();
      tokens.add(BytesRef.deepCopyOf(bytes));
    }
    tokenStream.end();
    return tokens;
  }
 catch (  IOException ioe) {
    throw new RuntimeException("Error occured while iterating over tokenstream",ioe);
  }
 finally {
    IOUtils.closeWhileHandlingException(tokenStream);
  }
}
