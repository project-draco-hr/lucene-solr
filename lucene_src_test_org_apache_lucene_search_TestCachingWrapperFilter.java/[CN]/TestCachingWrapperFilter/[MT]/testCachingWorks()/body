{
  Directory dir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,dir);
  writer.close();
  IndexReader reader=new SlowMultiReaderWrapper(IndexReader.open(dir));
  AtomicReaderContext context=(AtomicReaderContext)reader.getTopReaderContext();
  MockFilter filter=new MockFilter();
  CachingWrapperFilter cacher=new CachingWrapperFilter(filter);
  cacher.getDocIdSet(context,context.reader.getLiveDocs());
  assertTrue("first time",filter.wasCalled());
  cacher.getDocIdSet(context,context.reader.getLiveDocs());
  filter.clear();
  cacher.getDocIdSet(context,context.reader.getLiveDocs());
  assertFalse("second time",filter.wasCalled());
  reader.close();
  dir.close();
}
