{
  try {
    CloudJettyRunner jetty=this.cloudJettys.get(0);
    del("*:*");
    commit();
    indexr("id","1","text","XXXX XXXX","str_s","a","field_i","7");
    indexr("id","2","text","XXXX XXXX","str_s","b","field_i","8");
    indexr("id","3","text","XXXX XXXX","str_s","a","field_i","20");
    indexr("id","4","text","XXXX XXXX","str_s","b","field_i","11");
    indexr("id","5","text","XXXX XXXX","str_s","c","field_i","30");
    indexr("id","6","text","XXXX XXXX","str_s","c","field_i","40");
    indexr("id","7","text","XXXX XXXX","str_s","c","field_i","50");
    indexr("id","8","text","XXXX XXXX","str_s","c","field_i","60");
    commit();
    Map params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select id, field_i, str_s from collection1 where text='XXXX' order by field_iff desc");
    SolrStream solrStream=new SolrStream(jetty.url,params);
    Tuple tuple=getTuple(new ExceptionStream(solrStream));
    assert(tuple.EOF);
    assert(tuple.EXCEPTION);
    assert(tuple.getException().contains("Fields in the sort spec must be included in the field list"));
    params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select id, field_iff, str_s from collection1 where text='XXXX' order by field_iff desc");
    solrStream=new SolrStream(jetty.url,params);
    tuple=getTuple(new ExceptionStream(solrStream));
    assert(tuple.EOF);
    assert(tuple.EXCEPTION);
    assert(tuple.getException().contains("sort param field can't be found:"));
    params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select str_s, count(*), sum(field_iff), min(field_i), max(field_i), avg(field_i) from collection1 where text='XXXX' group by str_s having ((sum(field_iff) = 19) AND (min(field_i) = 8))");
    solrStream=new SolrStream(jetty.url,params);
    tuple=getTuple(new ExceptionStream(solrStream));
    assert(tuple.EOF);
    assert(tuple.EXCEPTION);
    assert(tuple.getException().contains("undefined field:"));
    params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select str_s, count(*), blah(field_iff), min(field_i), max(field_i), avg(field_i) from collection1 where text='XXXX' group by str_s having ((sum(field_iff) = 19) AND (min(field_i) = 8))");
    solrStream=new SolrStream(jetty.url,params);
    tuple=getTuple(new ExceptionStream(solrStream));
    assert(tuple.EOF);
    assert(tuple.EXCEPTION);
    assert(tuple.getException().contains("Invalid function: blah"));
    params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select str_s from collection1 where text='XXXX' group by str_s");
    solrStream=new SolrStream(jetty.url,params);
    tuple=getTuple(new ExceptionStream(solrStream));
    assert(tuple.EOF);
    assert(tuple.EXCEPTION);
    assert(tuple.getException().contains("Group by queries must include atleast one aggregate function."));
  }
  finally {
    delete();
  }
}
