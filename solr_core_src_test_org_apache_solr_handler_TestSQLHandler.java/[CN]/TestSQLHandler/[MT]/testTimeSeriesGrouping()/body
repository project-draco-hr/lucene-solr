{
  try {
    CloudJettyRunner jetty=this.cloudJettys.get(0);
    del("*:*");
    commit();
    indexr("id","1","year_i","2015","month_i","11","day_i","7","item_i","5");
    indexr("id","2","year_i","2015","month_i","11","day_i","7","item_i","10");
    indexr("id","3","year_i","2015","month_i","11","day_i","8","item_i","30");
    indexr("id","4","year_i","2015","month_i","11","day_i","8","item_i","12");
    indexr("id","5","year_i","2015","month_i","10","day_i","1","item_i","4");
    indexr("id","6","year_i","2015","month_i","10","day_i","3","item_i","5");
    indexr("id","7","year_i","2014","month_i","4","day_i","4","item_i","6");
    indexr("id","8","year_i","2014","month_i","4","day_i","2","item_i","1");
    commit();
    Map params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select year_i, sum(item_i) from collection1 group by year_i order by year_i desc");
    SolrStream solrStream=new SolrStream(jetty.url,params);
    List<Tuple> tuples=getTuples(solrStream);
    assert(tuples.size() == 2);
    Tuple tuple=null;
    tuple=tuples.get(0);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getDouble("sum(item_i)") == 66);
    tuple=tuples.get(1);
    assert(tuple.getLong("year_i") == 2014);
    assert(tuple.getDouble("sum(item_i)") == 7);
    params.put("sql","select year_i, month_i, sum(item_i) from collection1 group by year_i, month_i order by year_i desc, month_i desc");
    solrStream=new SolrStream(jetty.url,params);
    tuples=getTuples(solrStream);
    assert(tuples.size() == 3);
    tuple=null;
    tuple=tuples.get(0);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 11);
    assert(tuple.getDouble("sum(item_i)") == 57);
    tuple=tuples.get(1);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 10);
    assert(tuple.getDouble("sum(item_i)") == 9);
    tuple=tuples.get(2);
    assert(tuple.getLong("year_i") == 2014);
    assert(tuple.getLong("month_i") == 4);
    assert(tuple.getDouble("sum(item_i)") == 7);
    params=new HashMap();
    params.put(CommonParams.QT,"/sql");
    params.put("sql","select year_i, month_i, day_i, sum(item_i) from collection1 group by year_i, month_i, day_i order by year_i desc, month_i desc, day_i desc");
    solrStream=new SolrStream(jetty.url,params);
    tuples=getTuples(solrStream);
    assert(tuples.size() == 6);
    tuple=null;
    tuple=tuples.get(0);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 11);
    assert(tuple.getLong("day_i") == 8);
    assert(tuple.getDouble("sum(item_i)") == 42);
    tuple=tuples.get(1);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 11);
    assert(tuple.getLong("day_i") == 7);
    assert(tuple.getDouble("sum(item_i)") == 15);
    tuple=tuples.get(2);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 10);
    assert(tuple.getLong("day_i") == 3);
    assert(tuple.getDouble("sum(item_i)") == 5);
    tuple=tuples.get(3);
    assert(tuple.getLong("year_i") == 2015);
    assert(tuple.getLong("month_i") == 10);
    assert(tuple.getLong("day_i") == 1);
    assert(tuple.getDouble("sum(item_i)") == 4);
    tuple=tuples.get(4);
    assert(tuple.getLong("year_i") == 2014);
    assert(tuple.getLong("month_i") == 4);
    assert(tuple.getLong("day_i") == 4);
    assert(tuple.getDouble("sum(item_i)") == 6);
    tuple=tuples.get(5);
    assert(tuple.getLong("year_i") == 2014);
    assert(tuple.getLong("month_i") == 4);
    assert(tuple.getLong("day_i") == 2);
    assert(tuple.getDouble("sum(item_i)") == 1);
  }
  finally {
    delete();
  }
}
