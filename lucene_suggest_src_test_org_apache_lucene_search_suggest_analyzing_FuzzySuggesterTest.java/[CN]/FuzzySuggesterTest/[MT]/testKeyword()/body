{
  Input keys[]=new Input[]{new Input("foo",50),new Input("bar",10),new Input("barbar",12),new Input("barbara",6)};
  Analyzer analyzer=new MockAnalyzer(random(),MockTokenizer.KEYWORD,false);
  Directory tempDir=getDirectory();
  FuzzySuggester suggester=new FuzzySuggester(tempDir,"fuzzy",analyzer);
  suggester.build(new InputArrayIterator(keys));
  List<LookupResult> results=suggester.lookup(TestUtil.stringToCharSequence("bariar",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("barbr",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("barbara",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbara",results.get(0).key.toString());
  assertEquals(6,results.get(0).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("barbar",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  assertEquals("barbara",results.get(1).key.toString());
  assertEquals(6,results.get(1).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("barbaa",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  assertEquals("barbara",results.get(1).key.toString());
  assertEquals(6,results.get(1).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("f",random()),false,2);
  assertEquals(1,results.size());
  assertEquals("foo",results.get(0).key.toString());
  assertEquals(50,results.get(0).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("bar",random()),false,1);
  assertEquals(1,results.size());
  assertEquals("bar",results.get(0).key.toString());
  assertEquals(10,results.get(0).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("b",random()),false,2);
  assertEquals(2,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  assertEquals("bar",results.get(1).key.toString());
  assertEquals(10,results.get(1).value,0.01F);
  results=suggester.lookup(TestUtil.stringToCharSequence("ba",random()),false,3);
  assertEquals(3,results.size());
  assertEquals("barbar",results.get(0).key.toString());
  assertEquals(12,results.get(0).value,0.01F);
  assertEquals("bar",results.get(1).key.toString());
  assertEquals(10,results.get(1).value,0.01F);
  assertEquals("barbara",results.get(2).key.toString());
  assertEquals(6,results.get(2).value,0.01F);
  IOUtils.close(analyzer,tempDir);
}
