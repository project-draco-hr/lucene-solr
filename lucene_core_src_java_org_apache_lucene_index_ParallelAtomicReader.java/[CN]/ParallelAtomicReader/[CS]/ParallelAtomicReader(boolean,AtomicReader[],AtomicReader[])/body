{
  this.closeSubReaders=closeSubReaders;
  if (readers.length == 0 && storedFieldsReaders.length > 0)   throw new IllegalArgumentException("There must be at least one main reader if storedFieldsReaders are used.");
  this.parallelReaders=readers.clone();
  this.storedFieldsReaders=storedFieldsReaders.clone();
  if (parallelReaders.length > 0) {
    final AtomicReader first=parallelReaders[0];
    this.maxDoc=first.maxDoc();
    this.numDocs=first.numDocs();
    this.hasDeletions=first.hasDeletions();
  }
 else {
    this.maxDoc=this.numDocs=0;
    this.hasDeletions=false;
  }
  Collections.addAll(completeReaderSet,this.parallelReaders);
  Collections.addAll(completeReaderSet,this.storedFieldsReaders);
  for (  AtomicReader reader : completeReaderSet) {
    if (reader.maxDoc() != maxDoc) {
      throw new IllegalArgumentException("All readers must have same maxDoc: " + maxDoc + "!="+ reader.maxDoc());
    }
  }
  for (  final AtomicReader reader : this.parallelReaders) {
    final FieldInfos readerFieldInfos=reader.getFieldInfos();
    for (    FieldInfo fieldInfo : readerFieldInfos) {
      if (!fieldToReader.containsKey(fieldInfo.name)) {
        fieldInfos.add(fieldInfo);
        fieldToReader.put(fieldInfo.name,reader);
        if (fieldInfo.storeTermVector) {
          tvFieldToReader.put(fieldInfo.name,reader);
        }
      }
    }
  }
  for (  final AtomicReader reader : this.parallelReaders) {
    final Fields readerFields=reader.fields();
    if (readerFields != null) {
      final FieldsEnum it=readerFields.iterator();
      String name;
      while ((name=it.next()) != null) {
        if (fieldToReader.get(name) == reader) {
          this.fields.addField(name,it.terms());
        }
      }
    }
  }
  if (!closeSubReaders) {
    for (    AtomicReader reader : completeReaderSet) {
      reader.incRef();
    }
  }
}
