{
  File tmpDir=createTempDir().toFile();
  File solrHome=new File(tmpDir,"home");
  copyMinConf(new File(solrHome,"myCollect"));
  if (leaveOnLocal) {
    FileUtils.copyFile(new File(SolrTestCaseJ4.TEST_HOME(),"solr-stress-new.xml"),new File(solrHome,"solr.xml"));
  }
  System.setProperty("solr.solr.home",solrHome.getAbsolutePath());
  ignoreException("No UpdateLog found - cannot sync");
  ignoreException("No UpdateLog found - cannot recover");
  System.setProperty("zkClientTimeout","8000");
  zkDir=tmpDir.getAbsolutePath() + File.separator + "zookeeper"+ System.currentTimeMillis()+ "/server1/data";
  zkServer=new ZkTestServer(zkDir);
  zkServer.run();
  System.setProperty("zkHost",zkServer.getZkAddress());
  AbstractZkTestCase.buildZooKeeper(zkServer.getZkHost(),zkServer.getZkAddress(),"solrconfig.xml","schema.xml");
  zkClient=new SolrZkClient(zkServer.getZkAddress(),AbstractZkTestCase.TIMEOUT);
  if (toZk) {
    zkClient.makePath("solr.xml",XML_FOR_ZK.getBytes(StandardCharsets.UTF_8),true);
  }
  zkClient.close();
  log.info("####SETUP_START " + getTestName());
  System.setProperty("solr.test.sys.prop1","propone");
  System.setProperty("solr.test.sys.prop2","proptwo");
  Method method=SolrDispatchFilter.class.getDeclaredMethod("loadConfigSolr",SolrResourceLoader.class);
  method.setAccessible(true);
  if (solrDispatchFilter != null)   solrDispatchFilter.destroy();
  solrDispatchFilter=new SolrDispatchFilter();
  Object obj=method.invoke(solrDispatchFilter,new SolrResourceLoader(null));
  cfg=(NodeConfig)obj;
  log.info("####SETUP_END " + getTestName());
}
