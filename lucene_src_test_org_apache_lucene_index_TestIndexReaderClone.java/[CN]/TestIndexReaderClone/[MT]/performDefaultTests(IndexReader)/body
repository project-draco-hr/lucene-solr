{
  Similarity sim=new DefaultSimilarity().get("field1");
  float norm1=sim.decodeNormValue(MultiNorms.norms(r1,"field1")[4]);
  IndexReader pr1Clone=(IndexReader)r1.clone();
  pr1Clone.deleteDocument(10);
  pr1Clone.setNorm(4,"field1",sim.encodeNormValue(0.5f));
  assertTrue(sim.decodeNormValue(MultiNorms.norms(r1,"field1")[4]) == norm1);
  assertTrue(sim.decodeNormValue(MultiNorms.norms(pr1Clone,"field1")[4]) != norm1);
  final Bits delDocs=MultiFields.getDeletedDocs(r1);
  assertTrue(delDocs == null || !delDocs.get(10));
  assertTrue(MultiFields.getDeletedDocs(pr1Clone).get(10));
  try {
    r1.deleteDocument(11);
    fail("Tried to delete doc 11 and an exception should have been thrown");
  }
 catch (  Exception exception) {
  }
  pr1Clone.close();
}
