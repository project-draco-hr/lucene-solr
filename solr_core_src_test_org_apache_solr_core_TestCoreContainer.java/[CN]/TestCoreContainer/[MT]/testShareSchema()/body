{
  final File solrHomeDirectory=new File(TEMP_DIR,this.getClass().getName() + "_shareSchema");
  if (solrHomeDirectory.exists()) {
    FileUtils.deleteDirectory(solrHomeDirectory);
  }
  assertTrue("Failed to mkdirs workDir",solrHomeDirectory.mkdirs());
  FileUtils.copyDirectory(new File(SolrTestCaseJ4.TEST_HOME()),solrHomeDirectory);
  File fconf=new File(solrHomeDirectory,"solr.xml");
  final CoreContainer cores=new CoreContainer(solrHomeDirectory.getAbsolutePath());
  System.setProperty("shareSchema","true");
  cores.load(solrHomeDirectory.getAbsolutePath(),fconf);
  try {
    cores.setPersistent(false);
    assertTrue(cores.isShareSchema());
    CoreDescriptor descriptor1=new CoreDescriptor(cores,"core1","./collection1");
    SolrCore core1=cores.create(descriptor1);
    CoreDescriptor descriptor2=new CoreDescriptor(cores,"core2","./collection1");
    SolrCore core2=cores.create(descriptor2);
    assertSame(core1.getSchema(),core2.getSchema());
    core1.close();
    core2.close();
  }
  finally {
    cores.shutdown();
    System.clearProperty("shareSchema");
  }
}
