{
  MockCoresLocator cl=new MockCoresLocator();
  SolrResourceLoader resourceLoader=new SolrResourceLoader(createTempDir().toString());
  System.setProperty("configsets",getFile("solr/configsets").getAbsolutePath());
  final CoreContainer cc=new CoreContainer(SolrXmlConfig.fromString(resourceLoader,CONFIGSETS_SOLR_XML),new Properties(),cl);
  CoreDescriptor badcore=new CoreDescriptor(cc,"badcore","badcore","configSet","nosuchconfigset");
  cl.add(badcore);
  try {
    cc.load();
    assertThat(cc.getCoreInitFailures().size(),is(1));
    assertThat(cc.getCoreInitFailures().get("badcore").exception.getMessage(),containsString("nosuchconfigset"));
    cc.unload("badcore",true,true,true);
    assertThat(cc.getCoreInitFailures().size(),is(0));
    SolrCore core=cc.create(new CoreDescriptor(cc,"badcore","badcore","configSet","minimal"));
    assertThat(core,not(nullValue()));
  }
  finally {
    cc.shutdown();
  }
}
