{
  File solrHomeDirectory=new File(dataDir,this.getClass().getName() + "_noCores");
  boolean oldSolrXml=random().nextBoolean();
  SetUpHome(solrHomeDirectory,oldSolrXml ? EMPTY_SOLR_XML : EMPTY_SOLR_XML2);
  CoreContainer cores=new CoreContainer(solrHomeDirectory.getAbsolutePath());
  cores.load();
  try {
    assertEquals("There should not be cores",0,cores.getCores().size());
    FileUtils.copyDirectory(new File(SolrTestCaseJ4.TEST_HOME(),"collection1"),solrHomeDirectory);
    CoreDescriptor coreDescriptor=new CoreDescriptor(cores,"core1",solrHomeDirectory.getAbsolutePath());
    SolrCore newCore=cores.create(coreDescriptor);
    cores.register(newCore,false);
    assertEquals("There core registered",1,cores.getCores().size());
    if (oldSolrXml) {
      assertXmlFile(new File(solrHomeDirectory,"solr.xml"),"/solr/cores[@transientCacheSize='32']");
    }
    newCore.close();
    cores.remove("core1");
    assertEquals("There should not be cores",0,cores.getCores().size());
    SolrCore ret=cores.remove("non_existent_core");
    assertNull(ret);
  }
  finally {
    cores.shutdown();
    FileUtils.deleteDirectory(solrHomeDirectory);
  }
}
