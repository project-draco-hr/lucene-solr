{
  if (solrHomeDirectory.exists()) {
    FileUtils.deleteDirectory(solrHomeDirectory);
  }
  assertTrue("Failed to mkdirs workDir",solrHomeDirectory.mkdirs());
  try {
    File solrXmlFile=new File(solrHomeDirectory,"solr.xml");
    BufferedWriter out=new BufferedWriter(new OutputStreamWriter(new FileOutputStream(solrXmlFile),IOUtils.CHARSET_UTF_8));
    out.write(xmlFile);
    out.close();
  }
 catch (  IOException e) {
    FileUtils.deleteDirectory(solrHomeDirectory);
    throw e;
  }
  System.setProperty(SOLR_HOME_PROP,solrHomeDirectory.getAbsolutePath());
}
