{
  File solrHomeDirectory=new File(TEMP_DIR,this.getClass().getName() + "_sameDataDir");
  SetUpHome(solrHomeDirectory,SOLR_XML_SAME_DATADIR);
  copyMinConf(new File(solrHomeDirectory,"core1"));
  copyMinConf(new File(solrHomeDirectory,"core2"));
  CoreContainer.Initializer init=new CoreContainer.Initializer();
  CoreContainer cores=null;
  SolrCore core1=null;
  SolrCore core2=null;
  try {
    cores=init.initialize();
    core1=cores.getCore("core1");
    core2=cores.getCore("core2");
  }
 catch (  SolrException se) {
    assertEquals("Exception code should be 500",500,se.code());
    assertTrue("Should have seen an exception when two cores have the same data dir",se.getMessage().contains("More than one core points to data dir"));
  }
 finally {
    if (cores != null) {
      if (core1 != null)       core1.close();
      if (core2 != null)       core2.close();
      cores.shutdown();
    }
    FileUtils.deleteDirectory(solrHomeDirectory);
  }
}
