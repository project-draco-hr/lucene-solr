{
  double minLon=mortonUnhashLon(currStart);
  double minLat=mortonUnhashLat(currStart);
  double maxLon;
  double maxLat;
  boolean isWithin;
  do {
    maxLon=mortonUnhashLon(currEnd);
    maxLat=mortonUnhashLat(currEnd);
    if ((isWithin=within(minLat,maxLat,minLon,maxLon) == true) || boundary(minLat,maxLat,minLon,maxLon) == true) {
      final int m;
      if (isWithin == false || (m=shift % GeoPointField.PRECISION_STEP) == 0) {
        setNextRange(isWithin == false);
        advanceVariables();
        break;
      }
 else       if (shift < 54) {
        withinOnly=true;
        shift=(short)(shift - m);
        lastWithin=currEnd & ~((1L << shift) - 1);
        setNextRange(false);
        break;
      }
    }
    if (isWithin == true || (relationImpl.cellIntersectsMBR(minLat,maxLat,minLon,maxLon) == true && shift != maxShift)) {
      currEnd=currStart | (1L << --shift) - 1;
    }
 else {
      advanceVariables();
      minLon=mortonUnhashLon(currStart);
      minLat=mortonUnhashLat(currStart);
    }
  }
 while (shift < 63);
}
