{
  if (dvType != null) {
    DocValues.Type currentDVType=docValuesType.get(fieldName);
    if (currentDVType == null) {
      docValuesType.put(fieldName,dvType);
    }
 else     if (currentDVType != null && currentDVType != dvType) {
      throw new IllegalArgumentException("cannot change DocValues type from " + currentDVType + " to "+ dvType+ " for field \""+ fieldName+ "\"");
    }
  }
  Integer fieldNumber=nameToNumber.get(fieldName);
  if (fieldNumber == null) {
    final Integer preferredBoxed=Integer.valueOf(preferredFieldNumber);
    if (preferredFieldNumber != -1 && !numberToName.containsKey(preferredBoxed)) {
      fieldNumber=preferredBoxed;
    }
 else {
      while (numberToName.containsKey(++lowestUnassignedFieldNumber)) {
      }
      fieldNumber=lowestUnassignedFieldNumber;
    }
    numberToName.put(fieldNumber,fieldName);
    nameToNumber.put(fieldName,fieldNumber);
  }
  return fieldNumber.intValue();
}
