{
  IndexWriter w=new IndexWriter(dir,autoCommit,new WhitespaceAnalyzer(),true);
  w.setUseCompoundFile(false);
  w.setMergeFactor(mergeFactor);
  w.setRAMBufferSizeMB(.1);
  w.setMaxBufferedDocs(maxBufferedDocs);
  threads=new IndexingThread[nThreads];
  for (int i=0; i < threads.length; i++) {
    IndexingThread th=new IndexingThread();
    th.w=w;
    th.base=1000000 * i;
    th.range=range;
    th.iterations=iterations;
    threads[i]=th;
  }
  for (int i=0; i < threads.length; i++) {
    threads[i].start();
  }
  for (int i=0; i < threads.length; i++) {
    threads[i].join();
  }
  w.close();
  Map docs=new HashMap();
  for (int i=0; i < threads.length; i++) {
    IndexingThread th=threads[i];
synchronized (th) {
      docs.putAll(th.docs);
    }
  }
  return docs;
}
