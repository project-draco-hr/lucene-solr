{
  Directory dir=newFSDirectory(oldIndexDir);
  IndexReader reader=IndexReader.open(dir);
  IndexSearcher searcher=new IndexSearcher(reader);
  ScoreDoc[] hits=searcher.search(new TermQuery(new Term("content","aaa")),null,1000).scoreDocs;
  assertEquals("wrong number of hits",34,hits.length);
  Document d=searcher.doc(hits[0].doc);
  assertEquals("wrong first document","21",d.get("id"));
  reader.close();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setOpenMode(OpenMode.APPEND));
  writer.forceMerge(1);
  writer.close();
  reader=IndexReader.open(dir);
  searcher=new IndexSearcher(reader);
  hits=searcher.search(new TermQuery(new Term("content","aaa")),null,1000).scoreDocs;
  assertEquals("wrong number of hits",34,hits.length);
  doTestHits(hits,34,searcher.getIndexReader());
  reader.close();
  dir.close();
}
