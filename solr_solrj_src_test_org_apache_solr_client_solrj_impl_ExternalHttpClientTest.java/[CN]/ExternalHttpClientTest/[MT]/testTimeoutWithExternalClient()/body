{
  HttpClientBuilder builder=HttpClientBuilder.create();
  RequestConfig config=RequestConfig.custom().setSocketTimeout(2000).build();
  builder.setDefaultRequestConfig(config);
  HttpSolrClient solrClient=null;
  try (CloseableHttpClient httpClient=builder.build()){
    solrClient=new HttpSolrClient(jetty.getBaseUrl().toString() + "/slow/foo",httpClient);
    SolrQuery q=new SolrQuery("*:*");
    try {
      QueryResponse response=solrClient.query(q,SolrRequest.METHOD.GET);
      fail("No exception thrown.");
    }
 catch (    SolrServerException e) {
      assertTrue(e.getMessage().contains("Timeout"));
    }
  }
  finally {
    if (solrClient != null) {
      solrClient.shutdown();
    }
  }
}
