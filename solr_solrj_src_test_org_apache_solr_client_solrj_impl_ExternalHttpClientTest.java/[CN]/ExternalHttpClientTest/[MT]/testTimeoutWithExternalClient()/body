{
  HttpClientBuilder builder=HttpClientBuilder.create();
  RequestConfig config=RequestConfig.custom().setSocketTimeout(2000).build();
  builder.setDefaultRequestConfig(config);
  HttpSolrServer server=null;
  try (CloseableHttpClient httpClient=builder.build()){
    server=new HttpSolrServer(jetty.getBaseUrl().toString() + "/slow/foo",httpClient);
    SolrQuery q=new SolrQuery("*:*");
    try {
      QueryResponse response=server.query(q,SolrRequest.METHOD.GET);
      fail("No exception thrown.");
    }
 catch (    SolrServerException e) {
      assertTrue(e.getMessage().contains("Timeout"));
    }
  }
  finally {
    if (server != null) {
      server.shutdown();
    }
  }
}
