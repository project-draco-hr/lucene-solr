{
  do {
    while (flushControl.netBytes() > flushControl.stallLimitBytes()) {
      if (sync.trySetStalled()) {
        assert wasStalled=true;
        return;
      }
    }
  }
 while (!sync.tryReset());
}
