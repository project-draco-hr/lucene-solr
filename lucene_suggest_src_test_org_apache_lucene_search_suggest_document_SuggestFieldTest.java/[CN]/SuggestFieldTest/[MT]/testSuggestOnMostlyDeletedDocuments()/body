{
  Analyzer analyzer=new MockAnalyzer(random());
  IndexWriter iw=new IndexWriter(dir,iwcWithSuggestField(analyzer,"suggest_field"));
  int num=atLeast(10);
  Document document=new Document();
  for (int i=1; i <= num; i++) {
    document.add(newSuggestField("suggest_field","abc_" + i,i));
    document.add(new IntField("weight_fld",i,Field.Store.YES));
    iw.addDocument(document);
    document.clear();
  }
  DirectoryReader reader=DirectoryReader.open(iw,false);
  for (int docID=0; docID < reader.maxDoc(); docID++) {
    StoredDocument doc=reader.document(docID);
    StorableField[] weights=doc.getFields("weight_fld");
    assertThat(weights.length,equalTo(1));
    int weight=(int)weights[0].numericValue();
    if (weight != 1) {
      assertTrue(iw.tryDeleteDocument(reader,docID));
    }
  }
  reader.close();
  reader=DirectoryReader.open(iw,false);
  SuggestIndexSearcher indexSearcher=new SuggestIndexSearcher(reader,analyzer);
  TopSuggestDocs suggest=indexSearcher.suggest("suggest_field","abc_",1);
  assertSuggestions(suggest,new Entry("abc_1",1));
  reader.close();
  iw.close();
}
