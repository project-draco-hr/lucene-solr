{
  Analyzer analyzer=new MockAnalyzer(random());
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwcWithSuggestField(analyzer,"suggest_field"));
  int num=atLeast(10);
  Document document=new Document();
  List<Entry> entries=new ArrayList<>();
  for (int i=num; i > 0; i--) {
    if (random().nextInt(4) == 1) {
      document.add(newSuggestField("suggest_field","abc_" + i,i));
      entries.add(new Entry("abc_" + i,i));
    }
    document.add(new IntField("weight_fld",i,Field.Store.YES));
    iw.addDocument(document);
    document.clear();
    if (usually()) {
      iw.commit();
    }
  }
  DirectoryReader reader=iw.getReader();
  SuggestIndexSearcher indexSearcher=new SuggestIndexSearcher(reader,analyzer);
  TopSuggestDocs suggest=indexSearcher.suggest("suggest_field","abc_",(entries.size() == 0) ? 1 : entries.size());
  assertSuggestions(suggest,entries.toArray(new Entry[entries.size()]));
  reader.close();
  iw.close();
}
