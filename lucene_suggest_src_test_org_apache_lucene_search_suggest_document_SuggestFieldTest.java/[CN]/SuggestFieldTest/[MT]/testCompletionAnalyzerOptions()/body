{
  Analyzer analyzer=new MockAnalyzer(random(),MockTokenizer.WHITESPACE,true,MockTokenFilter.ENGLISH_STOPSET);
  Map<String,Analyzer> map=new HashMap<>();
  map.put("suggest_field_default",new CompletionAnalyzer(analyzer));
  CompletionAnalyzer completionAnalyzer=new CompletionAnalyzer(analyzer,false,true);
  map.put("suggest_field_no_p_sep",completionAnalyzer);
  completionAnalyzer=new CompletionAnalyzer(analyzer,true,false);
  map.put("suggest_field_no_p_pos_inc",completionAnalyzer);
  completionAnalyzer=new CompletionAnalyzer(analyzer,false,false);
  map.put("suggest_field_no_p_sep_or_pos_inc",completionAnalyzer);
  PerFieldAnalyzerWrapper analyzerWrapper=new PerFieldAnalyzerWrapper(analyzer,map);
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwcWithSuggestField(analyzerWrapper,map.keySet()));
  Document document=new Document();
  document.add(newSuggestField("suggest_field_default","foobar",7));
  document.add(newSuggestField("suggest_field_default","foo bar",8));
  document.add(newSuggestField("suggest_field_default","the fo",9));
  document.add(newSuggestField("suggest_field_default","the foo bar",10));
  document.add(newSuggestField("suggest_field_no_p_sep","foobar",7));
  document.add(newSuggestField("suggest_field_no_p_sep","foo bar",8));
  document.add(newSuggestField("suggest_field_no_p_sep","the fo",9));
  document.add(newSuggestField("suggest_field_no_p_sep","the foo bar",10));
  document.add(newSuggestField("suggest_field_no_p_pos_inc","foobar",7));
  document.add(newSuggestField("suggest_field_no_p_pos_inc","foo bar",8));
  document.add(newSuggestField("suggest_field_no_p_pos_inc","the fo",9));
  document.add(newSuggestField("suggest_field_no_p_pos_inc","the foo bar",10));
  document.add(newSuggestField("suggest_field_no_p_sep_or_pos_inc","foobar",7));
  document.add(newSuggestField("suggest_field_no_p_sep_or_pos_inc","foo bar",8));
  document.add(newSuggestField("suggest_field_no_p_sep_or_pos_inc","the fo",9));
  document.add(newSuggestField("suggest_field_no_p_sep_or_pos_inc","the foo bar",10));
  iw.addDocument(document);
  DirectoryReader reader=iw.getReader();
  SuggestIndexSearcher indexSearcher=new SuggestIndexSearcher(reader,analyzer);
  TopSuggestDocs suggest;
  suggest=indexSearcher.suggest("suggest_field_default","fo",4);
  assertSuggestions(suggest,new Entry("foo bar",8),new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_default","foob",4);
  assertSuggestions(suggest,new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_sep","fo",4);
  assertSuggestions(suggest,new Entry("the foo bar",10),new Entry("the fo",9),new Entry("foo bar",8),new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_sep","foob",4);
  assertSuggestions(suggest,new Entry("the foo bar",10),new Entry("foo bar",8),new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_pos_inc","fo",4);
  assertSuggestions(suggest,new Entry("the foo bar",10),new Entry("the fo",9),new Entry("foo bar",8),new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_pos_inc","foob",4);
  assertSuggestions(suggest,new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_sep_or_pos_inc","fo",4);
  assertSuggestions(suggest,new Entry("the foo bar",10),new Entry("the fo",9),new Entry("foo bar",8),new Entry("foobar",7));
  suggest=indexSearcher.suggest("suggest_field_no_p_sep_or_pos_inc","foob",4);
  assertSuggestions(suggest,new Entry("the foo bar",10),new Entry("foo bar",8),new Entry("foobar",7));
  reader.close();
  iw.close();
}
