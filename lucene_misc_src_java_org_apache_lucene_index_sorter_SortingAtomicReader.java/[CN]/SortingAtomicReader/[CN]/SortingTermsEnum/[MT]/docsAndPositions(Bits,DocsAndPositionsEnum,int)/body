{
  final DocsAndPositionsEnum inReuse;
  final SortingDocsAndPositionsEnum wrapReuse;
  if (reuse != null && reuse instanceof SortingDocsAndPositionsEnum) {
    wrapReuse=(SortingDocsAndPositionsEnum)reuse;
    inReuse=wrapReuse.getWrapped();
  }
 else {
    wrapReuse=null;
    inReuse=reuse;
  }
  final DocsAndPositionsEnum inDocsAndPositions=in.docsAndPositions(newToOld(liveDocs),inReuse,flags);
  if (inDocsAndPositions == null) {
    return null;
  }
  final boolean storeOffsets=indexOptions.compareTo(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS) >= 0;
  return new SortingDocsAndPositionsEnum(docMap.size(),wrapReuse,inDocsAndPositions,docMap,storeOffsets);
}
