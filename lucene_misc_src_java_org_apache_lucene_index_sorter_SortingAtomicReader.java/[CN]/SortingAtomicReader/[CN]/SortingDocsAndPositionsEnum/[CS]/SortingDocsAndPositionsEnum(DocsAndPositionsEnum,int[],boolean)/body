{
  super(in);
  this.storeOffsets=storeOffsets;
  final RAMFile file=new RAMFile();
  final IndexOutput out=new RAMOutputStream(file);
  docs=new int[32];
  offsets=new long[32];
  int doc;
  int i=0;
  while ((doc=in.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    if (i == docs.length) {
      docs=ArrayUtil.grow(docs,i + 1);
      offsets=ArrayUtil.grow(offsets,i + 1);
    }
    docs[i]=old2new[doc];
    offsets[i]=out.getFilePointer();
    addPositions(in,out);
    i++;
  }
  upto=i;
  SorterTemplate sorter=new DocOffsetSorterTemplate(docs,offsets);
  sorter.quickSort(0,upto - 1);
  out.close();
  this.postingInput=new RAMInputStream("",file);
}
