{
  String sep="";
  while (true) {
    String line=reader.readLine();
    if (line == null) {
      openNextFile();
      continue;
    }
    rawDocSize+=line.length();
    if (line.startsWith(prefix)) {
      if (collectMatchLine) {
        buf.append(sep).append(line);
        sep=NEW_LINE;
      }
      break;
    }
    if (terminatingTag != null && line.startsWith(terminatingTag)) {
      buf.setLength(0);
      break;
    }
    if (collectAll) {
      buf.append(sep).append(line);
      sep=NEW_LINE;
    }
  }
}
