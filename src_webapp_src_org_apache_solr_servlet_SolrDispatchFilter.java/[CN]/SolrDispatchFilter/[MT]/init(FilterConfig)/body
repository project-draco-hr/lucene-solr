{
  log.info("SolrDispatchFilter.init()");
  boolean abortOnConfigurationError=true;
  try {
    this.pathPrefix=config.getInitParameter("path-prefix");
    SolrCore core=null;
    multicore=MultiCore.getRegistry();
    if (multicore.isEnabled()) {
      log.info("Using existing multicore configuration");
    }
 else {
      String instanceDir=SolrResourceLoader.locateInstanceDir();
      File multiconfig=new File(instanceDir,"multicore.xml");
      log.info("looking for multicore.xml: " + multiconfig.getAbsolutePath());
      if (multiconfig.exists()) {
        multicore.load(instanceDir,multiconfig);
      }
    }
    if (multicore.isEnabled()) {
      singlecore=null;
      core=multicore.getDefaultCore();
    }
 else {
      singlecore=new SolrCore(null,null,new SolrConfig(),null);
      core=singlecore;
    }
    log.info("user.dir=" + System.getProperty("user.dir"));
    Config globalConfig=core.getSolrConfig();
    long uploadLimitKB=globalConfig.getInt("requestDispatcher/requestParsers/@multipartUploadLimitInKB",2000);
    boolean enableRemoteStreams=globalConfig.getBool("requestDispatcher/requestParsers/@enableRemoteStreaming",false);
    parsers=new SolrRequestParsers(enableRemoteStreams,uploadLimitKB);
    this.handleSelect=globalConfig.getBool("requestDispatcher/@handleSelect",false);
    abortOnConfigurationError=globalConfig.getBool("abortOnConfigurationError",true);
  }
 catch (  Throwable t) {
    log.log(Level.SEVERE,"Could not start SOLR. Check solr/home property",t);
    SolrConfig.severeErrors.add(t);
    SolrCore.log(t);
  }
  if (abortOnConfigurationError && SolrConfig.severeErrors.size() > 0) {
    StringWriter sw=new StringWriter();
    PrintWriter out=new PrintWriter(sw);
    out.println("Severe errors in solr configuration.\n");
    out.println("Check your log files for more detailed information on what may be wrong.\n");
    out.println("If you want solr to continue after configuration errors, change: \n");
    out.println(" <abortOnConfigurationError>false</abortOnConfigurationError>\n");
    if (multicore.isEnabled()) {
      out.println("in multicore.xml\n");
    }
 else {
      out.println("in solrconfig.xml\n");
    }
    for (    Throwable t : SolrConfig.severeErrors) {
      out.println("-------------------------------------------------------------");
      t.printStackTrace(out);
    }
    out.flush();
    abortErrorMessage=sw.toString();
  }
  log.info("SolrDispatchFilter.init() done");
}
