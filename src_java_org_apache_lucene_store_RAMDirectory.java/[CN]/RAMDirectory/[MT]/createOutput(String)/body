{
  ensureOpen();
  RAMFile file=new RAMFile(this);
synchronized (this) {
    RAMFile existing=(RAMFile)fileMap.get(name);
    if (existing != null) {
      sizeInBytes-=existing.sizeInBytes;
      existing.directory=null;
    }
    fileMap.put(name,file);
  }
  return new RAMOutputStream(file);
}
