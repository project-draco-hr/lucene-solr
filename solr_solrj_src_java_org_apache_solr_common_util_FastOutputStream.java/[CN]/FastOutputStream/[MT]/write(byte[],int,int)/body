{
  for (; ; ) {
    int space=buf.length - pos;
    if (len <= space) {
      System.arraycopy(arr,off,buf,pos,len);
      pos+=len;
      return;
    }
 else     if (len > buf.length) {
      if (pos > 0) {
        flush(buf,0,pos);
        written+=pos;
        pos=0;
      }
      flush(arr,off,len);
      written+=len;
      return;
    }
    System.arraycopy(arr,off,buf,pos,space);
    written+=buf.length;
    flush(buf,0,buf.length);
    pos=0;
    off+=space;
    len-=space;
  }
}
