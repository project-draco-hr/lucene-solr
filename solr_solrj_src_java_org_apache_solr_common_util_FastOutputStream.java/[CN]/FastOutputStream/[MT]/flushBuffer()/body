{
  if (pos > 0) {
    flush(buf,0,pos);
    written+=pos;
    pos=0;
  }
}
