{
  MockDirectoryWrapper directory=newDirectory();
  IndexWriter writer=new IndexWriter(directory,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(2));
  writer.setInfoStream(VERBOSE ? System.out : null);
  for (int iter=0; iter < 7; iter++) {
    if (VERBOSE) {
      System.out.println("TEST: iter=" + iter);
    }
    for (int j=0; j < 21; j++) {
      Document doc=new Document();
      doc.add(newField("content","a b c",Field.Store.NO,Field.Index.ANALYZED));
      writer.addDocument(doc);
    }
    writer.close();
    TestIndexWriter.assertNoUnreferencedFiles(directory,"testNoExtraFiles");
    writer=new IndexWriter(directory,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.APPEND).setMaxBufferedDocs(2));
  }
  writer.close();
  directory.close();
}
