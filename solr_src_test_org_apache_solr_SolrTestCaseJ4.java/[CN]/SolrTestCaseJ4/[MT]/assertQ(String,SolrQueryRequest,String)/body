{
  try {
    String m=(null == message) ? "" : message + " ";
    String response=h.query(req);
    if (req.getParams().getBool("facet",false)) {
      String[] allTests=new String[tests.length + 1];
      System.arraycopy(tests,0,allTests,1,tests.length);
      allTests[0]="*[count(//lst[@name='facet_counts']/*[@name='exception'])=0]";
      tests=allTests;
    }
    String results=h.validateXPath(response,tests);
    if (null != results) {
      String msg="REQUEST FAILED: xpath=" + results + "\n\txml response was: "+ response+ "\n\trequest was:"+ req.getParamString();
      log.error(msg);
      throw new RuntimeException(msg);
    }
  }
 catch (  XPathExpressionException e1) {
    throw new RuntimeException("XPath is invalid",e1);
  }
catch (  Exception e2) {
    log.error("REQUEST FAILED: " + req.getParamString());
    throw new RuntimeException("Exception during query",e2);
  }
}
