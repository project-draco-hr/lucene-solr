{
  if (model == null) {
    model=new LinkedHashMap<Comparable,Doc>();
  }
  int commitOneOutOf=Math.max(nDocs / 10,10);
  int order=-1;
  for (  Doc doc : model.values()) {
    order=Math.max(order,doc.order);
  }
  order++;
  for (int i=0; i < nDocs; i++) {
    Doc doc=createDoc(descriptor);
    doc.order=order++;
    updateJ(toJSON(doc),null);
    model.put(doc.id,doc);
    if (random.nextInt(commitOneOutOf) == 0) {
      assertU(commit());
    }
    if (random.nextInt(10) == 0) {
      updateJ(toJSON(doc),null);
      model.put(doc.id,doc);
    }
  }
  if (random.nextInt(10) == 0) {
    assertU(optimize());
  }
 else {
    assertU(commit());
  }
  return model;
}
