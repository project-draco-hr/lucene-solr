{
  log.info("###deleteCore");
  RefCounted<SolrIndexSearcher> holder=null;
  if (h != null) {
    holder=h.getCore().getSearcher();
    log.info("END SEARCHER REFCOUNT=" + (holder.getRefcount() - 1) + " instance="+ holder.get());
    h.close();
  }
  if (dataDir != null) {
    String skip=System.getProperty("solr.test.leavedatadir");
    if (null != skip && 0 != skip.trim().length()) {
      System.err.println("NOTE: per solr.test.leavedatadir, dataDir will not be removed: " + dataDir.getAbsolutePath());
    }
 else {
      if (!recurseDelete(dataDir)) {
        System.err.println("!!!! WARNING: best effort to remove " + dataDir.getAbsolutePath() + " FAILED !!!!!");
      }
    }
  }
  if (factoryProp == null) {
    System.clearProperty("solr.directoryFactory");
  }
  dataDir=null;
  solrConfig=null;
  h=null;
  lrf=null;
  configString=schemaString=null;
  if (holder != null) {
    log.info("FINAL SEARCHER REFCOUNT=" + (holder.getRefcount() - 1) + " instance="+ holder.get());
    holder.decref();
  }
  endTrackingSearchers();
}
