{
  sis.read(dir);
  MultiSegmentReader reader=new MultiSegmentReader(dir,sis,false,readers);
  assertTrue(reader != null);
  assertEquals(2,reader.numDocs());
  reader.deleteDocument(0);
  assertEquals(1,reader.numDocs());
  reader.undeleteAll();
  assertEquals(2,reader.numDocs());
  reader.commit();
  reader.close();
  sis.read(dir);
  openReaders();
  reader=new MultiSegmentReader(dir,sis,false,readers);
  assertEquals(2,reader.numDocs());
  reader.deleteDocument(0);
  assertEquals(1,reader.numDocs());
  reader.commit();
  reader.close();
  sis.read(dir);
  reader=new MultiSegmentReader(dir,sis,false,readers);
  assertEquals(1,reader.numDocs());
}
