{
  int numReaders=mergeState.readers.size();
  mergeState.matchingSegmentReaders=new SegmentReader[numReaders];
  for (int i=0; i < numReaders; i++) {
    AtomicReader reader=mergeState.readers.get(i);
    if (reader instanceof SegmentReader) {
      SegmentReader segmentReader=(SegmentReader)reader;
      boolean same=true;
      FieldInfos segmentFieldInfos=segmentReader.getFieldInfos();
      for (      FieldInfo fi : segmentFieldInfos) {
        FieldInfo other=mergeState.fieldInfos.fieldInfo(fi.number);
        if (other == null || !other.name.equals(fi.name)) {
          same=false;
          break;
        }
      }
      if (same) {
        mergeState.matchingSegmentReaders[i]=segmentReader;
        mergeState.matchedCount++;
      }
    }
  }
  if (mergeState.infoStream.isEnabled("SM")) {
    mergeState.infoStream.message("SM","merge store matchedCount=" + mergeState.matchedCount + " vs "+ mergeState.readers.size());
    if (mergeState.matchedCount != mergeState.readers.size()) {
      mergeState.infoStream.message("SM","" + (mergeState.readers.size() - mergeState.matchedCount) + " non-bulk merges");
    }
  }
}
