{
  MiniSolrCloudCluster cluster=new MiniSolrCloudCluster(0,createTempDir(),buildJettyConfig("/solr"));
  try {
    CloudSolrClient client=cluster.getSolrClient();
    CollectionAdminRequest.List listReq=new CollectionAdminRequest.List();
    try {
      client.request(listReq);
      fail("Requests to a non-running cluster should throw a SolrException");
    }
 catch (    SolrException e) {
      assertTrue("Unexpected message: " + e.getMessage(),e.getMessage().contains("cluster not found/not ready"));
    }
    cluster.startJettySolrRunner();
    client.connect(20,TimeUnit.SECONDS);
    client.request(listReq);
  }
  finally {
    cluster.shutdown();
  }
}
