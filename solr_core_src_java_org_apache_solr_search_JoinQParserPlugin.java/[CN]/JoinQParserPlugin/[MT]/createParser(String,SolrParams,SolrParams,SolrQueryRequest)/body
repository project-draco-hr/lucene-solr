{
  return new QParser(qstr,localParams,params,req){
    public Query parse() throws SyntaxError {
      String fromField=getParam("from");
      String fromIndex=getParam("fromIndex");
      String toField=getParam("to");
      String v=localParams.get("v");
      Query fromQuery;
      long fromCoreOpenTime=0;
      if (fromIndex != null && !fromIndex.equals(req.getCore().getCoreDescriptor().getName())) {
        CoreContainer container=req.getCore().getCoreDescriptor().getCoreContainer();
        final SolrCore fromCore=container.getCore(fromIndex);
        RefCounted<SolrIndexSearcher> fromHolder=null;
        if (fromCore == null) {
          throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Cross-core join: no such core " + fromIndex);
        }
        LocalSolrQueryRequest otherReq=new LocalSolrQueryRequest(fromCore,params);
        try {
          QParser parser=QParser.getParser(v,"lucene",otherReq);
          fromQuery=parser.getQuery();
          fromHolder=fromCore.getRegisteredSearcher();
          if (fromHolder != null)           fromCoreOpenTime=fromHolder.get().getOpenTime();
        }
  finally {
          otherReq.close();
          fromCore.close();
          if (fromHolder != null)           fromHolder.decref();
        }
      }
 else {
        QParser fromQueryParser=subQuery(v,null);
        fromQuery=fromQueryParser.getQuery();
      }
      JoinQuery jq=new JoinQuery(fromField,toField,fromIndex,fromQuery);
      jq.fromCoreOpenTime=fromCoreOpenTime;
      return jq;
    }
  }
;
}
