{
  dir.maybeThrowDeterministicException();
  delegate.close();
  if (dir.trackDiskUsage) {
    long size=dir.getRecomputedActualSizeInBytes();
    if (size > dir.maxUsedSize) {
      dir.maxUsedSize=size;
    }
  }
synchronized (dir) {
    dir.openFileHandles.remove(this);
    dir.openFilesForWrite.remove(name);
  }
}
