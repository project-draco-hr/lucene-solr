{
  boolean success=false;
  if (done) {
    return null;
  }
  try {
    ByteArrayDataInput input=new ByteArrayDataInput();
    if (reader.read(scratch)) {
      weight=decode(scratch,input);
      if (hasPayloads) {
        payload=decodePayload(scratch,input);
      }
      success=true;
      return scratch;
    }
    close();
    success=done=true;
    return null;
  }
  finally {
    if (!success) {
      done=true;
      close();
    }
  }
}
