{
  XPathRecordReader rr=new XPathRecordReader("/anyd/contenido");
  rr.addField("descdend","//boo",true);
  rr.addField("inr_descd","//boo/i",false);
  rr.addField("cont","/anyd/contenido",false);
  rr.addField("id","/anyd/contenido/@id",false);
  rr.addField("status","/anyd/status",false);
  rr.addField("title","/anyd/contenido/titulo",false,XPathRecordReader.FLATTEN);
  rr.addField("resume","/anyd/contenido/resumen",false);
  rr.addField("text","/anyd/contenido/texto",false);
  String xml="<anyd>\n" + "  this <boo>top level</boo> is ignored because it is external to the forEach\n" + "  <status>as is <boo>this element</boo></status>\n"+ "  <contenido id=\"10097\" idioma=\"cat\">\n"+ "    This one is <boo>not ignored as its</boo> inside a forEach\n"+ "    <antetitulo><i> big <boo>antler</boo></i></antetitulo>\n"+ "    <titulo>  My <i>flattened <boo>title</boo></i> </titulo>\n"+ "    <resumen> My summary <i>skip this!</i>  </resumen>\n"+ "    <texto>   <boo>Within the body of</boo>My text</texto>\n"+ "    <p>Access <boo>inner <i>sub clauses</i> as well</boo></p>\n"+ "    </contenido>\n"+ "</anyd>";
  List<Map<String,Object>> l=rr.getAllRecords(new StringReader(xml));
  assertEquals(1,l.size());
  Map<String,Object> m=l.get(0);
  assertEquals("This one is  inside a forEach",m.get("cont").toString().trim());
  assertEquals("10097",m.get("id"));
  assertEquals("My flattened title",m.get("title").toString().trim());
  assertEquals("My summary",m.get("resume").toString().trim());
  assertEquals("My text",m.get("text").toString().trim());
  assertEquals("not ignored as its",(String)((List)m.get("descdend")).get(0));
  assertEquals("antler",(String)((List)m.get("descdend")).get(1));
  assertEquals("Within the body of",(String)((List)m.get("descdend")).get(2));
  assertEquals("inner  as well",(String)((List)m.get("descdend")).get(3));
  assertEquals("sub clauses",m.get("inr_descd").toString().trim());
}
