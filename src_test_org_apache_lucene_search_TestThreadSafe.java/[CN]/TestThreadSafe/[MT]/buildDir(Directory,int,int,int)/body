{
  IndexWriter iw=new IndexWriter(dir,new WhitespaceAnalyzer(),true);
  iw.setMaxBufferedDocs(10);
  for (int j=0; j < nDocs; j++) {
    Document d=new Document();
    int nFields=r.nextInt(maxFields);
    for (int i=0; i < nFields; i++) {
      int flen=r.nextInt(maxFieldLen);
      StringBuffer sb=new StringBuffer("^ ");
      while (sb.length() < flen)       sb.append(" " + words[r.nextInt(words.length)]);
      sb.append(" $");
      Field.Store store=Field.Store.YES;
      Field.Index index=Field.Index.TOKENIZED;
      d.add(new Field("f" + i,sb.toString(),store,index));
    }
    iw.addDocument(d);
  }
  iw.close();
}
