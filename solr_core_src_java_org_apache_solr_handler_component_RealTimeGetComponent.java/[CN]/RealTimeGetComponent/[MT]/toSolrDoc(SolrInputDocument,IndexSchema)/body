{
  Document doc=DocumentBuilder.toDocument(sdoc,schema);
  Document out=new Document();
  for (  IndexableField f : doc.getFields()) {
    if (f.fieldType().stored()) {
      out.add(f);
    }
 else     if (f.fieldType().docValuesType() != DocValuesType.NONE) {
      SchemaField schemaField=schema.getFieldOrNull(f.name());
      if (schemaField != null && !schemaField.stored() && schemaField.useDocValuesAsStored()) {
        out.add(f);
      }
    }
 else {
      log.debug("Don't know how to handle field " + f);
    }
  }
  return toSolrDoc(out,schema);
}
