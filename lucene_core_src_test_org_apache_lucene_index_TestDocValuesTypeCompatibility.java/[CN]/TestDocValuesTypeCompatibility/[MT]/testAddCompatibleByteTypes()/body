{
  int numIter=atLeast(10);
  for (int i=0; i < numIter; i++) {
    Directory dir=newDirectory();
    IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
    int numDocs=atLeast(100);
    iwc.setMaxBufferedDocs(2 * numDocs);
    iwc.setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH);
    iwc.setRAMPerThreadHardLimitMB(2000);
    IndexWriter writer=new IndexWriter(dir,iwc);
    boolean mustBeFixed=random().nextBoolean();
    int maxSize=2 + random().nextInt(15);
    IndexableField bytesField=getRandomBytesField(mustBeFixed,maxSize,true);
    addDoc(writer,bytesField);
    for (int j=0; j < numDocs; j++) {
      bytesField=getRandomBytesField(mustBeFixed,maxSize,false);
      addDoc(writer,bytesField);
    }
    writer.close();
    dir.close();
  }
}
