{
  int numIter=atLeast(10);
  for (int i=0; i < numIter; i++) {
    Directory dir=newDirectory();
    IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
    int numDocs=atLeast(100);
    iwc.setMaxBufferedDocs(2 * numDocs);
    iwc.setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH);
    iwc.setRAMPerThreadHardLimitMB(2000);
    IndexWriter writer=new IndexWriter(dir,iwc);
    Field[] fields=new Field[]{new DoubleDocValuesField("f",1.0),new IntDocValuesField("f",1),new ShortDocValuesField("f",(short)1),new ByteDocValuesField("f",(byte)1)};
    int base=random().nextInt(fields.length - 1);
    addDoc(writer,fields[base]);
    for (int j=0; j < numDocs; j++) {
      int f=base + random().nextInt(fields.length - base);
      addDoc(writer,fields[f]);
    }
    writer.close();
    dir.close();
  }
}
