{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  int numDocs=atLeast(100);
  iwc.setMaxBufferedDocs(numDocs);
  iwc.setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH);
  iwc.setRAMPerThreadHardLimitMB(2000);
  IndexWriter writer=new IndexWriter(dir,iwc);
  int numDocsIndexed=0;
  for (int j=1; j < numDocs; j++) {
    try {
      addDoc(writer,getRandomIndexableDVField());
      numDocsIndexed++;
    }
 catch (    IllegalArgumentException e) {
      assertTrue(e.getMessage().startsWith("Incompatible DocValues type:"));
    }
  }
  writer.commit();
  DirectoryReader open=DirectoryReader.open(dir);
  assertEquals(numDocsIndexed,open.numDocs());
  open.close();
  writer.close();
  dir.close();
}
