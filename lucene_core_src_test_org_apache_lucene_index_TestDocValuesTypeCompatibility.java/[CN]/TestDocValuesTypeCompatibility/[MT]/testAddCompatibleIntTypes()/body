{
  int numIter=atLeast(10);
  for (int i=0; i < numIter; i++) {
    Directory dir=newDirectory();
    IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
    int numDocs=atLeast(100);
    iwc.setMaxBufferedDocs(2 * numDocs);
    iwc.setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH);
    iwc.setRAMPerThreadHardLimitMB(2000);
    IndexWriter writer=new IndexWriter(dir,iwc);
    Type[] types=new Type[]{Type.VAR_INTS,Type.FIXED_INTS_16,Type.FIXED_INTS_64,Type.FIXED_INTS_16,Type.FIXED_INTS_8};
    Type maxType=types[random().nextInt(types.length)];
    for (int j=0; j < numDocs; j++) {
      addDoc(writer,getRandomIntsField(maxType,j == 0));
    }
    writer.close();
    dir.close();
  }
}
