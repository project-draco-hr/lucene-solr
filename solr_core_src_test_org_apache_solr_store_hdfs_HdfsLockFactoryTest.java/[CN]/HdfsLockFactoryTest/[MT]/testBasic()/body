{
  URI uri=dfsCluster.getURI();
  Path lockPath=new Path(uri.toString(),"/basedir/lock");
  Configuration conf=new Configuration();
  HdfsDirectory dir=new HdfsDirectory(lockPath,conf);
  Lock lock=dir.makeLock("testlock");
  boolean success=lock.obtain();
  assertTrue("We could not get the lock when it should be available",success);
  success=lock.obtain();
  assertFalse("We got the lock but it should be unavailble",success);
  lock.close();
  success=lock.obtain();
  assertTrue("We could not get the lock when it should be available",success);
  success=lock.obtain();
  assertFalse("We got the lock but it should be unavailble",success);
  dir.close();
}
