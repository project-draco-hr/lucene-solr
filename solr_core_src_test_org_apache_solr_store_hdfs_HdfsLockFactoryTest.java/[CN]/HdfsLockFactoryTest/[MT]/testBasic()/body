{
  String uri=HdfsTestUtil.getURI(dfsCluster);
  Path lockPath=new Path(uri,"/basedir/lock");
  Configuration conf=HdfsTestUtil.getClientConfiguration(dfsCluster);
  HdfsDirectory dir=new HdfsDirectory(lockPath,conf);
  Lock lock=dir.makeLock("testlock");
  boolean success=lock.obtain();
  assertTrue("We could not get the lock when it should be available",success);
  Lock lock2=dir.makeLock("testlock");
  success=lock2.obtain();
  assertFalse("We got the lock but it should be unavailble",success);
  IOUtils.close(lock,lock2);
  lock=dir.makeLock("testlock");
  success=lock.obtain();
  assertTrue("We could not get the lock when it should be available",success);
  lock2=dir.makeLock("testlock");
  success=lock2.obtain();
  assertFalse("We got the lock but it should be unavailble",success);
  IOUtils.close(lock,lock2);
  dir.close();
}
