{
  InputStream is;
  String file=configSetZkPath + "/" + resource;
  int maxTries=10;
  Exception exception=null;
  while (maxTries-- > 0) {
    try {
      if (zkController.pathExists(file)) {
        Stat stat=new Stat();
        byte[] bytes=zkController.getZkClient().getData(file,null,stat,true);
        return new ZkByteArrayInputStream(bytes,stat);
      }
 else {
        break;
      }
    }
 catch (    KeeperException.SessionExpiredException e) {
      exception=e;
      try {
        Thread.sleep(1000);
        log.debug("Sleeping for 1s before retrying fetching resource=" + resource);
      }
 catch (      InterruptedException ie) {
        Thread.currentThread().interrupt();
        throw new IOException("Could not load resource=" + resource,ie);
      }
    }
catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      throw new IOException("Error opening " + file,e);
    }
catch (    KeeperException e) {
      throw new IOException("Error opening " + file,e);
    }
  }
  if (exception != null) {
    throw new IOException("We re-tried 10 times but was still unable to fetch resource=" + resource + " from ZK",exception);
  }
  try {
    is=classLoader.getResourceAsStream(resource.replace(File.separatorChar,'/'));
  }
 catch (  Exception e) {
    throw new IOException("Error opening " + resource,e);
  }
  if (is == null) {
    throw new SolrResourceNotFoundException("Can't find resource '" + resource + "' in classpath or '"+ configSetZkPath+ "', cwd="+ System.getProperty("user.dir"));
  }
  return is;
}
