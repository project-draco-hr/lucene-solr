{
  MockDirectoryWrapper dir=newMockDirectory(random(),new SingleInstanceLockFactory());
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(null));
  try {
    dir.close();
    fail();
  }
 catch (  Exception expected) {
    assertTrue(expected.getMessage().contains("there are still open locks"));
  }
 finally {
    IOUtils.closeWhileHandlingException(iw);
  }
}
