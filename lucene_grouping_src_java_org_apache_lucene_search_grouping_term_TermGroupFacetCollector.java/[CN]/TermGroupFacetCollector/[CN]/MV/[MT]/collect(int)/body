{
  int groupOrd=groupFieldTermsIndex.getOrd(doc);
  if (facetFieldNumTerms == 0) {
    int segmentGroupedFacetsIndex=groupOrd * (facetFieldNumTerms + 1);
    if (facetPrefix != null || segmentGroupedFacetHits.exists(segmentGroupedFacetsIndex)) {
      return;
    }
    segmentTotalCount++;
    segmentFacetCounts[facetFieldNumTerms]++;
    segmentGroupedFacetHits.put(segmentGroupedFacetsIndex);
    BytesRef groupKey;
    if (groupOrd == -1) {
      groupKey=null;
    }
 else {
      groupKey=BytesRef.deepCopyOf(groupFieldTermsIndex.lookupOrd(groupOrd));
    }
    groupedFacetHits.add(new GroupedFacetHit(groupKey,null));
    return;
  }
  facetFieldDocTermOrds.setDocument(doc);
  long ord;
  boolean empty=true;
  while ((ord=facetFieldDocTermOrds.nextOrd()) != SortedSetDocValues.NO_MORE_ORDS) {
    process(groupOrd,(int)ord);
    empty=false;
  }
  if (empty) {
    process(groupOrd,facetFieldNumTerms);
  }
}
