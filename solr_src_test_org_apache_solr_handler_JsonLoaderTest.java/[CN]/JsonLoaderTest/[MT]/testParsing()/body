{
  Reader reader=new StringReader(input);
  BufferingRequestProcessor p=new BufferingRequestProcessor(null);
  JsonLoader loader=new JsonLoader(p);
  loader.processUpdate(p,new JSONParser(reader));
  assertEquals(2,p.addCommands.size());
  AddUpdateCommand add=p.addCommands.get(0);
  SolrInputDocument d=add.solrDoc;
  SolrInputField f=d.getField("boosted");
  assertEquals(6.7f,f.getBoost());
  assertEquals(2,f.getValues().size());
  add=p.addCommands.get(1);
  d=add.solrDoc;
  f=d.getField("f1");
  assertEquals(2,f.getValues().size());
  assertEquals(3.45f,d.getDocumentBoost());
  assertEquals(true,add.allowDups);
  assertEquals(2,p.commitCommands.size());
  CommitUpdateCommand commit=p.commitCommands.get(0);
  assertFalse(commit.optimize);
  assertTrue(commit.waitFlush);
  assertTrue(commit.waitSearcher);
  commit=p.commitCommands.get(1);
  assertTrue(commit.optimize);
  assertFalse(commit.waitFlush);
  assertFalse(commit.waitSearcher);
  assertEquals(2,p.deleteCommands.size());
  DeleteUpdateCommand delete=p.deleteCommands.get(0);
  assertEquals(delete.id,"ID");
  assertEquals(delete.query,null);
  delete=p.deleteCommands.get(1);
  assertEquals(delete.id,null);
  assertEquals(delete.query,"QUERY");
  assertEquals(1,p.rollbackCommands.size());
}
