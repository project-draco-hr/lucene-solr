{
  if (files.isEmpty()) {
    if (allowEmpty) {
      return null;
    }
 else {
      throw new IllegalStateException("empty list of files not allowed");
    }
  }
  String segmentsFile=files.remove(files.size() - 1);
  if (!segmentsFile.startsWith(IndexFileNames.SEGMENTS) || segmentsFile.equals(IndexFileNames.SEGMENTS_GEN)) {
    throw new IllegalStateException("last file to copy+sync must be segments_N but got " + segmentsFile + "; check your Revision implementation!");
  }
  return segmentsFile;
}
