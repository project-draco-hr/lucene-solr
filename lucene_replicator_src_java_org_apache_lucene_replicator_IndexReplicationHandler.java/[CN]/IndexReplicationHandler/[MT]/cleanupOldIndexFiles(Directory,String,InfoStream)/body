{
  try {
    IndexCommit commit=getLastCommit(dir);
    if (commit != null && commit.getSegmentsFileName().equals(segmentsFile)) {
      Set<String> commitFiles=new HashSet<>();
      commitFiles.addAll(commit.getFileNames());
      commitFiles.add(IndexFileNames.SEGMENTS_GEN);
      Matcher matcher=IndexFileNames.CODEC_FILE_PATTERN.matcher("");
      for (      String file : dir.listAll()) {
        if (!commitFiles.contains(file) && (matcher.reset(file).matches() || file.startsWith(IndexFileNames.SEGMENTS))) {
          IOUtils.deleteFilesIgnoringExceptions(dir,file);
        }
      }
    }
  }
 catch (  Throwable t) {
    if (infoStream.isEnabled(INFO_STREAM_COMPONENT)) {
      infoStream.message(INFO_STREAM_COMPONENT,"cleanupOldIndexFiles(): failed on error " + t.getMessage());
    }
  }
}
