{
  Directory dir=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()));
  addDocumentWithFields(writer);
  addDocumentWithFields(writer);
  writer.close();
  IndexReader reader=IndexReader.open(dir,false);
  reader.deleteDocument(0);
  reader.deleteDocument(1);
  reader.close();
  reader=IndexReader.open(dir,false);
  reader.undeleteAll();
  reader.close();
  reader=IndexReader.open(dir,false);
  assertEquals(2,reader.numDocs());
  reader.close();
  dir.close();
}
