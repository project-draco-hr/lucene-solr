{
  Future<RecoveryInfo> future=core.getUpdateHandler().getUpdateLog().applyBufferedUpdates();
  if (future == null) {
    log.info("No replay needed.");
  }
 else {
    log.info("Replaying buffered documents.");
    RecoveryInfo report=future.get();
    if (report.failed) {
      SolrException.log(log,"Replay failed");
      throw new SolrException(ErrorCode.SERVER_ERROR,"Replay failed");
    }
  }
  if (log.isDebugEnabled()) {
    try {
      RefCounted<SolrIndexSearcher> searchHolder=core.getNewestSearcher(false);
      SolrIndexSearcher searcher=searchHolder.get();
      try {
        log.debug(core.getCoreDescriptor().getCoreContainer().getZkController().getNodeName() + " replayed " + searcher.search(new MatchAllDocsQuery(),1).totalHits);
      }
  finally {
        searchHolder.decref();
      }
    }
 catch (    Exception e) {
      log.debug("Error in solrcloud_debug block",e);
    }
  }
  return future;
}
