{
  WaitForState prepCmd=new WaitForState();
  prepCmd.setCoreName(leaderCoreName);
  prepCmd.setNodeName(zkController.getNodeName());
  prepCmd.setCoreNodeName(coreZkNodeName);
  prepCmd.setState(Replica.State.RECOVERING);
  prepCmd.setCheckLive(true);
  prepCmd.setOnlyIfLeader(true);
  final Slice.State state=slice.getState();
  if (state != Slice.State.CONSTRUCTION && state != Slice.State.RECOVERY && state != Slice.State.RECOVERY_FAILED) {
    prepCmd.setOnlyIfLeaderActive(true);
  }
  final int maxTries=30;
  for (int numTries=0; numTries < maxTries; numTries++) {
    try {
      sendPrepRecoveryCmd(leaderBaseUrl,prepCmd);
      break;
    }
 catch (    ExecutionException e) {
      SolrServerException solrException=(SolrServerException)e.getCause();
      if (solrException.getRootCause() instanceof SocketTimeoutException && numTries < maxTries) {
        LOG.warn("Socket timeout when send prep recovery cmd, retrying.. ");
        continue;
      }
      throw e;
    }
  }
}
