{
  try (HttpSolrClient client=new HttpSolrClient.Builder(leaderBaseUrl).build()){
    client.setConnectionTimeout(30000);
    WaitForState prepCmd=new WaitForState();
    prepCmd.setCoreName(leaderCoreName);
    prepCmd.setNodeName(zkController.getNodeName());
    prepCmd.setCoreNodeName(coreZkNodeName);
    prepCmd.setState(Replica.State.RECOVERING);
    prepCmd.setCheckLive(true);
    prepCmd.setOnlyIfLeader(true);
    final Slice.State state=slice.getState();
    if (state != Slice.State.CONSTRUCTION && state != Slice.State.RECOVERY) {
      prepCmd.setOnlyIfLeaderActive(true);
    }
    HttpUriRequestResponse mrr=client.httpUriRequest(prepCmd);
    prevSendPreRecoveryHttpUriRequest=mrr.httpUriRequest;
    LOG.info("Sending prep recovery command to [{}]; [{}]",leaderBaseUrl,prepCmd.toString());
    mrr.future.get();
  }
 }
