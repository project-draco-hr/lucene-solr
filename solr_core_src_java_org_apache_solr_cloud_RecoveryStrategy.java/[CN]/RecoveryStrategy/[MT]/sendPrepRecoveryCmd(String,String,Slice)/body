{
  HttpSolrClient server=new HttpSolrClient(leaderBaseUrl);
  try {
    server.setConnectionTimeout(30000);
    WaitForState prepCmd=new WaitForState();
    prepCmd.setCoreName(leaderCoreName);
    prepCmd.setNodeName(zkController.getNodeName());
    prepCmd.setCoreNodeName(coreZkNodeName);
    prepCmd.setState(ZkStateReader.RECOVERING);
    prepCmd.setCheckLive(true);
    prepCmd.setOnlyIfLeader(true);
    if (!Slice.CONSTRUCTION.equals(slice.getState()) && !Slice.RECOVERY.equals(slice.getState())) {
      prepCmd.setOnlyIfLeaderActive(true);
    }
    HttpUriRequestResponse mrr=server.httpUriRequest(prepCmd);
    prevSendPreRecoveryHttpUriRequest=mrr.httpUriRequest;
    log.info("Sending prep recovery command to {}; {}",leaderBaseUrl,prepCmd.toString());
    mrr.future.get();
  }
  finally {
    server.shutdown();
  }
}
