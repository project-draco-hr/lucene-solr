{
  if (filter != null) {
    query=new DrillDownQuery(filter,query);
  }
  if (sort != null) {
    int limit=searcher.getIndexReader().maxDoc();
    if (limit == 0) {
      limit=1;
    }
    topN=Math.min(topN,limit);
    final TopFieldCollector hitCollector=TopFieldCollector.create(sort,topN,after,true,doDocScores,doMaxScore,true);
    DrillSidewaysResult r=search(query,hitCollector,fsp);
    return new DrillSidewaysResult(r.facetResults,hitCollector.topDocs());
  }
 else {
    return search(after,query,topN,fsp);
  }
}
