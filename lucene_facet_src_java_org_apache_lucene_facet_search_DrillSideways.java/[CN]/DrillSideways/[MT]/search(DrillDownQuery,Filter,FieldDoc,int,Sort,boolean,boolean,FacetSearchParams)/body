{
  if (filter != null) {
    query=new DrillDownQuery(filter,query);
  }
  if (sort != null) {
    final TopFieldCollector hitCollector=TopFieldCollector.create(sort,Math.min(topN,searcher.getIndexReader().maxDoc()),after,true,doDocScores,doMaxScore,true);
    DrillSidewaysResult r=search(query,hitCollector,fsp);
    return new DrillSidewaysResult(r.facetResults,hitCollector.topDocs());
  }
 else {
    return search(after,query,topN,fsp);
  }
}
