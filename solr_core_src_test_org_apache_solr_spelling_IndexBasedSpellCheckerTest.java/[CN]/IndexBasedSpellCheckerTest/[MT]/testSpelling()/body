{
  IndexBasedSpellChecker checker=new IndexBasedSpellChecker();
  NamedList spellchecker=new NamedList();
  spellchecker.add("classname",IndexBasedSpellChecker.class.getName());
  File indexDir=new File(TEMP_DIR,"spellingIdx" + new Date().getTime());
  indexDir.mkdirs();
  spellchecker.add(AbstractLuceneSpellChecker.INDEX_DIR,indexDir.getAbsolutePath());
  spellchecker.add(IndexBasedSpellChecker.FIELD,"title");
  spellchecker.add(AbstractLuceneSpellChecker.SPELLCHECKER_ARG_NAME,spellchecker);
  SolrCore core=h.getCore();
  String dictName=checker.init(spellchecker,core);
  assertTrue(dictName + " is not equal to " + SolrSpellChecker.DEFAULT_DICTIONARY_NAME,dictName.equals(SolrSpellChecker.DEFAULT_DICTIONARY_NAME) == true);
  RefCounted<SolrIndexSearcher> holder=core.getSearcher();
  SolrIndexSearcher searcher=holder.get();
  try {
    checker.build(core,searcher);
    IndexReader reader=searcher.getIndexReader();
    Collection<Token> tokens=queryConverter.convert("documemt");
    SpellingOptions spellOpts=new SpellingOptions(tokens,reader);
    SpellingResult result=checker.getSuggestions(spellOpts);
    assertTrue("result is null and it shouldn't be",result != null);
    Map<String,Integer> suggestions=result.get(spellOpts.tokens.iterator().next());
    assertTrue("documemt is null and it shouldn't be",suggestions != null);
    assertTrue("documemt Size: " + suggestions.size() + " is not: "+ 1,suggestions.size() == 1);
    Map.Entry<String,Integer> entry=suggestions.entrySet().iterator().next();
    assertTrue(entry.getKey() + " is not equal to " + "document",entry.getKey().equals("document") == true);
    assertTrue(entry.getValue() + " does not equal: " + SpellingResult.NO_FREQUENCY_INFO,entry.getValue() == SpellingResult.NO_FREQUENCY_INFO);
    spellOpts.tokens=queryConverter.convert("super");
    result=checker.getSuggestions(spellOpts);
    assertTrue("result is null and it shouldn't be",result != null);
    suggestions=result.get(spellOpts.tokens.iterator().next());
    assertTrue("suggestions size should be 0",suggestions.size() == 0);
    spellOpts.tokens=queryConverter.convert("document");
    result=checker.getSuggestions(spellOpts);
    assertTrue("result is null and it shouldn't be",result != null);
    suggestions=result.get(spellOpts.tokens.iterator().next());
    assertTrue("suggestions is null and it shouldn't be",suggestions == null);
    spellOpts.tokens=queryConverter.convert("red");
    spellOpts.count=2;
    result=checker.getSuggestions(spellOpts);
    assertNotNull(result);
    suggestions=result.get(spellOpts.tokens.iterator().next());
    assertTrue("suggestions is not null and it should be",suggestions == null);
    spellOpts.tokens=queryConverter.convert("bug");
    result=checker.getSuggestions(spellOpts);
    assertNotNull(result);
    suggestions=result.get(spellOpts.tokens.iterator().next());
    assertNotNull(suggestions);
    assertTrue("suggestions Size: " + suggestions.size() + " is not: "+ 2,suggestions.size() == 2);
    entry=suggestions.entrySet().iterator().next();
    assertTrue(entry.getKey() + " is equal to " + "bug and it shouldn't be",entry.getKey().equals("bug") == false);
    assertTrue(entry.getValue() + " does not equal: " + SpellingResult.NO_FREQUENCY_INFO,entry.getValue() == SpellingResult.NO_FREQUENCY_INFO);
    entry=suggestions.entrySet().iterator().next();
    assertTrue(entry.getKey() + " is equal to " + "bug and it shouldn't be",entry.getKey().equals("bug") == false);
    assertTrue(entry.getValue() + " does not equal: " + SpellingResult.NO_FREQUENCY_INFO,entry.getValue() == SpellingResult.NO_FREQUENCY_INFO);
  }
  finally {
    holder.decref();
  }
}
