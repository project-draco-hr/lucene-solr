{
  ResponseBuilder builder=SearchHandler.getResponseBuilder(req);
  SolrIndexSearcher searcher=req.getSearcher();
  SolrParams params=req.getParams();
  if (builder.isNeedDocSet()) {
    builder.setResults(searcher.getDocListAndSet(builder.getQuery(),builder.getFilters(),builder.getSortSpec().getSort(),builder.getSortSpec().getOffset(),builder.getSortSpec().getCount(),builder.getFieldFlags()));
  }
 else {
    DocListAndSet results=new DocListAndSet();
    results.docList=searcher.getDocList(builder.getQuery(),builder.getFilters(),builder.getSortSpec().getSort(),builder.getSortSpec().getOffset(),builder.getSortSpec().getCount(),builder.getFieldFlags());
    builder.setResults(results);
  }
  if (builder.getResults().docList != null && builder.getResults().docList.size() <= 50) {
    SolrPluginUtils.optimizePreFetchDocs(builder.getResults().docList,builder.getQuery(),req,rsp);
  }
  rsp.add("response",builder.getResults().docList);
}
