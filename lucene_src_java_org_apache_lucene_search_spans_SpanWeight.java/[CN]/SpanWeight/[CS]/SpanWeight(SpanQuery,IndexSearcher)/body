{
  this.similarity=searcher.getSimilarityProvider().get(query.getField());
  this.query=query;
  termContexts=new HashMap<Term,TermContext>();
  TreeSet<Term> terms=new TreeSet<Term>();
  query.extractTerms(terms);
  final IndexReaderContext context=searcher.getTopReaderContext();
  final TermStatistics termStats[]=new TermStatistics[terms.size()];
  int i=0;
  for (  Term term : terms) {
    TermContext state=TermContext.build(context,term,true);
    termStats[i]=searcher.termStatistics(term,state);
    termContexts.put(term,state);
    i++;
  }
  stats=similarity.computeStats(searcher.collectionStatistics(query.getField()),query.getBoost(),termStats);
}
