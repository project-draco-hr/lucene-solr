{
  this.similarity=searcher.getSimilarityProvider().get(query.getField());
  this.query=query;
  terms=new TreeSet<Term>();
  query.extractTerms(terms);
  final ReaderContext context=searcher.getTopReaderContext();
  final TermContext states[]=new TermContext[terms.size()];
  int i=0;
  for (  Term term : terms)   states[i++]=TermContext.build(context,term,true);
  stats=similarity.computeStats(searcher,query.getField(),query.getBoost(),states);
}
