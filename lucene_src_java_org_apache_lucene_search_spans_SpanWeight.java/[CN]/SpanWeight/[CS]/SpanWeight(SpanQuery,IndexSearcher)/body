{
  this.similarity=searcher.getSimilarityProvider().get(query.getField());
  this.query=query;
  terms=new TreeSet<Term>();
  query.extractTerms(terms);
  final ReaderContext context=searcher.getTopReaderContext();
  final TermContext states[]=new TermContext[terms.size()];
  final TermStatistics termStats[]=new TermStatistics[terms.size()];
  int i=0;
  for (  Term term : terms) {
    states[i]=TermContext.build(context,term,true);
    termStats[i]=searcher.termStatistics(term,states[i]);
    i++;
  }
  stats=similarity.computeStats(searcher.collectionStatistics(query.getField()),query.getBoost(),termStats);
}
