{
  super(TermAutomatonQuery.this);
  this.automaton=automaton;
  this.searcher=searcher;
  this.termStates=termStates;
  this.similarity=searcher.getSimilarity(true);
  List<TermStatistics> allTermStats=new ArrayList<>();
  for (  Map.Entry<Integer,BytesRef> ent : idToTerm.entrySet()) {
    Integer termID=ent.getKey();
    if (ent.getValue() != null) {
      allTermStats.add(searcher.termStatistics(new Term(field,ent.getValue()),termStates.get(termID)));
    }
  }
  stats=similarity.computeWeight(getBoost(),searcher.collectionStatistics(field),allTermStats.toArray(new TermStatistics[allTermStats.size()]));
}
