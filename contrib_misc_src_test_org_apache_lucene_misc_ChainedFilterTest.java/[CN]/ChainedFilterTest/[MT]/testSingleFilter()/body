{
  for (int mode=0; mode < 2; mode++) {
    boolean old=(mode == 0);
    ChainedFilter chain=getChainedFilter(new Filter[]{dateFilter},null,old);
    int numHits=searcher.search(query,chain,1000).totalHits;
    assertEquals(MAX,numHits);
    chain=new ChainedFilter(new Filter[]{bobFilter});
    numHits=searcher.search(query,chain,1000).totalHits;
    assertEquals(MAX / 2,numHits);
    chain=getChainedFilter(new Filter[]{bobFilter},new int[]{ChainedFilter.AND},old);
    TopDocs hits=searcher.search(query,chain,1000);
    numHits=hits.totalHits;
    assertEquals(MAX / 2,numHits);
    assertEquals("bob",searcher.doc(hits.scoreDocs[0].doc).get("owner"));
    chain=getChainedFilter(new Filter[]{bobFilter},new int[]{ChainedFilter.ANDNOT},old);
    hits=searcher.search(query,chain,1000);
    numHits=hits.totalHits;
    assertEquals(MAX / 2,numHits);
    assertEquals("sue",searcher.doc(hits.scoreDocs[0].doc).get("owner"));
  }
}
