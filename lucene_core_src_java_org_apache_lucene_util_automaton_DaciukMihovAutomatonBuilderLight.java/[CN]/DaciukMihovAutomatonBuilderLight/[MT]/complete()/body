{
  if (this.stateRegistry == null)   throw new IllegalStateException();
  if (root.hasChildren())   replaceOrRegister(root);
  stateRegistry=null;
  return root;
}
