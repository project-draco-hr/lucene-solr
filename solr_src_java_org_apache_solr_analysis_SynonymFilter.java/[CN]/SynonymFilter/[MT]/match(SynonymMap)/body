{
  SynonymMap result=null;
  if (map.submap != null) {
    AttributeSource tok=nextTok();
    if (tok != null) {
      if (tok == this)       tok=cloneAttributes();
      TermAttribute termAtt=(TermAttribute)tok.getAttribute(TermAttribute.class);
      SynonymMap subMap=map.submap.get(termAtt.termBuffer(),0,termAtt.termLength());
      if (subMap != null) {
        result=match(subMap);
      }
      if (result != null) {
        matched.addFirst(tok);
      }
 else {
        pushTok(tok);
      }
    }
  }
  if (result == null && map.synonyms != null) {
    result=map;
  }
  return result;
}
