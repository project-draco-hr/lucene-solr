{
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=new IndexSearcher(indexReader);
  FacetSearchParams fsp=new FacetSearchParams(new CountFacetRequest(CP_A,NUM_CHILDREN_CP_A),new CountFacetRequest(CP_B,NUM_CHILDREN_CP_B));
  FacetsCollector fc=new CountingFacetsCollector(fsp,taxoReader,new FacetArrays(taxoReader.getSize()));
  searcher.search(new MatchAllDocsQuery(),fc);
  List<FacetResult> facetResults=fc.getFacetResults();
  assertEquals("invalid number of facet results",2,facetResults.size());
  for (  FacetResult res : facetResults) {
    FacetResultNode root=res.getFacetResultNode();
    assertEquals("wrong count for " + root.label,allExpectedCounts.get(root.label),(int)root.value);
    assertEquals("invalid residue",0,(int)root.residue);
    for (    FacetResultNode child : root.subResults) {
      assertEquals("wrong count for " + child.label,allExpectedCounts.get(child.label),(int)child.value);
    }
  }
  IOUtils.close(indexReader,taxoReader);
}
