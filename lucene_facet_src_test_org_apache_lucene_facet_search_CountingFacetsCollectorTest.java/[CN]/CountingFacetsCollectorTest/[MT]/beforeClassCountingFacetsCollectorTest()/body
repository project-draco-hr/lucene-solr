{
  indexDir=newDirectory();
  taxoDir=newDirectory();
  IndexWriterConfig conf=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  conf.setMergePolicy(NoMergePolicy.COMPOUND_FILES);
  IndexWriter indexWriter=new IndexWriter(indexDir,conf);
  TaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(taxoDir);
  Map<String,OrdinalPolicy> policies=new HashMap<String,CategoryListParams.OrdinalPolicy>();
  policies.put(CP_B.components[0],OrdinalPolicy.ALL_PARENTS);
  policies.put(CP_C.components[0],OrdinalPolicy.NO_PARENTS);
  policies.put(CP_D.components[0],OrdinalPolicy.NO_PARENTS);
  CategoryListParams clp=new PerDimensionOrdinalPolicy(policies);
  fip=new FacetIndexingParams(clp);
  allExpectedCounts=newCounts();
  termExpectedCounts=newCounts();
  indexDocsNoFacets(indexWriter);
  indexDocsWithFacetsNoTerms(indexWriter,taxoWriter,allExpectedCounts);
  indexDocsWithFacetsAndTerms(indexWriter,taxoWriter,allExpectedCounts);
  indexDocsWithFacetsAndSomeTerms(indexWriter,taxoWriter,allExpectedCounts);
  IOUtils.close(indexWriter,taxoWriter);
}
