{
  indexDir=newDirectory();
  taxoDir=newDirectory();
  IndexWriterConfig conf=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  conf.setMergePolicy(NoMergePolicy.COMPOUND_FILES);
  IndexWriter indexWriter=new IndexWriter(indexDir,conf);
  TaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(taxoDir);
  allExpectedCounts=newCounts();
  termExpectedCounts=newCounts();
  indexDocsNoFacets(indexWriter);
  indexDocsWithFacetsNoTerms(indexWriter,taxoWriter,allExpectedCounts);
  indexDocsWithFacetsAndTerms(indexWriter,taxoWriter,allExpectedCounts);
  indexDocsWithFacetsAndSomeTerms(indexWriter,taxoWriter,allExpectedCounts);
  for (  CategoryPath cp : CATEGORIES_A) {
    if (termExpectedCounts.get(cp) > 0) {
      ++numChildrenIndexedA;
    }
  }
  for (  CategoryPath cp : CATEGORIES_B) {
    if (termExpectedCounts.get(cp) > 0) {
      ++numChildrenIndexedB;
    }
  }
  IOUtils.close(indexWriter,taxoWriter);
}
