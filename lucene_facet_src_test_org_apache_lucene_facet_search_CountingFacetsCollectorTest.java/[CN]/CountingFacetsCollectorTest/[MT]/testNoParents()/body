{
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=new IndexSearcher(indexReader);
  FacetSearchParams fsp=new FacetSearchParams(fip,new CountFacetRequest(CP_C,NUM_CHILDREN_CP_C),new CountFacetRequest(CP_D,NUM_CHILDREN_CP_D));
  FacetsCollector fc=new CountingFacetsCollector(fsp,taxoReader);
  searcher.search(new MatchAllDocsQuery(),fc);
  List<FacetResult> facetResults=fc.getFacetResults();
  assertEquals("invalid number of facet results",fsp.facetRequests.size(),facetResults.size());
  for (  FacetResult res : facetResults) {
    FacetResultNode root=res.getFacetResultNode();
    assertEquals("wrong count for " + root.label,allExpectedCounts.get(root.label),(int)root.value);
    for (    FacetResultNode child : root.subResults) {
      assertEquals("wrong count for " + child.label,allExpectedCounts.get(child.label),(int)child.value);
    }
  }
  IOUtils.close(indexReader,taxoReader);
}
