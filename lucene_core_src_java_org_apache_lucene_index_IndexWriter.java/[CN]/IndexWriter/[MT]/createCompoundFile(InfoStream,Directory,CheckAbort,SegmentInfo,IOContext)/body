{
  final String fileName=IndexFileNames.segmentFileName(info.name,"",IndexFileNames.COMPOUND_FILE_EXTENSION);
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","create compound file " + fileName);
  }
  Collection<String> files=info.files();
  CompoundFileDirectory cfsDir=new CompoundFileDirectory(directory,fileName,context,true);
  IOException prior=null;
  try {
    for (    String file : files) {
      directory.copy(cfsDir,file,file,context);
      checkAbort.work(directory.fileLength(file));
    }
  }
 catch (  IOException ex) {
    prior=ex;
  }
 finally {
    IOUtils.closeWhileHandlingException(prior,cfsDir);
  }
  Set<String> siFiles=new HashSet<String>();
  siFiles.add(fileName);
  siFiles.add(IndexFileNames.segmentFileName(info.name,"",IndexFileNames.COMPOUND_FILE_ENTRIES_EXTENSION));
  info.setFiles(siFiles);
  return files;
}
