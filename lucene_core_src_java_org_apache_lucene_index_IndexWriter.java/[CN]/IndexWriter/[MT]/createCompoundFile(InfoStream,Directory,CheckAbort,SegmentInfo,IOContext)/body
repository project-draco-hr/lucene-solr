{
  String cfsFiles[]=info.getCodec().compoundFormat().files(info);
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","create compound file");
  }
  Collection<String> files=info.files();
  boolean success=false;
  try {
    info.getCodec().compoundFormat().write(directory,info,files,checkAbort,context);
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.deleteFilesIgnoringExceptions(directory,cfsFiles);
    }
  }
  Set<String> siFiles=new HashSet<>();
  for (  String cfsFile : cfsFiles) {
    siFiles.add(cfsFile);
  }
  ;
  info.setFiles(siFiles);
  return files;
}
