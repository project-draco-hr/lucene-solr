{
  String cfsFileName=IndexFileNames.segmentFileName(info.name,"",IndexFileNames.COMPOUND_FILE_EXTENSION);
  String cfeFileName=IndexFileNames.segmentFileName(info.name,"",IndexFileNames.COMPOUND_FILE_ENTRIES_EXTENSION);
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","create compound file");
  }
  Collection<String> files=info.files();
  boolean success=false;
  try {
    info.getCodec().compoundFormat().write(directory,info,files,checkAbort,context);
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.deleteFilesIgnoringExceptions(directory,cfsFileName,cfeFileName);
    }
  }
  Set<String> siFiles=new HashSet<>();
  siFiles.add(cfsFileName);
  siFiles.add(cfeFileName);
  info.setFiles(siFiles);
  return files;
}
