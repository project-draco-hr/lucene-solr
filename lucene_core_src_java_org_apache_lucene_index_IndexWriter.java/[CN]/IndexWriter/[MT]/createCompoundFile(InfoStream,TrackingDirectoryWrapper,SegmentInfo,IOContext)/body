{
  if (!directory.getCreatedFiles().isEmpty()) {
    throw new IllegalStateException("pass a clean trackingdir for CFS creation");
  }
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","create compound file");
  }
  boolean success=false;
  try {
    info.getCodec().compoundFormat().write(directory,info,context);
    success=true;
  }
  finally {
    if (!success) {
      deleteNewFiles(directory.getCreatedFiles());
    }
  }
  info.setFiles(new HashSet<>(directory.getCreatedFiles()));
}
