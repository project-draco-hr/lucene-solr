{
  if (!directory.getCreatedFiles().isEmpty()) {
    throw new IllegalStateException("pass a clean trackingdir for CFS creation");
  }
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","create compound file");
  }
  boolean success=false;
  try {
    info.getCodec().compoundFormat().write(directory,info,context);
    success=true;
  }
  finally {
    if (!success) {
      Set<String> cfsFiles=new HashSet<>(directory.getCreatedFiles());
      for (      String file : cfsFiles) {
        IOUtils.deleteFilesIgnoringExceptions(directory,file);
      }
    }
  }
  Set<String> siFiles=new HashSet<>(directory.getCreatedFiles());
  info.setFiles(siFiles);
}
