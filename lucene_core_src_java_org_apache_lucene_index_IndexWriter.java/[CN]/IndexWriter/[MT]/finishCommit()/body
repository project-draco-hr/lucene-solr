{
  if (pendingCommit != null) {
    try {
      if (infoStream.isEnabled("IW")) {
        infoStream.message("IW","commit: pendingCommit != null");
      }
      pendingCommit.finishCommit(directory);
      if (infoStream.isEnabled("IW")) {
        infoStream.message("IW","commit: wrote segments file \"" + pendingCommit.getSegmentsFileName() + "\"");
      }
      lastCommitChangeCount=pendingCommitChangeCount;
      segmentInfos.updateGeneration(pendingCommit);
      rollbackSegments=pendingCommit.createBackupSegmentInfos();
      deleter.checkpoint(pendingCommit,true);
    }
  finally {
      deleter.decRef(filesToCommit);
      filesToCommit=null;
      pendingCommit=null;
      notifyAll();
    }
  }
 else {
    if (infoStream.isEnabled("IW")) {
      infoStream.message("IW","commit: pendingCommit == null; skip");
    }
  }
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","commit: done");
  }
}
