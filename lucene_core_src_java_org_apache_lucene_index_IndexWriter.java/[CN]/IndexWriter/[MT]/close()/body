{
  boolean lostChanges=false;
  if (config.getMatchVersion().onOrAfter(Version.LUCENE_50) == false) {
    lostChanges=hasUncommittedChanges();
    if (lostChanges == false) {
synchronized (this) {
        if (pendingMerges.isEmpty() == false) {
          lostChanges=true;
        }
        if (runningMerges.isEmpty() == false) {
          lostChanges=true;
        }
      }
    }
  }
  rollback();
  if (lostChanges) {
    throw new RuntimeException("this writer is closed, but some pending changes or running merges were discarded; use shutdown to save pending changes and finish merges before closing");
  }
}
