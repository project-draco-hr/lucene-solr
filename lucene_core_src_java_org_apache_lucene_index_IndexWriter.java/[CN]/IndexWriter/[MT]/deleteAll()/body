{
  ensureOpen();
  boolean success=false;
  try {
synchronized (fullFlushLock) {
      docWriter.lockAndAbortAll(this);
      processEvents(false,true);
synchronized (this) {
        try {
          abortMerges();
          segmentInfos.clear();
          deleter.checkpoint(segmentInfos,false);
          readerPool.dropAll(false);
          ++changeCount;
          segmentInfos.changed();
          globalFieldNumberMap.clear();
          pendingNumDocs.set(0);
          success=true;
        }
  finally {
          docWriter.unlockAllAfterAbortAll(this);
          if (!success) {
            if (infoStream.isEnabled("IW")) {
              infoStream.message("IW","hit exception during deleteAll");
            }
          }
        }
      }
    }
  }
 catch (  OutOfMemoryError oom) {
    tragicEvent(oom,"deleteAll");
  }
}
