{
  ensureOpen();
  boolean success=false;
synchronized (fullFlushLock) {
    try {
      docWriter.lockAndAbortAll();
synchronized (this) {
        try {
          finishMerges(false);
          segmentInfos.clear();
          deleter.checkpoint(segmentInfos,false);
          readerPool.dropAll(false);
          ++changeCount;
          segmentInfos.changed();
          globalFieldNumberMap.clear();
          success=true;
        }
 catch (        OutOfMemoryError oom) {
          handleOOM(oom,"deleteAll");
        }
 finally {
          if (!success) {
            if (infoStream.isEnabled("IW")) {
              infoStream.message("IW","hit exception during deleteAll");
            }
          }
        }
      }
    }
  finally {
      docWriter.unlockAllAfterAbortAll();
    }
  }
}
