{
  ensureOpen();
  boolean success=false;
  try {
synchronized (fullFlushLock) {
      long abortedDocCount=docWriter.lockAndAbortAll(this);
      pendingNumDocs.addAndGet(-abortedDocCount);
      processEvents(false,true);
synchronized (this) {
        try {
          abortMerges();
          stopMerges=false;
          pendingNumDocs.addAndGet(-segmentInfos.totalMaxDoc());
          segmentInfos.clear();
          deleter.checkpoint(segmentInfos,false);
          readerPool.dropAll(false);
          changeCount.incrementAndGet();
          segmentInfos.changed();
          globalFieldNumberMap.clear();
          success=true;
        }
  finally {
          docWriter.unlockAllAfterAbortAll(this);
          if (!success) {
            if (infoStream.isEnabled("IW")) {
              infoStream.message("IW","hit exception during deleteAll");
            }
          }
        }
      }
    }
  }
 catch (  VirtualMachineError tragedy) {
    tragicEvent(tragedy,"deleteAll");
  }
}
