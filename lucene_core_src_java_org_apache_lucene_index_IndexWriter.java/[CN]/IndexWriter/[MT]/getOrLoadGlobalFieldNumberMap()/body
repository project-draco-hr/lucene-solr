{
  final FieldNumberBiMap map=new FieldNumberBiMap();
  if (segmentInfos.size() > 0) {
    if (segmentInfos.getFormat() > SegmentInfos.FORMAT_DIAGNOSTICS) {
      for (      SegmentInfo info : segmentInfos) {
        for (        FieldInfo fi : getFieldInfos(info)) {
          map.addOrGet(fi.name,fi.number);
        }
      }
    }
 else {
      for (      FieldInfo fi : getFieldInfos(segmentInfos.info(segmentInfos.size() - 1))) {
        map.addOrGet(fi.name,fi.number);
      }
    }
  }
  return map;
}
