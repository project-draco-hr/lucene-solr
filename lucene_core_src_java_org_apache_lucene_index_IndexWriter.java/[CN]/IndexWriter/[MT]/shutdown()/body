{
  if (pendingCommit != null) {
    throw new IllegalStateException("cannot close: prepareCommit was already called with no corresponding call to commit");
  }
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","now flush at close");
  }
  boolean success=false;
  try {
    flush(true,true);
    finishMerges(true);
    commit();
    rollback();
    success=true;
  }
  finally {
    if (success == false) {
      try {
        rollback();
      }
 catch (      Throwable t) {
      }
    }
  }
}
