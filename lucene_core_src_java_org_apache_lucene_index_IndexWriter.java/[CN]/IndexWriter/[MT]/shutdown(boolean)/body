{
  if (pendingCommit != null) {
    throw new IllegalStateException("cannot shutdown: prepareCommit was already called with no corresponding call to commit");
  }
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","now flush at shutdown");
  }
  boolean success=false;
  try {
    flush(waitForMerges,true);
    finishMerges(waitForMerges);
    commit();
    close();
    success=true;
  }
  finally {
    if (success == false) {
      try {
        rollback();
      }
 catch (      Throwable t) {
      }
    }
  }
}
