{
  if (infoStream.isEnabled("IW")) {
    infoStream.message("IW","commit: start");
  }
synchronized (commitLock) {
    ensureOpen(false);
    if (infoStream.isEnabled("IW")) {
      infoStream.message("IW","commit: enter lock");
    }
    long seqNo;
    if (pendingCommit == null) {
      if (infoStream.isEnabled("IW")) {
        infoStream.message("IW","commit: now prepare");
      }
      seqNo=prepareCommitInternal(mergePolicy);
    }
 else {
      if (infoStream.isEnabled("IW")) {
        infoStream.message("IW","commit: already prepared");
      }
      seqNo=pendingSeqNo;
    }
    finishCommit();
    return seqNo;
  }
}
