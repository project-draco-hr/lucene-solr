{
  flushDeletesCount.incrementAndGet();
  final BufferedDeletesStream.ApplyDeletesResult result;
  result=bufferedDeletesStream.applyDeletes(readerPool,segmentInfos.asList());
  if (result.anyDeletes) {
    checkpoint();
  }
  if (!keepFullyDeletedSegments && result.allDeleted != null) {
    if (infoStream.isEnabled("IW")) {
      infoStream.message("IW","drop 100% deleted segments: " + segString(result.allDeleted));
    }
    for (    SegmentInfoPerCommit info : result.allDeleted) {
      if (!mergingSegments.contains(info)) {
        segmentInfos.remove(info);
        readerPool.drop(info);
      }
    }
    checkpoint();
  }
  bufferedDeletesStream.prune(segmentInfos);
}
