{
synchronized (bufferedDeletesStream) {
    if (infoStream.isEnabled("IW")) {
      infoStream.message("IW","publishFlushedSegment");
    }
    if (globalPacket != null && globalPacket.any()) {
      bufferedDeletesStream.push(globalPacket);
    }
    final long nextGen;
    if (packet != null && packet.any()) {
      nextGen=bufferedDeletesStream.push(packet);
    }
 else {
      nextGen=bufferedDeletesStream.getNextGen();
    }
    if (infoStream.isEnabled("IW")) {
      infoStream.message("IW","publish sets newSegment delGen=" + nextGen + " seg="+ segString(newSegment));
    }
    newSegment.setBufferedDeletesGen(nextGen);
    segmentInfos.add(newSegment);
    checkpoint();
  }
}
