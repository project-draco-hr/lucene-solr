{
  Query parentQueryWithRandomChild=createParentQuery();
  ToChildBlockJoinQuery blockJoinQuery=new ToChildBlockJoinQuery(parentQueryWithRandomChild,parentsFilter);
  Filter childFilter=new FilterWrapper(new QueryWrapperFilter(new TermQuery(new Term("common_field","1"))));
  try {
    indexSearcher.search(new FilteredQuery(blockJoinQuery,childFilter),1);
    fail("didn't get expected exception");
  }
 catch (  IllegalStateException expected) {
    assertTrue(expected.getMessage() != null && expected.getMessage().contains(ToChildBlockJoinQuery.ILLEGAL_ADVANCE_ON_PARENT));
  }
}
