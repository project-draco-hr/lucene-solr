{
  int randomChildNumber=getRandomChildNumber(0);
  int nextRandomChildNumber=getRandomChildNumber(randomChildNumber);
  Query parentQueryWithRandomChild=createChildrenQueryWithOneParent(nextRandomChildNumber);
  ToParentBlockJoinQuery blockJoinQuery=new ToParentBlockJoinQuery(parentQueryWithRandomChild,parentsFilter,ScoreMode.None);
  BooleanQuery conjunctionQuery=new BooleanQuery();
  WildcardQuery childQuery=new WildcardQuery(new Term("child",createFieldValue(randomChildNumber)));
  conjunctionQuery.add(new BooleanClause(childQuery,BooleanClause.Occur.MUST));
  conjunctionQuery.add(new BooleanClause(blockJoinQuery,BooleanClause.Occur.MUST));
  try {
    indexSearcher.search(conjunctionQuery,1);
    fail("didn't get expected exception");
  }
 catch (  IllegalStateException expected) {
    assertTrue(expected.getMessage() != null && expected.getMessage().contains("child query must only match non-parent docs"));
  }
}
