{
  final JettyConfig config=JettyConfig.builder().withSSLConfig(sslConfig).build();
  final MiniSolrCloudCluster cluster=new MiniSolrCloudCluster(NUM_SERVERS,createTempDir(),config);
  try {
    checkClusterWithCollectionCreations(cluster,sslConfig);
    SSLContext.setDefault(sslConfig.isSSLMode() ? sslConfig.buildClientSSLContext() : DEFAULT_SSL_CONTEXT);
    HttpClientUtil.resetHttpClientBuilder();
    checkClusterJettys(cluster,sslConfig);
  }
  finally {
    cluster.shutdown();
  }
}
