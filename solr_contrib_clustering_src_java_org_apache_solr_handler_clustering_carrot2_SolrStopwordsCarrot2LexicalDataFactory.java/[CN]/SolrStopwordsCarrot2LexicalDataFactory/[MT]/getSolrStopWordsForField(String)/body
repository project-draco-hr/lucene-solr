{
synchronized (solrStopWords) {
    if (!solrStopWords.containsKey(fieldName)) {
      solrStopWords.put(fieldName,new ArrayList<>());
      IndexSchema schema=core.getLatestSchema();
      final Analyzer fieldAnalyzer=schema.getFieldType(fieldName).getIndexAnalyzer();
      if (fieldAnalyzer instanceof TokenizerChain) {
        final TokenFilterFactory[] filterFactories=((TokenizerChain)fieldAnalyzer).getTokenFilterFactories();
        for (        TokenFilterFactory factory : filterFactories) {
          if (factory instanceof StopFilterFactory) {
            CharArraySet stopWords=((StopFilterFactory)factory).getStopWords();
            solrStopWords.get(fieldName).add(stopWords);
          }
          if (factory instanceof CommonGramsFilterFactory) {
            CharArraySet commonWords=((CommonGramsFilterFactory)factory).getCommonWords();
            solrStopWords.get(fieldName).add(commonWords);
          }
        }
      }
    }
    return solrStopWords.get(fieldName);
  }
}
