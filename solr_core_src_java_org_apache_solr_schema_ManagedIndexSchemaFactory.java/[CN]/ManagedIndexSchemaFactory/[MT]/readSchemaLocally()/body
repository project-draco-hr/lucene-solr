{
  InputStream schemaInputStream=null;
  try {
    schemaInputStream=loader.openSchema(managedSchemaResourceName);
    loadedResource=managedSchemaResourceName;
    warnIfNonManagedSchemaExists();
  }
 catch (  IOException e) {
    log.info("The schema is configured as managed, but managed schema resource " + managedSchemaResourceName + " not found - loading non-managed schema "+ resourceName+ " instead");
  }
  if (null == schemaInputStream) {
    try {
      schemaInputStream=loader.openSchema(resourceName);
      loadedResource=resourceName;
      shouldUpgrade=true;
    }
 catch (    Exception e) {
      final String msg="Error loading both non-managed schema '" + resourceName + "' and managed schema '"+ managedSchemaResourceName+ "'";
      log.error(msg,e);
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,msg,e);
    }
  }
  return schemaInputStream;
}
