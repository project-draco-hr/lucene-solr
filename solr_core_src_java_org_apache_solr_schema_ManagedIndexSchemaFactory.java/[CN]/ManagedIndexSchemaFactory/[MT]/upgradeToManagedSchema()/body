{
  SolrResourceLoader loader=config.getResourceLoader();
  if (loader instanceof ZkSolrResourceLoader) {
    zkUgradeToManagedSchema();
  }
 else {
    schema.persistManagedSchema(true);
    if (resourceName.equals(managedSchemaResourceName)) {
      log.info("On upgrading to managed schema, did not rename non-managed schema '" + resourceName + "' because it's the same as the managed schema's name.");
    }
 else {
      final File nonManagedSchemaFile=locateConfigFile(resourceName);
      if (null == nonManagedSchemaFile) {
        log.warn("On upgrading to managed schema, did not rename non-managed schema " + resourceName + " because it's neither an absolute file "+ "nor under SolrConfig.getConfigDir() or the current directory."+ "  PLEASE REMOVE THIS FILE.");
      }
 else {
        File upgradedSchemaFile=new File(nonManagedSchemaFile + UPGRADED_SCHEMA_EXTENSION);
        if (nonManagedSchemaFile.renameTo(upgradedSchemaFile)) {
          schema.setResourceName(managedSchemaResourceName);
          log.info("After upgrading to managed schema, renamed the non-managed schema " + nonManagedSchemaFile + " to "+ upgradedSchemaFile);
        }
 else {
          log.warn("Can't rename " + nonManagedSchemaFile.toString() + " to "+ upgradedSchemaFile.toString()+ " - PLEASE REMOVE THIS FILE.");
        }
      }
    }
  }
}
