{
  BytesRef ref=new BytesRef();
  for (int j=0; j < 2 * RANDOM_MULTIPLIER; j++) {
    final int size=797;
    BitSet bits=new BitSet(size);
    for (int i=0; i < size; i++) {
      String str;
      do {
        str=_TestUtil.randomRealisticUnicodeString(random,1000);
      }
 while (str.length() == 0);
      ref.copy(str);
      bits.set(hash.add(ref));
    }
    assertEquals(hash.size(),bits.cardinality());
    int[] compact=hash.compact();
    assertTrue(size < compact.length);
    for (int i=0; i < size; i++) {
      bits.set(compact[i],false);
    }
    assertEquals(0,bits.cardinality());
    hash.clear();
    assertEquals(0,hash.size());
    hash.reinit();
  }
}
