{
  try {
    localHostName=getHostAddress();
    Matcher m=URL_POST.matcher(localHostName);
    if (m.matches()) {
      hostName=m.group(1);
    }
 else {
      log.error("Unrecognized host:" + localHostName);
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"Unrecognized host:" + localHostName);
    }
    try {
      zkClient.makePath(ZkStateReader.LIVE_NODES_ZKNODE);
    }
 catch (    KeeperException e) {
      if (e.code() != KeeperException.Code.NODEEXISTS) {
        log.error("",e);
        throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
      }
    }
    createEphemeralLiveNode();
    setUpCollectionsNode();
    zkStateReader.makeCollectionsNodeWatches();
  }
 catch (  IOException e) {
    log.error("",e);
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Can't create ZooKeeperController",e);
  }
catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    log.error("",e);
    throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
  }
catch (  KeeperException e) {
    log.error("",e);
    throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR,"",e);
  }
}
