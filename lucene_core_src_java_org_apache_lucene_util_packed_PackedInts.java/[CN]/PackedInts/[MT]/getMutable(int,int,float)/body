{
  acceptableOverheadRatio=Math.max(COMPACT,acceptableOverheadRatio);
  acceptableOverheadRatio=Math.min(FASTEST,acceptableOverheadRatio);
  float acceptableOverheadPerValue=acceptableOverheadRatio * bitsPerValue;
  int maxBitsPerValue=bitsPerValue + (int)acceptableOverheadPerValue;
  if (bitsPerValue <= 8 && maxBitsPerValue >= 8) {
    return new Direct8(valueCount);
  }
 else   if (bitsPerValue <= 16 && maxBitsPerValue >= 16) {
    return new Direct16(valueCount);
  }
 else   if (bitsPerValue <= 32 && maxBitsPerValue >= 32) {
    return new Direct32(valueCount);
  }
 else   if (bitsPerValue <= 64 && maxBitsPerValue >= 64) {
    return new Direct64(valueCount);
  }
 else   if (valueCount <= Packed8ThreeBlocks.MAX_SIZE && bitsPerValue <= 24 && maxBitsPerValue >= 24) {
    return new Packed8ThreeBlocks(valueCount);
  }
 else   if (valueCount <= Packed16ThreeBlocks.MAX_SIZE && bitsPerValue <= 48 && maxBitsPerValue >= 48) {
    return new Packed16ThreeBlocks(valueCount);
  }
 else {
    for (int bpv=bitsPerValue; bpv <= maxBitsPerValue; ++bpv) {
      if (Packed64SingleBlock.isSupported(bpv)) {
        float overhead=Packed64SingleBlock.overheadPerValue(bpv);
        float acceptableOverhead=acceptableOverheadPerValue + bitsPerValue - bpv;
        if (overhead <= acceptableOverhead) {
          return Packed64SingleBlock.create(valueCount,bpv);
        }
      }
    }
    return new Packed64(valueCount,bitsPerValue);
  }
}
