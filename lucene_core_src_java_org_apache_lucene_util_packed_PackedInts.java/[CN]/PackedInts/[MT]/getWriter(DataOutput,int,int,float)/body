{
  acceptableOverheadRatio=Math.max(COMPACT,acceptableOverheadRatio);
  acceptableOverheadRatio=Math.min(FASTEST,acceptableOverheadRatio);
  float acceptableOverheadPerValue=acceptableOverheadRatio * bitsPerValue;
  int maxBitsPerValue=bitsPerValue + (int)acceptableOverheadPerValue;
  if (bitsPerValue <= 8 && maxBitsPerValue >= 8) {
    return new PackedWriter(out,valueCount,8);
  }
 else   if (bitsPerValue <= 16 && maxBitsPerValue >= 16) {
    return new PackedWriter(out,valueCount,16);
  }
 else   if (bitsPerValue <= 32 && maxBitsPerValue >= 32) {
    return new PackedWriter(out,valueCount,32);
  }
 else   if (bitsPerValue <= 64 && maxBitsPerValue >= 64) {
    return new PackedWriter(out,valueCount,64);
  }
 else   if (valueCount <= Packed8ThreeBlocks.MAX_SIZE && bitsPerValue <= 24 && maxBitsPerValue >= 24) {
    return new PackedWriter(out,valueCount,24);
  }
 else   if (valueCount <= Packed16ThreeBlocks.MAX_SIZE && bitsPerValue <= 48 && maxBitsPerValue >= 48) {
    return new PackedWriter(out,valueCount,bitsPerValue);
  }
 else {
    for (int bpv=bitsPerValue; bpv <= maxBitsPerValue; ++bpv) {
      if (Packed64SingleBlock.isSupported(bpv)) {
        float overhead=Packed64SingleBlock.overheadPerValue(bpv);
        float acceptableOverhead=acceptableOverheadPerValue + bitsPerValue - bpv;
        if (overhead <= acceptableOverhead) {
          return new Packed64SingleBlockWriter(out,valueCount,bpv);
        }
      }
    }
    return new PackedWriter(out,valueCount,bitsPerValue);
  }
}
