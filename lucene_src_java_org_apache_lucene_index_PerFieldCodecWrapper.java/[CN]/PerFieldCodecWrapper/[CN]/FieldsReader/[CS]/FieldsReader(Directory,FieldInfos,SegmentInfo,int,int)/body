{
  final Map<Codec,FieldsProducer> producers=new HashMap<Codec,FieldsProducer>();
  boolean success=false;
  try {
    for (    FieldInfo fi : fieldInfos) {
      if (fi.isIndexed) {
        fields.add(fi.name);
        Codec codec=segmentCodecs.codecs[fi.getCodecId()];
        if (!producers.containsKey(codec)) {
          producers.put(codec,codec.fieldsProducer(new SegmentReadState(dir,si,fieldInfos,readBufferSize,indexDivisor,"" + fi.getCodecId())));
        }
        codecs.put(fi.name,producers.get(codec));
      }
    }
    success=true;
  }
  finally {
    if (!success) {
      for (      FieldsProducer fp : producers.values()) {
        try {
          fp.close();
        }
 catch (        Throwable t) {
        }
      }
    }
  }
}
