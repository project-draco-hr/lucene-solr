{
  SolrCore core=h.getCore();
  UpdateRequestProcessorChain pc=core.getUpdateProcessingChain(chain);
  assertNotNull("No Chain named: " + chain,pc);
  SolrQueryResponse rsp=new SolrQueryResponse();
  SolrQueryRequest req=new LocalSolrQueryRequest(core,requestParams);
  try {
    SolrRequestInfo.setRequestInfo(new SolrRequestInfo(req,rsp));
    AddUpdateCommand cmd=new AddUpdateCommand(req);
    cmd.solrDoc=docIn;
    UpdateRequestProcessor processor=pc.createProcessor(req,rsp);
    if (null != processor) {
      processor.processAdd(cmd);
    }
    return cmd.solrDoc;
  }
  finally {
    SolrRequestInfo.clearRequestInfo();
    req.close();
  }
}
