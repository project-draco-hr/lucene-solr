{
  long endNumOpens=SolrIndexSearcher.numOpens.get();
  long endNumCloses=SolrIndexSearcher.numCloses.get();
  int retries=0;
  while (endNumOpens - numOpens != endNumCloses - numCloses) {
    if (retries++ > waitSeconds) {
      break;
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
    }
    endNumOpens=SolrIndexSearcher.numOpens.get();
    endNumCloses=SolrIndexSearcher.numCloses.get();
  }
  SolrIndexSearcher.numOpens.getAndSet(0);
  SolrIndexSearcher.numCloses.getAndSet(0);
  if (endNumOpens - numOpens != endNumCloses - numCloses) {
    String msg="ERROR: SolrIndexSearcher opens=" + (endNumOpens - numOpens) + " closes="+ (endNumCloses - numCloses);
    log.error(msg);
    if ("TestReplicationHandler".equals(RandomizedContext.current().getTargetClass().getSimpleName())) {
      log.warn("TestReplicationHandler wants to fail!: " + msg);
    }
 else {
      if (failTest)       fail(msg);
    }
  }
}
