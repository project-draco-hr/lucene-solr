{
  try {
    deleteCore();
    resetExceptionIgnores();
    endTrackingSearchers();
    endTrackingZkClients();
    resetFactory();
    coreName=ConfigSolrXmlOld.DEFAULT_DEFAULT_CORE_NAME;
  }
  finally {
    try {
      if (dataDir != null && dataDir.exists() && !recurseDelete(dataDir)) {
        String msg="!!!! WARNING: best effort to remove " + dataDir.getAbsolutePath() + " FAILED !!!!!";
        if (RandomizedContext.current().getTargetClass().isAnnotationPresent(SuppressTempDirCleanUp.class)) {
          System.err.println(msg);
        }
 else {
          fail(msg);
        }
      }
    }
  finally {
      dataDir=null;
      System.clearProperty("jetty.testMode");
      System.clearProperty("tests.shardhandler.randomSeed");
      System.clearProperty("enable.update.log");
      System.clearProperty("useCompoundFile");
      System.clearProperty("urlScheme");
      if (isSSLMode()) {
        HttpClientUtil.setConfigurer(new HttpClientConfigurer());
      }
      sslConfig=null;
    }
  }
  IpTables.unblockAllPorts();
}
