{
  try {
    deleteCore();
    resetExceptionIgnores();
    endTrackingSearchers();
    endTrackingZkClients();
    resetFactory();
    coreName=ConfigSolrXmlOld.DEFAULT_DEFAULT_CORE_NAME;
  }
  finally {
    try {
      if (LEAVE_TEST_TMP_DIR) {
        System.err.println("NOTE: per solr.test.leavetmpdir, the test tmp directory will not be removed: " + rootTmpDir.getAbsolutePath());
      }
 else {
        if (rootTmpDir != null && rootTmpDir.exists() && !recurseDelete(rootTmpDir)) {
          String msg="!!!! WARNING: best effort to remove " + rootTmpDir.getAbsolutePath() + " FAILED !!!!!";
          if (LEAVE_TEST_TMP_DIR_ANNOTATION) {
            System.err.println(msg);
          }
 else {
            fail(msg);
          }
        }
      }
    }
  finally {
      initCoreDataDir=null;
      System.clearProperty("jetty.testMode");
      System.clearProperty("tests.shardhandler.randomSeed");
      System.clearProperty("enable.update.log");
      System.clearProperty("useCompoundFile");
      System.clearProperty("urlScheme");
      if (isSSLMode()) {
        HttpClientUtil.setConfigurer(new HttpClientConfigurer());
      }
      sslConfig=null;
    }
  }
  IpTables.unblockAllPorts();
}
