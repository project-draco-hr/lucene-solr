{
  try {
    deleteCore();
    resetExceptionIgnores();
    endTrackingSearchers();
    if (!RandomizedContext.current().getTargetClass().isAnnotationPresent(SuppressObjectReleaseTracker.class)) {
      assertTrue("Some resources were not closed, shutdown, or released.",ObjectReleaseTracker.clearObjectTrackerAndCheckEmpty());
    }
 else {
      if (!ObjectReleaseTracker.clearObjectTrackerAndCheckEmpty()) {
        log.warn("Some resources were not closed, shutdown, or released. Remove the SuppressObjectReleaseTracker annotation to get more information on the fail.");
      }
    }
    resetFactory();
    coreName=DEFAULT_TEST_CORENAME;
  }
  finally {
    initCoreDataDir=null;
    System.clearProperty("zookeeper.forceSync");
    System.clearProperty("jetty.testMode");
    System.clearProperty("tests.shardhandler.randomSeed");
    System.clearProperty("enable.update.log");
    System.clearProperty("useCompoundFile");
    System.clearProperty("urlScheme");
    if (isSSLMode()) {
      HttpClientUtil.setConfigurer(new HttpClientConfigurer());
    }
    sslConfig=null;
  }
  IpTables.unblockAllPorts();
}
