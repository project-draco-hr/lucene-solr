{
  String coreName=dcore.getProperty(CoreDescriptor.CORE_NAME);
  Map<String,String> coreAttribs=new HashMap<String,String>();
  CloudDescriptor cd=dcore.getCloudDescriptor();
  String collection=null;
  if (cd != null)   collection=cd.getCollectionName();
  if (origCoreName == null) {
    origCoreName=coreName;
  }
  Properties properties=dcore.getCoreProperties();
  Node node=null;
  if (cfg != null) {
    node=cfg.getNode("/solr/cores/core[@name='" + origCoreName + "']",false);
  }
  coreAttribs.put(CoreDescriptor.CORE_NAME,coreName);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_INSTDIR,dcore.getRawInstanceDir(),null);
  coreAttribs.put(CoreDescriptor.CORE_COLLECTION,StringUtils.isNotBlank(collection) ? collection : dcore.getName());
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_DATADIR,dcore.getDataDir(),null);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_ULOGDIR,dcore.getUlogDir(),null);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_TRANSIENT,Boolean.toString(dcore.isTransient()),null);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_LOADONSTARTUP,Boolean.toString(dcore.isLoadOnStartup()),null);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_COLLECTION,collection,dcore.getName());
  String shard=null;
  String roles=null;
  if (cd != null) {
    shard=cd.getShardId();
    roles=cd.getRoles();
  }
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_SHARD,shard,null);
  addCoreProperty(coreAttribs,loader,node,CoreDescriptor.CORE_ROLES,roles,null);
  coreAttribs.put(CoreDescriptor.CORE_LOADONSTARTUP,Boolean.toString(dcore.isLoadOnStartup()));
  coreAttribs.put(CoreDescriptor.CORE_TRANSIENT,Boolean.toString(dcore.isTransient()));
  SolrXMLSerializer.SolrCoreXMLDef solrCoreXMLDef=new SolrXMLSerializer.SolrCoreXMLDef();
  solrCoreXMLDef.coreAttribs=coreAttribs;
  solrCoreXMLDef.coreProperties=properties;
  solrCoreXMLDefs.add(solrCoreXMLDef);
}
