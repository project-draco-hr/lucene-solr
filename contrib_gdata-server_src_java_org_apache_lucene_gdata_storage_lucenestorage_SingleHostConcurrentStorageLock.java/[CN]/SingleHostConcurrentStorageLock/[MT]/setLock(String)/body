{
  this.writeLock.lock();
  try {
    if (this.isClosed.get())     throw new IllegalStateException("Lock has been closed");
    Thread t=Thread.currentThread();
    if (this.threads.containsKey(t))     throw new ConcurrencyException("one thread must not obtain more than one lock -- single thread can not modify more than one resource");
    if (this.locks.containsKey(key)) {
      return false;
    }
    this.locks.put(key,t);
    this.threads.put(t,key);
    return true;
  }
  finally {
    this.writeLock.unlock();
  }
}
