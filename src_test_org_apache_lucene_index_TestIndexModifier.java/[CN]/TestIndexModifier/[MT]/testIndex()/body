{
  Directory ramDir=new RAMDirectory();
  IndexModifier i=new IndexModifier(ramDir,new StandardAnalyzer(),true);
  i.addDocument(getDoc());
  assertEquals(1,i.docCount());
  i.flush();
  i.addDocument(getDoc(),new SimpleAnalyzer());
  assertEquals(2,i.docCount());
  i.optimize();
  assertEquals(2,i.docCount());
  i.flush();
  i.deleteDocument(0);
  assertEquals(1,i.docCount());
  i.flush();
  assertEquals(1,i.docCount());
  i.addDocument(getDoc());
  i.addDocument(getDoc());
  i.flush();
  i.deleteDocuments(allDocTerm);
  assertEquals(0,i.docCount());
  i.optimize();
  assertEquals(0,i.docCount());
  assertNull(i.getInfoStream());
  assertTrue(i.getUseCompoundFile());
  assertEquals(0,i.getMaxBufferedDocs());
  assertEquals(10000,i.getMaxFieldLength());
  assertEquals(10,i.getMergeFactor());
  i.setMaxBufferedDocs(100);
  i.setMergeFactor(25);
  i.setMaxFieldLength(250000);
  i.addDocument(getDoc());
  i.setUseCompoundFile(false);
  i.flush();
  assertEquals(100,i.getMaxBufferedDocs());
  assertEquals(25,i.getMergeFactor());
  assertEquals(250000,i.getMaxFieldLength());
  assertFalse(i.getUseCompoundFile());
  i.deleteDocuments(allDocTerm);
  i.setMaxBufferedDocs(100);
  i.setMergeFactor(25);
  i.setMaxFieldLength(250000);
  i.addDocument(getDoc());
  i.setUseCompoundFile(false);
  i.optimize();
  assertEquals(100,i.getMaxBufferedDocs());
  assertEquals(25,i.getMergeFactor());
  assertEquals(250000,i.getMaxFieldLength());
  assertFalse(i.getUseCompoundFile());
  i.close();
  try {
    i.docCount();
    fail();
  }
 catch (  IllegalStateException e) {
  }
}
