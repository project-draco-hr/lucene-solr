{
  try {
    for (int i=0; i < ITERATIONS; i++) {
      int rand=random.nextInt(101);
      if (rand < 5) {
        index.optimize();
      }
 else       if (rand < 60) {
        Document doc=getDocument();
        index.addDocument(doc);
        idStack.push(doc.get("id"));
        added++;
      }
 else {
        String delId=null;
        try {
          delId=(String)idStack.pop();
        }
 catch (        EmptyStackException e) {
          continue;
        }
        Term delTerm=new Term("id",new Integer(delId).toString());
        int delCount=index.delete(delTerm);
        if (delCount != 1) {
          throw new RuntimeException("Internal error: " + threadNumber + " deleted "+ delCount+ " documents, term="+ delTerm);
        }
        deleted++;
      }
      if (maxWait > 0) {
        try {
          rand=random.nextInt(maxWait);
          Thread.sleep(rand);
        }
 catch (        InterruptedException e) {
          throw new RuntimeException(e);
        }
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
