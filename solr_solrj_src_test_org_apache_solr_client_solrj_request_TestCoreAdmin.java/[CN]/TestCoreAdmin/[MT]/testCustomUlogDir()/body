{
  SolrServer server=getSolrAdmin();
  File tmp=new File(TEMP_DIR,"solrtest-" + getTestClass().getSimpleName() + "-"+ System.currentTimeMillis());
  tmp.mkdirs();
  File dataDir=new File(tmp,this.getTestName() + System.currentTimeMillis() + "-"+ "data");
  File newCoreInstanceDir=new File(tmp,this.getTestName() + System.currentTimeMillis() + "-"+ "instance");
  File instanceDir=new File(cores.getSolrHome());
  FileUtils.copyDirectory(instanceDir,new File(newCoreInstanceDir,"newcore"));
  CoreAdminRequest.Create req=new CoreAdminRequest.Create();
  req.setCoreName("newcore");
  req.setInstanceDir(newCoreInstanceDir.getAbsolutePath() + File.separator + "newcore");
  req.setDataDir(dataDir.getAbsolutePath());
  req.setUlogDir(new File(dataDir,"ulog").getAbsolutePath());
  req.process(server);
  SolrCore core=cores.getCore("newcore");
  File logDir;
  try {
    logDir=core.getUpdateHandler().getUpdateLog().getLogDir();
  }
  finally {
    core.close();
  }
  assertEquals(new File(dataDir,"ulog" + File.separator + "tlog").getAbsolutePath(),logDir.getAbsolutePath());
  server.shutdown();
}
