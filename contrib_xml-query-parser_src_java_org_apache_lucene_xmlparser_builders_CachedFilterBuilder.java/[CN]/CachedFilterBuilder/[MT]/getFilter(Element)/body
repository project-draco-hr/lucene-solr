{
  Element childElement=DOMUtils.getFirstChildOrFail(e);
  if (filterCache == null) {
    filterCache=new LRUCache(cacheSize);
  }
  QueryBuilder qb=queryFactory.getQueryBuilder(childElement.getNodeName());
  Object cacheKey=null;
  Query q=null;
  Filter f=null;
  if (qb != null) {
    q=qb.getQuery(childElement);
    cacheKey=q;
  }
 else {
    f=filterFactory.getFilter(childElement);
    cacheKey=f;
  }
  Filter cachedFilter=(Filter)filterCache.get(cacheKey);
  if (cachedFilter != null) {
    return cachedFilter;
  }
  if (qb != null) {
    cachedFilter=new QueryWrapperFilter(q);
  }
 else {
    cachedFilter=new CachingWrapperFilter(f);
  }
  filterCache.put(cacheKey,cachedFilter);
  return cachedFilter;
}
