{
  try {
    int nonZeroCount=0;
    for (    TermsWriter field : fields) {
      if (field.numTerms > 0) {
        nonZeroCount++;
      }
    }
    final long dirStart=out.getFilePointer();
    out.writeVInt(nonZeroCount);
    for (    TermsWriter field : fields) {
      if (field.numTerms > 0) {
        out.writeVInt(field.fieldInfo.number);
        out.writeVLong(field.numTerms);
        out.writeVLong(field.termsStartPointer);
        if (field.fieldInfo.indexOptions != IndexOptions.DOCS_ONLY) {
          out.writeVLong(field.sumTotalTermFreq);
        }
        out.writeVLong(field.sumDocFreq);
        out.writeVInt(field.docCount);
      }
    }
    writeTrailer(dirStart);
  }
  finally {
    IOUtils.close(out,postingsWriter,termsIndexWriter);
  }
}
