{
  Directory directory=newDirectory();
  IndexWriter writer=new IndexWriter(directory,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())));
  Document d1=new Document();
  d1.add(newTextField("default","one two",Field.Store.YES));
  writer.addDocument(d1);
  Document d2=new Document();
  d2.add(newTextField("default","one three",Field.Store.YES));
  writer.addDocument(d2);
  Document d3=new Document();
  d3.add(newTextField("default","two four",Field.Store.YES));
  writer.addDocument(d3);
  writer.close();
  Directory target=newDirectory();
  ((BaseDirectoryWrapper)target).setCrossCheckTermVectorsOnClose(false);
  writer=new IndexWriter(target,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())));
  IndexReader reader=new TestReader(DirectoryReader.open(directory));
  writer.addIndexes(reader);
  writer.close();
  reader.close();
  reader=DirectoryReader.open(target);
  TermsEnum terms=MultiFields.getTerms(reader,"default").iterator(null);
  while (terms.next() != null) {
    assertTrue(terms.term().utf8ToString().indexOf('e') != -1);
  }
  assertEquals(TermsEnum.SeekStatus.FOUND,terms.seekCeil(new BytesRef("one")));
  DocsAndPositionsEnum positions=terms.docsAndPositions(MultiFields.getLiveDocs(reader),null);
  while (positions.nextDoc() != DocIdSetIterator.NO_MORE_DOCS) {
    assertTrue((positions.docID() % 2) == 1);
  }
  reader.close();
  directory.close();
  target.close();
}
