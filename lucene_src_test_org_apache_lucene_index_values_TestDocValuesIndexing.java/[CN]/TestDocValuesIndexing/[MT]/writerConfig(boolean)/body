{
  final IndexWriterConfig cfg=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer());
  cfg.setMergePolicy(newLogMergePolicy(random));
  MergePolicy mergePolicy=cfg.getMergePolicy();
  if (mergePolicy instanceof LogMergePolicy) {
    LogMergePolicy policy=((LogMergePolicy)mergePolicy);
    policy.setUseCompoundFile(useCompoundFile);
    policy.setRequireContiguousMerge(true);
  }
 else   if (useCompoundFile) {
    LogMergePolicy policy=new LogDocMergePolicy();
    policy.setUseCompoundFile(useCompoundFile);
    policy.setRequireContiguousMerge(true);
    cfg.setMergePolicy(policy);
  }
  cfg.setCodecProvider(provider);
  return cfg;
}
