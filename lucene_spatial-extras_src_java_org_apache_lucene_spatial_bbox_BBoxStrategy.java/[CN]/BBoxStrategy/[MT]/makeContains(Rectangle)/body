{
  Query qMinY=this.makeNumericRangeQuery(field_minY,null,bbox.getMinY(),false,true);
  Query qMaxY=this.makeNumericRangeQuery(field_maxY,bbox.getMaxY(),null,true,false);
  Query yConditions=this.makeQuery(BooleanClause.Occur.MUST,qMinY,qMaxY);
  Query xConditions;
  if (!bbox.getCrossesDateLine()) {
    Query qMinX=this.makeNumericRangeQuery(field_minX,null,bbox.getMinX(),false,true);
    Query qMaxX=this.makeNumericRangeQuery(field_maxX,bbox.getMaxX(),null,true,false);
    Query qMinMax=this.makeQuery(BooleanClause.Occur.MUST,qMinX,qMaxX);
    Query qNonXDL=this.makeXDL(false,qMinMax);
    if (!ctx.isGeo()) {
      xConditions=qNonXDL;
    }
 else {
      Query qXDLLeft=this.makeNumericRangeQuery(field_minX,null,bbox.getMinX(),false,true);
      Query qXDLRight=this.makeNumericRangeQuery(field_maxX,bbox.getMaxX(),null,true,false);
      Query qXDLLeftRight=this.makeQuery(BooleanClause.Occur.SHOULD,qXDLLeft,qXDLRight);
      Query qXDL=this.makeXDL(true,qXDLLeftRight);
      Query qEdgeDL=null;
      if (bbox.getMinX() == bbox.getMaxX() && Math.abs(bbox.getMinX()) == 180) {
        double edge=bbox.getMinX() * -1;
        qEdgeDL=makeQuery(BooleanClause.Occur.SHOULD,makeNumberTermQuery(field_minX,edge),makeNumberTermQuery(field_maxX,edge));
      }
      xConditions=this.makeQuery(BooleanClause.Occur.SHOULD,qNonXDL,qXDL,qEdgeDL);
    }
  }
 else {
    Query qXDLLeft=this.makeNumericRangeQuery(field_minX,null,bbox.getMinX(),false,true);
    Query qXDLRight=this.makeNumericRangeQuery(field_maxX,bbox.getMaxX(),null,true,false);
    Query qXDLLeftRight=this.makeXDL(true,this.makeQuery(BooleanClause.Occur.MUST,qXDLLeft,qXDLRight));
    Query qWorld=makeQuery(BooleanClause.Occur.MUST,makeNumberTermQuery(field_minX,-180),makeNumberTermQuery(field_maxX,180));
    xConditions=makeQuery(BooleanClause.Occur.SHOULD,qXDLLeftRight,qWorld);
  }
  return this.makeQuery(BooleanClause.Occur.MUST,xConditions,yConditions);
}
