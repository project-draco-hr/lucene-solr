{
  parseParams(FacetParams.FACET_FIELD,field);
  String f=key;
  int offset=params.getFieldInt(f,FacetParams.FACET_OFFSET,0);
  int limit=params.getFieldInt(f,FacetParams.FACET_LIMIT,10);
  int mincount=params.getFieldInt(f,FacetParams.FACET_MINCOUNT,1);
  boolean missing=params.getFieldBool(f,FacetParams.FACET_MISSING,false);
  String sort=params.getFieldParam(f,FacetParams.FACET_SORT,limit > 0 ? FacetParams.FACET_SORT_COUNT : FacetParams.FACET_SORT_INDEX);
  String prefix=params.getFieldParam(f,FacetParams.FACET_PREFIX);
  Map<String,Object> cmd=new HashMap<String,Object>();
  cmd.put("field",facetValue);
  if (offset != 0)   cmd.put("offset",offset);
  if (limit != 10)   cmd.put("limit",limit);
  if (mincount != 1)   cmd.put("mincount",mincount);
  if (missing)   cmd.put("missing",missing);
  if (prefix != null)   cmd.put("prefix",prefix);
  if (sort.equals("count")) {
  }
 else   if (sort.equals("index")) {
    cmd.put("sort","index asc");
  }
 else {
    cmd.put("sort",sort);
  }
  Map<String,Object> type=new HashMap<>(1);
  type.put("terms",cmd);
  addSub(key,type);
  handleSubs(cmd);
}
