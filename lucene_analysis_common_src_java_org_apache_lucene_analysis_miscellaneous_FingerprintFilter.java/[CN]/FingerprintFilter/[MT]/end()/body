{
  if (!inputEnded) {
    input.end();
    inputEnded=true;
  }
  if (finalState != null) {
    restoreState(finalState);
  }
}
