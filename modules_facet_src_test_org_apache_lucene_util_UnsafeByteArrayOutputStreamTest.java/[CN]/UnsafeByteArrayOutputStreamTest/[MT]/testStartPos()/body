{
  byte[] buf=new byte[10];
  for (int i=0; i < buf.length; i++) {
    buf[i]=(byte)i;
  }
  int startPos=3;
  UnsafeByteArrayOutputStream ubaos=new UnsafeByteArrayOutputStream(buf,startPos);
  int numValues=5;
  for (int i=0; i < numValues; i++) {
    ubaos.write((i + 1) * 2);
  }
  assertEquals("invalid buffer length",startPos + numValues,ubaos.length());
  assertEquals("invalid startPos",startPos,ubaos.getStartPos());
  byte[] bytes=ubaos.toByteArray();
  for (int i=0; i < startPos; i++) {
    assertEquals(i,bytes[i]);
  }
  for (int i=startPos, j=0; j < numValues; i++, j++) {
    assertEquals((j + 1) * 2,bytes[i]);
  }
  for (int i=startPos + numValues; i < buf.length; i++) {
    assertEquals(i,bytes[i]);
  }
}
