{
  termsOut=new TermInfosWriter(state.directory,state.segmentInfo.name,state.fieldInfos,state.termIndexInterval);
  boolean success=false;
  try {
    final String freqFile=IndexFileNames.segmentFileName(state.segmentInfo.name,"",Lucene3xPostingsFormat.FREQ_EXTENSION);
    freqOut=state.directory.createOutput(freqFile,state.context);
    totalNumDocs=state.segmentInfo.getDocCount();
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.closeWhileHandlingException(termsOut);
    }
  }
  success=false;
  try {
    if (state.fieldInfos.hasProx()) {
      final String proxFile=IndexFileNames.segmentFileName(state.segmentInfo.name,"",Lucene3xPostingsFormat.PROX_EXTENSION);
      proxOut=state.directory.createOutput(proxFile,state.context);
    }
 else {
      proxOut=null;
    }
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.closeWhileHandlingException(termsOut,freqOut);
    }
  }
  skipListWriter=new PreFlexRWSkipListWriter(termsOut.skipInterval,termsOut.maxSkipLevels,totalNumDocs,freqOut,proxOut);
}
