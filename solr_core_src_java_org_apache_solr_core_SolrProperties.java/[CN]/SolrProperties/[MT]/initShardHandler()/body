{
  PluginInfo info=null;
  Map<String,String> attrs=new HashMap<String,String>();
  NamedList args=new NamedList();
  boolean haveHandler=false;
  for (  String s : solrProperties.stringPropertyNames()) {
    String val=solrProperties.getProperty(s);
    if (s.indexOf(SHARD_HANDLER_FACTORY) != -1) {
      haveHandler=true;
      if (SHARD_HANDLER_NAME.equals(s) || SHARD_HANDLER_CLASS.equals(s)) {
        attrs.put(s,val);
      }
 else {
        args.add(s,val);
      }
    }
  }
  if (haveHandler) {
    info=new PluginInfo(SHARD_HANDLER_FACTORY,attrs,args,null);
  }
 else {
    Map m=new HashMap();
    m.put("class",HttpShardHandlerFactory.class.getName());
    info=new PluginInfo("shardHandlerFactory",m,null,Collections.<PluginInfo>emptyList());
  }
  HttpShardHandlerFactory fac=new HttpShardHandlerFactory();
  if (info != null) {
    fac.init(info);
  }
  return fac;
}
