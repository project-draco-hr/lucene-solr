{
  String val=container.getContainerProperties().getProperty("solr.persistent","false");
  if (!Boolean.parseBoolean(val))   return;
  CoreDescriptorPlus plus;
  plus=coreDescriptorPlusMap.get(coreName);
  if (plus == null) {
    log.error("Expected to find core for persisting, but we did not. Core: " + coreName);
    return;
  }
  Properties outProps=new Properties();
  outProps.putAll(attribs);
  Properties corePropsOrig=plus.getPropsOrig();
  for (  String prop : corePropsOrig.stringPropertyNames()) {
    val=corePropsOrig.getProperty(prop);
    if (val.indexOf("$") != -1) {
      outProps.put(prop,val);
      continue;
    }
    if (outProps.getProperty(prop) == null) {
      outProps.put(prop,val);
    }
  }
  for (  String prop : CoreDescriptor.standardPropNames) {
    if (corePropsOrig.getProperty(prop) == null) {
      outProps.remove(prop);
    }
  }
  OutputStream os=null;
  try {
    os=new FileOutputStream(plus.getFilePath());
    outProps.store(os,null);
  }
 catch (  IOException e) {
    log.error("Failed to persist core {}, filepath {}",coreName,plus.getFilePath());
  }
 finally {
    IOUtils.closeQuietly(os);
  }
}
