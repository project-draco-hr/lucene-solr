{
  if (history != null) {
    throw new IllegalStateException("History already registered");
  }
  history=new CircularList<LoggingEvent>(cfg.size);
  appender=new EventAppender(this);
  if (cfg.threshold != null) {
    appender.setThreshold(Level.toLevel(cfg.threshold));
  }
 else {
    appender.setThreshold(Level.WARN);
  }
  Logger log=org.apache.log4j.LogManager.getRootLogger();
  log.addAppender(appender);
}
