{
  final String url=initProps.getProperty(URL);
  final String driver=initProps.getProperty(DRIVER);
  if (url == null)   throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"JDBC URL cannot be null");
  if (driver != null) {
    try {
      DocBuilder.loadClass(driver,context.getSolrCore());
    }
 catch (    ClassNotFoundException e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Could not load driver: " + driver,e);
    }
  }
 else {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Driver must be specified");
  }
  factory=new Callable<Connection>(){
    public Connection call() throws Exception {
      LOG.info("Creating a connection for entity " + context.getEntityAttribute(DataImporter.NAME) + " with URL: "+ url);
      long start=System.currentTimeMillis();
      Connection c=null;
      try {
        c=DriverManager.getConnection(url,initProps);
      }
 catch (      SQLException e) {
        Driver d=(Driver)DocBuilder.loadClass(driver,context.getSolrCore()).newInstance();
        c=d.connect(url,initProps);
      }
      LOG.info("Time taken for getConnection(): " + (System.currentTimeMillis() - start));
      return c;
    }
  }
;
}
