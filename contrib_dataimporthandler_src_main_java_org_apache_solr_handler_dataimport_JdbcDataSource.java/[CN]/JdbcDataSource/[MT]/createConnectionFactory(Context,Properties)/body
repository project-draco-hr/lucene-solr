{
  final String url=initProps.getProperty(URL);
  final String driver=initProps.getProperty(DRIVER);
  if (url == null)   throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"JDBC URL cannot be null");
  if (driver != null) {
    try {
      DocBuilder.loadClass(driver,context.getSolrCore());
    }
 catch (    ClassNotFoundException e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Could not load driver: " + driver,e);
    }
  }
 else {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Driver must be specified");
  }
  String s=initProps.getProperty("maxRows");
  if (s != null) {
    maxRows=Integer.parseInt(s);
  }
  factory=new Callable<Connection>(){
    public Connection call() throws Exception {
      LOG.info("Creating a connection for entity " + context.getEntityAttribute(DataImporter.NAME) + " with URL: "+ url);
      long start=System.currentTimeMillis();
      Connection c=null;
      try {
        c=DriverManager.getConnection(url,initProps);
        if (Boolean.parseBoolean(initProps.getProperty("readOnly"))) {
          c.setReadOnly(true);
          c.setAutoCommit(true);
          c.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);
          c.setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT);
        }
        if (!Boolean.parseBoolean(initProps.getProperty("autoCommit"))) {
          c.setAutoCommit(false);
        }
        String transactionIsolation=initProps.getProperty("transactionIsolation");
        if ("TRANSACTION_READ_UNCOMMITTED".equals(transactionIsolation)) {
          c.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED);
        }
 else         if ("TRANSACTION_READ_COMMITTED".equals(transactionIsolation)) {
          c.setTransactionIsolation(Connection.TRANSACTION_READ_COMMITTED);
        }
 else         if ("TRANSACTION_REPEATABLE_READ".equals(transactionIsolation)) {
          c.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ);
        }
 else         if ("TRANSACTION_SERIALIZABLE".equals(transactionIsolation)) {
          c.setTransactionIsolation(Connection.TRANSACTION_SERIALIZABLE);
        }
 else         if ("TRANSACTION_NONE".equals(transactionIsolation)) {
          c.setTransactionIsolation(Connection.TRANSACTION_NONE);
        }
        String holdability=initProps.getProperty("holdability");
        if ("CLOSE_CURSORS_AT_COMMIT".equals(holdability)) {
          c.setHoldability(ResultSet.CLOSE_CURSORS_AT_COMMIT);
        }
 else {
          c.setHoldability(ResultSet.HOLD_CURSORS_OVER_COMMIT);
        }
      }
 catch (      SQLException e) {
        Driver d=(Driver)DocBuilder.loadClass(driver,context.getSolrCore()).newInstance();
        c=d.connect(url,initProps);
      }
      LOG.info("Time taken for getConnection(): " + (System.currentTimeMillis() - start));
      return c;
    }
  }
;
}
