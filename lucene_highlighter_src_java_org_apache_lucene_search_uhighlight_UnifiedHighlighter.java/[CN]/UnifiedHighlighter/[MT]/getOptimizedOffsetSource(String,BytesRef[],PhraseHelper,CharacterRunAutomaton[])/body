{
  if (terms.length == 0 && automata.length == 0 && !phraseHelper.willRewrite()) {
    return OffsetSource.NONE_NEEDED;
  }
  OffsetSource offsetSource=getOffsetSource(field);
switch (offsetSource) {
case POSTINGS:
    if (phraseHelper.willRewrite()) {
      return OffsetSource.ANALYSIS;
    }
 else     if (automata.length > 0) {
      return OffsetSource.ANALYSIS;
    }
  break;
case POSTINGS_WITH_TERM_VECTORS:
if (!phraseHelper.willRewrite() && automata.length == 0) {
  return OffsetSource.POSTINGS;
}
break;
case ANALYSIS:
case TERM_VECTORS:
case NONE_NEEDED:
default :
break;
}
return offsetSource;
}
