{
  if (file.canRead()) {
    if (file.isDirectory()) {
      String[] files=file.list();
      if (files != null) {
        for (int i=0; i < files.length; i++) {
          indexDocs(writer,new File(file,files[i]));
        }
      }
    }
 else {
      FileInputStream fis;
      try {
        fis=new FileInputStream(file);
      }
 catch (      FileNotFoundException fnfe) {
        return;
      }
      try {
        Document doc=new Document();
        Field pathField=new Field("path",file.getPath(),Field.Store.YES,Field.Index.NOT_ANALYZED_NO_NORMS);
        pathField.setOmitTermFreqAndPositions(true);
        doc.add(pathField);
        NumericField modifiedField=new NumericField("modified");
        modifiedField.setLongValue(file.lastModified());
        doc.add(modifiedField);
        doc.add(new Field("contents",new BufferedReader(new InputStreamReader(fis,"UTF-8"))));
        if (writer.getConfig().getOpenMode() == OpenMode.CREATE) {
          System.out.println("adding " + file);
          writer.addDocument(doc);
        }
 else {
          System.out.println("updating " + file);
          writer.updateDocument(new Term("path",file.getPath()),doc);
        }
      }
  finally {
        fis.close();
      }
    }
  }
}
