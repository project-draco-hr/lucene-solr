{
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  IndexSearcher searcher=new IndexSearcher(indexReader);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  FacetsConfig config=new FacetsConfig();
  Expression expr=JavascriptCompiler.compile("_score * sqrt(popularity)");
  SimpleBindings bindings=new SimpleBindings();
  bindings.add(new SortField("_score",SortField.Type.SCORE));
  bindings.add(new SortField("popularity",SortField.Type.LONG));
  FacetsCollector fc=new FacetsCollector(true);
  Facets.search(searcher,new MatchAllDocsQuery(),10,fc);
  Facets facets=new TaxonomyFacetSumValueSource(taxoReader,config,fc,expr.getValueSource(bindings));
  FacetResult result=facets.getTopChildren(10,"A");
  indexReader.close();
  taxoReader.close();
  return result;
}
