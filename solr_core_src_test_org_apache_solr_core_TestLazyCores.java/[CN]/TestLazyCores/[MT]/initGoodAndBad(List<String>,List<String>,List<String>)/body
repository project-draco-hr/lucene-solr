{
  solrHomeDirectory=createTempDir().toFile();
  ignoreException(Pattern.quote("SAXParseException"));
  for (  String coreName : goodCores) {
    File coreRoot=new File(solrHomeDirectory,coreName);
    copyMinConf(coreRoot,"name=" + coreName);
  }
  String top=SolrTestCaseJ4.TEST_HOME() + "/collection1/conf";
  String min_schema=FileUtils.readFileToString(new File(top,"schema-tiny.xml"),StandardCharsets.UTF_8);
  String min_config=FileUtils.readFileToString(new File(top,"solrconfig-minimal.xml"),StandardCharsets.UTF_8);
  String rand_snip=FileUtils.readFileToString(new File(top,"solrconfig.snippet.randomindexconfig.xml"),StandardCharsets.UTF_8);
  String bad_config=min_config.replace("<requestHandler","<reqsthalr");
  String bad_schema=min_schema.replace("<field","<filed");
  for (  String coreName : badConfigCores) {
    writeCustomConfig(coreName,bad_config,min_schema,rand_snip);
  }
  for (  String coreName : badSchemaCores) {
    writeCustomConfig(coreName,min_config,bad_schema,rand_snip);
  }
  SolrResourceLoader loader=new SolrResourceLoader(solrHomeDirectory.toPath());
  NodeConfig config=SolrXmlConfig.fromString(loader,"<solr/>");
  return createCoreContainer(config,new CorePropertiesLocator(config.getCoreRootDirectory()));
}
