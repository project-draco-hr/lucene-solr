{
  if (solrHomeDirectory.exists()) {
    FileUtils.deleteDirectory(solrHomeDirectory);
  }
  assertTrue("Failed to mkdirs workDir",solrHomeDirectory.mkdirs());
  for (int idx=1; idx < 10; ++idx) {
    copyConfFiles(solrHomeDirectory,"collection" + idx);
  }
  File solrXml=new File(solrHomeDirectory,"solr.xml");
  FileUtils.write(solrXml,LOTS_SOLR_XML,IOUtils.CHARSET_UTF_8.toString());
  final CoreContainer cores=new CoreContainer(solrHomeDirectory.getAbsolutePath());
  cores.load(solrHomeDirectory.getAbsolutePath(),solrXml);
  cores.setPersistent(false);
  return cores;
}
