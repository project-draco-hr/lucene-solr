{
  final CoreContainer cc=initGoodAndBad(Arrays.asList("core1","core2"),Arrays.asList("badSchema1","badSchema2"),Arrays.asList("badConfig1","badConfig2"));
  try {
    checkInCores(cc,"core1","core2");
    checkNotInCores(cc,"badSchema1","badSchema2","badConfig1","badConfig2");
    SolrCore core1=cc.getCore("core1");
    checkSearch(core1);
    testMessage(cc.getCoreInitFailures(),makePath("badConfig1","conf","solrconfig.xml"));
    testMessage(cc.getCoreInitFailures(),makePath("badConfig2","conf","solrconfig.xml"));
    testMessage(cc.getCoreInitFailures(),makePath("badSchema1","conf","schema.xml"));
    testMessage(cc.getCoreInitFailures(),makePath("badSchema2","conf","schema.xml"));
    checkStatus(cc,true,"core1");
    checkStatus(cc,true,"core2");
    checkStatus(cc,false,"badSchema1");
    checkStatus(cc,false,"badSchema2");
    checkStatus(cc,false,"badConfig1");
    checkStatus(cc,false,"badConfig2");
    copyGoodConf("badConfig1","solrconfig-minimal.xml","solrconfig.xml");
    copyGoodConf("badConfig2","solrconfig-minimal.xml","solrconfig.xml");
    copyGoodConf("badSchema1","schema-tiny.xml","schema.xml");
    copyGoodConf("badSchema2","schema-tiny.xml","schema.xml");
    SolrCore bc1=cc.getCore("badConfig1");
    SolrCore bc2=cc.getCore("badConfig2");
    SolrCore bs1=cc.getCore("badSchema1");
    SolrCore bs2=cc.getCore("badSchema2");
    checkInCores(cc,"core1","core2","badSchema1","badSchema2","badConfig1","badConfig2");
    checkStatus(cc,true,"core1");
    checkStatus(cc,true,"core2");
    checkStatus(cc,true,"badSchema1");
    checkStatus(cc,true,"badSchema2");
    checkStatus(cc,true,"badConfig1");
    checkStatus(cc,true,"badConfig2");
    checkSearch(core1);
    checkSearch(bc1);
    checkSearch(bs1);
    core1.close();
    bc1.close();
    bc2.close();
    bs1.close();
    bs2.close();
  }
  finally {
    cc.shutdown();
  }
}
