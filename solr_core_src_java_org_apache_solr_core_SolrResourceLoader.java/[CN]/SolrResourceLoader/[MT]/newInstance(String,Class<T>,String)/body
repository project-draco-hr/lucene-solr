{
  Class<? extends T> clazz=findClass(cname,expectedType,subpackages);
  if (clazz == null) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Can not find class: " + cname + " in "+ classLoader);
  }
  T obj=null;
  try {
    obj=clazz.newInstance();
  }
 catch (  Exception e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Error instantiating class: '" + clazz.getName() + "'",e);
  }
  if (!live) {
    if (obj instanceof SolrCoreAware) {
      assertAwareCompatibility(SolrCoreAware.class,obj);
      waitingForCore.add((SolrCoreAware)obj);
    }
    if (org.apache.solr.util.plugin.ResourceLoaderAware.class.isInstance(obj)) {
      log.warn("Class [{}] uses org.apache.solr.util.plugin.ResourceLoaderAware " + "which is deprecated. Change to org.apache.lucene.analysis.util.ResourceLoaderAware.",cname);
    }
    if (obj instanceof ResourceLoaderAware) {
      assertAwareCompatibility(ResourceLoaderAware.class,obj);
      waitingForResources.add((ResourceLoaderAware)obj);
    }
    if (obj instanceof SolrInfoMBean) {
      infoMBeans.add((SolrInfoMBean)obj);
    }
  }
  return obj;
}
