{
  waitForThingsToLevelOut(30000);
  String testCollectionName="all_in_lir";
  String shardId="shard1";
  createCollection(testCollectionName,1,3,1);
  cloudClient.setDefaultCollection(testCollectionName);
  Map<String,Object> stateObj=Utils.makeMap();
  stateObj.put(ZkStateReader.STATE_PROP,"down");
  stateObj.put("createdByNodeName","test");
  stateObj.put("createdByCoreNodeName","test");
  byte[] znodeData=Utils.toJSON(stateObj);
  SolrZkClient zkClient=cloudClient.getZkStateReader().getZkClient();
  zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node1",znodeData,true);
  zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node2",znodeData,true);
  zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node3",znodeData,true);
  for (  JettySolrRunner jetty : jettys) {
    ChaosMonkey.stop(jetty);
  }
  Thread.sleep(2000);
  for (  JettySolrRunner jetty : jettys) {
    ChaosMonkey.start(jetty);
  }
  waitForRecoveriesToFinish(testCollectionName,true);
  try {
    zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node1",znodeData,true);
  }
 catch (  NodeExistsException e) {
  }
  try {
    zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node2",znodeData,true);
  }
 catch (  NodeExistsException e) {
  }
  try {
    zkClient.makePath("/collections/" + testCollectionName + "/leader_initiated_recovery/"+ shardId+ "/core_node3",znodeData,true);
  }
 catch (  NodeExistsException e) {
  }
  for (  JettySolrRunner jetty : jettys) {
    chaosMonkey.expireSession(jetty);
  }
  Thread.sleep(2000);
  waitForRecoveriesToFinish(testCollectionName,true);
}
