{
  String timeoutMessage="Request took too long during query expansion. Terminating request.";
  try {
    ignoreException(timeoutMessage);
    queryServer(p);
    fail("no exception matching expected: " + ErrorCode.BAD_REQUEST.code + ": "+ timeoutMessage);
  }
 catch (  SolrServerException e) {
    assertTrue("Exception " + e.getCause() + " is not a SolrException:\n"+ prettyStackTrace(e.getCause()),e.getCause() instanceof SolrException);
    assertEquals(ErrorCode.BAD_REQUEST.code,((SolrException)e.getCause()).code());
    assertTrue("Expected error message substr not found: " + timeoutMessage + " <!< "+ e.getMessage(),e.getMessage().contains(timeoutMessage));
  }
 finally {
    unIgnoreException(timeoutMessage);
  }
}
