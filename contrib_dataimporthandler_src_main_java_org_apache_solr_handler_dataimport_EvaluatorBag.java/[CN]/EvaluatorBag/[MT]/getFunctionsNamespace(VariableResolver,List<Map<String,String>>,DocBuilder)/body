{
  final Map<String,Evaluator> evaluators=new HashMap<String,Evaluator>();
  evaluators.put(DATE_FORMAT_EVALUATOR,getDateFormatEvaluator());
  evaluators.put(SQL_ESCAPE_EVALUATOR,getSqlEscapingEvaluator());
  evaluators.put(URL_ENCODE_EVALUATOR,getUrlEvaluator());
  SolrCore core=docBuilder == null ? null : docBuilder.dataImporter.getCore();
  for (  Map<String,String> map : fn) {
    try {
      evaluators.put(map.get(NAME),(Evaluator)loadClass(map.get(CLASS),core).newInstance());
    }
 catch (    Exception e) {
      throw new DataImportHandlerException(DataImportHandlerException.SEVERE,"Unable to instantiate evaluator: " + map.get(CLASS),e);
    }
  }
  return new HashMap<String,Object>(){
    @Override public String get(    Object key){
      if (key == null)       return null;
      Matcher m=FORMAT_METHOD.matcher((String)key);
      if (!m.find())       return null;
      String fname=m.group(1);
      Evaluator evaluator=evaluators.get(fname);
      if (evaluator == null)       return null;
      return evaluator.evaluate(resolver,m.group(2));
    }
  }
;
}
