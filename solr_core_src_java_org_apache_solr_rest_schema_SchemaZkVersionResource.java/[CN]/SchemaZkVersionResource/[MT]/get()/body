{
  try {
    int zkVersion=-1;
    IndexSchema schema=getSchema();
    if (schema instanceof ManagedIndexSchema) {
      ManagedIndexSchema managed=(ManagedIndexSchema)schema;
      zkVersion=managed.getSchemaZkVersion();
      if (refreshIfBelowVersion != -1 && zkVersion < refreshIfBelowVersion) {
        log.info("REFRESHING SCHEMA (refreshIfBelowVersion=" + refreshIfBelowVersion + ", currentVersion="+ zkVersion+ ") before returning version!");
        ZkSolrResourceLoader zkSolrResourceLoader=(ZkSolrResourceLoader)getSolrCore().getResourceLoader();
        ZkIndexSchemaReader zkIndexSchemaReader=zkSolrResourceLoader.getZkIndexSchemaReader();
        managed=zkIndexSchemaReader.refreshSchemaFromZk(refreshIfBelowVersion);
        zkVersion=managed.getSchemaZkVersion();
      }
    }
    getSolrResponse().add("zkversion",zkVersion);
  }
 catch (  Exception e) {
    getSolrResponse().setException(e);
  }
  handlePostExecution(log);
  return new SolrOutputRepresentation();
}
