{
  SegmentWriteState state=new SegmentWriteState(null,directory,segment,null,mergedDocs,0,termIndexInterval);
  final FormatPostingsFieldsConsumer consumer=new FormatPostingsFieldsWriter(state,fieldInfos);
  try {
    queue=new SegmentMergeQueue(readers.size());
    mergeTermInfos(consumer);
  }
  finally {
    consumer.finish();
    if (queue != null)     queue.close();
  }
}
