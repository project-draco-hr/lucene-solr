{
  try {
    List<String> files=zkClient.getChildren(zkPath,null,true);
    Files.createDirectories(dir);
    for (    String file : files) {
      List<String> children=zkClient.getChildren(zkPath + "/" + file,null,true);
      if (children.size() == 0) {
        byte[] data=zkClient.getData(zkPath + "/" + file,null,null,true);
        Path filename=dir.resolve(file);
        logger.info("Writing file {}",filename);
        Files.write(filename,data);
      }
 else {
        downloadFromZK(zkPath + "/" + file,dir.resolve(file));
      }
    }
  }
 catch (  KeeperException|InterruptedException e) {
    throw new IOException("Error downloading files from zookeeper path " + zkPath + " to "+ dir.toString(),SolrZkClient.checkInterrupted(e));
  }
}
