{
  try {
    final AtomicInteger counter=new AtomicInteger();
    HttpClientConfigurer custom=new HttpClientConfigurer(){
      @Override public void configure(      DefaultHttpClient httpClient,      SolrParams config){
        super.configure(httpClient,config);
        counter.set(config.getInt("custom-param",-1));
      }
    }
;
    HttpClientUtil.setConfigurer(custom);
    ModifiableSolrParams params=new ModifiableSolrParams();
    params.set("custom-param",5);
    HttpClientUtil.createClient(params).close();
    assertEquals(5,counter.get());
  }
  finally {
    HttpClientUtil.setConfigurer(new HttpClientConfigurer());
  }
}
