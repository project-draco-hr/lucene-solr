{
  highlighter=new Highlighter(new SimpleHTMLFormatter(),new QueryScorer(q));
  highlighter.setMaxDocCharsToAnalyze(maxDocCharsToAnalyze);
  return new BenchmarkHighlighter(){
    public int doHighlight(    IndexReader reader,    int doc,    String field,    Document document,    Analyzer analyzer,    String text) throws Exception {
      TokenStream ts=TokenSources.getAnyTokenStream(reader,doc,field,document,analyzer);
      TextFragment[] frag=highlighter.getBestTextFragments(ts,text,mergeContiguous,maxFrags);
      return frag != null ? frag.length : 0;
    }
  }
;
}
