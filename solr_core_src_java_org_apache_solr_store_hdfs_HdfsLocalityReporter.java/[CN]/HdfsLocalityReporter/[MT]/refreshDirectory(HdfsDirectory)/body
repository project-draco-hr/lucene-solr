{
  Map<FileStatus,BlockLocation[]> directoryCache=cache.get(dir);
  Set<FileStatus> cachedStatuses=directoryCache.keySet();
  FileSystem fs=dir.getFileSystem();
  FileStatus[] statuses=fs.listStatus(dir.getHdfsDirPath());
  List<FileStatus> statusList=Arrays.asList(statuses);
  logger.debug("Updating locality information for: {}",statusList);
  cachedStatuses.retainAll(statusList);
  for (  FileStatus status : statusList) {
    if (!status.isDirectory() && !directoryCache.containsKey(status)) {
      BlockLocation[] locations=fs.getFileBlockLocations(status,0,status.getLen());
      directoryCache.put(status,locations);
    }
  }
}
