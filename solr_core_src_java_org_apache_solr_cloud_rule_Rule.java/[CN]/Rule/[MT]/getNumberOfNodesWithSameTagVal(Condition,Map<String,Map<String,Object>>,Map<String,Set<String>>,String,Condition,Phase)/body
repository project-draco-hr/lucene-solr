{
  int countMatchingThisTagValue=0;
  for (  Map.Entry<String,Set<String>> entry : shardVsNodeSet.entrySet()) {
    if (shardCondition.val.equals(WILD_WILD_CARD) || entry.getKey().equals(shardName)) {
      Set<String> nodesInThisShard=shardVsNodeSet.get(shardCondition.val.equals(WILD_WILD_CARD) ? entry.getKey() : shardName);
      if (nodesInThisShard != null) {
        for (        String aNode : nodesInThisShard) {
          Object obj=nodeVsTags.get(aNode).get(tag.name);
          if (tagCondition.canMatch(obj,phase))           countMatchingThisTagValue++;
        }
      }
    }
  }
  return countMatchingThisTagValue;
}
