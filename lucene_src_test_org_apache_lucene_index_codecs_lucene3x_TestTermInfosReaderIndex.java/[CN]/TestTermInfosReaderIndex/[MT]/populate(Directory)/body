{
  IndexWriterConfig config=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random,MockTokenizer.KEYWORD,false));
  config.setCodec(new PreFlexRWCodec());
  LogMergePolicy mp=newLogMergePolicy();
  mp.setUseCompoundFile(false);
  config.setMergePolicy(mp);
  RandomIndexWriter writer=new RandomIndexWriter(random,directory,config);
  for (int i=0; i < NUMBER_OF_DOCUMENTS; i++) {
    Document document=new Document();
    for (int f=0; f < NUMBER_OF_FIELDS; f++) {
      document.add(newField("field" + f,getText(),StringField.TYPE_UNSTORED));
    }
    writer.addDocument(document);
  }
  writer.forceMerge(1);
  writer.close();
  return config.getTermIndexInterval();
}
