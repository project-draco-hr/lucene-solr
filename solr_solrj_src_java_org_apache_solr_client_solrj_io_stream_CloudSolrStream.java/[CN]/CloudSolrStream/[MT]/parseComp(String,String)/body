{
  String[] fls=fl.split(",");
  HashSet fieldSet=new HashSet();
  for (  String f : fls) {
    fieldSet.add(f.trim());
  }
  String[] sorts=sort.split(",");
  Comparator[] comps=new Comparator[sorts.length];
  for (int i=0; i < sorts.length; i++) {
    String s=sorts[i];
    String[] spec=s.trim().split("\\s+");
    String fieldName=spec[0].trim();
    String order=spec[1].trim();
    if (!fieldSet.contains(spec[0])) {
      throw new IOException("Fields in the sort spec must be included in the field list:" + spec[0]);
    }
    if (null != fieldMappings && fieldMappings.containsKey(fieldName)) {
      fieldName=fieldMappings.get(fieldName);
    }
    comps[i]=new FieldComparator(fieldName,order.equalsIgnoreCase("asc") ? ComparatorOrder.ASCENDING : ComparatorOrder.DESCENDING);
  }
  if (comps.length > 1) {
    return new MultiComp(comps);
  }
 else {
    return comps[0];
  }
}
