{
  StreamExpression expression=new StreamExpression(factory.getFunctionName(this.getClass()));
  expression.addParameter(collection);
  ModifiableSolrParams mParams=new ModifiableSolrParams(SolrParams.toMultiMap(params.toNamedList()));
  for (  Entry<String,String[]> param : mParams.getMap().entrySet()) {
    String value=String.join(",",param.getValue());
    value=value.replace("\"","\\\"");
    expression.addParameter(new StreamExpressionNamedParameter(param.getKey(),value));
  }
  expression.addParameter(new StreamExpressionNamedParameter("zkHost",zkHost));
  if (null != fieldMappings && 0 != fieldMappings.size()) {
    StringBuilder sb=new StringBuilder();
    for (    Entry<String,String> mapping : fieldMappings.entrySet()) {
      if (sb.length() > 0) {
        sb.append(",");
      }
      sb.append(mapping.getKey());
      sb.append("=");
      sb.append(mapping.getValue());
    }
    expression.addParameter(new StreamExpressionNamedParameter("aliases",sb.toString()));
  }
  return expression;
}
