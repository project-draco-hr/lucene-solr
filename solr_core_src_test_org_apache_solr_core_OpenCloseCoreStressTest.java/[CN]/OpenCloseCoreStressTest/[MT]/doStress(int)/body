{
  makeCores(solrHomeDirectory);
  buildClients();
  try {
    log.info("Starting indexing and querying");
    int secondsRun=0;
    int secondsRemaining=secondsToRun;
    do {
      int cycleSeconds=Math.min(resetInterval,secondsRemaining);
      log.info(String.format(Locale.ROOT,"\n\n\n\n\nStarting a %,d second cycle, seconds left: %,d. Seconds run so far: %,d.",cycleSeconds,secondsRemaining,secondsRun));
      Indexer idxer=new Indexer(this,url,indexingClients,indexingThreads,cycleSeconds,random());
      Queries queries=new Queries(this,url,queryingClients,queryThreads,random());
      idxer.waitOnThreads();
      queries.waitOnThreads();
      secondsRemaining=Math.max(secondsRemaining - resetInterval,0);
      checkResults(queryingClients.get(0),queries,idxer);
      secondsRun+=cycleSeconds;
      if (secondsRemaining > 0) {
        deleteAllDocuments(queryingClients.get(0),queries);
      }
    }
 while (secondsRemaining > 0);
    assertTrue("We didn't index any documents, somethings really messed up",cumulativeDocs > 0);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Caught unexpected exception");
  }
}
