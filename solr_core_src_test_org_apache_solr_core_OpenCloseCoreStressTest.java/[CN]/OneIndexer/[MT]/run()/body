{
  SolrTestCaseJ4.log.info(String.format(Locale.ROOT,"Starting indexing thread: " + getId()));
  while (Indexer.stopTime > System.currentTimeMillis()) {
    int myId=Indexer.idUnique.incrementAndGet();
    Indexer.docsThisCycle.incrementAndGet();
    String core=OCCST.getRandomCore(random);
    OCCST.incrementCoreCount(core);
    Indexer.progress(myId,core);
    for (int idx=0; idx < 3; ++idx) {
      SolrInputDocument doc=new SolrInputDocument();
      doc.addField("id","id" + Integer.toString(myId));
      doc.addField("text","text " + Integer.toString(myId));
      UpdateRequest update=new UpdateRequest();
      update.add(doc);
      try {
        client.setBaseURL(baseUrl + core);
        UpdateResponse response=client.add(doc,OpenCloseCoreStressTest.COMMIT_WITHIN);
        if (response.getStatus() != 0) {
          SolrTestCaseJ4.log.warn("Failed to index a document to core " + core + " with status "+ response.getStatus());
        }
 else {
          Indexer.qTimesAccum.addAndGet(response.getQTime());
          Indexer.updateCounts.incrementAndGet();
          break;
        }
        Thread.sleep(100L);
      }
 catch (      Exception e) {
        if (e instanceof InterruptedException)         return;
        Indexer.errors.incrementAndGet();
        if (idx == 2) {
          SolrTestCaseJ4.log.warn("Could not reach server while indexing for three tries, quitting " + e.getMessage());
        }
 else {
          SolrTestCaseJ4.log.info("Indexing thread " + Thread.currentThread().getId() + " swallowed one exception "+ e.getMessage());
          try {
            Thread.sleep(500);
          }
 catch (          InterruptedException tex) {
            return;
          }
        }
      }
    }
  }
  SolrTestCaseJ4.log.info("Leaving indexing thread " + getId());
}
