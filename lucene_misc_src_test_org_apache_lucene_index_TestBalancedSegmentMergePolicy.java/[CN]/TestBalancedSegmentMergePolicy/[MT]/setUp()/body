{
  super.setUp();
  dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  BalancedSegmentMergePolicy mp=new BalancedSegmentMergePolicy();
  mp.setMergePolicyParams(newMergePolicyParams(random()));
  iwc.setMergePolicy(mp);
  iw=new RandomIndexWriter(random(),dir,iwc);
  LineFileDocs docs=new LineFileDocs(random(),!Codec.getDefault().getName().equals("Lucene3x"));
  int numDocs=atLeast(200);
  for (int i=0; i < numDocs; i++) {
    iw.addDocument(docs.nextDoc());
    if (random().nextInt(6) == 0) {
      iw.deleteDocuments(new Term("docid",Integer.toString(i)));
    }
    if (random().nextInt(10) == 0) {
      iw.commit();
    }
  }
}
