{
  Directory store=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,store,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setSimilarityProvider(new SimpleSimilarity()));
  Document d1=new Document();
  d1.add(newField("field","a c",Field.Store.YES,Field.Index.ANALYZED));
  Document d2=new Document();
  d2.add(newField("field","a b c",Field.Store.YES,Field.Index.ANALYZED));
  writer.addDocument(d1);
  writer.addDocument(d2);
  IndexReader reader=writer.getReader();
  writer.close();
  IndexSearcher searcher=newSearcher(reader);
  searcher.setSimilarityProvider(new SimpleSimilarity());
  Term a=new Term("field","a");
  Term b=new Term("field","b");
  Term c=new Term("field","c");
  searcher.search(new TermQuery(b),new Collector(){
    private Scorer scorer;
    @Override public void setScorer(    Scorer scorer) throws IOException {
      this.scorer=scorer;
    }
    @Override public final void collect(    int doc) throws IOException {
      assertEquals(1.0f,scorer.score());
    }
    @Override public void setNextReader(    AtomicReaderContext context){
    }
    @Override public boolean acceptsDocsOutOfOrder(){
      return true;
    }
  }
);
  BooleanQuery bq=new BooleanQuery();
  bq.add(new TermQuery(a),BooleanClause.Occur.SHOULD);
  bq.add(new TermQuery(b),BooleanClause.Occur.SHOULD);
  searcher.search(bq,new Collector(){
    private int base=0;
    private Scorer scorer;
    @Override public void setScorer(    Scorer scorer) throws IOException {
      this.scorer=scorer;
    }
    @Override public final void collect(    int doc) throws IOException {
      assertEquals((float)doc + base + 1,scorer.score());
    }
    @Override public void setNextReader(    AtomicReaderContext context){
      base=context.docBase;
    }
    @Override public boolean acceptsDocsOutOfOrder(){
      return true;
    }
  }
);
  PhraseQuery pq=new PhraseQuery();
  pq.add(a);
  pq.add(c);
  searcher.search(pq,new Collector(){
    private Scorer scorer;
    @Override public void setScorer(    Scorer scorer) throws IOException {
      this.scorer=scorer;
    }
    @Override public final void collect(    int doc) throws IOException {
      assertEquals(1.0f,scorer.score());
    }
    @Override public void setNextReader(    AtomicReaderContext context){
    }
    @Override public boolean acceptsDocsOutOfOrder(){
      return true;
    }
  }
);
  pq.setSlop(2);
  searcher.search(pq,new Collector(){
    private Scorer scorer;
    @Override public void setScorer(    Scorer scorer) throws IOException {
      this.scorer=scorer;
    }
    @Override public final void collect(    int doc) throws IOException {
      assertEquals(2.0f,scorer.score());
    }
    @Override public void setNextReader(    AtomicReaderContext context){
    }
    @Override public boolean acceptsDocsOutOfOrder(){
      return true;
    }
  }
);
  searcher.close();
  reader.close();
  store.close();
}
