{
  final File workDir=new File(dataDir,this.getClass().getName());
  if (workDir.exists()) {
    FileUtils.deleteDirectory(workDir);
  }
  assertTrue("Failed to mkdirs workDir",workDir.mkdirs());
  final CoreContainer cores=h.getCoreContainer();
  final CoreAdminHandler admin=new CoreAdminHandler(cores);
  try (SolrCore core=cores.getCore("collection1")){
    FailingDirectoryFactory dirFactory=(FailingDirectoryFactory)core.getDirectoryFactory();
    try {
      dirFactory.fail=true;
      ignoreException(FAILING_MSG);
      SolrQueryResponse resp=new SolrQueryResponse();
      admin.handleRequestBody(req(CoreAdminParams.ACTION,CoreAdminParams.CoreAdminAction.MERGEINDEXES.toString(),CoreAdminParams.CORE,"collection1",CoreAdminParams.INDEX_DIR,workDir.getAbsolutePath()),resp);
      fail("exception expected");
    }
 catch (    FailingDirectoryFactory.FailingDirectoryFactoryException e) {
    }
 finally {
      unIgnoreException(FAILING_MSG);
    }
    dirFactory.fail=false;
  }
   FileUtils.deleteDirectory(workDir);
}
