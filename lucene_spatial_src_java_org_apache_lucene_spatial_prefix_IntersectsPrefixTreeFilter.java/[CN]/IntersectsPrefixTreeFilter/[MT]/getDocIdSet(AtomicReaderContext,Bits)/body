{
  return new VisitorTemplate(context,acceptDocs,hasIndexedLeaves){
    private OpenBitSet results;
    @Override protected void start(){
      results=new OpenBitSet(maxDoc);
    }
    @Override protected DocIdSet finish(){
      return results;
    }
    @Override protected boolean visit(    Node cell) throws IOException {
      if (cell.getShapeRel() == SpatialRelation.WITHIN || cell.getLevel() == detailLevel) {
        collectDocs(results);
        return false;
      }
      return true;
    }
    @Override protected void visitLeaf(    Node cell) throws IOException {
      collectDocs(results);
    }
    @Override protected void visitScanned(    Node cell,    Shape cellShape) throws IOException {
      if (queryShape.relate(cellShape).intersects())       collectDocs(results);
    }
  }
.getDocIdSet();
}
