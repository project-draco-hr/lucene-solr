{
  final Random rnd=newRandom();
  String field="field" + precisionStep;
  int termCountT=0, termCountC=0;
  for (int i=0; i < 50; i++) {
    long lower=(long)(rnd.nextDouble() * noDocs * distance) + startOffset;
    long upper=(long)(rnd.nextDouble() * noDocs * distance) + startOffset;
    if (lower > upper) {
      long a=lower;
      lower=upper;
      upper=a;
    }
    NumericRangeQuery tq=NumericRangeQuery.newLongRange(field,precisionStep,new Long(lower),new Long(upper),true,true);
    TermRangeQuery cq=new TermRangeQuery(field,NumericUtils.longToPrefixCoded(lower),NumericUtils.longToPrefixCoded(upper),true,true);
    TopDocs tTopDocs=searcher.search(tq,1);
    TopDocs cTopDocs=searcher.search(cq,1);
    assertEquals("Returned count for NumericRangeQuery and TermRangeQuery must be equal",cTopDocs.totalHits,tTopDocs.totalHits);
    termCountT+=tq.getTotalNumberOfTerms();
    termCountC+=cq.getTotalNumberOfTerms();
    tq=NumericRangeQuery.newLongRange(field,precisionStep,new Long(lower),new Long(upper),false,false);
    cq=new TermRangeQuery(field,NumericUtils.longToPrefixCoded(lower),NumericUtils.longToPrefixCoded(upper),false,false);
    tTopDocs=searcher.search(tq,1);
    cTopDocs=searcher.search(cq,1);
    assertEquals("Returned count for NumericRangeQuery and TermRangeQuery must be equal",cTopDocs.totalHits,tTopDocs.totalHits);
    termCountT+=tq.getTotalNumberOfTerms();
    termCountC+=cq.getTotalNumberOfTerms();
    tq=NumericRangeQuery.newLongRange(field,precisionStep,new Long(lower),new Long(upper),false,true);
    cq=new TermRangeQuery(field,NumericUtils.longToPrefixCoded(lower),NumericUtils.longToPrefixCoded(upper),false,true);
    tTopDocs=searcher.search(tq,1);
    cTopDocs=searcher.search(cq,1);
    assertEquals("Returned count for NumericRangeQuery and TermRangeQuery must be equal",cTopDocs.totalHits,tTopDocs.totalHits);
    termCountT+=tq.getTotalNumberOfTerms();
    termCountC+=cq.getTotalNumberOfTerms();
    tq=NumericRangeQuery.newLongRange(field,precisionStep,new Long(lower),new Long(upper),true,false);
    cq=new TermRangeQuery(field,NumericUtils.longToPrefixCoded(lower),NumericUtils.longToPrefixCoded(upper),true,false);
    tTopDocs=searcher.search(tq,1);
    cTopDocs=searcher.search(cq,1);
    assertEquals("Returned count for NumericRangeQuery and TermRangeQuery must be equal",cTopDocs.totalHits,tTopDocs.totalHits);
    termCountT+=tq.getTotalNumberOfTerms();
    termCountC+=cq.getTotalNumberOfTerms();
  }
  if (precisionStep == Integer.MAX_VALUE) {
    assertEquals("Total number of terms should be equal for unlimited precStep",termCountT,termCountC);
  }
 else {
    System.out.println("Average number of terms during random search on '" + field + "':");
    System.out.println(" Trie query: " + (((double)termCountT) / (50 * 4)));
    System.out.println(" Classical query: " + (((double)termCountC) / (50 * 4)));
  }
}
