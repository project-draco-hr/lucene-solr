{
  int detailLevel=grid.getMaxLevelForPrecision(shape,distErrPct);
  List<Node> cells=grid.getNodes(shape,detailLevel,true);
  if (!(shape instanceof Point)) {
    Point ctr=shape.getCenter();
    cells.add(grid.getNodes(ctr,grid.getMaxLevels(),false).get(0));
  }
  String fname=fieldInfo.getFieldName();
  if (store) {
    String wkt=grid.getSpatialContext().toString(shape);
    if (index) {
      Field f=new Field(fname,wkt,TYPE_STORED);
      f.setTokenStream(new CellTokenStream(cells.iterator()));
      return f;
    }
    return new StoredField(fname,wkt);
  }
  if (index) {
    return new Field(fname,new CellTokenStream(cells.iterator()),TYPE_UNSTORED);
  }
  throw new UnsupportedOperationException("Fields need to be indexed or store [" + fname + "]");
}
