{
  Directory dir=newDirectory();
  CharacterRunAutomaton stopSet=new CharacterRunAutomaton(new RegExp("the|a|of").toLightAutomaton());
  Analyzer analyzer=new MockAnalyzer(random(),MockTokenizer.SIMPLE,true,stopSet);
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir,analyzer);
  Document doc=new Document();
  doc.add(newTextField("field","the quick brown fox",Field.Store.NO));
  writer.addDocument(doc);
  Document doc2=new Document();
  doc2.add(newTextField("field","quick brown fox",Field.Store.NO));
  writer.addDocument(doc2);
  IndexReader reader=writer.getReader();
  IndexSearcher searcher=newSearcher(reader);
  SpanQuery sfq=new SpanFirstQuery(new SpanTermQuery(new Term("field","quick")),1);
  assertEquals(1,searcher.search(sfq,10).totalHits);
  SpanQuery include=new SpanFirstQuery(new SpanTermQuery(new Term("field","quick")),2);
  sfq=new SpanNotQuery(include,sfq);
  assertEquals(1,searcher.search(sfq,10).totalHits);
  writer.shutdown();
  reader.close();
  dir.close();
}
