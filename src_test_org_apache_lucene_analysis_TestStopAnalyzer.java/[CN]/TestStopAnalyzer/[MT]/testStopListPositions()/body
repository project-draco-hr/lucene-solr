{
  boolean defaultEnable=StopFilter.getEnablePositionIncrementsDefault();
  StopFilter.setEnablePositionIncrementsDefault(true);
  try {
    Set stopWordsSet=new HashSet();
    stopWordsSet.add("good");
    stopWordsSet.add("test");
    stopWordsSet.add("analyzer");
    StopAnalyzer newStop=new StopAnalyzer((String[])stopWordsSet.toArray(new String[3]));
    StringReader reader=new StringReader("This is a good test of the english stop analyzer with positions");
    int expectedIncr[]={1,1,1,3,1,1,1,2,1};
    TokenStream stream=newStop.tokenStream("test",reader);
    assertNotNull(stream);
    int i=0;
    TermAttribute termAtt=stream.getAttribute(TermAttribute.class);
    PositionIncrementAttribute posIncrAtt=stream.addAttribute(PositionIncrementAttribute.class);
    while (stream.incrementToken()) {
      String text=termAtt.term();
      assertFalse(stopWordsSet.contains(text));
      assertEquals(expectedIncr[i++],posIncrAtt.getPositionIncrement());
    }
  }
  finally {
    StopFilter.setEnablePositionIncrementsDefault(defaultEnable);
  }
}
