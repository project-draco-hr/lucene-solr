{
  assertTrue(testDoc != null);
  FieldInfos fieldInfos=new FieldInfos();
  _TestUtil.add(testDoc,fieldInfos);
  assertTrue(fieldInfos.size() == DocHelper.all.size());
  IndexOutput output=dir.createOutput(filename,newIOContext(random));
  assertTrue(output != null);
  fieldInfos.write(output);
  output.close();
  return fieldInfos;
}
