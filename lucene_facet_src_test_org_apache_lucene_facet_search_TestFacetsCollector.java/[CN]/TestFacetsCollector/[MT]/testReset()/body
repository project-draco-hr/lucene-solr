{
  Directory indexDir=newDirectory();
  Directory taxoDir=newDirectory();
  TaxonomyWriter taxonomyWriter=new DirectoryTaxonomyWriter(taxoDir);
  IndexWriter iw=new IndexWriter(indexDir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())));
  FacetFields facetFields=new FacetFields(taxonomyWriter);
  Document doc=new Document();
  facetFields.addFields(doc,Arrays.asList(new CategoryPath("a/1",'/'),new CategoryPath("b/1",'/')));
  iw.addDocument(doc);
  taxonomyWriter.close();
  iw.close();
  DirectoryReader r=DirectoryReader.open(indexDir);
  DirectoryTaxonomyReader taxo=new DirectoryTaxonomyReader(taxoDir);
  FacetSearchParams fsp=new FacetSearchParams(new CountFacetRequest(new CategoryPath("a"),10),new CountFacetRequest(new CategoryPath("b"),10));
  final FacetsAccumulator fa=random().nextBoolean() ? new FacetsAccumulator(fsp,r,taxo) : new StandardFacetsAccumulator(fsp,r,taxo);
  final FacetsCollector fc=FacetsCollector.create(fa);
  fc.getFacetResults();
  new IndexSearcher(r).search(new MatchAllDocsQuery(),fc);
  List<FacetResult> res1=fc.getFacetResults();
  assertEquals(2,res1.size());
  for (  FacetResult res : res1) {
    assertEquals(1,res.getFacetResultNode().subResults.size());
    assertEquals(1,(int)res.getFacetResultNode().subResults.get(0).value);
  }
  fc.reset();
  List<FacetResult> res2=fc.getFacetResults();
  assertNotSame("reset() should clear the cached results",res1,res2);
  IOUtils.close(taxo,taxoDir,r,indexDir);
}
