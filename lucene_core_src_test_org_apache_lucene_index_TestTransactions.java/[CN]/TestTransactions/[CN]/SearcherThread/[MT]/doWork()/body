{
  IndexReader r1=null, r2=null;
synchronized (lock) {
    try {
      r1=DirectoryReader.open(dir1);
      r2=DirectoryReader.open(dir2);
    }
 catch (    IOException e) {
      if (!e.getMessage().contains("on purpose")) {
        throw e;
      }
      if (r1 != null) {
        r1.close();
      }
      if (r2 != null) {
        r2.close();
      }
      return;
    }
  }
  if (r1.numDocs() != r2.numDocs()) {
    throw new RuntimeException("doc counts differ: r1=" + r1.numDocs() + " r2="+ r2.numDocs());
  }
  r1.close();
  r2.close();
}
