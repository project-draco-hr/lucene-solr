{
  Directory dir=new RAMDirectory();
  IndexWriter writer=newWriter(dir,true);
  writer.setUseCompoundFile(false);
  addDocs(writer,1);
  writer.close();
  Directory other=new RAMDirectory();
  writer=newWriter(other,true);
  writer.setUseCompoundFile(true);
  writer.addIndexesNoOptimize(new Directory[]{dir});
  assertTrue(writer.newestSegment().getUseCompoundFile());
  writer.close();
}
