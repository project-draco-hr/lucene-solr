{
  Directory dir=new RAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new IndexWriterConfig(Version.LUCENE_40,analyzer));
  Document doc=new Document();
  String dummyTitle="this is a dummy title ";
  doc.add(new TextField("title",dummyTitle,Field.Store.YES));
  String dummyContent="there is some content written here";
  doc.add(new TextField("contents",dummyContent,Field.Store.YES));
  writer.addDocument(doc,analyzer);
  writer.commit();
  DirectoryReader directoryReader=DirectoryReader.open(dir);
  IndexSearcher indexSearcher=new IndexSearcher(directoryReader);
  TopDocs result=indexSearcher.search(new MatchAllDocsQuery(),1);
  assertTrue(result.totalHits > 0);
  Document d=indexSearcher.doc(result.scoreDocs[0].doc);
  assertNotNull(d);
  assertNotNull(d.getField("title"));
  assertEquals(dummyTitle,d.getField("title").stringValue());
  assertNotNull(d.getField("contents"));
  assertEquals(dummyContent,d.getField("contents").stringValue());
  doc=new Document();
  String dogmasTitle="dogmas";
  doc.add(new TextField("title",dogmasTitle,Field.Store.YES));
  String dogmasContents="white men can't jump";
  doc.add(new TextField("contents",dogmasContents,Field.Store.YES));
  writer.addDocument(doc,analyzer);
  writer.commit();
  directoryReader.close();
  directoryReader=DirectoryReader.open(dir);
  indexSearcher=new IndexSearcher(directoryReader);
  result=indexSearcher.search(new MatchAllDocsQuery(),2);
  Document d1=indexSearcher.doc(result.scoreDocs[1].doc);
  assertNotNull(d1);
  assertNotNull(d1.getField("title"));
  assertEquals(dogmasTitle,d1.getField("title").stringValue());
  assertNotNull(d1.getField("contents"));
  assertEquals(dogmasContents,d1.getField("contents").stringValue());
  indexSearcher=new IndexSearcher(directoryReader);
  result=indexSearcher.search(new MatchAllDocsQuery(),2);
  assertEquals(2,result.totalHits);
  writer.close();
  indexSearcher.getIndexReader().close();
  dir.close();
}
