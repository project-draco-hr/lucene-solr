{
  if (bufferedDeleteTerms.size() > 0) {
    if (getInfoStream() != null)     getInfoStream().println("flush " + numBufferedDeleteTerms + " buffered terms on "+ segmentInfos.size()+ " segments.");
    if (flushedRamSegments) {
      IndexReader reader=null;
      try {
        reader=SegmentReader.get(segmentInfos.info(segmentInfos.size() - 1));
        reader.setDeleter(getDeleter());
        applyDeletesSelectively(bufferedDeleteTerms,reader);
      }
  finally {
        if (reader != null)         reader.close();
      }
    }
    int infosEnd=segmentInfos.size();
    if (flushedRamSegments) {
      infosEnd--;
    }
    for (int i=0; i < infosEnd; i++) {
      IndexReader reader=null;
      try {
        reader=SegmentReader.get(segmentInfos.info(i));
        reader.setDeleter(getDeleter());
        applyDeletes(bufferedDeleteTerms,reader);
      }
  finally {
        if (reader != null)         reader.close();
      }
    }
    bufferedDeleteTerms.clear();
    numBufferedDeleteTerms=0;
  }
}
