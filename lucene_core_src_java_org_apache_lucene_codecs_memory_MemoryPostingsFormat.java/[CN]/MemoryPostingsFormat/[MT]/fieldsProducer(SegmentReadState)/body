{
  final String fileName=IndexFileNames.segmentFileName(state.segmentInfo.name,state.segmentSuffix,EXTENSION);
  final IndexInput in=state.dir.openInput(fileName,IOContext.READONCE);
  final SortedMap<String,TermsReader> fields=new TreeMap<String,TermsReader>();
  try {
    while (true) {
      final int termCount=in.readVInt();
      if (termCount == 0) {
        break;
      }
      final TermsReader termsReader=new TermsReader(state.fieldInfos,in,termCount);
      fields.put(termsReader.field.name,termsReader);
    }
  }
  finally {
    in.close();
  }
  return new FieldsProducer(){
    @Override public Iterator<String> iterator(){
      return new UnmodifiableIterator<String>(fields.keySet().iterator());
    }
    @Override public Terms terms(    String field){
      return fields.get(field);
    }
    @Override public int size(){
      return fields.size();
    }
    @Override public void close(){
      for (      TermsReader termsReader : fields.values()) {
        termsReader.fst=null;
      }
    }
  }
;
}
