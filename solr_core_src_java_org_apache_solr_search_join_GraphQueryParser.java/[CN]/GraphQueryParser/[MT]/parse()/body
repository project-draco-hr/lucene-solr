{
  SolrParams localParams=getLocalParams();
  Query rootNodeQuery=subQuery(localParams.get(QueryParsing.V),null).getQuery();
  String traversalFilterS=localParams.get("traversalFilter");
  Query traversalFilter=traversalFilterS == null ? null : subQuery(traversalFilterS,null).getQuery();
  String fromField=localParams.get("from","node_id");
  String toField=localParams.get("to","edge_ids");
  boolean onlyLeafNodes=localParams.getBool("returnOnlyLeaf",false);
  boolean returnRootNodes=localParams.getBool("returnRoot",true);
  int maxDepth=localParams.getInt("maxDepth",-1);
  boolean useAutn=localParams.getBool("useAutn",false);
  GraphQuery gq=new GraphQuery(rootNodeQuery,fromField,toField,traversalFilter);
  gq.setMaxDepth(maxDepth);
  gq.setOnlyLeafNodes(onlyLeafNodes);
  gq.setReturnRoot(returnRootNodes);
  gq.setUseAutn(useAutn);
  return gq;
}
