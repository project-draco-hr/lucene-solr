{
  MockDirectoryWrapper dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setRAMBufferSizeMB(0.5));
  for (int i=0; i < 3; i++) {
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      for (int k=0; k < 100; k++) {
        doc.add(newField("field",Integer.toString(random.nextInt()),storedTextType));
      }
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      Document doc=new Document();
      doc.add(newField("field","aaa aaa aaa aaa aaa aaa aaa aaa aaa aaa",storedTextType));
      writer.addDocument(doc);
    }
    for (int j=0; j < 100; j++) {
      StringBuilder b=new StringBuilder();
      String x=Integer.toString(j) + ".";
      for (int k=0; k < 1000; k++)       b.append(x);
      String longTerm=b.toString();
      Document doc=new Document();
      doc.add(newField("field",longTerm,storedTextType));
      writer.addDocument(doc);
    }
  }
  writer.close();
  IndexReader reader=IndexReader.open(dir);
  IndexSearcher searcher=new IndexSearcher(reader);
  ScoreDoc[] hits=searcher.search(new TermQuery(new Term("field","aaa")),null,1000).scoreDocs;
  assertEquals(300,hits.length);
  searcher.close();
  reader.close();
  dir.close();
}
