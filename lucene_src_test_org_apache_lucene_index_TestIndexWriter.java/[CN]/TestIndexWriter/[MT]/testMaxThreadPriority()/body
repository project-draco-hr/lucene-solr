{
  int pri=Thread.currentThread().getPriority();
  try {
    MockRAMDirectory dir=new MockRAMDirectory();
    IndexWriterConfig conf=newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(2);
    ((LogMergePolicy)conf.getMergePolicy()).setMergeFactor(2);
    IndexWriter iw=new IndexWriter(dir,conf);
    Document document=new Document();
    document.add(new Field("tvtest","a b c",Field.Store.NO,Field.Index.ANALYZED,Field.TermVector.YES));
    Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
    for (int i=0; i < 4; i++)     iw.addDocument(document);
    iw.close();
  }
  finally {
    Thread.currentThread().setPriority(pri);
  }
}
