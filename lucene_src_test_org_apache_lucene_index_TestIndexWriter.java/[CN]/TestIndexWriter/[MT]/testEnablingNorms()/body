{
  MockDirectoryWrapper dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(10));
  for (int j=0; j < 10; j++) {
    Document doc=new Document();
    Field f=newField("field","aaa",Field.Store.YES,Field.Index.ANALYZED);
    if (j != 8) {
      f.setOmitNorms(true);
    }
    doc.add(f);
    writer.addDocument(doc);
  }
  writer.close();
  Term searchTerm=new Term("field","aaa");
  IndexSearcher searcher=new IndexSearcher(dir,false);
  ScoreDoc[] hits=searcher.search(new TermQuery(searchTerm),null,1000).scoreDocs;
  assertEquals(10,hits.length);
  searcher.close();
  writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(10));
  for (int j=0; j < 27; j++) {
    Document doc=new Document();
    Field f=newField("field","aaa",Field.Store.YES,Field.Index.ANALYZED);
    if (j != 26) {
      f.setOmitNorms(true);
    }
    doc.add(f);
    writer.addDocument(doc);
  }
  writer.close();
  searcher=new IndexSearcher(dir,false);
  hits=searcher.search(new TermQuery(searchTerm),null,1000).scoreDocs;
  assertEquals(27,hits.length);
  searcher.close();
  IndexReader reader=IndexReader.open(dir,true);
  reader.close();
  dir.close();
}
