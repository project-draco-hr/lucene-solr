{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(2));
  ((LogMergePolicy)writer.getMergePolicy()).setMergeFactor(10);
  Document doc=new Document();
  doc.add(newField("field","aaa",Field.Store.YES,Field.Index.ANALYZED,Field.TermVector.WITH_POSITIONS_OFFSETS));
  for (int i=0; i < 19; i++)   writer.addDocument(doc);
  writer.flush(false,true,true);
  writer.close();
  SegmentInfos sis=new SegmentInfos();
  sis.read(dir);
  assertEquals(10,sis.size());
  dir.close();
}
