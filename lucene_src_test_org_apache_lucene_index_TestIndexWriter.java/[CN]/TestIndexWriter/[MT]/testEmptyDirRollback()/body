{
  Directory dir=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(2));
  assertEquals(0,dir.listAll().length);
  Document doc=new Document();
  doc.add(new Field("c","val",Store.YES,Index.ANALYZED,TermVector.WITH_POSITIONS_OFFSETS));
  writer.addDocument(doc);
  assertEquals("only the stored and term vector files should exist in the directory",5,dir.listAll().length);
  doc=new Document();
  doc.add(new Field("c","val",Store.YES,Index.ANALYZED,TermVector.WITH_POSITIONS_OFFSETS));
  writer.addDocument(doc);
  assertTrue("flush should have occurred and files created",dir.listAll().length > 5);
  writer.rollback();
  assertEquals("no files should exist in the directory after rollback",0,dir.listAll().length);
  writer.close();
  assertEquals("expected a no-op close after IW.rollback()",0,dir.listAll().length);
}
