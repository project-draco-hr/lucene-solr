{
  Directory dir=new MockRAMDirectory();
  for (int iter=0; iter < 2; iter++) {
    IndexWriter writer=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new StandardAnalyzer(TEST_VERSION_CURRENT)).setMaxBufferedDocs(2).setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH).setMergeScheduler(new SerialMergeScheduler()));
    writer.setMergePolicy(new LogDocMergePolicy(writer));
    Document document=new Document();
    Field storedField=new Field("stored","stored",Field.Store.YES,Field.Index.NO);
    document.add(storedField);
    writer.addDocument(document);
    writer.addDocument(document);
    document=new Document();
    document.add(storedField);
    Field termVectorField=new Field("termVector","termVector",Field.Store.NO,Field.Index.NOT_ANALYZED,Field.TermVector.WITH_POSITIONS_OFFSETS);
    document.add(termVectorField);
    writer.addDocument(document);
    writer.optimize();
    writer.close();
    IndexReader reader=IndexReader.open(dir,true);
    assertTrue(reader.getTermFreqVectors(0) == null);
    assertTrue(reader.getTermFreqVectors(1) == null);
    assertTrue(reader.getTermFreqVectors(2) != null);
    reader.close();
  }
  dir.close();
}
