{
  Map entityAttrs=createMap("name","e","url","testdata.xml",XPathEntityProcessor.FOR_EACH,"/root");
  List fields=new ArrayList();
  fields.add(createMap("column","a","xpath","/root/a","flatten","true"));
  Context c=getContext(null,new VariableResolverImpl(),getDataSource(testXmlFlatten),Context.FULL_DUMP,fields,entityAttrs);
  XPathEntityProcessor xPathEntityProcessor=new XPathEntityProcessor();
  xPathEntityProcessor.init(c);
  Map<String,Object> result=null;
  while (true) {
    Map<String,Object> row=xPathEntityProcessor.nextRow();
    if (row == null)     break;
    result=row;
  }
  assertEquals("1B2",result.get("a"));
}
