{
  try {
    initDirectoryFactory();
    boolean indexExists=getDirectoryFactory().exists(getNewIndexDir());
    boolean firstTime;
synchronized (SolrCore.class) {
      firstTime=dirs.add(new File(getNewIndexDir()).getCanonicalPath());
    }
    boolean removeLocks=solrConfig.unlockOnStartup;
    initIndexReaderFactory();
    if (indexExists && firstTime && removeLocks) {
      Directory dir=SolrIndexWriter.getDirectory(getIndexDir(),getDirectoryFactory(),solrConfig.mainIndexConfig);
      if (dir != null) {
        if (IndexWriter.isLocked(dir)) {
          log.warn(logid + "WARNING: Solr index directory '" + getIndexDir()+ "' is locked.  Unlocking...");
          IndexWriter.unlock(dir);
        }
        dir.close();
      }
    }
    if (!indexExists) {
      log.warn(logid + "Solr index directory '" + new File(getNewIndexDir())+ "' doesn't exist."+ " Creating new index...");
      SolrIndexWriter writer=new SolrIndexWriter("SolrCore.initIndex",getIndexDir(),getDirectoryFactory(),true,schema,solrConfig.mainIndexConfig,solrDelPolicy);
      writer.close();
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
