{
  int minLength=Integer.MAX_VALUE;
  int maxLength=Integer.MIN_VALUE;
  for (  BytesRef b : values) {
    minLength=Math.min(minLength,b.length);
    maxLength=Math.max(maxLength,b.length);
  }
  boolean success=false;
  IndexOutput data=null;
  IndexOutput index=null;
  String dataName=IndexFileNames.segmentFileName(state.segmentInfo.name,Integer.toString(field.number),"dat");
  String indexName=IndexFileNames.segmentFileName(state.segmentInfo.name,Integer.toString(field.number),"idx");
  try {
    data=dir.createOutput(dataName,state.context);
    index=dir.createOutput(indexName,state.context);
    if (minLength == maxLength) {
      addFixedSortedBytesField(field,data,index,values,docToOrd,minLength);
    }
 else {
      addVarSortedBytesField(field,data,index,values,docToOrd);
    }
    success=true;
  }
  finally {
    if (success) {
      IOUtils.close(data,index);
    }
 else {
      IOUtils.closeWhileHandlingException(data,index);
    }
  }
}
