{
  assertU(adoc("id","1","x_td","0","y_td","0","z_td","0","w_td","0"));
  assertU(adoc("id","2","x_td","0","y_td","1","z_td","0","w_td","0"));
  assertU(adoc("id","3","x_td","1","y_td","1","z_td","1","w_td","1"));
  assertU(adoc("id","4","x_td","1","y_td","0","z_td","0","w_td","0"));
  assertU(adoc("id","5","x_td","2.3","y_td","5.5","z_td","7.9","w_td","-2.4"));
  assertU(commit());
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, 0, 0)","fq","id:2"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, 0, 0)","fq","id:3"),"//float[@name='score']='" + 2.0f + "'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, 0, 0)","fq","id:4"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, 0, 0)","fq","id:5"),"//float[@name='score']='" + (float)(2.3 * 2.3 + 5.5 * 5.5) + "'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, 0, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, 0, 0, 0)","fq","id:2"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, 0, 0, 0)","fq","id:3"),"//float[@name='score']='" + 3.0f + "'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, 0, 0, 0)","fq","id:4"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, 0, 0, 0)","fq","id:5"),"//float[@name='score']='" + (float)(2.3 * 2.3 + 5.5 * 5.5 + 7.9 * 7.9) + "'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0, 0)","fq","id:2"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0, 0)","fq","id:3"),"//float[@name='score']='" + 4.0f + "'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0, 0)","fq","id:4"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0, 0)","fq","id:5"),"//float[@name='score']='" + (float)(2.3 * 2.3 + 5.5 * 5.5 + 7.9 * 7.9 + 2.4 * 2.4) + "'");
  try {
    assertQ(req("fl","*,score","q","{!func}sqedist(x_td, y_td, z_td, w_td, 0, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
    assertTrue("should throw an exception",false);
  }
 catch (  Exception e) {
    Throwable cause=e.getCause();
    assertNotNull(cause);
    assertTrue(cause instanceof SolrException);
  }
  assertQ(req("fl","*,score","q","{!func}dist(2, x_td, y_td, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
  assertQ(req("fl","*,score","q","{!func}dist(2, x_td, y_td, 0, 0)","fq","id:2"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}dist(2, x_td, y_td, 0, 0)","fq","id:3"),"//float[@name='score']='" + (float)Math.sqrt(2.0) + "'");
  assertQ(req("fl","*,score","q","{!func}dist(2, x_td, y_td, 0, 0)","fq","id:4"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}dist(2, x_td, y_td, 0, 0)","fq","id:5"),"//float[@name='score']='" + (float)Math.sqrt((2.3 * 2.3 + 5.5 * 5.5)) + "'");
  assertQ(req("fl","*,score","q","{!func}dist(1, x_td, y_td, 0, 0)","fq","id:1"),"//float[@name='score']='0.0'");
  assertQ(req("fl","*,score","q","{!func}dist(1, x_td, y_td, 0, 0)","fq","id:2"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}dist(1, x_td, y_td, 0, 0)","fq","id:3"),"//float[@name='score']='" + (float)2.0 + "'");
  assertQ(req("fl","*,score","q","{!func}dist(1, x_td, y_td, 0, 0)","fq","id:4"),"//float[@name='score']='1.0'");
  assertQ(req("fl","*,score","q","{!func}dist(1, x_td, y_td, 0, 0)","fq","id:5"),"//float[@name='score']='" + (float)(2.3 + 5.5) + "'");
}
