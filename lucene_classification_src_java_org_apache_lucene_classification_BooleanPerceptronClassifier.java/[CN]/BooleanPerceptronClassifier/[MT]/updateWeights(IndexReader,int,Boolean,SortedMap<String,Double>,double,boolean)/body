{
  TermsEnum cte=textTerms.iterator();
  Terms terms=indexReader.getTermVector(docId,textFieldName);
  if (terms == null) {
    throw new IOException("term vectors must be stored for field " + textFieldName);
  }
  TermsEnum termsEnum=terms.iterator();
  BytesRef term;
  while ((term=termsEnum.next()) != null) {
    cte.seekExact(term);
    if (assignedClass != null) {
      long termFreqLocal=termsEnum.totalTermFreq();
      Long previousValue=Util.get(fst,term);
      String termString=term.utf8ToString();
      weights.put(termString,previousValue == null ? 0 : previousValue + modifier * termFreqLocal);
    }
  }
  if (updateFST) {
    updateFST(weights);
  }
}
