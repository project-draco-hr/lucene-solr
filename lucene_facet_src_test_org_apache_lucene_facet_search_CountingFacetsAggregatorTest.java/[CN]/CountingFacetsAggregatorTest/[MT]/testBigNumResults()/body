{
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=newSearcher(indexReader);
  FacetSearchParams fsp=new FacetSearchParams(new CountFacetRequest(CP_A,Integer.MAX_VALUE),new CountFacetRequest(CP_B,Integer.MAX_VALUE));
  FacetsCollector fc=FacetsCollector.create(randomAccumulator(fsp,indexReader,taxoReader));
  searcher.search(new MatchAllDocsQuery(),fc);
  List<FacetResult> facetResults=fc.getFacetResults();
  assertEquals("invalid number of facet results",2,facetResults.size());
  for (  FacetResult res : facetResults) {
    FacetResultNode root=res.getFacetResultNode();
    assertEquals("wrong count for " + root.label,allExpectedCounts.get(root.label),(int)root.value);
    for (    FacetResultNode child : root.subResults) {
      assertEquals("wrong count for " + child.label,allExpectedCounts.get(child.label),(int)child.value);
    }
  }
  IOUtils.close(indexReader,taxoReader);
}
