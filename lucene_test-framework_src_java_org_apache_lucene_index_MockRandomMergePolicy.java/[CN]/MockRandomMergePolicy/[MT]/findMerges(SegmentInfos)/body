{
  MergeSpecification mergeSpec=null;
  int numSegments=segmentInfos.size();
  List<SegmentInfoPerCommit> segments=new ArrayList<SegmentInfoPerCommit>();
  final Collection<SegmentInfoPerCommit> merging=writer.get().getMergingSegments();
  for (  SegmentInfoPerCommit sipc : segmentInfos) {
    if (!merging.contains(sipc)) {
      segments.add(sipc);
    }
  }
  numSegments=segments.size();
  if (numSegments > 1 && (numSegments > 30 || random.nextInt(5) == 3)) {
    Collections.shuffle(segments,random);
    mergeSpec=new MergeSpecification();
    final int segsToMerge=_TestUtil.nextInt(random,1,numSegments);
    mergeSpec.add(new OneMerge(segments.subList(0,segsToMerge)));
  }
  return mergeSpec;
}
