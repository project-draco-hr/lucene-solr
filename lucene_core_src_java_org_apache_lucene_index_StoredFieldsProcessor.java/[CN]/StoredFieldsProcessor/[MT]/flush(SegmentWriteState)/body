{
  int numDocs=state.segmentInfo.getDocCount();
  if (numDocs > 0) {
    initFieldsWriter(state.context);
    fill(numDocs);
  }
  if (fieldsWriter != null) {
    boolean success=false;
    try {
      fieldsWriter.finish(state.fieldInfos,numDocs);
      success=true;
    }
  finally {
      if (success) {
        IOUtils.close(fieldsWriter);
      }
 else {
        IOUtils.closeWhileHandlingException(fieldsWriter);
      }
    }
  }
}
