{
  grow((int)Math.min(Integer.MAX_VALUE,iter.cost()));
  if (bitSet != null) {
    bitSet.or(iter);
  }
 else {
    while (true) {
      final int end=Math.min(threshold,buffer.length);
      for (int i=bufferSize; i < end; ++i) {
        final int doc=iter.nextDoc();
        if (doc == DocIdSetIterator.NO_MORE_DOCS) {
          bufferSize=i;
          return;
        }
        buffer[bufferSize++]=doc;
      }
      bufferSize=end;
      if (bufferSize + 1 >= threshold) {
        break;
      }
      buffer=ArrayUtil.grow(buffer,bufferSize + 1);
    }
    upgradeToBitSet();
    for (int doc=iter.nextDoc(); doc != DocIdSetIterator.NO_MORE_DOCS; doc=iter.nextDoc()) {
      bitSet.set(doc);
    }
  }
}
