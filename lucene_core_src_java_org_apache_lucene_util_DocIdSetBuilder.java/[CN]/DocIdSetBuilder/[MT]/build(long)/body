{
  try {
    if (bitSet != null) {
      if (costHint == -1) {
        return new BitDocIdSet(bitSet);
      }
 else {
        return new BitDocIdSet(bitSet,costHint);
      }
    }
 else {
      LSBRadixSorter sorter=new LSBRadixSorter();
      sorter.sort(buffer,0,bufferSize);
      final int l=dedup(buffer,bufferSize);
      buffer=ArrayUtil.grow(buffer,l + 1);
      buffer[l]=DocIdSetIterator.NO_MORE_DOCS;
      return new IntArrayDocIdSet(buffer,l);
    }
  }
  finally {
    this.buffer=null;
    this.bufferSize=0;
    this.bitSet=null;
  }
}
