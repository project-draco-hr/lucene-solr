{
  Path lockDir=dir.getDirectory();
  Files.createDirectories(lockDir);
  Path lockFile=lockDir.resolve(lockName);
  try {
    Files.createFile(lockFile);
  }
 catch (  FileAlreadyExistsException|AccessDeniedException e) {
    throw new LockObtainFailedException("Lock held elsewhere: " + lockFile,e);
  }
  final FileTime creationTime=Files.readAttributes(lockFile,BasicFileAttributes.class).creationTime();
  return new SimpleFSLock(lockFile,creationTime);
}
