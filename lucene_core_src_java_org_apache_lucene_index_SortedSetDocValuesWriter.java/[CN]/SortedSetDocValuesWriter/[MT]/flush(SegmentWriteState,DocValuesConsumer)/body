{
  final int valueCount=hash.size();
  final PackedLongValues ords=pending.build();
  final PackedLongValues ordCounts=pendingCounts.build();
  final int[] sortedValues=hash.sort();
  final int[] ordMap=new int[valueCount];
  for (int ord=0; ord < valueCount; ord++) {
    ordMap[sortedValues[ord]]=ord;
  }
  dvConsumer.addSortedSetField(fieldInfo,new EmptyDocValuesProducer(){
    @Override public SortedSetDocValues getSortedSet(    FieldInfo fieldInfoIn){
      if (fieldInfoIn != fieldInfo) {
        throw new IllegalArgumentException("wrong fieldInfo");
      }
      return new BufferedSortedSetDocValues(sortedValues,ordMap,hash,ords,ordCounts,maxCount,docsWithField);
    }
  }
);
}
