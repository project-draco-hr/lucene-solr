{
  Object o=map.get(name);
  if (o == null) {
    throw new IllegalArgumentException("Invalid reference '" + name + "'");
  }
 else   if (o instanceof Expression) {
    return ((Expression)o).getValueSource(this);
  }
  SortField field=(SortField)o;
switch (field.getType()) {
case INT:
    return new IntFieldSource(field.getField(),(IntParser)field.getParser());
case LONG:
  return new LongFieldSource(field.getField(),(LongParser)field.getParser());
case FLOAT:
return new FloatFieldSource(field.getField(),(FloatParser)field.getParser());
case DOUBLE:
return new DoubleFieldSource(field.getField(),(DoubleParser)field.getParser());
case SCORE:
return new ScoreValueSource();
default :
throw new UnsupportedOperationException();
}
}
