{
  final Set already=new HashSet();
  List top=new LinkedList();
  final String field=(f == null) ? "contents" : f;
  if (a == null)   a=new StandardAnalyzer(Version.LUCENE_CURRENT);
  TokenStream ts=a.tokenStream(field,new StringReader(query));
  TermAttribute termAtt=ts.addAttribute(TermAttribute.class);
  while (ts.incrementToken()) {
    String word=termAtt.term();
    if (already.add(word))     top.add(word);
  }
  final BooleanQuery tmp=new BooleanQuery();
  Iterator it=top.iterator();
  while (it.hasNext()) {
    String word=(String)it.next();
    TermQuery tq=new TermQuery(new Term(field,word));
    tmp.add(tq,BooleanClause.Occur.SHOULD);
    syns.search(new TermQuery(new Term(Syns2Index.F_WORD,word)),new Collector(){
      IndexReader reader;
      @Override public boolean acceptsDocsOutOfOrder(){
        return true;
      }
      @Override public void collect(      int doc) throws IOException {
        Document d=reader.document(doc);
        String[] values=d.getValues(Syns2Index.F_SYN);
        for (int j=0; j < values.length; j++) {
          String syn=values[j];
          if (already.add(syn)) {
            TermQuery tq=new TermQuery(new Term(field,syn));
            if (boost > 0)             tq.setBoost(boost);
            tmp.add(tq,BooleanClause.Occur.SHOULD);
          }
        }
      }
      @Override public void setNextReader(      IndexReader reader,      int docBase) throws IOException {
        this.reader=reader;
      }
      @Override public void setScorer(      Scorer scorer) throws IOException {
      }
    }
);
  }
  return tmp;
}
