{
  Collection<Token> result=new ArrayList<Token>();
  TokenStream ts=analyzer.reusableTokenStream("",new StringReader(q));
  ts.reset();
  TermAttribute termAtt=(TermAttribute)ts.addAttribute(TermAttribute.class);
  OffsetAttribute offsetAtt=(OffsetAttribute)ts.addAttribute(OffsetAttribute.class);
  TypeAttribute typeAtt=(TypeAttribute)ts.addAttribute(TypeAttribute.class);
  FlagsAttribute flagsAtt=(FlagsAttribute)ts.addAttribute(FlagsAttribute.class);
  PayloadAttribute payloadAtt=(PayloadAttribute)ts.addAttribute(PayloadAttribute.class);
  PositionIncrementAttribute posIncAtt=(PositionIncrementAttribute)ts.addAttribute(PositionIncrementAttribute.class);
  while (ts.incrementToken()) {
    Token token=new Token();
    token.setTermBuffer(termAtt.termBuffer(),0,termAtt.termLength());
    token.setOffset(offsetAtt.startOffset(),offsetAtt.endOffset());
    token.setType(typeAtt.type());
    token.setFlags(flagsAtt.getFlags());
    token.setPayload(payloadAtt.getPayload());
    token.setPositionIncrement(posIncAtt.getPositionIncrement());
    result.add(token);
  }
  return result;
}
