{
  Fields fields=segState.reader.fields();
  String currentField=null;
  TermsEnum termsEnum=null;
  PostingsEnum postingsEnum=null;
  for (  DocValuesUpdate update : updates) {
    Term term=update.term;
    int limit=update.docIDUpto;
    if (!term.field().equals(currentField)) {
      currentField=term.field();
      Terms terms=fields.terms(currentField);
      if (terms != null) {
        termsEnum=terms.iterator();
      }
 else {
        termsEnum=null;
      }
    }
    if (termsEnum == null) {
      continue;
    }
    if (termsEnum.seekExact(term.bytes())) {
      final Bits acceptDocs=segState.rld.getLiveDocs();
      postingsEnum=termsEnum.postings(postingsEnum,PostingsEnum.NONE);
      DocValuesFieldUpdates dvUpdates=dvUpdatesContainer.getUpdates(update.field,update.type);
      if (dvUpdates == null) {
        dvUpdates=dvUpdatesContainer.newUpdates(update.field,update.type,segState.reader.maxDoc());
      }
      int doc;
      while ((doc=postingsEnum.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
        if (doc >= limit) {
          break;
        }
        if (acceptDocs != null && acceptDocs.get(doc) == false) {
          continue;
        }
        dvUpdates.add(doc,update.value);
      }
    }
  }
}
