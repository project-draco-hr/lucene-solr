{
  Map<String,Long> results=new HashMap<String,Long>();
  DocCollection collectionState=cluster.getSolrClient().getZkStateReader().getClusterState().getCollection(COLLECTION);
  for (  Replica replica : collectionState.getReplicas()) {
    String coreName=replica.getCoreName();
    try (HttpSolrClient client=getHttpSolrClient(replica.getCoreUrl())){
      ModifiableSolrParams params=new ModifiableSolrParams();
      params.set("command","indexversion");
      params.set("_trace","getIndexVersion");
      params.set("qt",ReplicationHandler.PATH);
      QueryRequest req=new QueryRequest(params);
      NamedList<Object> res=client.request(req);
      assertNotNull("null response from server: " + coreName,res);
      Object version=res.get("indexversion");
      assertNotNull("null version from server: " + coreName,version);
      assertTrue("version isn't a long: " + coreName,version instanceof Long);
      results.put(coreName,(Long)version);
      long numDocs=client.query(params("q","*:*","distrib","false","rows","0","_trace","counting_docs")).getResults().getNumFound();
      log.info("core=" + coreName + "; ver="+ version+ "; numDocs="+ numDocs);
    }
   }
  return results;
}
