{
  try {
    searcher=new IndexSearcher(IndexReader.open(collection));
    Analyzer analyzer=new StopAnalyzer();
    try {
      query=QueryParser.parse(criteria,"contents",analyzer);
      hits=searcher.search(query);
      hitCount=new Integer(hits.length()).toString();
      HITCOUNT=hits.length();
      PAGECOUNT=PAGECOUNT=(int)(((double)startRow) / maxRows);
      pageCount=new Integer(PAGECOUNT).toString();
      thispage=maxRows;
      if ((startRow + maxRows) > hits.length()) {
        thispage=hits.length() - startRow;
      }
      hitArray=new ArrayList();
      for (int i=startRow; i < (thispage + startRow); i++) {
        hitMap=new HashMap();
        Document doc=hits.doc(i);
        hitMap.put("score",new Float(hits.score(i)).toString());
        fields=doc.fields();
        while (fields.hasMoreElements()) {
          Field field=(Field)fields.nextElement();
          String fieldName=field.name();
          hitMap.put(fieldName,doc.get(fieldName));
        }
        hitArray.add(hitMap);
      }
    }
 catch (    Exception e) {
      throw new JspException("An error occurred while parsing the index : " + e.toString());
    }
  }
 catch (  Exception e) {
    throw new JspException("An error occurred while trying to open the search index: " + e.toString());
  }
}
