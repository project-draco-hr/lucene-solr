{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMaxBufferedDocs(2).setRAMBufferSizeMB(IndexWriterConfig.DISABLE_AUTO_FLUSH).setMergePolicy(newLogMergePolicy(50)));
  FieldType customType=new FieldType();
  customType.setStored(true);
  FieldType customType1=new FieldType(TextField.TYPE_UNSTORED);
  customType1.setTokenized(false);
  customType1.setStoreTermVectors(true);
  customType1.setStoreTermVectorPositions(true);
  customType1.setStoreTermVectorOffsets(true);
  Document document=new Document();
  Field storedField=newField("stored","stored",customType);
  document.add(storedField);
  Field termVectorField=newField("termVector","termVector",customType1);
  document.add(termVectorField);
  for (int i=0; i < 98; i++)   writer.addDocument(document);
  writer.close();
  IndexReader ir=IndexReader.open(dir,false);
  assertEquals(98,ir.maxDoc());
  assertEquals(98,ir.numDocs());
  for (int i=0; i < 98; i+=2)   ir.deleteDocument(i);
  assertEquals(49,ir.numDocs());
  ir.close();
  writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMergePolicy(newLogMergePolicy(3)));
  writer.expungeDeletes(false);
  writer.close();
  ir=IndexReader.open(dir,true);
  assertEquals(49,ir.maxDoc());
  assertEquals(49,ir.numDocs());
  ir.close();
  dir.close();
}
