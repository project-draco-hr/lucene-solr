{
  clearAttributes();
  if (useOldAPI)   return incrementTokenOld();
  int length=0;
  int start=bufferIndex;
  char[] buffer=termAtt.termBuffer();
  while (true) {
    if (bufferIndex >= dataLen) {
      offset+=dataLen;
      if (!charUtils.fill(ioBuffer,input)) {
        dataLen=0;
        if (length > 0)         break;
 else         return false;
      }
      dataLen=ioBuffer.getLength();
      bufferIndex=0;
    }
    final int c=charUtils.codePointAt(ioBuffer.getBuffer(),bufferIndex);
    bufferIndex+=Character.charCount(c);
    if (isTokenChar(c)) {
      if (length == 0)       start=offset + bufferIndex - 1;
 else       if (length >= buffer.length - 1)       buffer=termAtt.resizeTermBuffer(2 + length);
      length+=Character.toChars(normalize(c),buffer,length);
      if (length >= MAX_WORD_LEN)       break;
    }
 else     if (length > 0)     break;
  }
  termAtt.setTermLength(length);
  offsetAtt.setOffset(correctOffset(start),correctOffset(start + length));
  return true;
}
