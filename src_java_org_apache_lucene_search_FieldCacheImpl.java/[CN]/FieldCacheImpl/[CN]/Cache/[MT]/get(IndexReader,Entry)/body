{
  Map innerCache;
  Object value;
  final Object readerKey=reader.getFieldCacheKey();
synchronized (readerCache) {
    innerCache=(Map)readerCache.get(readerKey);
    if (innerCache == null) {
      innerCache=new HashMap();
      readerCache.put(readerKey,innerCache);
      value=null;
    }
 else {
      value=innerCache.get(key);
    }
    if (value == null) {
      value=new CreationPlaceholder();
      innerCache.put(key,value);
    }
  }
  if (value instanceof CreationPlaceholder) {
synchronized (value) {
      CreationPlaceholder progress=(CreationPlaceholder)value;
      if (progress.value == null) {
        progress.value=createValue(reader,key);
synchronized (readerCache) {
          innerCache.put(key,progress.value);
        }
      }
      return progress.value;
    }
  }
  return value;
}
