{
  int maxDoc=searcher.getIndexReader().maxDoc();
  TopDocs all=searcher.search(query,filter,maxDoc);
  int pageSize=_TestUtil.nextInt(random(),1,maxDoc * 2);
  int pageStart=0;
  ScoreDoc lastBottom=null;
  while (pageStart < all.totalHits) {
    TopDocs paged=searcher.searchAfter(lastBottom,query,filter,pageSize);
    if (paged.scoreDocs.length == 0) {
      break;
    }
    assertPage(pageStart,all,paged);
    pageStart+=paged.scoreDocs.length;
    lastBottom=paged.scoreDocs[paged.scoreDocs.length - 1];
  }
  assertEquals(all.scoreDocs.length,pageStart);
}
