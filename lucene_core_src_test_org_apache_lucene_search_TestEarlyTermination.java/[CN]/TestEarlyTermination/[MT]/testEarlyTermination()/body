{
  final int iters=atLeast(5);
  final IndexReader reader=writer.getReader();
  for (int i=0; i < iters; ++i) {
    final IndexSearcher searcher=newSearcher(reader);
    final Collector collector=new SimpleCollector(){
      final boolean outOfOrder=random().nextBoolean();
      boolean collectionTerminated=true;
      @Override public void collect(      int doc) throws IOException {
        assertFalse(collectionTerminated);
        if (rarely()) {
          collectionTerminated=true;
          throw new CollectionTerminatedException();
        }
      }
      @Override protected void doSetNextReader(      AtomicReaderContext context) throws IOException {
        if (random().nextBoolean()) {
          collectionTerminated=true;
          throw new CollectionTerminatedException();
        }
 else {
          collectionTerminated=false;
        }
      }
      @Override public boolean acceptsDocsOutOfOrder(){
        return outOfOrder;
      }
    }
;
    searcher.search(new MatchAllDocsQuery(),collector);
  }
  reader.close();
}
