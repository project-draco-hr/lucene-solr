{
  try {
    new RegExp(regexp).toAutomaton();
  }
 catch (  Exception e) {
    return;
  }
  if (!UnicodeUtil.validUTF16String(regexp))   return;
  RegexpQuery smart=new RegexpQuery(new Term("field",regexp));
  DumbRegexpQuery dumb=new DumbRegexpQuery(new Term("field",regexp));
  if (!(smart.getTermsEnum(searcher.getIndexReader()) instanceof AutomatonTermsEnum))   return;
  TopDocs smartDocs=searcher.search(smart,25);
  TopDocs dumbDocs=searcher.search(dumb,25);
  assertEquals(dumbDocs.totalHits,smartDocs.totalHits);
}
