{
  if (jetty != null) {
    try {
      String url="http://localhost:" + port + context;
      HttpSolrServer s=new HttpSolrServer(url);
      s.setConnectionTimeout(DEFAULT_CONNECTION_TIMEOUT);
      s.setDefaultMaxConnectionsPerHost(100);
      s.setMaxTotalConnections(100);
      return s;
    }
 catch (    Exception ex) {
      throw new RuntimeException(ex);
    }
  }
 else {
    return new EmbeddedSolrServer(h.getCoreContainer(),"");
  }
}
