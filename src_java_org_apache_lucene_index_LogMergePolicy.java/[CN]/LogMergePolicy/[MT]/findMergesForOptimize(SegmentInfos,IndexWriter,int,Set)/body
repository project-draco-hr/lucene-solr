{
  MergeSpecification spec;
  if (!isOptimized(infos,writer,maxNumSegments,segmentsToOptimize)) {
    int numSegments=infos.size();
    while (numSegments > 0) {
      final SegmentInfo info=infos.info(--numSegments);
      if (segmentsToOptimize.contains(info)) {
        numSegments++;
        break;
      }
    }
    if (numSegments > 0) {
      spec=new MergeSpecification();
      while (numSegments > 0) {
        final int first;
        if (numSegments > mergeFactor)         first=numSegments - mergeFactor;
 else         first=0;
        if (numSegments > 1 || !isOptimized(writer,infos.info(0)))         spec.add(new OneMerge(infos.range(first,numSegments),useCompoundFile));
        numSegments-=mergeFactor;
      }
    }
 else     spec=null;
  }
 else   spec=null;
  return spec;
}
