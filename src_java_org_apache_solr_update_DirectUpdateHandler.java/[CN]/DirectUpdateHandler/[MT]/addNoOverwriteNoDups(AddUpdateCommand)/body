{
  if (cmd.id == null) {
    cmd.id=getId(cmd.doc);
  }
synchronized (this) {
    if (existsInIndex(cmd.id))     return 0;
    doAdd(cmd.doc);
  }
  return 1;
}
