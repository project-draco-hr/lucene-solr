{
  if (!cmd.fromPending && !cmd.fromCommitted)   throw new SolrException(400,"meaningless command: " + cmd);
  if (!cmd.fromPending || !cmd.fromCommitted)   throw new SolrException(400,"operation not supported" + cmd);
  Query q=QueryParsing.parseQuery(cmd.query,schema);
  int totDeleted=0;
synchronized (this) {
    closeWriter();
    openSearcher();
    final DeleteHitCollector deleter=new DeleteHitCollector(searcher);
    searcher.search(q,null,deleter);
    totDeleted=deleter.deleted;
  }
  if (SolrCore.log.isLoggable(Level.FINE)) {
    SolrCore.log.fine("docs deleted:" + totDeleted);
  }
}
