{
  if (isCancelled)   return;
  String collectionName=core.getCoreDescriptor().getCloudDescriptor().getCollectionName();
  String shard=core.getCoreDescriptor().getCloudDescriptor().getShardId();
  log.debug("The leader state has changed: {} @ {}:{}",event,collectionName,shard);
  if (Event.EventType.None.equals(event.getType())) {
    return;
  }
  try {
    log.info("Received new leader state @ {}:{}",collectionName,shard);
    SolrZkClient zkClient=core.getCoreDescriptor().getCoreContainer().getZkController().getZkClient();
    ClusterState clusterState=core.getCoreDescriptor().getCoreContainer().getZkController().getClusterState();
    if (CdcrLeaderStateManager.this.isLeaderRegistered(zkClient,clusterState)) {
      CdcrLeaderStateManager.this.checkIfIAmLeader();
    }
  }
 catch (  KeeperException|InterruptedException e) {
    log.warn("Failed updating leader state and setting watch @ " + collectionName + ":"+ shard,e);
  }
}
