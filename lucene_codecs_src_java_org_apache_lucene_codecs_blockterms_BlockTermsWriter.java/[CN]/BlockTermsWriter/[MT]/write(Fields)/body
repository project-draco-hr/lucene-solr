{
  boolean success=false;
  try {
    for (    String field : fields) {
      Terms terms=fields.terms(field);
      if (terms == null) {
        continue;
      }
      TermsEnum termsEnum=terms.iterator(null);
      TermsWriter termsWriter=addField(fieldInfos.fieldInfo(field));
      while (true) {
        BytesRef term=termsEnum.next();
        if (term == null) {
          break;
        }
        termsWriter.write(term,termsEnum);
      }
      termsWriter.finish();
    }
    success=true;
  }
  finally {
    if (success) {
      IOUtils.close(this);
    }
 else {
      IOUtils.closeWhileHandlingException(this);
    }
  }
}
