{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,conf);
  for (int i=0; i < numDocs; i++) {
    Document doc=new Document();
    final int numFields=1 + random.nextInt(fieldNames.length);
    for (int j=0; j < numFields; j++) {
      FieldType customType=new FieldType();
      customType.setIndexed(true);
      customType.setTokenized(random.nextBoolean());
      customType.setOmitNorms(random.nextBoolean());
      doc.add(newField(fieldNames[random.nextInt(fieldNames.length)],_TestUtil.randomRealisticUnicodeString(random),customType));
    }
    writer.addDocument(doc);
    if (random.nextInt(20) == 0) {
      writer.commit();
    }
  }
  writer.close();
  return dir;
}
