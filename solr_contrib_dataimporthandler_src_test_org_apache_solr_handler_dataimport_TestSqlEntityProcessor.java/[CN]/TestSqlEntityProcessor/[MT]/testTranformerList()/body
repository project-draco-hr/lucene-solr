{
  EntityProcessor sep=new EntityProcessorWrapper(new SqlEntityProcessor(),null);
  List<Map<String,Object>> rows=getRows(2);
  VariableResolverImpl vr=new VariableResolverImpl();
  HashMap<String,String> ea=new HashMap<String,String>();
  ea.put("query","SELECT * FROM A");
  ea.put("transformer",T2.class.getName());
  sep.init(getContext(null,vr,getDs(rows),Context.FULL_DUMP,null,ea));
  local.set(0);
  Map<String,Object> r=null;
  int count=0;
  while (true) {
    r=sep.nextRow();
    if (r == null)     break;
    count++;
  }
  assertEquals(2,(int)local.get());
  assertEquals(4,count);
}
