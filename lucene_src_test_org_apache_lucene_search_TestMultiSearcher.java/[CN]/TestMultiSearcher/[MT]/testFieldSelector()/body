{
  MockRAMDirectory ramDirectory1, ramDirectory2;
  IndexSearcher indexSearcher1, indexSearcher2;
  ramDirectory1=newDirectory(random);
  ramDirectory2=newDirectory(random);
  Query query=new TermQuery(new Term("contents","doc0"));
  initIndex(random,ramDirectory1,10,true,null);
  initIndex(random,ramDirectory2,10,true,"x");
  indexSearcher1=new IndexSearcher(ramDirectory1,true);
  indexSearcher2=new IndexSearcher(ramDirectory2,true);
  MultiSearcher searcher=getMultiSearcherInstance(new Searcher[]{indexSearcher1,indexSearcher2});
  assertTrue("searcher is null and it shouldn't be",searcher != null);
  ScoreDoc[] hits=searcher.search(query,null,1000).scoreDocs;
  assertTrue("hits is null and it shouldn't be",hits != null);
  assertTrue(hits.length + " does not equal: " + 2,hits.length == 2);
  Document document=searcher.doc(hits[0].doc);
  assertTrue("document is null and it shouldn't be",document != null);
  assertTrue("document.getFields() Size: " + document.getFields().size() + " is not: "+ 2,document.getFields().size() == 2);
  Set<String> ftl=new HashSet<String>();
  ftl.add("other");
  SetBasedFieldSelector fs=new SetBasedFieldSelector(ftl,Collections.<String>emptySet());
  document=searcher.doc(hits[0].doc,fs);
  assertTrue("document is null and it shouldn't be",document != null);
  assertTrue("document.getFields() Size: " + document.getFields().size() + " is not: "+ 1,document.getFields().size() == 1);
  String value=document.get("contents");
  assertTrue("value is not null and it should be",value == null);
  value=document.get("other");
  assertTrue("value is null and it shouldn't be",value != null);
  ftl.clear();
  ftl.add("contents");
  fs=new SetBasedFieldSelector(ftl,Collections.<String>emptySet());
  document=searcher.doc(hits[1].doc,fs);
  value=document.get("contents");
  assertTrue("value is null and it shouldn't be",value != null);
  value=document.get("other");
  assertTrue("value is not null and it should be",value == null);
  indexSearcher1.close();
  indexSearcher2.close();
  ramDirectory1.close();
  ramDirectory2.close();
}
