{
  IOContext context=newIOContext(random());
  SegmentReader r1=new SegmentReader(si1,DirectoryReader.DEFAULT_TERMS_INDEX_DIVISOR,context);
  SegmentReader r2=new SegmentReader(si2,DirectoryReader.DEFAULT_TERMS_INDEX_DIVISOR,context);
  final Codec codec=Codec.getDefault();
  SegmentMerger merger=new SegmentMerger(InfoStream.getDefault(),si1.dir,IndexWriterConfig.DEFAULT_TERM_INDEX_INTERVAL,merged,MergeState.CheckAbort.NONE,null,new FieldInfos.Builder(),codec,context);
  merger.add(r1);
  merger.add(r2);
  MergeState mergeState=merger.merge();
  r1.close();
  r2.close();
  final SegmentInfo info=new SegmentInfo(si1.dir,Constants.LUCENE_MAIN_VERSION,merged,si1.docCount + si2.docCount,-1,merged,false,null,false,0,codec,null);
  if (useCompoundFile) {
    Collection<String> filesToDelete=IndexWriter.createCompoundFile(dir,merged + ".cfs",MergeState.CheckAbort.NONE,info,newIOContext(random()));
    info.setUseCompoundFile(true);
    for (    final String fileToDelete : filesToDelete) {
      si1.dir.deleteFile(fileToDelete);
    }
  }
  return info;
}
