{
  Directory dir=newDirectory();
  IndexWriterConfig config=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  config.setSimilarity(new PackedNormSimilarity());
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir,config);
  int num=_TestUtil.nextInt(random(),1,1000);
  for (int i=0; i < num; i++) {
    Document doc=new Document();
    doc.add(new StringField("len",Integer.toString(i),Field.Store.YES));
    StringBuilder sb=new StringBuilder();
    for (int j=0; j < i; j++) {
      sb.append(" token");
    }
    doc.add(new TextField("content",sb.toString(),Field.Store.NO));
    writer.addDocument(doc);
  }
  DirectoryReader ir=writer.getReader();
  writer.close();
  for (  AtomicReaderContext context : ir.leaves()) {
    AtomicReader reader=context.reader();
    DocValues norms=reader.normValues("content");
    assertNotNull(norms);
    Source source=norms.getSource();
    assertEquals(Type.VAR_INTS,source.getType());
    for (int i=0; i < reader.maxDoc(); i++) {
      assertEquals(source.getInt(i),Long.parseLong(reader.document(i).get("len")));
    }
  }
  ir.close();
  dir.close();
}
