{
  MockDirectoryWrapper dir=newDirectory();
  dir.setCheckIndexOnClose(false);
  IndexWriterConfig config=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  Similarity provider=new MySimProvider();
  config.setSimilarity(provider);
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir,config);
  final LineFileDocs docs=new LineFileDocs(random());
  int num=atLeast(100);
  try {
    for (int i=0; i < num; i++) {
      Document doc=docs.nextDoc();
      float nextFloat=random().nextFloat();
      Field f=new Field(exceptionTestField,"" + nextFloat,TextField.TYPE_STORED);
      f.setBoost(nextFloat);
      doc.add(f);
      writer.addDocument(doc);
      doc.removeField(exceptionTestField);
      if (rarely()) {
        writer.commit();
      }
    }
    fail("expected exception - incompatible types");
  }
 catch (  IllegalArgumentException e) {
  }
  writer.commit();
  writer.close();
  dir.close();
}
