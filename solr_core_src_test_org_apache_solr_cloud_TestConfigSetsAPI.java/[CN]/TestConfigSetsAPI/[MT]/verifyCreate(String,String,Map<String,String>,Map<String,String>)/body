{
  final SolrClient solrClient=new HttpSolrClient(solrCluster.getJettySolrRunners().get(0).getBaseUrl().toString());
  setupBaseConfigSet(baseConfigSetName,oldProps);
  SolrZkClient zkClient=new SolrZkClient(solrCluster.getZkServer().getZkAddress(),AbstractZkTestCase.TIMEOUT,AbstractZkTestCase.TIMEOUT,null);
  try {
    ZkConfigManager configManager=new ZkConfigManager(zkClient);
    assertFalse(configManager.configExists(configSetName));
    Create create=new Create();
    create.setBaseConfigSetName(baseConfigSetName).setConfigSetName(configSetName);
    if (newProps != null) {
      Properties p=new Properties();
      p.putAll(newProps);
      create.setNewConfigSetProperties(p);
    }
    ConfigSetAdminResponse response=create.process(solrClient);
    assertNotNull(response.getResponse());
    assertTrue(configManager.configExists(configSetName));
    verifyProperties(configSetName,oldProps,newProps,zkClient);
  }
  finally {
    zkClient.close();
  }
  solrClient.close();
}
