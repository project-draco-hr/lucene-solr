{
  NamedList nl=new NamedList();
  NamedList params=solrParamsToNamedList(updateRequest.getParams());
  if (updateRequest.getCommitWithin() != -1) {
    params.add("commitWithin",updateRequest.getCommitWithin());
  }
  Iterator<SolrInputDocument> docIter=null;
  if (updateRequest.getDocIterator() != null) {
    docIter=updateRequest.getDocIterator();
  }
  Map<SolrInputDocument,Map<String,Object>> docMap=updateRequest.getDocumentsMap();
  nl.add("params",params);
  if (updateRequest.getDeleteByIdMap() != null) {
    nl.add("delByIdMap",updateRequest.getDeleteByIdMap());
  }
  nl.add("delByQ",updateRequest.getDeleteQuery());
  if (docMap != null) {
    nl.add("docsMap",docMap.entrySet().iterator());
  }
 else {
    if (updateRequest.getDocuments() != null) {
      docIter=updateRequest.getDocuments().iterator();
    }
    nl.add("docs",docIter);
  }
  JavaBinCodec codec=new JavaBinCodec();
  codec.marshal(nl,os);
}
