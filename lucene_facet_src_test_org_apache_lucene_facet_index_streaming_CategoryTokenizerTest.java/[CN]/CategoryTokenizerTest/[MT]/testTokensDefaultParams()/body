{
  Directory directory=newDirectory();
  TaxonomyWriter taxonomyWriter=new DirectoryTaxonomyWriter(directory);
  FacetIndexingParams indexingParams=FacetIndexingParams.ALL_PARENTS;
  CategoryTokenizer tokenizer=new CategoryTokenizer(new CategoryAttributesStream(categoryContainer),indexingParams);
  Set<String> categoryTerms=new HashSet<String>();
  for (int i=0; i < initialCatgeories.length; i++) {
    categoryTerms.add(initialCatgeories[i].toString(indexingParams.getFacetDelimChar()));
  }
  int nTokens;
  for (nTokens=0; tokenizer.incrementToken(); nTokens++) {
    if (!categoryTerms.remove(tokenizer.termAttribute.toString())) {
      fail("Unexpected term: " + tokenizer.termAttribute.toString());
    }
  }
  assertTrue("all category terms should have been found",categoryTerms.isEmpty());
  assertEquals("Wrong number of tokens",3,nTokens);
  taxonomyWriter.close();
  directory.close();
}
