{
  OutputStream out=null;
  try {
    File f=new File(tempfile);
    f.deleteOnExit();
    char lastChar=tempfile.charAt(tempfile.length() - 1);
    if (f.isDirectory() || lastChar == '\\' || lastChar == '/')     f.mkdirs();
 else {
      File parent=f.getParentFile();
      parent.deleteOnExit();
      parent.mkdirs();
      out=new FileOutputStream(tempfile);
      transferData(in,out);
    }
  }
  finally {
    if (out != null)     out.close();
  }
}
