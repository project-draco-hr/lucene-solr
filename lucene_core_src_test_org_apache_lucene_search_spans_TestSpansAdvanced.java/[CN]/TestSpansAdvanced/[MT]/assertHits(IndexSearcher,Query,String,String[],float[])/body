{
  QueryUtils.check(random(),query,s);
  final float tolerance=1e-5f;
  TopDocs topdocs=s.search(query,10000);
  assertEquals(expectedIds.length,topdocs.totalHits);
  for (int i=0; i < topdocs.totalHits; i++) {
    int id=topdocs.scoreDocs[i].doc;
    float score=topdocs.scoreDocs[i].score;
    StoredDocument doc=s.doc(id);
    assertEquals(expectedIds[i],doc.get(FIELD_ID));
    boolean scoreEq=Math.abs(expectedScores[i] - score) < tolerance;
    if (!scoreEq) {
      System.out.println(i + " warning, expected score: " + expectedScores[i]+ ", actual "+ score);
      System.out.println(s.explain(query,id));
    }
    assertEquals(expectedScores[i],score,tolerance);
    assertEquals(s.explain(query,id).getValue(),score,tolerance);
  }
}
