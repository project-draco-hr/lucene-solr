{
  Directory dir1=getAssertNoDeletesDirectory(newDirectory());
  IndexWriter writer=new IndexWriter(dir1,newIndexWriterConfig(new MockAnalyzer(random())));
  createIndexNoClose(false,"test",writer);
  DirectoryReader r=writer.getReader();
  writer.close();
  TestUtil.checkIndex(dir1);
  assertEquals(100,r.numDocs());
  Query q=new TermQuery(new Term("indexname","test"));
  IndexSearcher searcher=newSearcher(r);
  assertEquals(100,searcher.search(q,10).totalHits);
  try {
    DirectoryReader.openIfChanged(r);
    fail("failed to hit AlreadyClosedException");
  }
 catch (  AlreadyClosedException ace) {
  }
  r.close();
  dir1.close();
}
