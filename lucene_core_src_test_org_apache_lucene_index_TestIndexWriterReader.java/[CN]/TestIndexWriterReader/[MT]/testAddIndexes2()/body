{
  boolean doFullMerge=false;
  Directory dir1=getAssertNoDeletesDirectory(newDirectory());
  IndexWriter writer=new IndexWriter(dir1,newIndexWriterConfig(new MockAnalyzer(random())));
  Directory dir2=newDirectory();
  IndexWriter writer2=new IndexWriter(dir2,newIndexWriterConfig(new MockAnalyzer(random())));
  createIndexNoClose(!doFullMerge,"index2",writer2);
  writer2.shutdown();
  writer.addIndexes(dir2);
  writer.addIndexes(dir2);
  writer.addIndexes(dir2);
  writer.addIndexes(dir2);
  writer.addIndexes(dir2);
  IndexReader r1=writer.getReader();
  assertEquals(500,r1.maxDoc());
  r1.close();
  writer.shutdown();
  dir1.close();
  dir2.close();
}
