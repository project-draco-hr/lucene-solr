{
  Directory dir1=getAssertNoDeletesDirectory(newDirectory());
  MyWarmer warmer=new MyWarmer();
  IndexWriter writer=new IndexWriter(dir1,newIndexWriterConfig(new MockAnalyzer(random())).setMaxBufferedDocs(2).setMergedSegmentWarmer(warmer).setMergeScheduler(new ConcurrentMergeScheduler()).setMergePolicy(newLogMergePolicy()));
  createIndexNoClose(false,"test",writer);
  IndexReader r1=writer.getReader();
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setMergeFactor(2);
  int num=atLeast(100);
  for (int i=0; i < num; i++) {
    writer.addDocument(DocHelper.createDocument(i,"test",4));
  }
  ((ConcurrentMergeScheduler)writer.getConfig().getMergeScheduler()).sync();
  assertTrue(warmer.warmCount > 0);
  final int count=warmer.warmCount;
  writer.addDocument(DocHelper.createDocument(17,"test",4));
  writer.forceMerge(1);
  assertTrue(warmer.warmCount > count);
  writer.close();
  r1.close();
  dir1.close();
}
