{
  assumeFalse("PreFlex codec does not support ReaderTermsIndexDivisor!","Lucene3x".equals(Codec.getDefault().getName()));
  IndexWriterConfig conf=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random())).setReaderTermsIndexDivisor(-1);
  final String format=_TestUtil.getPostingsFormat("f");
  assumeFalse("Format: " + format + " does not support ReaderTermsIndexDivisor!",(format.equals("SimpleText") || format.equals("Memory")));
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,conf);
  Document doc=new Document();
  doc.add(new TextField("f","val"));
  w.addDocument(doc);
  IndexReader r=IndexReader.open(w,true).getSequentialSubReaders()[0];
  try {
    _TestUtil.docs(random(),r,"f",new BytesRef("val"),null,null,false);
    fail("should have failed to seek since terms index was not loaded.");
  }
 catch (  IllegalStateException e) {
  }
 finally {
    r.close();
    w.close();
    dir.close();
  }
}
