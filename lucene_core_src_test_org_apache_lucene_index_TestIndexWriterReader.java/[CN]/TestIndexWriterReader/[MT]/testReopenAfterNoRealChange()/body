{
  Directory d=getAssertNoDeletesDirectory(newDirectory());
  IndexWriter w=new IndexWriter(d,newIndexWriterConfig(new MockAnalyzer(random())));
  DirectoryReader r=w.getReader();
  DirectoryReader r2=DirectoryReader.openIfChanged(r);
  assertNull(r2);
  w.addDocument(new Document());
  DirectoryReader r3=DirectoryReader.openIfChanged(r);
  assertNotNull(r3);
  assertTrue(r3.getVersion() != r.getVersion());
  assertTrue(r3.isCurrent());
  w.deleteDocuments(new Term("foo","bar"));
  assertFalse(r3.isCurrent());
  DirectoryReader r4=DirectoryReader.openIfChanged(r3);
  assertNull(r4);
  w.deleteDocuments(new Term("foo","bar"));
  DirectoryReader r5=DirectoryReader.openIfChanged(r3,w);
  assertNull(r5);
  r3.close();
  w.close();
  d.close();
}
