{
  clearIndex();
  assertU(commit());
  assertU(adoc("id","1"));
  assertJQ(req("q","id:1"),"/response/numFound==0");
  assertJQ(req("qt","/get","id","1","fl","id"),"=={'doc':{'id':'1'}}");
  assertJQ(req("qt","/get","ids","1","fl","id"),"=={" + "  'response':{'numFound':1,'start':0,'docs':[" + "      {"+ "        'id':'1'}]"+ "  }}}");
  assertU(commit());
  assertJQ(req("q","id:1"),"/response/numFound==1");
  assertJQ(req("qt","/get","id","1","fl","id"),"=={'doc':{'id':'1'}}");
  assertJQ(req("qt","/get","ids","1","fl","id"),"=={" + "  'response':{'numFound':1,'start':0,'docs':[" + "      {"+ "        'id':'1'}]"+ "  }}}");
  assertU(delI("1"));
  assertJQ(req("q","id:1"),"/response/numFound==1");
  assertJQ(req("qt","/get","id","1"),"=={'doc':null}");
  assertJQ(req("qt","/get","ids","1"),"=={'response':{'numFound':0,'start':0,'docs':[]}}");
  assertU(adoc("id","10"));
  assertU(adoc("id","11"));
  assertJQ(req("qt","/get","id","10","fl","id"),"=={'doc':{'id':'10'}}");
  assertU(delQ("id:10 abcdef"));
  assertJQ(req("qt","/get","id","10"),"=={'doc':null}");
  assertJQ(req("qt","/get","id","11","fl","id"),"=={'doc':{'id':'11'}}");
  SolrQueryRequest req=req();
  RefCounted<SolrIndexSearcher> realtimeHolder=req.getCore().getRealtimeSearcher();
  assertU(adoc("id","12"));
  assertU(adoc("id","13"));
  assertJQ(req("qt","/get","id","11","fl","id","fqX","id:11"),"=={doc:{id:'11'}}");
  RefCounted<SolrIndexSearcher> realtimeHolder2=req.getCore().getRealtimeSearcher();
  assertEquals(realtimeHolder.get(),realtimeHolder2.get());
  realtimeHolder2.decref();
  assertJQ(req("qt","/get","id","12","fl","id","fq","id:11"),"=={doc:null}");
  assertJQ(req("qt","/get","id","12","fl","id","fq","id:13"),"=={doc:null}");
  assertJQ(req("qt","/get","id","12","fl","id","fq","id:12"),"=={doc:{id:'12'}}");
  assertU(adoc("id","14"));
  assertU(adoc("id","15"));
  assertJQ(req("qt","/get","ids","12,14,13,15","fl","id","fq","id:[10 TO 14]","fq","id:[13 TO 19]"),"/response/docs==[{id:'14'},{id:'13'}]");
  assertU(adoc("id","16"));
  assertU(adoc("id","17"));
  assertJQ(req("qt","/get","ids","17,16,15,14","fl","id","fq","id:[15 TO 16]"),"/response/docs==[{id:'16'},{id:'15'}]");
  assertJQ(req("qt","/get","ids","17,16,15,14","fl","id","fq","{!frange l=15 u=16}id"),"/response/docs==[{id:'16'},{id:'15'}]");
  realtimeHolder.decref();
  req.close();
}
