{
  solrCoreState.increfSolrCoreState();
  final SolrCore currentCore;
  if (!getNewIndexDir().equals(getIndexDir())) {
    currentCore=null;
  }
 else {
    currentCore=this;
  }
  boolean success=false;
  SolrCore core=null;
  try {
    CoreDescriptor cd=new CoreDescriptor(coreDescriptor.getName(),coreDescriptor);
    cd.loadExtraProperties();
    core=new SolrCore(getName(),getDataDir(),coreConfig.getSolrConfig(),coreConfig.getIndexSchema(),coreConfig.getProperties(),cd,updateHandler,solrDelPolicy,currentCore);
    core.getUpdateHandler().getSolrCoreState().newIndexWriter(core,false);
    core.getSearcher(true,false,null,true);
    success=true;
    return core;
  }
  finally {
    if (!success) {
      IOUtils.closeQuietly(core);
    }
  }
}
