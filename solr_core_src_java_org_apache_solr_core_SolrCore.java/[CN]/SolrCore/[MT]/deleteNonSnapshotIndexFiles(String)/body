{
  if (getIndexDir().equals(indexDirPath)) {
    return;
  }
  this.snapshotDelLock.lock();
  Directory dir=getDirectoryFactory().get(indexDirPath,DirContext.DEFAULT,"none");
  try {
    Collection<SnapshotMetaData> snapshots=snapshotMgr.listSnapshotsInIndexDir(indexDirPath);
    log.info("Following snapshots exist in the index directory {} : {}",indexDirPath,snapshots);
    if (snapshots.isEmpty()) {
      log.info("Removing index directory {} since all named snapshots are deleted.",indexDirPath);
      getDirectoryFactory().remove(dir);
    }
 else {
      SolrSnapshotManager.deleteNonSnapshotIndexFiles(this,dir,snapshots);
    }
  }
  finally {
    snapshotDelLock.unlock();
    if (dir != null) {
      getDirectoryFactory().release(dir);
    }
  }
}
