{
  IndexFingerprint f=null;
  f=perSegmentFingerprintCache.get(ctx.reader().getCoreCacheKey());
  if (f == null || (f.getMaxInHash() > maxVersion)) {
    log.debug("IndexFingerprint cache miss for searcher:{} reader:{} readerHash:{} maxVersion:{}",searcher,ctx.reader(),ctx.reader().hashCode(),maxVersion);
    f=IndexFingerprint.getFingerprint(searcher,ctx,maxVersion);
    if (f.getMaxVersionEncountered() == f.getMaxInHash()) {
      log.info("Caching fingerprint for searcher:{} leafReaderContext:{} mavVersion:{}",searcher,ctx,maxVersion);
      perSegmentFingerprintCache.put(ctx.reader().getCoreCacheKey(),f);
    }
  }
 else {
    log.debug("IndexFingerprint cache hit for searcher:{} reader:{} readerHash:{} maxVersion:{}",searcher,ctx.reader(),ctx.reader().hashCode(),maxVersion);
  }
  log.debug("Cache Size: {}, Segments Size:{}",perSegmentFingerprintCache.size(),searcher.getTopReaderContext().leaves().size());
  return f;
}
