{
  if (handler == null) {
    String msg="Null Request Handler '" + req.getParams().get(CommonParams.QT) + "'";
    if (log.isWarnEnabled())     log.warn(logid + msg + ":"+ req);
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,msg);
  }
  preDecorateResponse(req,rsp);
  if (requestLog.isDebugEnabled() && rsp.getToLog().size() > 0) {
    requestLog.debug(rsp.getToLogAsString(logid));
  }
  handler.handleRequest(req,rsp);
  postDecorateResponse(handler,req,rsp);
  if (rsp.getToLog().size() > 0) {
    if (requestLog.isInfoEnabled()) {
      requestLog.info(rsp.getToLogAsString(logid));
    }
    if (log.isWarnEnabled() && slowQueryThresholdMillis >= 0) {
      final long qtime=(long)(req.getRequestTimer().getTime());
      if (qtime >= slowQueryThresholdMillis) {
        log.warn("slow: " + rsp.getToLogAsString(logid));
      }
    }
  }
}
