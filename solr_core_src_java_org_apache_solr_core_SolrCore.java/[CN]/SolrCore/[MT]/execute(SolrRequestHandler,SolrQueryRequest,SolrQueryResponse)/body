{
  if (handler == null) {
    String msg="Null Request Handler '" + req.getParams().get(CommonParams.QT) + "'";
    if (log.isWarnEnabled())     log.warn(logid + msg + ":"+ req);
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,msg);
  }
  preDecorateResponse(req,rsp);
  handler.handleRequest(req,rsp);
  postDecorateResponse(handler,req,rsp);
  if (rsp.getToLog().size() > 0) {
    if (log.isInfoEnabled()) {
      log.info(rsp.getToLogAsString(logid));
    }
    if (log.isWarnEnabled()) {
      final int qtime=(int)(rsp.getEndTime() - req.getStartTime());
      if (slowQueryThresholdMillis >= 0 && qtime >= slowQueryThresholdMillis) {
        log.warn("slow: " + rsp.getToLogAsString(logid));
      }
    }
  }
}
