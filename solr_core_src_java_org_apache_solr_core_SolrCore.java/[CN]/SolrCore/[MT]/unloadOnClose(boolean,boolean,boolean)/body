{
  if (deleteIndexDir) {
    try {
      directoryFactory.remove(getIndexDir());
    }
 catch (    Exception e) {
      SolrException.log(log,"Failed to flag index dir for removal for core:" + name + " dir:"+ getIndexDir());
    }
  }
  if (deleteDataDir) {
    try {
      directoryFactory.remove(getDataDir(),true);
    }
 catch (    Exception e) {
      SolrException.log(log,"Failed to flag data dir for removal for core:" + name + " dir:"+ getDataDir());
    }
  }
  if (deleteInstanceDir) {
    addCloseHook(new CloseHook(){
      @Override public void preClose(      SolrCore core){
      }
      @Override public void postClose(      SolrCore core){
        CoreDescriptor cd=core.getCoreDescriptor();
        if (cd != null) {
          File instanceDir=new File(cd.getInstanceDir());
          try {
            FileUtils.deleteDirectory(instanceDir);
          }
 catch (          IOException e) {
            SolrException.log(log,"Failed to delete instance dir for core:" + core.getName() + " dir:"+ instanceDir.getAbsolutePath());
          }
        }
      }
    }
);
  }
}
