{
  if (!BlobRepository.BLOB_KEY_PATTERN_CHECKER.matcher(key).matches()) {
    throw new IllegalArgumentException("invalid key format, must end in /N where N is the version number");
  }
  CoreContainer coreContainer=getCoreDescriptor().getCoreContainer();
  BlobRepository.BlobContentRef blobRef=coreContainer.getBlobRepository().getBlobIncRef(key,decoder);
  addCloseHook(new CloseHook(){
    @Override public void preClose(    SolrCore core){
    }
    @Override public void postClose(    SolrCore core){
      core.getCoreDescriptor().getCoreContainer().getBlobRepository().decrementBlobRefCount(blobRef);
    }
  }
);
  return blobRef;
}
