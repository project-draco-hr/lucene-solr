{
  int count=refCount.decrementAndGet();
  if (count > 0)   return;
  if (count < 0) {
    log.error("Too many close [count:{}] on {}. Please report this exception to solr-user@lucene.apache.org",count,this);
    return;
  }
  log.info(logid + " CLOSING SolrCore " + this);
  if (closeHooks != null) {
    for (    CloseHook hook : closeHooks) {
      try {
        hook.preClose(this);
      }
 catch (      Throwable e) {
        SolrException.log(log,e);
      }
    }
  }
  try {
    infoRegistry.clear();
  }
 catch (  Throwable e) {
    SolrException.log(log,e);
  }
  try {
    if (null != updateHandler) {
      updateHandler.close();
    }
  }
 catch (  Throwable e) {
    SolrException.log(log,e);
  }
  try {
    if (solrCoreState != null) {
      if (updateHandler instanceof IndexWriterCloser) {
        solrCoreState.decrefSolrCoreState((IndexWriterCloser)updateHandler);
      }
 else {
        solrCoreState.decrefSolrCoreState(null);
      }
    }
  }
 catch (  Throwable e) {
    SolrException.log(log,e);
  }
  try {
    ExecutorUtil.shutdownAndAwaitTermination(searcherExecutor);
  }
 catch (  Throwable e) {
    SolrException.log(log,e);
  }
  try {
    closeSearcher();
  }
 catch (  Throwable e) {
    SolrException.log(log,e);
  }
  if (solrCoreState != null) {
    if (solrCoreState.getSolrCoreStateRefCnt() == 0) {
      try {
        directoryFactory.close();
      }
 catch (      Throwable t) {
        SolrException.log(log,t);
      }
    }
  }
  if (closeHooks != null) {
    for (    CloseHook hook : closeHooks) {
      try {
        hook.postClose(this);
      }
 catch (      Throwable e) {
        SolrException.log(log,e);
      }
    }
  }
}
