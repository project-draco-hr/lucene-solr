{
  FileSystem fs=FileSystems.getDefault();
  if (LuceneTestCase.VERBOSE) {
    fs=new VerboseFS(fs,new TestRuleSetupAndRestoreClassEnv.ThreadNameFixingPrintStreamInfoStream(System.out)).getFileSystem(null);
  }
  Random random=RandomizedContext.current().getRandom();
  if (random.nextInt(10) > 0) {
    fs=new DisableFsyncFS(fs).getFileSystem(null);
    fs=new LeakFS(fs).getFileSystem(null);
    fs=new HandleLimitFS(fs,MAX_OPEN_FILES).getFileSystem(null);
    if (random.nextInt(10) == 0) {
      fs=new WindowsFS(fs).getFileSystem(null);
    }
  }
  if (LuceneTestCase.VERBOSE) {
    System.out.println("filesystem: " + fs.provider());
  }
  return fs.provider().getFileSystem(URI.create("file:///"));
}
