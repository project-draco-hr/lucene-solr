{
  IndexWriter writer=initIndex(random,true);
  MockDirectoryWrapper dir=(MockDirectoryWrapper)writer.getDirectory();
  dir.setPreventDoubleWrite(false);
  crash(writer);
  writer=initIndex(random,dir,false);
  writer.close();
  IndexReader reader=IndexReader.open(dir,false);
  assertTrue(reader.numDocs() < 314);
  reader.close();
  dir.close();
}
