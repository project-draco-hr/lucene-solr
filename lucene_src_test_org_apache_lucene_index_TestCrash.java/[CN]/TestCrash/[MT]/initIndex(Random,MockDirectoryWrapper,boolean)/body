{
  dir.setLockFactory(NoLockFactory.getNoLockFactory());
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMaxBufferedDocs(10).setMergeScheduler(new ConcurrentMergeScheduler()));
  ((ConcurrentMergeScheduler)writer.getConfig().getMergeScheduler()).setSuppressExceptions();
  if (initialCommit) {
    writer.commit();
  }
  Document doc=new Document();
  doc.add(newField("content","aaa",Field.Store.YES,Field.Index.ANALYZED));
  doc.add(newField("id","0",Field.Store.YES,Field.Index.ANALYZED));
  for (int i=0; i < 157; i++)   writer.addDocument(doc);
  return writer;
}
