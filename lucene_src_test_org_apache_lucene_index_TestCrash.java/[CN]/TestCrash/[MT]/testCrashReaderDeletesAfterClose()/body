{
  IndexWriter writer=initIndex(newRandom(),false);
  MockDirectoryWrapper dir=(MockDirectoryWrapper)writer.getDirectory();
  writer.close(false);
  IndexReader reader=IndexReader.open(dir,false);
  reader.deleteDocument(3);
  reader.close();
  dir.crash();
  reader=IndexReader.open(dir,false);
  assertEquals(156,reader.numDocs());
  reader.close();
  dir.close();
}
