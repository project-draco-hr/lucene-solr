{
  log.info("STARTING ZK TEST SERVER");
  zooThread=new Thread(){
    @Override public void run(){
      ServerConfig config=new ServerConfig(){
{
          setClientPort(ZkTestServer.this.clientPort);
          this.dataDir=zkDir;
          this.dataLogDir=zkDir;
          this.tickTime=theTickTime;
        }
        public void setClientPort(        int clientPort){
          if (clientPortAddress != null) {
            try {
              this.clientPortAddress=new InetSocketAddress(InetAddress.getByName(clientPortAddress.getHostName()),clientPort);
            }
 catch (            UnknownHostException e) {
              throw new RuntimeException(e);
            }
          }
 else {
            this.clientPortAddress=new InetSocketAddress(clientPort);
          }
          log.info("client port:" + this.clientPortAddress);
        }
      }
;
      try {
        zkServer.runFromConfig(config);
      }
 catch (      Throwable e) {
        throw new RuntimeException(e);
      }
    }
  }
;
  zooThread.setDaemon(true);
  zooThread.start();
  int cnt=0;
  int port=-1;
  try {
    port=getPort();
  }
 catch (  IllegalStateException e) {
  }
  while (port < 1) {
    Thread.sleep(100);
    try {
      port=getPort();
    }
 catch (    IllegalStateException e) {
    }
    if (cnt == 500) {
      throw new RuntimeException("Could not get the port for ZooKeeper server");
    }
    cnt++;
  }
  log.info("start zk server on port:" + port);
}
