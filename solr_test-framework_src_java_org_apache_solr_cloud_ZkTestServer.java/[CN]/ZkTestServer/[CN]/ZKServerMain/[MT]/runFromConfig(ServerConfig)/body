{
  log.info("Starting server");
  try {
    zooKeeperServer=new ZooKeeperServer();
    FileTxnSnapLog ftxn=new FileTxnSnapLog(new File(config.getDataLogDir()),new File(config.getDataDir()));
    zooKeeperServer.setTxnLogFactory(ftxn);
    zooKeeperServer.setTickTime(config.getTickTime());
    zooKeeperServer.setMinSessionTimeout(config.getMinSessionTimeout());
    zooKeeperServer.setMaxSessionTimeout(config.getMaxSessionTimeout());
    cnxnFactory=ServerCnxnFactory.createFactory();
    cnxnFactory.configure(config.getClientPortAddress(),config.getMaxClientCnxns());
    cnxnFactory.startup(zooKeeperServer);
    cnxnFactory.join();
    if (zooKeeperServer.isRunning()) {
      zkServer.shutdown();
    }
  }
 catch (  InterruptedException e) {
    log.warn("Server interrupted",e);
  }
}
