{
  if (docsEnum != null) {
    int docId;
    do {
      docId=docsEnum.nextDoc();
      if (docId == DocIdSetIterator.NO_MORE_DOCS) {
        break;
      }
    }
 while (alreadyEmittedDocs.get(docId));
    if (docId == DocIdSetIterator.NO_MORE_DOCS) {
      docsEnum=null;
    }
 else {
      alreadyEmittedDocs.set(docId);
      return docId;
    }
  }
  for (; ; ) {
    do {
      if (upto == terms.size()) {
        return DocIdSetIterator.NO_MORE_DOCS;
      }
      scoreUpto=upto;
      TermsEnum.SeekStatus status=termsEnum.seekCeil(terms.get(ords[upto++],spare),true);
      if (status == TermsEnum.SeekStatus.FOUND) {
        docsEnum=reuse=termsEnum.docs(acceptDocs,reuse,0);
      }
    }
 while (docsEnum == null);
    int docId;
    do {
      docId=docsEnum.nextDoc();
      if (docId == DocIdSetIterator.NO_MORE_DOCS) {
        break;
      }
    }
 while (alreadyEmittedDocs.get(docId));
    if (docId == DocIdSetIterator.NO_MORE_DOCS) {
      docsEnum=null;
    }
 else {
      alreadyEmittedDocs.set(docId);
      return docId;
    }
  }
}
