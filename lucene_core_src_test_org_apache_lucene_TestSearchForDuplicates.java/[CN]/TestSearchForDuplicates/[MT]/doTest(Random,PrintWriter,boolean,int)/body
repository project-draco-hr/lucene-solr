{
  Directory directory=newDirectory();
  Analyzer analyzer=new MockAnalyzer(random);
  IndexWriterConfig conf=newIndexWriterConfig(analyzer);
  final MergePolicy mp=conf.getMergePolicy();
  mp.setNoCFSRatio(useCompoundFiles ? 1.0 : 0.0);
  IndexWriter writer=new IndexWriter(directory,conf);
  if (VERBOSE) {
    System.out.println("TEST: now build index MAX_DOCS=" + MAX_DOCS);
  }
  for (int j=0; j < MAX_DOCS; j++) {
    Document d=new Document();
    d.add(newTextField(PRIORITY_FIELD,HIGH_PRIORITY,Field.Store.YES));
    d.add(new IntField(ID_FIELD,j,Field.Store.YES));
    d.add(new NumericDocValuesField(ID_FIELD,j));
    writer.addDocument(d);
  }
  writer.close();
  IndexReader reader=DirectoryReader.open(directory);
  IndexSearcher searcher=newSearcher(reader);
  Query query=new TermQuery(new Term(PRIORITY_FIELD,HIGH_PRIORITY));
  out.println("Query: " + query.toString(PRIORITY_FIELD));
  if (VERBOSE) {
    System.out.println("TEST: search query=" + query);
  }
  final Sort sort=new Sort(SortField.FIELD_SCORE,new SortField(ID_FIELD,SortField.Type.INT));
  ScoreDoc[] hits=searcher.search(query,null,MAX_DOCS,sort).scoreDocs;
  printHits(out,hits,searcher);
  checkHits(hits,MAX_DOCS,searcher);
  searcher=newSearcher(reader);
  hits=null;
  BooleanQuery booleanQuery=new BooleanQuery();
  booleanQuery.add(new TermQuery(new Term(PRIORITY_FIELD,HIGH_PRIORITY)),BooleanClause.Occur.SHOULD);
  booleanQuery.add(new TermQuery(new Term(PRIORITY_FIELD,MED_PRIORITY)),BooleanClause.Occur.SHOULD);
  out.println("Query: " + booleanQuery.toString(PRIORITY_FIELD));
  hits=searcher.search(booleanQuery,null,MAX_DOCS,sort).scoreDocs;
  printHits(out,hits,searcher);
  checkHits(hits,MAX_DOCS,searcher);
  reader.close();
  directory.close();
}
