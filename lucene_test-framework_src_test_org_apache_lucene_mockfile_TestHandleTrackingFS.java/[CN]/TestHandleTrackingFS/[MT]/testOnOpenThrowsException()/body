{
  Path path=wrap(createTempDir());
  FileSystem fs=new HandleTrackingFS("test://",path.getFileSystem()){
    @Override protected void onClose(    Path path,    Object stream) throws IOException {
    }
    @Override protected void onOpen(    Path path,    Object stream) throws IOException {
      throw new IOException("boom");
    }
  }
.getFileSystem(URI.create("file:///"));
  Path dir=new FilterPath(path,fs);
  try {
    OutputStream file=Files.newOutputStream(dir.resolve("somefile"));
    fail("expected IOException");
  }
 catch (  IOException ex) {
  }
  try {
    SeekableByteChannel channel=Files.newByteChannel(dir.resolve("somefile"));
    fail("expected IOException");
  }
 catch (  IOException ex) {
  }
  try {
    InputStream stream=Files.newInputStream(dir.resolve("somefile"));
    fail("expected IOException");
  }
 catch (  IOException ex) {
  }
  fs.close();
  try {
    DirectoryStream<Path> dirStream=Files.newDirectoryStream(dir);
    fail("expected IOException");
  }
 catch (  IOException ex) {
  }
  fs.close();
}
