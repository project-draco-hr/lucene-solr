{
  Directory indexDir=newDirectory();
  Directory taxoDir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random(),indexDir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random(),MockTokenizer.WHITESPACE,false)));
  TaxonomyWriter tw=new DirectoryTaxonomyWriter(taxoDir,OpenMode.CREATE);
  Map<FacetLabel,CategoryListParams> paramsMap=new HashMap<FacetLabel,CategoryListParams>();
  paramsMap.put(new FacetLabel("Band"),new CategoryListParams("$music"));
  paramsMap.put(new FacetLabel("Composer"),new CategoryListParams("$music"));
  paramsMap.put(new FacetLabel("Author"),new CategoryListParams("$literature"));
  PerDimensionIndexingParams iParams=new PerDimensionIndexingParams(paramsMap);
  seedIndex(iw,tw,iParams);
  IndexReader ir=iw.getReader();
  tw.commit();
  TaxonomyReader tr=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=newSearcher(ir);
  FacetsCollector facetsCollector=performSearch(iParams,tr,ir,searcher);
  assertCorrectResults(facetsCollector);
  assertOrdinalsExist("$music",ir);
  assertOrdinalsExist("$literature",ir);
  IOUtils.close(tr,ir,iw,tw);
  IOUtils.close(indexDir,taxoDir);
}
