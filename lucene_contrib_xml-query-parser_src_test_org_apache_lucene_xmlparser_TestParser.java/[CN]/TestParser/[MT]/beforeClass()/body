{
  Analyzer analyzer=new MockAnalyzer(random,MockTokenizer.WHITESPACE,true,MockTokenFilter.ENGLISH_STOPSET,false);
  builder=new CorePlusExtensionsParser("contents",analyzer);
  BufferedReader d=new BufferedReader(new InputStreamReader(TestParser.class.getResourceAsStream("reuters21578.txt")));
  dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(Version.LUCENE_40,analyzer));
  String line=d.readLine();
  while (line != null) {
    int endOfDate=line.indexOf('\t');
    String date=line.substring(0,endOfDate).trim();
    String content=line.substring(endOfDate).trim();
    org.apache.lucene.document.Document doc=new org.apache.lucene.document.Document();
    doc.add(newField("date",date,Field.Store.YES,Field.Index.ANALYZED));
    doc.add(newField("contents",content,Field.Store.YES,Field.Index.ANALYZED));
    NumericField numericField=new NumericField("date2");
    numericField.setIntValue(Integer.valueOf(date));
    doc.add(numericField);
    writer.addDocument(doc);
    line=d.readLine();
  }
  d.close();
  writer.close();
  reader=IndexReader.open(dir,true);
  searcher=newSearcher(reader);
}
