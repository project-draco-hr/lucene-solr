{
  DocValueHolder valueHolder=new DocValueHolder();
  long maxV=1;
  final int NUM_VALUES=333 + random.nextInt(333);
  final long[] values=new long[NUM_VALUES];
  for (int rx=1; rx < maxBit; rx++, maxV*=2) {
    Directory dir=newDirectory();
    final Counter trackBytes=Counter.newCounter();
    DocValuesConsumer w=Ints.getWriter(dir,"test",trackBytes,type,newIOContext(random));
    for (int i=0; i < NUM_VALUES; i++) {
      final long v=random.nextLong() % (1 + maxV);
      valueHolder.numberValue=values[i]=v;
      w.add(i,valueHolder);
    }
    final int additionalDocs=1 + random.nextInt(9);
    w.finish(NUM_VALUES + additionalDocs);
    assertEquals(0,trackBytes.get());
    DocValues r=Ints.getValues(dir,"test",NUM_VALUES + additionalDocs,type,newIOContext(random));
    for (int iter=0; iter < 2; iter++) {
      Source s=getSource(r);
      assertEquals(type,s.type());
      for (int i=0; i < NUM_VALUES; i++) {
        final long v=s.getInt(i);
        assertEquals("index " + i,values[i],v);
      }
    }
    r.close();
    dir.close();
  }
}
