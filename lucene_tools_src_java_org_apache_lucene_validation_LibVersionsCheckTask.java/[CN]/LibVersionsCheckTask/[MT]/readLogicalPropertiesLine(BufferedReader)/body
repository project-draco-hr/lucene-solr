{
  final StringBuilder logicalLine=new StringBuilder();
  String line;
  do {
    line=reader.readLine();
    if (null == line) {
      return null;
    }
  }
 while (BLANK_OR_COMMENT_LINE_PATTERN.matcher(line).matches());
  Matcher backslashMatcher=TRAILING_BACKSLASH_PATTERN.matcher(line);
  if (backslashMatcher.find() && 1 == (backslashMatcher.group(1).length() % 2)) {
    final Matcher firstLineMatcher=TRAILING_WHITESPACE_BACKSLASH_PATTERN.matcher(line);
    if (firstLineMatcher.matches()) {
      logicalLine.append(firstLineMatcher.group(1));
    }
    line=reader.readLine();
    while (null != line && (backslashMatcher=TRAILING_BACKSLASH_PATTERN.matcher(line)).find() && 1 == (backslashMatcher.group(1).length() % 2)) {
      final Matcher goodStuffMatcher=WHITESPACE_GOODSTUFF_WHITESPACE_BACKSLASH_PATTERN.matcher(line);
      if (goodStuffMatcher.matches()) {
        logicalLine.append(goodStuffMatcher.group(1));
      }
      line=reader.readLine();
    }
    if (null != line) {
      final Matcher leadingWhitespaceMatcher=LEADING_WHITESPACE_PATTERN.matcher(line);
      if (leadingWhitespaceMatcher.matches()) {
        line=leadingWhitespaceMatcher.group(1);
      }
      logicalLine.append(line);
    }
  }
 else {
    logicalLine.append(line);
  }
  final Matcher leadingWhitespaceMatcher=LEADING_WHITESPACE_PATTERN.matcher(logicalLine);
  final CharSequence leadingWhitespaceStripped=leadingWhitespaceMatcher.matches() ? leadingWhitespaceMatcher.group(1) : logicalLine;
  StringBuilder output=new StringBuilder();
  final int numChars=leadingWhitespaceStripped.length();
  for (int pos=0; pos < numChars - 1; ++pos) {
    char ch=leadingWhitespaceStripped.charAt(pos);
    if (ch == '\\') {
      ch=leadingWhitespaceStripped.charAt(++pos);
    }
    output.append(ch);
  }
  if (numChars > 0) {
    output.append(leadingWhitespaceStripped.charAt(numChars - 1));
  }
  return output.toString();
}
