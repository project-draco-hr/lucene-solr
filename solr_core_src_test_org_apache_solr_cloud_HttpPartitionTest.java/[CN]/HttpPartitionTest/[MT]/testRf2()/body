{
  String testCollectionName="c8n_1x2";
  createCollection(testCollectionName,1,2,1);
  cloudClient.setDefaultCollection(testCollectionName);
  sendDoc(1);
  Replica notLeader=ensureAllReplicasAreActive(testCollectionName,"shard1",1,2,maxWaitSecsToSeeAllActive).get(0);
  SocketProxy proxy=getProxyForReplica(notLeader);
  proxy.close();
  sendDoc(2);
  Thread.sleep(sleepMsBeforeHealPartition);
  proxy.reopen();
  List<Replica> notLeaders=ensureAllReplicasAreActive(testCollectionName,"shard1",1,2,maxWaitSecsToSeeAllActive);
  sendDoc(3);
  assertDocsExistInAllReplicas(notLeaders,testCollectionName,1,3);
  int numDocs=1000;
  boolean hasPartition=false;
  for (int d=0; d < numDocs; d++) {
    if (d % 100 == 0) {
      if (hasPartition) {
        proxy.reopen();
        hasPartition=false;
      }
 else {
        if (d >= 100) {
          proxy.close();
          hasPartition=true;
          Thread.sleep(sleepMsBeforeHealPartition);
        }
      }
    }
    sendDoc(d + 4);
  }
  if (hasPartition) {
    proxy.reopen();
  }
  notLeaders=ensureAllReplicasAreActive(testCollectionName,"shard1",1,2,maxWaitSecsToSeeAllActive);
  assertDocsExistInAllReplicas(notLeaders,testCollectionName,1,numDocs + 3);
  try {
    CollectionAdminRequest req=new CollectionAdminRequest.Delete();
    req.setCollectionName(testCollectionName);
    req.process(cloudClient);
  }
 catch (  Exception e) {
    log.warn("Could not delete collection {} after test completed",testCollectionName);
  }
}
