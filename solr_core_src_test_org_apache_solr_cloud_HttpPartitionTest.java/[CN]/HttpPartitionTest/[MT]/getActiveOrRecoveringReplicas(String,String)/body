{
  Map<String,Replica> activeReplicas=new HashMap<String,Replica>();
  ZkStateReader zkr=cloudClient.getZkStateReader();
  ClusterState cs=zkr.getClusterState();
  assertNotNull(cs);
  for (  Slice shard : cs.getActiveSlices(testCollectionName)) {
    if (shard.getName().equals(shardId)) {
      for (      Replica replica : shard.getReplicas()) {
        String replicaState=replica.getStr(ZkStateReader.STATE_PROP);
        if (ZkStateReader.ACTIVE.equals(replicaState) || ZkStateReader.RECOVERING.equals(replicaState)) {
          activeReplicas.put(replica.getName(),replica);
        }
      }
    }
  }
  List<Replica> replicas=new ArrayList<Replica>();
  replicas.addAll(activeReplicas.values());
  return replicas;
}
