{
  Directory dir=newDirectory();
  int bitsPerValue=DirectWriter.bitsRequired(2);
  IndexOutput output=dir.createOutput("foo",IOContext.DEFAULT);
  DirectWriter writer=DirectWriter.getInstance(output,5,bitsPerValue);
  writer.add(1);
  writer.add(0);
  writer.add(2);
  writer.add(1);
  try {
    writer.finish();
    fail("didn't get expected exception");
  }
 catch (  IllegalStateException expected) {
    assertTrue(expected.getMessage().startsWith("Wrong number of values added"));
  }
  output.close();
  dir.close();
}
