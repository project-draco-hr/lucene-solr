{
  if (DVFirstPassGroupingCollector.class.isAssignableFrom(firstPassGroupingCollector.getClass())) {
    boolean diskResident=random().nextBoolean();
    return DVFirstPassGroupingCollector.create(groupSort,topDocs,groupField,Type.BYTES_VAR_SORTED,diskResident);
  }
 else   if (TermFirstPassGroupingCollector.class.isAssignableFrom(firstPassGroupingCollector.getClass())) {
    ValueSource vs=new BytesRefFieldSource(groupField);
    return new FunctionFirstPassGroupingCollector(vs,new HashMap<Object,Object>(),groupSort,topDocs);
  }
 else {
    return new TermFirstPassGroupingCollector(groupField,groupSort,topDocs);
  }
}
