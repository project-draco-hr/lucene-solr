{
  Directory dir=new RAMDirectory();
  IndexWriter writer=newWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()));
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundFile(false);
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundDocStore(false);
  addDocs(writer,1);
  writer.close();
  Directory other=new RAMDirectory();
  writer=newWriter(other,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()));
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundFile(true);
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundDocStore(true);
  writer.addIndexesNoOptimize(new Directory[]{dir});
  assertTrue(writer.newestSegment().getUseCompoundFile());
  writer.close();
}
