{
  LogCodec codec=new LogCodec();
  try {
    checkWriteHeader(codec,null);
    MemOutputStream out=new MemOutputStream(new byte[20 + (cmd.query.length())]);
    codec.init(out);
    codec.writeTag(JavaBinCodec.ARR,3);
    codec.writeInt(UpdateLog.DELETE_BY_QUERY | flags);
    codec.writeLong(cmd.getVersion());
    codec.writeStr(cmd.query);
synchronized (this) {
      long pos=fos.size();
      out.writeAll(fos);
      endRecord(pos);
      return pos;
    }
  }
 catch (  IOException e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,e);
  }
}
