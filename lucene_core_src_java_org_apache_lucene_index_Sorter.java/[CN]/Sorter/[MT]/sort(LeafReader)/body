{
  SortField fields[]=sort.getSort();
  final int reverseMul[]=new int[fields.length];
  final DocComparator comparators[]=new DocComparator[fields.length];
  for (int i=0; i < fields.length; i++) {
    comparators[i]=getDocComparator(reader,fields[i]);
  }
  final DocComparator comparator=new DocComparator(){
    @Override public int compare(    int docID1,    int docID2){
      for (int i=0; i < comparators.length; i++) {
        int comp=comparators[i].compare(docID1,docID2);
        if (comp != 0) {
          return comp;
        }
      }
      return Integer.compare(docID1,docID2);
    }
  }
;
  return sort(reader.maxDoc(),comparator);
}
