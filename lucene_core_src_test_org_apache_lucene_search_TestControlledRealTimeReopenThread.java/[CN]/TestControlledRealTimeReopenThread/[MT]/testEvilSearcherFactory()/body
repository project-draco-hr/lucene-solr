{
  final Directory dir=newDirectory();
  final RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  w.commit();
  final IndexReader other=DirectoryReader.open(dir);
  final SearcherFactory theEvilOne=new SearcherFactory(){
    @Override public IndexSearcher newSearcher(    IndexReader ignored){
      return LuceneTestCase.newSearcher(other);
    }
  }
;
  try {
    new SearcherManager(w.w,false,theEvilOne);
    fail("didn't hit expected exception");
  }
 catch (  IllegalStateException ise) {
  }
  w.shutdown();
  other.close();
  dir.close();
}
