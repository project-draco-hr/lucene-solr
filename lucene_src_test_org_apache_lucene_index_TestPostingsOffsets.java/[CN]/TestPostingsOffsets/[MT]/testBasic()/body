{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random,dir,iwc);
  Document doc=new Document();
  FieldType ft=new FieldType(TextField.TYPE_UNSTORED);
  ft.setIndexOptions(FieldInfo.IndexOptions.DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS);
  Token[] tokens=new Token[]{makeToken("a",1,0,6),makeToken("b",1,8,9),makeToken("a",1,9,17),makeToken("c",1,19,50)};
  doc.add(new Field("content",new CannedAnalyzer.CannedTokenizer(tokens),ft));
  w.addDocument(doc,new CannedAnalyzer(tokens));
  IndexReader r=w.getReader();
  w.close();
  DocsAndPositionsEnum dp=MultiFields.getTermPositionsEnum(r,null,"content",new BytesRef("a"),true);
  assertNotNull(dp);
  assertEquals(0,dp.nextDoc());
  assertEquals(2,dp.freq());
  assertEquals(0,dp.nextPosition());
  assertEquals(0,dp.startOffset());
  assertEquals(6,dp.endOffset());
  assertEquals(2,dp.nextPosition());
  assertEquals(9,dp.startOffset());
  assertEquals(17,dp.endOffset());
  assertEquals(DocsEnum.NO_MORE_DOCS,dp.nextDoc());
  dp=MultiFields.getTermPositionsEnum(r,null,"content",new BytesRef("b"),true);
  assertNotNull(dp);
  assertEquals(0,dp.nextDoc());
  assertEquals(1,dp.freq());
  assertEquals(1,dp.nextPosition());
  assertEquals(8,dp.startOffset());
  assertEquals(9,dp.endOffset());
  assertEquals(DocsEnum.NO_MORE_DOCS,dp.nextDoc());
  dp=MultiFields.getTermPositionsEnum(r,null,"content",new BytesRef("c"),true);
  assertNotNull(dp);
  assertEquals(0,dp.nextDoc());
  assertEquals(1,dp.freq());
  assertEquals(3,dp.nextPosition());
  assertEquals(19,dp.startOffset());
  assertEquals(50,dp.endOffset());
  assertEquals(DocsEnum.NO_MORE_DOCS,dp.nextDoc());
  r.close();
  dir.close();
}
