{
  int numDocs=random().nextInt(10000) + 150;
  for (  boolean cacheScores : new boolean[]{false,true}) {
    int bytesPerDoc=cacheScores ? 8 : 4;
    CachingCollector cc=CachingCollector.create(new NoOpCollector(),cacheScores,bytesPerDoc * ONE_BYTE * numDocs);
    LeafCollector acc=cc.getLeafCollector(null);
    acc.setScorer(new MockScorer());
    for (int i=0; i < numDocs; i++)     acc.collect(i);
    assertTrue(cc.isCached());
    acc.collect(numDocs);
    assertFalse(cc.isCached());
  }
}
