{
  String tempDir=System.getProperty("java.io.tmpdir");
  if (tempDir == null)   throw new IOException("java.io.tmpdir undefined, cannot run test");
  File indexDir2=new File(tempDir,"IndexReaderReopen2");
  Directory dir1=FSDirectory.getDirectory(indexDir2);
  createIndex(dir1,false);
  IndexReader lastReader=IndexReader.open(indexDir2);
  Random r=newRandom();
  for (int i=0; i < 10; i++) {
    int mod=r.nextInt(5);
    modifyIndex(mod,lastReader.directory());
    IndexReader reader=lastReader.reopen();
    if (reader != lastReader) {
      lastReader.close();
      lastReader=reader;
    }
  }
  lastReader.close();
  dir1.close();
  try {
    dir1.listAll();
    fail("did not hit AlreadyClosedException");
  }
 catch (  AlreadyClosedException ace) {
  }
}
