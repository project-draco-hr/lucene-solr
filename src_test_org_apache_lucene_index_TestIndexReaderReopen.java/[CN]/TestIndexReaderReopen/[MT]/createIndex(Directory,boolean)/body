{
  IndexWriter.unlock(dir);
  IndexWriter w=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new WhitespaceAnalyzer(TEST_VERSION_CURRENT)));
  w.setMergePolicy(new LogDocMergePolicy(w));
  for (int i=0; i < 100; i++) {
    w.addDocument(createDocument(i,4));
    if (multiSegment && (i % 10) == 0) {
      w.commit();
    }
  }
  if (!multiSegment) {
    w.optimize();
  }
  w.close();
  IndexReader r=IndexReader.open(dir,false);
  if (multiSegment) {
    assertTrue(r.getSequentialSubReaders().length > 1);
  }
 else {
    assertTrue(r.getSequentialSubReaders().length == 1);
  }
  r.close();
}
