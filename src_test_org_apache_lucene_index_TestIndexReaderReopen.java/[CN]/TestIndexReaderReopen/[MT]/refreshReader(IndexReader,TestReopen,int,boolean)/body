{
synchronized (createReaderMutex) {
    IndexReader r=null;
    if (test != null) {
      test.modifyIndex(modify);
      r=test.openReader();
    }
    IndexReader refreshed=reader.reopen();
    if (hasChanges) {
      if (refreshed == reader) {
        fail("No new IndexReader instance created during refresh.");
      }
    }
 else {
      if (refreshed != reader) {
        fail("New IndexReader instance created during refresh even though index had no changes.");
      }
    }
    return new ReaderCouple(r,refreshed);
  }
}
