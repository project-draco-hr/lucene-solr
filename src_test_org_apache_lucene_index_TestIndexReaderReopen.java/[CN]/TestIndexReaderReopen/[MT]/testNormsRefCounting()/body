{
  Directory dir1=new MockRAMDirectory();
  createIndex(dir1,false);
  SegmentReader reader1=(SegmentReader)IndexReader.open(dir1);
  IndexReader modifier=IndexReader.open(dir1);
  modifier.deleteDocument(0);
  modifier.close();
  SegmentReader reader2=(SegmentReader)reader1.reopen();
  modifier=IndexReader.open(dir1);
  modifier.setNorm(1,"field1",50);
  modifier.setNorm(1,"field2",50);
  modifier.close();
  SegmentReader reader3=(SegmentReader)reader2.reopen();
  modifier=IndexReader.open(dir1);
  modifier.deleteDocument(2);
  modifier.close();
  SegmentReader reader4=(SegmentReader)reader3.reopen();
  modifier=IndexReader.open(dir1);
  modifier.deleteDocument(3);
  modifier.close();
  SegmentReader reader5=(SegmentReader)reader3.reopen();
  assertRefCountEquals(5,reader1);
  assertFalse(reader1.normsClosed());
  reader1.close();
  assertRefCountEquals(4,reader1);
  assertFalse(reader1.normsClosed());
  reader2.close();
  assertRefCountEquals(3,reader1);
  assertTrue(reader1.normsClosed("field1"));
  assertTrue(reader1.normsClosed("field2"));
  assertFalse(reader1.normsClosed("field3"));
  assertFalse(reader1.normsClosed("field4"));
  reader3.close();
  assertRefCountEquals(2,reader1);
  assertFalse(reader3.normsClosed());
  reader5.close();
  assertRefCountEquals(1,reader1);
  assertFalse(reader3.normsClosed());
  reader4.close();
  assertRefCountEquals(0,reader1);
  assertTrue(reader1.normsClosed());
  assertTrue(reader3.normsClosed());
  dir1.close();
}
