{
  final Iterable<Number> docToValueCount=LegacyDocValuesIterables.sortedNumericToDocCount(valuesProducer,field,maxDoc);
  final Iterable<Number> values=LegacyDocValuesIterables.sortedNumericToValues(valuesProducer,field);
  meta.writeVInt(field.number);
  meta.writeByte(Lucene70DocValuesFormat.SORTED_NUMERIC);
  if (isSingleValued(docToValueCount)) {
    meta.writeVInt(SORTED_SINGLE_VALUED);
    addNumericField(field,singletonView(docToValueCount,values,null),NumberType.VALUE);
  }
 else {
    final SortedSet<LongsRef> uniqueValueSets=uniqueValueSets(docToValueCount,values);
    if (uniqueValueSets != null) {
      meta.writeVInt(SORTED_SET_TABLE);
      writeDictionary(uniqueValueSets);
      addNumericField(field,docToSetId(uniqueValueSets,docToValueCount,values),NumberType.ORDINAL);
    }
 else {
      meta.writeVInt(SORTED_WITH_ADDRESSES);
      addNumericField(field,values,NumberType.VALUE);
      addOrdIndex(field,docToValueCount);
    }
  }
}
