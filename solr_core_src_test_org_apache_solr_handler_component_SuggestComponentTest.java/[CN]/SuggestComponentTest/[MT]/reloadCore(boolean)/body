{
  if (createNewCore) {
    CoreContainer cores=h.getCoreContainer();
    SolrCore core=h.getCore();
    String dataDir1=core.getDataDir();
    CoreDescriptor cd=core.getCoreDescriptor();
    cores.unload(core.getName());
    SolrCore createdCore=cores.create(cd);
    assertEquals(dataDir1,createdCore.getDataDir());
    assertEquals(createdCore,h.getCore());
  }
 else {
    h.reload();
    RefCounted<SolrIndexSearcher> registeredSearcher=h.getCore().getRegisteredSearcher();
    RefCounted<SolrIndexSearcher> newestSearcher=h.getCore().getNewestSearcher(false);
    ;
    while (registeredSearcher.get() != newestSearcher.get()) {
      registeredSearcher.decref();
      newestSearcher.decref();
      Thread.sleep(50);
      registeredSearcher=h.getCore().getRegisteredSearcher();
      newestSearcher=h.getCore().getNewestSearcher(false);
    }
    registeredSearcher.decref();
    newestSearcher.decref();
  }
  assertQ(req("qt","standard","q","*:*"),"//*[@numFound='11']");
}
