{
  if (context instanceof SolrMorphlineContext) {
    DocumentLoader loader=((SolrMorphlineContext)context).getDocumentLoader();
    if (loader != null) {
      return loader;
    }
  }
  if (zkHost != null && zkHost.length() > 0) {
    if (collectionName == null || collectionName.length() == 0) {
      throw new MorphlineCompilationException("Parameter 'zkHost' requires that you also pass parameter 'collection'",config);
    }
    CloudSolrClient cloudSolrClient=new Builder().withZkHost(zkHost).build();
    cloudSolrClient.setDefaultCollection(collectionName);
    cloudSolrClient.connect();
    return new SolrClientDocumentLoader(cloudSolrClient,batchSize);
  }
 else {
    if (solrUrl == null || solrUrl.length() == 0) {
      throw new MorphlineCompilationException("Missing parameter 'solrUrl'",config);
    }
    int solrServerNumThreads=2;
    int solrServerQueueLength=solrServerNumThreads;
    SolrClient server=new SafeConcurrentUpdateSolrClient(solrUrl,solrServerQueueLength,solrServerNumThreads);
    return new SolrClientDocumentLoader(server,batchSize);
  }
}
