{
  if (context instanceof SolrMorphlineContext) {
    DocumentLoader loader=((SolrMorphlineContext)context).getDocumentLoader();
    if (loader != null) {
      return loader;
    }
  }
  if (zkHost != null && zkHost.length() > 0) {
    if (collectionName == null || collectionName.length() == 0) {
      throw new MorphlineCompilationException("Parameter 'zkHost' requires that you also pass parameter 'collection'",config);
    }
    try {
      CloudSolrServer cloudSolrServer=new CloudSolrServer(zkHost);
      cloudSolrServer.setDefaultCollection(collectionName);
      cloudSolrServer.connect();
      return new SolrServerDocumentLoader(cloudSolrServer,batchSize);
    }
 catch (    MalformedURLException e) {
      throw new MorphlineRuntimeException(e);
    }
  }
 else {
    if (solrUrl == null || solrUrl.length() == 0) {
      throw new MorphlineCompilationException("Missing parameter 'solrUrl'",config);
    }
    int solrServerNumThreads=2;
    int solrServerQueueLength=solrServerNumThreads;
    SolrServer server=new SafeConcurrentUpdateSolrServer(solrUrl,solrServerQueueLength,solrServerNumThreads);
    return new SolrServerDocumentLoader(server,batchSize);
  }
}
