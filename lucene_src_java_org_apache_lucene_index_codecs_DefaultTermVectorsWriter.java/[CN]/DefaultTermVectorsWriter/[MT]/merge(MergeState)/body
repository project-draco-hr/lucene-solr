{
  int rawDocLengths[]=new int[MAX_RAW_MERGE_DOCS];
  int rawDocLengths2[]=new int[MAX_RAW_MERGE_DOCS];
  int idx=0;
  int numDocs=0;
  for (  final MergeState.IndexReaderAndLiveDocs reader : mergeState.readers) {
    final SegmentReader matchingSegmentReader=mergeState.matchingSegmentReaders[idx++];
    DefaultTermVectorsReader matchingVectorsReader=null;
    if (matchingSegmentReader != null) {
      TermVectorsReader vectorsReader=matchingSegmentReader.getTermVectorsReader();
      if (vectorsReader != null && vectorsReader instanceof DefaultTermVectorsReader) {
        if (((DefaultTermVectorsReader)vectorsReader).canReadRawDocs()) {
          matchingVectorsReader=(DefaultTermVectorsReader)vectorsReader;
        }
      }
    }
    if (reader.liveDocs != null) {
      numDocs+=copyVectorsWithDeletions(mergeState,matchingVectorsReader,reader,rawDocLengths,rawDocLengths2);
    }
 else {
      numDocs+=copyVectorsNoDeletions(mergeState,matchingVectorsReader,reader,rawDocLengths,rawDocLengths2);
    }
  }
  finish(numDocs);
  return numDocs;
}
