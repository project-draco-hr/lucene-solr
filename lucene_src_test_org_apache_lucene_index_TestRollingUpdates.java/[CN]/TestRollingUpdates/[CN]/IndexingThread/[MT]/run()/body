{
  try {
    IndexReader open=null;
    for (int i=0; i < num; i++) {
      Document doc=new Document();
      doc.add(newField("id","test",Index.NOT_ANALYZED));
      writer.updateDocument(new Term("id","test"),doc);
      if (random.nextInt(10) == 0) {
        if (open == null)         open=IndexReader.open(writer,true);
        IndexReader reader=open.reopen();
        if (reader != open) {
          open.close();
          open=reader;
        }
        assertEquals("iter: " + i + " numDocs: "+ open.numDocs()+ " del: "+ open.numDeletedDocs()+ " max: "+ open.maxDoc(),1,open.numDocs());
      }
    }
    open.close();
  }
 catch (  Exception e) {
    fail(e.getMessage());
  }
}
