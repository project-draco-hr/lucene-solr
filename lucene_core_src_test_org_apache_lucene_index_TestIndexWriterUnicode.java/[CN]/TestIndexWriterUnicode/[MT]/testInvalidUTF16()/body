{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new TestIndexWriter.StringSplitAnalyzer()));
  Document doc=new Document();
  final int count=utf8Data.length / 2;
  for (int i=0; i < count; i++)   doc.add(newTextField("f" + i,utf8Data[2 * i],Field.Store.YES));
  w.addDocument(doc);
  w.shutdown();
  IndexReader ir=DirectoryReader.open(dir);
  StoredDocument doc2=ir.document(0);
  for (int i=0; i < count; i++) {
    assertEquals("field " + i + " was not indexed correctly",1,ir.docFreq(new Term("f" + i,utf8Data[2 * i + 1])));
    assertEquals("field " + i + " is incorrect",utf8Data[2 * i + 1],doc2.getField("f" + i).stringValue());
  }
  ir.close();
  dir.close();
}
