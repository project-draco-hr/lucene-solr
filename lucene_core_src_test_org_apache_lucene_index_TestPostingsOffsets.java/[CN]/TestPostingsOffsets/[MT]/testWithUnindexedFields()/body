{
  Directory dir=newDirectory();
  RandomIndexWriter riw=new RandomIndexWriter(random(),dir,iwc);
  for (int i=0; i < 100; i++) {
    Document doc=new Document();
    if (i < 99 && random().nextInt(2) == 0) {
      FieldType ft=new FieldType();
      ft.setIndexed(false);
      ft.setStored(true);
      doc.add(new Field("foo","boo!",ft));
    }
 else {
      FieldType ft=new FieldType(TextField.TYPE_STORED);
      ft.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS);
      if (random().nextBoolean()) {
        ft.setStoreTermVectors(true);
        ft.setStoreTermVectorPositions(true);
        ft.setStoreTermVectorOffsets(true);
      }
      doc.add(new Field("foo","bar",ft));
    }
    riw.addDocument(doc);
  }
  CompositeReader ir=riw.getReader();
  AtomicReader slow=SlowCompositeReaderWrapper.wrap(ir);
  FieldInfos fis=slow.getFieldInfos();
  assertEquals(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS_AND_OFFSETS,fis.fieldInfo("foo").getIndexOptions());
  slow.close();
  ir.close();
  riw.close();
  dir.close();
}
