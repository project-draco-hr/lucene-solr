{
  final Tokenizer tokenizer;
  TokenStream result;
  if (getVersion().onOrAfter(Version.LUCENE_4_8)) {
    tokenizer=new HMMChineseTokenizer();
    result=tokenizer;
  }
 else {
    tokenizer=new SentenceTokenizer();
    result=new WordTokenFilter(tokenizer);
  }
  result=new PorterStemFilter(result);
  if (!stopWords.isEmpty()) {
    result=new StopFilter(result,stopWords);
  }
  return new TokenStreamComponents(tokenizer,result);
}
