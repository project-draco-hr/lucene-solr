{
  for (  CharSequence context : contexts()) {
    validate(context);
  }
  PrefixTokenFilter prefixTokenFilter=new PrefixTokenFilter(stream,(char)CONTEXT_SEPARATOR,contexts());
  CompletionTokenStream completionTokenStream;
  if (stream instanceof CompletionTokenStream) {
    completionTokenStream=(CompletionTokenStream)stream;
    completionTokenStream=new CompletionTokenStream(prefixTokenFilter,completionTokenStream.preserveSep,completionTokenStream.preservePositionIncrements,completionTokenStream.maxGraphExpansions);
  }
 else {
    completionTokenStream=new CompletionTokenStream(prefixTokenFilter);
  }
  return completionTokenStream;
}
