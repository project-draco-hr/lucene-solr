{
  final Iterable<CharSequence> contexts=contexts();
  for (  CharSequence context : contexts) {
    validate(context);
  }
  CompletionTokenStream completionTokenStream;
  if (stream instanceof CompletionTokenStream) {
    completionTokenStream=(CompletionTokenStream)stream;
    PrefixTokenFilter prefixTokenFilter=new PrefixTokenFilter(completionTokenStream.inputTokenStream,(char)CONTEXT_SEPARATOR,contexts);
    completionTokenStream=new CompletionTokenStream(prefixTokenFilter,completionTokenStream.preserveSep,completionTokenStream.preservePositionIncrements,completionTokenStream.maxGraphExpansions);
  }
 else {
    completionTokenStream=new CompletionTokenStream(new PrefixTokenFilter(stream,(char)CONTEXT_SEPARATOR,contexts));
  }
  return completionTokenStream;
}
