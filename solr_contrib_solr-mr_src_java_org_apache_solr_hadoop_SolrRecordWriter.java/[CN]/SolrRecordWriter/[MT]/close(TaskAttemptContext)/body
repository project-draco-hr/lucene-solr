{
  if (context != null) {
    heartBeater.setProgress(context);
  }
  try {
    heartBeater.needHeartBeat();
    if (batch.size() > 0) {
      batchWriter.queueBatch(batch);
      numDocsWritten+=batch.size();
      batch.clear();
    }
    LOG.info("docsWritten: {}",numDocsWritten);
    batchWriter.close(context);
  }
 catch (  Exception e) {
    if (e instanceof IOException) {
      throw (IOException)e;
    }
    throw new IOException(e);
  }
 finally {
    heartBeater.cancelHeartBeat();
    heartBeater.close();
  }
  context.setStatus("Done");
}
