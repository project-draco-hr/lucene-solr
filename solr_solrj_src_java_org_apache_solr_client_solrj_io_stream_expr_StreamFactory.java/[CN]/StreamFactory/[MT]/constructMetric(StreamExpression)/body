{
  String function=expression.getFunctionName();
  if (functionNames.containsKey(function)) {
    Class clazz=functionNames.get(function);
    if (Expressible.class.isAssignableFrom(clazz) && Metric.class.isAssignableFrom(clazz)) {
      Metric metric=(Metric)createInstance(functionNames.get(function),new Class[]{StreamExpression.class,StreamFactory.class},new Object[]{expression,this});
      return metric;
    }
  }
  throw new IOException(String.format(Locale.ROOT,"Invalid metric expression %s - function '%s' is unknown (not mapped to a valid Metric)",expression,expression.getFunctionName()));
}
