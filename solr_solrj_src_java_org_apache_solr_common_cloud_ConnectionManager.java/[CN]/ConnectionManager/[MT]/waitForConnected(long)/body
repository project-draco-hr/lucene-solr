{
  long expire=System.currentTimeMillis() + waitForConnection;
  long left=waitForConnection;
  while (!connected && left > 0) {
    wait(left);
    checkClosed();
    left=expire - System.currentTimeMillis();
  }
  if (!connected) {
    throw new TimeoutException("Could not connect to ZooKeeper " + zkServerAddress + " within "+ waitForConnection+ " ms");
  }
}
