{
  try {
    VariableResolverImpl resolver=new VariableResolverImpl();
    Map<String,Object> indexerNamespace=new HashMap<String,Object>();
    if (persistedProperties.getProperty(LAST_INDEX_TIME) != null) {
      indexerNamespace.put(LAST_INDEX_TIME,DataImporter.DATE_TIME_FORMAT.get().parse(persistedProperties.getProperty(LAST_INDEX_TIME)));
    }
 else {
      indexerNamespace.put(LAST_INDEX_TIME,EPOCH);
    }
    indexerNamespace.put(INDEX_START_TIME,dataImporter.getIndexStartTime());
    indexerNamespace.put("request",requestParameters.requestParams);
    indexerNamespace.put("functions",functionsNamespace);
    for (    DataConfig.Entity entity : dataImporter.getConfig().document.entities) {
      String key=entity.name + "." + SolrWriter.LAST_INDEX_KEY;
      String lastIndex=persistedProperties.getProperty(key);
      if (lastIndex != null) {
        indexerNamespace.put(key,lastIndex);
      }
 else {
        indexerNamespace.put(key,EPOCH);
      }
    }
    resolver.addNamespace(DataConfig.IMPORTER_NS_SHORT,indexerNamespace);
    resolver.addNamespace(DataConfig.IMPORTER_NS,indexerNamespace);
    return resolver;
  }
 catch (  ParseException e) {
    DataImportHandlerException.wrapAndThrow(DataImportHandlerException.SEVERE,e);
    return null;
  }
}
