{
  try {
    while (true) {
      final FastInputStream is=getStream();
      int result;
      try {
        result=fetchPackets(is);
        if (result == 0 || result == NO_CONTENT) {
          if (file.exists())           file.setLastModified(lastmodified);
          return;
        }
      }
  finally {
        closeNoExp(is);
      }
    }
  }
  finally {
    cleanup();
    fsyncService.submit(new Runnable(){
      public void run(){
        try {
          FileUtils.sync(file);
        }
 catch (        IOException e) {
          fsyncException=e;
        }
      }
    }
);
  }
}
