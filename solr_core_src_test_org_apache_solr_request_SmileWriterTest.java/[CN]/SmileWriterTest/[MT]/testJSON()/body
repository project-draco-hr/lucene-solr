{
  SolrQueryRequest req=req("wt","json","json.nl","arrarr");
  SolrQueryResponse rsp=new SolrQueryResponse();
  SmileResponseWriter w=new SmileResponseWriter();
  ByteArrayOutputStream buf=new ByteArrayOutputStream();
  NamedList nl=new NamedList();
  nl.add("data1","he\u2028llo\u2029!");
  nl.add(null,42);
  rsp.add("nl",nl);
  rsp.add("byte",Byte.valueOf((byte)-3));
  rsp.add("short",Short.valueOf((short)-4));
  String expected="{\"nl\":[[\"data1\",\"he\\u2028llo\\u2029!\"],[null,42]],byte:-3,short:-4}";
  w.write(buf,req,rsp);
  Map m=(Map)decodeSmile(new ByteArrayInputStream(buf.toByteArray()));
  Map o2=(Map)new ObjectBuilder(new JSONParser(new StringReader(expected))).getObject();
  assertEquals(ZkStateReader.toJSONString(m),ZkStateReader.toJSONString(o2));
  req.close();
}
