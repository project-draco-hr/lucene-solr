{
  HttpSolrServer server=new HttpSolrServer("http://127.0.0.1:" + jetty.getLocalPort() + "/solr/debug/foo");
  SolrQuery q=new SolrQuery("*:*");
  try {
    server.query(q);
  }
 catch (  Throwable t) {
  }
  assertNull(DebugServlet.headers.get("Accept-Encoding"));
  server.setAllowCompression(true);
  try {
    server.query(q);
  }
 catch (  Throwable t) {
  }
  assertNotNull(DebugServlet.headers.get("Accept-Encoding"));
  server.setAllowCompression(false);
  try {
    server.query(q);
  }
 catch (  Throwable t) {
  }
  assertNull(DebugServlet.headers.get("Accept-Encoding"));
  HttpGet get=new HttpGet("http://127.0.0.1:" + jetty.getLocalPort() + "/solr/select?q=foo&wt=xml");
  get.setHeader("Accept-Encoding","gzip");
  DefaultHttpClient client=new DefaultHttpClient();
  HttpEntity entity=null;
  try {
    HttpResponse response=client.execute(get);
    entity=response.getEntity();
    Header ceheader=entity.getContentEncoding();
    assertEquals("gzip",ceheader.getValue());
  }
  finally {
    if (entity != null) {
      entity.getContent().close();
    }
    client.getConnectionManager().shutdown();
  }
  server=new HttpSolrServer("http://127.0.0.1:" + jetty.getLocalPort() + "/solr");
  server.setAllowCompression(true);
  q=new SolrQuery("foo");
  QueryResponse response=server.query(q);
  assertEquals(0,response.getStatus());
}
