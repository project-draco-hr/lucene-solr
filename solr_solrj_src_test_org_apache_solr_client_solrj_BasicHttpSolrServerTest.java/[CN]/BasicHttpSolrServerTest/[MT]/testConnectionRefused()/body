{
  int unusedPort=findUnusedPort();
  HttpSolrServer server=new HttpSolrServer("http://127.0.0.1:" + unusedPort + "/solr");
  SolrQuery q=new SolrQuery("*:*");
  try {
    QueryResponse response=server.query(q);
    fail("Should have thrown an exception.");
  }
 catch (  SolrServerException e) {
    assertTrue(e.getMessage().contains("refused"));
  }
}
