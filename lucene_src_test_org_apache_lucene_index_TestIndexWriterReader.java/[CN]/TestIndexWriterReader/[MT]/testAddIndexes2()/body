{
  boolean optimize=false;
  Directory dir1=newDirectory();
  IndexWriter writer=new IndexWriter(dir1,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()));
  writer.setInfoStream(infoStream);
  Directory dir2=newDirectory();
  IndexWriter writer2=new IndexWriter(dir2,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()));
  writer2.setInfoStream(infoStream);
  createIndexNoClose(!optimize,"index2",writer2);
  writer2.close();
  writer.addIndexes(new Directory[]{dir2});
  writer.addIndexes(new Directory[]{dir2});
  writer.addIndexes(new Directory[]{dir2});
  writer.addIndexes(new Directory[]{dir2});
  writer.addIndexes(new Directory[]{dir2});
  IndexReader r1=writer.getReader();
  assertEquals(500,r1.maxDoc());
  r1.close();
  writer.close();
  dir1.close();
  dir2.close();
}
