{
  Directory dir=newDirectory();
  IndexWriter w=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMaxBufferedDocs(2).setReaderPooling(true));
  ((LogMergePolicy)w.getMergePolicy()).setMergeFactor(10);
  w.setMergedSegmentWarmer(new IndexWriter.IndexReaderWarmer(){
    public void warm(    IndexReader r) throws IOException {
      final IndexSearcher s=new IndexSearcher(r);
      final TopDocs hits=s.search(new TermQuery(new Term("foo","bar")),10);
      assertEquals(20,hits.totalHits);
    }
  }
);
  Document doc=new Document();
  doc.add(new Field("foo","bar",Field.Store.YES,Field.Index.NOT_ANALYZED));
  for (int i=0; i < 20; i++) {
    w.addDocument(doc);
  }
  w.waitForMerges();
  w.close();
  dir.close();
}
