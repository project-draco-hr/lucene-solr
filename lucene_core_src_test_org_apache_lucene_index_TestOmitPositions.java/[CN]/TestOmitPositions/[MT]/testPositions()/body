{
  Directory ram=newDirectory();
  Analyzer analyzer=new MockAnalyzer(random());
  IndexWriter writer=new IndexWriter(ram,newIndexWriterConfig(analyzer));
  Document d=new Document();
  FieldType ft=new FieldType(TextField.TYPE_NOT_STORED);
  ft.setIndexOptions(IndexOptions.DOCS_ONLY);
  Field f1=newField("f1","This field has docs only",ft);
  d.add(f1);
  Field f2=newField("f2","This field has docs only",ft);
  d.add(f2);
  Field f3=newField("f3","This field has docs only",ft);
  d.add(f3);
  FieldType ft2=new FieldType(TextField.TYPE_NOT_STORED);
  ft2.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
  Field f4=newField("f4","This field has docs and freqs",ft2);
  d.add(f4);
  Field f5=newField("f5","This field has docs and freqs",ft2);
  d.add(f5);
  Field f6=newField("f6","This field has docs and freqs",ft2);
  d.add(f6);
  FieldType ft3=new FieldType(TextField.TYPE_NOT_STORED);
  ft3.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS);
  Field f7=newField("f7","This field has docs and freqs and positions",ft3);
  d.add(f7);
  Field f8=newField("f8","This field has docs and freqs and positions",ft3);
  d.add(f8);
  Field f9=newField("f9","This field has docs and freqs and positions",ft3);
  d.add(f9);
  writer.addDocument(d);
  writer.forceMerge(1);
  d=new Document();
  f1=newField("f1","This field has docs only",ft);
  d.add(f1);
  f4=newField("f4","This field has docs only",ft);
  d.add(f4);
  f7=newField("f7","This field has docs only",ft);
  d.add(f7);
  f2=newField("f2","This field has docs and freqs",ft2);
  d.add(f2);
  f5=newField("f5","This field has docs and freqs",ft2);
  d.add(f5);
  f8=newField("f8","This field has docs and freqs",ft2);
  d.add(f8);
  f3=newField("f3","This field has docs and freqs and positions",ft3);
  d.add(f3);
  f6=newField("f6","This field has docs and freqs and positions",ft3);
  d.add(f6);
  f9=newField("f9","This field has docs and freqs and positions",ft3);
  d.add(f9);
  writer.addDocument(d);
  writer.forceMerge(1);
  writer.shutdown();
  SegmentReader reader=getOnlySegmentReader(DirectoryReader.open(ram));
  FieldInfos fi=reader.getFieldInfos();
  assertEquals(IndexOptions.DOCS_ONLY,fi.fieldInfo("f1").getIndexOptions());
  assertEquals(IndexOptions.DOCS_ONLY,fi.fieldInfo("f2").getIndexOptions());
  assertEquals(IndexOptions.DOCS_ONLY,fi.fieldInfo("f3").getIndexOptions());
  assertEquals(IndexOptions.DOCS_ONLY,fi.fieldInfo("f4").getIndexOptions());
  assertEquals(IndexOptions.DOCS_AND_FREQS,fi.fieldInfo("f5").getIndexOptions());
  assertEquals(IndexOptions.DOCS_AND_FREQS,fi.fieldInfo("f6").getIndexOptions());
  assertEquals(IndexOptions.DOCS_ONLY,fi.fieldInfo("f7").getIndexOptions());
  assertEquals(IndexOptions.DOCS_AND_FREQS,fi.fieldInfo("f8").getIndexOptions());
  assertEquals(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS,fi.fieldInfo("f9").getIndexOptions());
  reader.close();
  ram.close();
}
