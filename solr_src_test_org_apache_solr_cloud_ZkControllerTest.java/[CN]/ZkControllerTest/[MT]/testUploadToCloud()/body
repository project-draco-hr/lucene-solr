{
  String zkDir=dataDir.getAbsolutePath() + File.separator + "zookeeper/server1/data";
  ZkTestServer server=new ZkTestServer(zkDir);
  ZkController zkController=null;
  try {
    server.run();
    AbstractZkTestCase.makeSolrZkNode(server.getZkHost());
    zkController=new ZkController(server.getZkAddress(),TIMEOUT,1000,"localhost","8983","/solr");
    zkController.uploadToZK(getFile("solr/conf"),ZkController.CONFIGS_ZKNODE + "/config1");
    if (DEBUG) {
      zkController.printLayoutToStdOut();
    }
  }
  finally {
    if (zkController != null) {
      zkController.close();
    }
    server.shutdown();
  }
}
