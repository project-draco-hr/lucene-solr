{
  Object value=result.get(rb.getGroupingSpec().getFields()[0]);
  if (TopGroups.class.isInstance(value)) {
    @SuppressWarnings("unchecked") TopGroups<BytesRef> topGroups=(TopGroups<BytesRef>)value;
    SolrDocumentList docList=new SolrDocumentList();
    docList.setStart(rb.getGroupingSpec().getOffset());
    docList.setNumFound(rb.totalHitCount);
    Float maxScore=Float.NEGATIVE_INFINITY;
    for (    GroupDocs<BytesRef> group : topGroups.groups) {
      for (      ScoreDoc scoreDoc : group.scoreDocs) {
        if (maxScore < scoreDoc.score) {
          maxScore=scoreDoc.score;
        }
        docList.add(solrDocumentSource.retrieve(scoreDoc));
      }
    }
    if (maxScore != Float.NEGATIVE_INFINITY) {
      docList.setMaxScore(maxScore);
    }
    rb.rsp.addResponse(docList);
  }
}
