{
  if (allReplicasInLine) {
    try (SolrCore core=cc.getCore(coreName)){
      final Replica.State lirState=zkController.getLeaderInitiatedRecoveryState(collection,shardId,core.getCoreDescriptor().getCloudDescriptor().getCoreNodeName());
      if (lirState == Replica.State.DOWN) {
        zkController.updateLeaderInitiatedRecoveryState(collection,shardId,leaderProps.getStr(ZkStateReader.CORE_NODE_NAME_PROP),Replica.State.ACTIVE,core.getCoreDescriptor(),true);
      }
    }
   }
 else {
    try (SolrCore core=cc.getCore(coreName)){
      final Replica.State lirState=zkController.getLeaderInitiatedRecoveryState(collection,shardId,core.getCoreDescriptor().getCloudDescriptor().getCoreNodeName());
      if (lirState == Replica.State.DOWN || lirState == Replica.State.RECOVERING) {
        log.warn("The previous leader marked me " + core.getName() + " as "+ lirState.toString()+ " and I haven't recovered yet, so I shouldn't be the leader.");
        throw new SolrException(ErrorCode.SERVER_ERROR,"Leader Initiated Recovery prevented leadership");
      }
    }
   }
}
