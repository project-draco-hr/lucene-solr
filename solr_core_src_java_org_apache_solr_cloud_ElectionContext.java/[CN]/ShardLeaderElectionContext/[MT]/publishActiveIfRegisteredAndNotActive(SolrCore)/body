{
  if (core.getCoreDescriptor().getCloudDescriptor().hasRegistered()) {
    ZkStateReader zkStateReader=zkController.getZkStateReader();
    zkStateReader.forceUpdateCollection(collection);
    ClusterState clusterState=zkStateReader.getClusterState();
    Replica rep=(clusterState == null) ? null : clusterState.getReplica(collection,leaderProps.getStr(ZkStateReader.CORE_NODE_NAME_PROP));
    if (rep != null && rep.getState() != Replica.State.ACTIVE && rep.getState() != Replica.State.RECOVERING) {
      log.debug("We have become the leader after core registration but are not in an ACTIVE state - publishing ACTIVE");
      zkController.publish(core.getCoreDescriptor(),Replica.State.ACTIVE);
    }
  }
}
