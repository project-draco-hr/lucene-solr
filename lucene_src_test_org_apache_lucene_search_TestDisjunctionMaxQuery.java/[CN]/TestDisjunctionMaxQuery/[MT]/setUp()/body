{
  super.setUp();
  Random random=newRandom();
  index=newDirectory(random);
  RandomIndexWriter writer=new RandomIndexWriter(random,index,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()).setSimilarity(sim));
{
    Document d1=new Document();
    d1.add(new Field("id","d1",Field.Store.YES,Field.Index.NOT_ANALYZED));
    d1.add(new Field("hed","elephant",Field.Store.YES,Field.Index.ANALYZED));
    d1.add(new Field("dek","elephant",Field.Store.YES,Field.Index.ANALYZED));
    writer.addDocument(d1);
  }
{
    Document d2=new Document();
    d2.add(new Field("id","d2",Field.Store.YES,Field.Index.NOT_ANALYZED));
    d2.add(new Field("hed","elephant",Field.Store.YES,Field.Index.ANALYZED));
    d2.add(new Field("dek","albino",Field.Store.YES,Field.Index.ANALYZED));
    d2.add(new Field("dek","elephant",Field.Store.YES,Field.Index.ANALYZED));
    writer.addDocument(d2);
  }
{
    Document d3=new Document();
    d3.add(new Field("id","d3",Field.Store.YES,Field.Index.NOT_ANALYZED));
    d3.add(new Field("hed","albino",Field.Store.YES,Field.Index.ANALYZED));
    d3.add(new Field("hed","elephant",Field.Store.YES,Field.Index.ANALYZED));
    writer.addDocument(d3);
  }
{
    Document d4=new Document();
    d4.add(new Field("id","d4",Field.Store.YES,Field.Index.NOT_ANALYZED));
    d4.add(new Field("hed","albino",Field.Store.YES,Field.Index.ANALYZED));
    d4.add(new Field("hed","elephant",Field.Store.YES,Field.Index.ANALYZED));
    d4.add(new Field("dek","albino",Field.Store.YES,Field.Index.ANALYZED));
    writer.addDocument(d4);
  }
  r=writer.getReader();
  writer.close();
  s=new IndexSearcher(SlowMultiReaderWrapper.wrap(r));
  s.setSimilarity(sim);
}
