{
  super.setUp();
  index=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,index,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setSimilarity(sim).setMergePolicy(newLogMergePolicy()));
{
    Document d1=new Document();
    d1.add(newField("id","d1",nonAnalyzedType));
    d1.add(newField("hed","elephant",TextField.TYPE_STORED));
    d1.add(newField("dek","elephant",TextField.TYPE_STORED));
    writer.addDocument(d1);
  }
{
    Document d2=new Document();
    d2.add(newField("id","d2",nonAnalyzedType));
    d2.add(newField("hed","elephant",TextField.TYPE_STORED));
    d2.add(newField("dek","albino",TextField.TYPE_STORED));
    d2.add(newField("dek","elephant",TextField.TYPE_STORED));
    writer.addDocument(d2);
  }
{
    Document d3=new Document();
    d3.add(newField("id","d3",nonAnalyzedType));
    d3.add(newField("hed","albino",TextField.TYPE_STORED));
    d3.add(newField("hed","elephant",TextField.TYPE_STORED));
    writer.addDocument(d3);
  }
{
    Document d4=new Document();
    d4.add(newField("id","d4",nonAnalyzedType));
    d4.add(newField("hed","albino",TextField.TYPE_STORED));
    d4.add(newField("hed","elephant",nonAnalyzedType));
    d4.add(newField("dek","albino",TextField.TYPE_STORED));
    writer.addDocument(d4);
  }
  r=SlowCompositeReaderWrapper.wrap(writer.getReader());
  writer.close();
  s=newSearcher(r);
  s.setSimilarity(sim);
}
