{
  File a=new File(System.getProperty("user.home"),"indexStoreA");
  File b=new File(System.getProperty("user.home"),"indexStoreB");
  FSDirectory indexStoreA=FSDirectory.getDirectory(a,true);
  FSDirectory indexStoreB=FSDirectory.getDirectory(b,true);
  Document lDoc=new Document();
  lDoc.add(Field.Text("fulltext","Once upon a time....."));
  lDoc.add(Field.Keyword("id","doc1"));
  lDoc.add(Field.Keyword("handle","1"));
  Document lDoc2=new Document();
  lDoc2.add(Field.Text("fulltext","in a galaxy far far away....."));
  lDoc2.add(Field.Keyword("id","doc2"));
  lDoc2.add(Field.Keyword("handle","1"));
  Document lDoc3=new Document();
  lDoc3.add(Field.Text("fulltext","a bizarre bug manifested itself...."));
  lDoc3.add(Field.Keyword("id","doc3"));
  lDoc3.add(Field.Keyword("handle","1"));
  IndexWriter writerA=new IndexWriter(indexStoreA,new StandardAnalyzer(),true);
  IndexWriter writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),true);
  writerA.addDocument(lDoc);
  writerA.addDocument(lDoc2);
  writerA.addDocument(lDoc3);
  writerA.close();
  writerA.optimize();
  writerB.close();
  Query query=QueryParser.parse("handle:1","fulltext",new StandardAnalyzer());
  Searcher[] searchers=new Searcher[2];
  searchers[0]=new IndexSearcher(indexStoreB);
  searchers[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher=new MultiSearcher(searchers);
  Hits hits=mSearcher.search(query);
  assertEquals(3,hits.length());
  try {
    for (int i=0; i < hits.length(); i++) {
      Document d=hits.doc(i);
    }
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    fail("ArrayIndexOutOfBoundsException thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher.close();
  }
  writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),false);
  writerB.addDocument(lDoc);
  writerB.optimize();
  writerB.close();
  Searcher[] searchers2=new Searcher[2];
  searchers2[0]=new IndexSearcher(indexStoreB);
  searchers2[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher2=new MultiSearcher(searchers2);
  Hits hits2=mSearcher2.search(query);
  assertEquals(4,hits2.length());
  try {
    for (int i=0; i < hits2.length(); i++) {
      Document d=hits2.doc(i);
    }
  }
 catch (  Exception e) {
    fail("Exception thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher2.close();
  }
  Term term=new Term("id","doc1");
  IndexReader readerB=IndexReader.open(indexStoreB);
  readerB.delete(term);
  readerB.close();
  writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),false);
  writerB.optimize();
  writerB.close();
  Searcher[] searchers3=new Searcher[2];
  searchers3[0]=new IndexSearcher(indexStoreB);
  searchers3[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher3=new MultiSearcher(searchers3);
  Hits hits3=mSearcher3.search(query);
  assertEquals(3,hits3.length());
  try {
    for (int i=0; i < hits3.length(); i++) {
      Document d=hits3.doc(i);
    }
  }
 catch (  IOException e) {
    fail("IOException thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher3.close();
  }
}
