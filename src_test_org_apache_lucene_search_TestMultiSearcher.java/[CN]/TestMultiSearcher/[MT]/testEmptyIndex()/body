{
  Directory indexStoreA=new RAMDirectory();
  Directory indexStoreB=new RAMDirectory();
  Document lDoc=new Document();
  lDoc.add(new Field("fulltext","Once upon a time.....",Field.Store.YES,Field.Index.TOKENIZED));
  lDoc.add(new Field("id","doc1",Field.Store.YES,Field.Index.UN_TOKENIZED));
  lDoc.add(new Field("handle","1",Field.Store.YES,Field.Index.UN_TOKENIZED));
  Document lDoc2=new Document();
  lDoc2.add(new Field("fulltext","in a galaxy far far away.....",Field.Store.YES,Field.Index.TOKENIZED));
  lDoc2.add(new Field("id","doc2",Field.Store.YES,Field.Index.UN_TOKENIZED));
  lDoc2.add(new Field("handle","1",Field.Store.YES,Field.Index.UN_TOKENIZED));
  Document lDoc3=new Document();
  lDoc3.add(new Field("fulltext","a bizarre bug manifested itself....",Field.Store.YES,Field.Index.TOKENIZED));
  lDoc3.add(new Field("id","doc3",Field.Store.YES,Field.Index.UN_TOKENIZED));
  lDoc3.add(new Field("handle","1",Field.Store.YES,Field.Index.UN_TOKENIZED));
  IndexWriter writerA=new IndexWriter(indexStoreA,new StandardAnalyzer(),true);
  IndexWriter writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),true);
  writerA.addDocument(lDoc);
  writerA.addDocument(lDoc2);
  writerA.addDocument(lDoc3);
  writerA.optimize();
  writerA.close();
  writerB.close();
  Query query=QueryParser.parse("handle:1","fulltext",new StandardAnalyzer());
  Searcher[] searchers=new Searcher[2];
  searchers[0]=new IndexSearcher(indexStoreB);
  searchers[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher=getMultiSearcherInstance(searchers);
  Hits hits=mSearcher.search(query);
  assertEquals(3,hits.length());
  try {
    for (int i=0; i < hits.length(); i++) {
      Document d=hits.doc(i);
    }
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    fail("ArrayIndexOutOfBoundsException thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher.close();
  }
  writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),false);
  writerB.addDocument(lDoc);
  writerB.optimize();
  writerB.close();
  Searcher[] searchers2=new Searcher[2];
  searchers2[0]=new IndexSearcher(indexStoreB);
  searchers2[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher2=getMultiSearcherInstance(searchers2);
  Hits hits2=mSearcher2.search(query);
  assertEquals(4,hits2.length());
  try {
    for (int i=0; i < hits2.length(); i++) {
      Document d=hits2.doc(i);
    }
  }
 catch (  Exception e) {
    fail("Exception thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher2.close();
  }
  Term term=new Term("id","doc1");
  IndexReader readerB=IndexReader.open(indexStoreB);
  readerB.delete(term);
  readerB.close();
  writerB=new IndexWriter(indexStoreB,new StandardAnalyzer(),false);
  writerB.optimize();
  writerB.close();
  Searcher[] searchers3=new Searcher[2];
  searchers3[0]=new IndexSearcher(indexStoreB);
  searchers3[1]=new IndexSearcher(indexStoreA);
  Searcher mSearcher3=getMultiSearcherInstance(searchers3);
  Hits hits3=mSearcher3.search(query);
  assertEquals(3,hits3.length());
  try {
    for (int i=0; i < hits3.length(); i++) {
      Document d=hits3.doc(i);
    }
  }
 catch (  IOException e) {
    fail("IOException thrown: " + e.getMessage());
    e.printStackTrace();
  }
 finally {
    mSearcher3.close();
  }
}
