{
  sb=(sb == null ? new StringBuffer() : sb);
  String sep="";
  while (true) {
    String line=reader.readLine();
    if (line == null) {
      openNextFile();
      continue;
    }
    if (line.startsWith(prefix)) {
      if (collectMatchLine) {
        sb.append(sep).append(line);
        sep=NEW_LINE;
      }
      break;
    }
    if (terminatingTag != null && line.startsWith(terminatingTag)) {
      sb.setLength(0);
      break;
    }
    if (collectAll) {
      sb.append(sep).append(line);
      sep=NEW_LINE;
    }
  }
  return sb;
}
