{
  Collection<SolrCore> coreList=new ArrayList<>();
  do {
    coreList.clear();
synchronized (modifyLock) {
      coreList.addAll(cores.values());
      cores.clear();
      coreList.addAll(transientCores.values());
      transientCores.clear();
      coreList.addAll(pendingCloses);
      pendingCloses.clear();
    }
    for (    SolrCore core : coreList) {
      MDCLoggingContext.setCore(core);
      try {
        core.close();
      }
 catch (      Throwable e) {
        SolrException.log(log,"Error shutting down core",e);
        if (e instanceof Error) {
          throw (Error)e;
        }
      }
 finally {
        MDCLoggingContext.clear();
      }
    }
  }
 while (coreList.size() > 0);
}
