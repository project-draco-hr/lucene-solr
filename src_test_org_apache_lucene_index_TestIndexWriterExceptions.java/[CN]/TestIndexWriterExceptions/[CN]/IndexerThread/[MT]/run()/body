{
  final Document doc=new Document();
  doc.add(new Field("content1","aaa bbb ccc ddd",Field.Store.YES,Field.Index.TOKENIZED));
  doc.add(new Field("content6","aaa bbb ccc ddd",Field.Store.NO,Field.Index.TOKENIZED,Field.TermVector.WITH_POSITIONS_OFFSETS));
  doc.add(new Field("content2","aaa bbb ccc ddd",Field.Store.YES,Field.Index.UN_TOKENIZED));
  doc.add(new Field("content3","aaa bbb ccc ddd",Field.Store.YES,Field.Index.NO));
  doc.add(new Field("content4","aaa bbb ccc ddd",Field.Store.NO,Field.Index.TOKENIZED));
  doc.add(new Field("content5","aaa bbb ccc ddd",Field.Store.NO,Field.Index.UN_TOKENIZED));
  doc.add(new Field("content7","aaa bbb ccc ddd",Field.Store.NO,Field.Index.UN_TOKENIZED,Field.TermVector.WITH_POSITIONS_OFFSETS));
  final Field idField=new Field("id","",Field.Store.YES,Field.Index.UN_TOKENIZED);
  doc.add(idField);
  final long stopTime=System.currentTimeMillis() + 3000;
  while (System.currentTimeMillis() < stopTime) {
    doFail.set(this);
    final String id="" + r.nextInt(50);
    idField.setValue(id);
    Term idTerm=new Term("id",id);
    try {
      writer.updateDocument(idTerm,doc);
    }
 catch (    RuntimeException re) {
      if (DEBUG) {
        System.out.println("EXC: ");
        re.printStackTrace(System.out);
      }
      try {
        _TestUtil.checkIndex(writer.getDirectory());
      }
 catch (      IOException ioe) {
        System.out.println(Thread.currentThread().getName() + ": unexpected exception1");
        ioe.printStackTrace(System.out);
        failure=ioe;
        break;
      }
    }
catch (    Throwable t) {
      System.out.println(Thread.currentThread().getName() + ": unexpected exception2");
      t.printStackTrace(System.out);
      failure=t;
      break;
    }
    doFail.set(null);
    try {
      writer.updateDocument(idTerm,doc);
    }
 catch (    Throwable t) {
      System.out.println(Thread.currentThread().getName() + ": unexpected exception3");
      t.printStackTrace(System.out);
      failure=t;
      break;
    }
  }
}
