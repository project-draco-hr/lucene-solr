{
  ArrayList<FacetRequest> requests=new ArrayList<FacetRequest>(expectedCounts.size());
  for (  String dim : expectedCounts.keySet()) {
    requests.add(new CountFacetRequest(new CategoryPath(dim),5));
  }
  FacetSearchParams fsp=new FacetSearchParams(requests,fip);
  FacetsCollector fc=FacetsCollector.create(fsp,indexReader,taxoReader);
  MatchAllDocsQuery base=new MatchAllDocsQuery();
  searcher.search(base,fc);
  List<FacetResult> facetResults=fc.getFacetResults();
  assertEquals(requests.size(),facetResults.size());
  for (  FacetResult res : facetResults) {
    FacetResultNode node=res.getFacetResultNode();
    String dim=node.label.components[0];
    assertEquals("wrong count for " + dim,expectedCounts.get(dim).intValue(),(int)node.value);
  }
}
