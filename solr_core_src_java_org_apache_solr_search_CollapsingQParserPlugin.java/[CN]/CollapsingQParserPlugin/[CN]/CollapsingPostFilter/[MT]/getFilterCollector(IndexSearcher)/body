{
  try {
    SolrIndexSearcher searcher=(SolrIndexSearcher)indexSearcher;
    CollectorFactory collectorFactory=new CollectorFactory();
    IntIntOpenHashMap boostDocsMap=null;
    Map context=null;
    SolrRequestInfo info=SolrRequestInfo.getRequestInfo();
    if (info != null) {
      context=info.getReq().getContext();
    }
    if (this.boosted == null && context != null) {
      this.boosted=(Map<BytesRef,Integer>)context.get(QueryElevationComponent.BOOSTED_PRIORITY);
    }
    boostDocsMap=getBoostDocs(searcher,this.boosted,context);
    return collectorFactory.getCollector(this.collapseField,this.min,this.max,this.nullPolicy,this.hint,this.needsScores,this.size,boostDocsMap,searcher);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
