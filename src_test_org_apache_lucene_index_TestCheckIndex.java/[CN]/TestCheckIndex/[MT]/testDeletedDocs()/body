{
  MockRAMDirectory dir=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir,new WhitespaceAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
  writer.setMaxBufferedDocs(2);
  Document doc=new Document();
  doc.add(new Field("field","aaa",Field.Store.YES,Field.Index.ANALYZED,Field.TermVector.WITH_POSITIONS_OFFSETS));
  for (int i=0; i < 19; i++) {
    writer.addDocument(doc);
  }
  writer.close();
  IndexReader reader=IndexReader.open(dir);
  reader.deleteDocument(5);
  reader.close();
  ByteArrayOutputStream bos=new ByteArrayOutputStream(1024);
  CheckIndex checker=new CheckIndex(dir);
  checker.setInfoStream(new PrintStream(bos));
  CheckIndex.Status indexStatus=checker.checkIndex();
  if (indexStatus.clean == false) {
    System.out.println("CheckIndex failed");
    System.out.println(bos.toString());
    fail();
  }
  assertTrue(((CheckIndex.Status.SegmentInfoStatus)indexStatus.segmentInfos.get(0)).openReaderPassed);
  final List onlySegments=new ArrayList();
  onlySegments.add("_0");
  assertTrue(checker.checkIndex(onlySegments).clean == true);
}
