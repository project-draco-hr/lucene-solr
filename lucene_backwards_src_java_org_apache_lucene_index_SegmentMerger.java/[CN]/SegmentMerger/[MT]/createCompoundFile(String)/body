{
  CompoundFileWriter cfsWriter=new CompoundFileWriter(directory,fileName,checkAbort);
  List<String> files=new ArrayList<String>(IndexFileNames.COMPOUND_EXTENSIONS.length + 1);
  for (int i=0; i < IndexFileNames.COMPOUND_EXTENSIONS.length; i++) {
    String ext=IndexFileNames.COMPOUND_EXTENSIONS[i];
    if (ext.equals(IndexFileNames.PROX_EXTENSION) && !hasProx())     continue;
    if (mergeDocStores || (!ext.equals(IndexFileNames.FIELDS_EXTENSION) && !ext.equals(IndexFileNames.FIELDS_INDEX_EXTENSION)))     files.add(segment + "." + ext);
  }
  for (int i=0; i < fieldInfos.size(); i++) {
    FieldInfo fi=fieldInfos.fieldInfo(i);
    if (fi.isIndexed && !fi.omitNorms) {
      files.add(segment + "." + IndexFileNames.NORMS_EXTENSION);
      break;
    }
  }
  if (fieldInfos.hasVectors() && mergeDocStores) {
    for (int i=0; i < IndexFileNames.VECTOR_EXTENSIONS.length; i++) {
      files.add(segment + "." + IndexFileNames.VECTOR_EXTENSIONS[i]);
    }
  }
  for (  String file : files) {
    cfsWriter.addFile(file);
  }
  cfsWriter.close();
  return files;
}
