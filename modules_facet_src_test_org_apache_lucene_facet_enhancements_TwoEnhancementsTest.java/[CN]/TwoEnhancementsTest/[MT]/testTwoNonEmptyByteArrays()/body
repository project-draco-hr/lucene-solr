{
  Directory indexDir=new RAMDirectory();
  Directory taxoDir=new RAMDirectory();
  EnhancementsIndexingParams indexingParams=new DefaultEnhancementsIndexingParams(new CategoryEnhancementDummy2(),new CategoryEnhancementDummy3());
  List<CategoryPath> categoryPaths=new ArrayList<CategoryPath>();
  categoryPaths.add(new CategoryPath("a","b"));
  IndexWriter indexWriter=new IndexWriter(indexDir,new IndexWriterConfig(TEST_VERSION_CURRENT,new WhitespaceAnalyzer(TEST_VERSION_CURRENT)));
  TaxonomyWriter taxo=new LuceneTaxonomyWriter(taxoDir);
  Document doc=new Document();
  indexWriter.addDocument(new EnhancementsDocumentBuilder(taxo,indexingParams).setCategoryPaths(categoryPaths).build(doc));
  indexWriter.close();
  IndexReader indexReader=IndexReader.open(indexDir);
  Term term=DrillDown.term(indexingParams,new CategoryPath("a","b"));
  EnhancementsPayloadIterator iterator=new EnhancementsPayloadIterator(indexingParams.getCategoryEnhancements(),indexReader,term);
  assertTrue("EnhancementsPayloadIterator failure",iterator.init());
  assertTrue("Missing document 0",iterator.setdoc(0));
  byte[] dummy2=(byte[])iterator.getCategoryData(new CategoryEnhancementDummy2());
  assertTrue("Bad array returned for CategoryEnhancementDummy2",Arrays.equals(dummy2,CategoryEnhancementDummy2.CATEGORY_TOKEN_BYTES));
  byte[] dummy3=(byte[])iterator.getCategoryData(new CategoryEnhancementDummy3());
  assertTrue("Bad array returned for CategoryEnhancementDummy3",Arrays.equals(dummy3,CategoryEnhancementDummy3.CATEGORY_TOKEN_BYTES));
}
