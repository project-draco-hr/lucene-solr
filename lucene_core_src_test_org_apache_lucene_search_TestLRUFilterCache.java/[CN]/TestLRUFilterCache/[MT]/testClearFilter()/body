{
  Directory dir=newDirectory();
  final RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  Document doc=new Document();
  StringField f=new StringField("color","",Store.NO);
  doc.add(f);
  final int numDocs=atLeast(10);
  for (int i=0; i < numDocs; ++i) {
    f.setStringValue(random().nextBoolean() ? "red" : "blue");
    w.addDocument(doc);
  }
  final DirectoryReader reader=w.getReader();
  final LeafReaderContext leaf1=reader.leaves().get(0);
  final Filter filter1=new QueryWrapperFilter(new TermQuery(new Term("color","blue")));
  final Filter filter2=new QueryWrapperFilter(new TermQuery(new Term("color","blue")));
  final LRUFilterCache filterCache=new LRUFilterCache(Integer.MAX_VALUE,Long.MAX_VALUE);
  final Filter cachedFilter1=filterCache.doCache(filter1,FilterCachingPolicy.ALWAYS_CACHE);
  cachedFilter1.getDocIdSet(leaf1,null);
  filterCache.clearFilter(filter2);
  assertTrue(filterCache.cachedFilters().isEmpty());
  filterCache.assertConsistent();
  reader.close();
  w.close();
  dir.close();
}
