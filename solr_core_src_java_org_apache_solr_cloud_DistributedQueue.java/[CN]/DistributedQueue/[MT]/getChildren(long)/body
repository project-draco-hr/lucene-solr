{
  LatchChildWatcher watcher=childrenWatcher;
  TreeMap<Long,String> children=new TreeMap<>();
  if (watcher == null || watcher.getWatchedEvent() != null) {
    watcher=new LatchChildWatcher();
    while (true) {
      try {
        children=orderedChildren(watcher);
        break;
      }
 catch (      KeeperException.NoNodeException e) {
        zookeeper.create(dir,new byte[0],acl,CreateMode.PERSISTENT,true);
      }
    }
    childrenWatcher=watcher;
  }
  while (true) {
    if (!children.isEmpty())     break;
    watcher.await(wait == Long.MAX_VALUE ? DEFAULT_TIMEOUT : wait);
    if (watcher.getWatchedEvent() != null) {
      children=orderedChildren(null);
    }
    if (wait != Long.MAX_VALUE)     break;
  }
  return children;
}
