{
  TimerContext time=null;
  if (wait == Long.MAX_VALUE) {
    time=stats.time(dir + "_peek_wait_forever");
  }
 else {
    time=stats.time(dir + "_peek_wait" + wait);
  }
  try {
    if (wait == 0) {
      return element();
    }
    TreeMap<Long,String> orderedChildren=getChildren(wait);
    for (    String headNode : orderedChildren.values()) {
      String path=dir + "/" + headNode;
      try {
        byte[] data=zookeeper.getData(path,null,null,true);
        return new QueueEvent(path,data,null);
      }
 catch (      KeeperException.NoNodeException e) {
      }
    }
    return null;
  }
  finally {
    time.stop();
  }
}
