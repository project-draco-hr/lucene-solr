{
  updateLock.lockInterruptibly();
  try {
    if (lastWatcher != null && !knownChildren.isEmpty()) {
      return remove ? knownChildren.pollFirst() : knownChildren.first();
    }
    ChildWatcher newWatcher=new ChildWatcher();
    knownChildren=fetchZkChildren(newWatcher);
    lastWatcher=newWatcher;
    if (knownChildren.isEmpty()) {
      return null;
    }
    changed.signalAll();
    return remove ? knownChildren.pollFirst() : knownChildren.first();
  }
  finally {
    updateLock.unlock();
  }
}
