{
  TimerContext timer=stats.time(dir + "_take");
  updateLock.lockInterruptibly();
  try {
    while (true) {
      byte[] result=removeFirst();
      if (result != null) {
        return result;
      }
      notEmpty.await();
    }
  }
  finally {
    updateLock.unlock();
    timer.stop();
  }
}
