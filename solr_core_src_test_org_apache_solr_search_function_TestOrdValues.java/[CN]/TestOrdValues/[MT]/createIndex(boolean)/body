{
  if (VERBOSE) {
    System.out.println("TEST: setUp");
  }
  dir=newDirectory();
  anlzr=new MockAnalyzer(random());
  IndexWriterConfig iwc=newIndexWriterConfig(anlzr).setMergePolicy(newLogMergePolicy());
  if (doMultiSegment) {
    iwc.setMaxBufferedDocs(TestUtil.nextInt(random(),2,7));
  }
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,iwc);
  int remaining=N_DOCS;
  boolean done[]=new boolean[N_DOCS];
  int i=0;
  while (remaining > 0) {
    if (done[i]) {
      throw new Exception("to set this test correctly N_DOCS=" + N_DOCS + " must be primary and greater than 2!");
    }
    addDoc(iw,i);
    done[i]=true;
    i=(i + 4) % N_DOCS;
    remaining--;
  }
  if (!doMultiSegment) {
    if (VERBOSE) {
      System.out.println("TEST: setUp full merge");
    }
    iw.forceMerge(1);
  }
  iw.shutdown();
  if (VERBOSE) {
    System.out.println("TEST: setUp done close");
  }
}
