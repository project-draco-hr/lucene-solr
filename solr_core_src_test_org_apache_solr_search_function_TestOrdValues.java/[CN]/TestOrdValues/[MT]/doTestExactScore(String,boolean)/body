{
  IndexReader r=DirectoryReader.open(dir);
  IndexSearcher s=newSearcher(r);
  ValueSource vs;
  if (inOrder) {
    vs=new OrdFieldSource(field);
  }
 else {
    vs=new ReverseOrdFieldSource(field);
  }
  Query q=new FunctionQuery(vs);
  TopDocs td=s.search(q,1000);
  assertEquals("All docs should be matched!",N_DOCS,td.totalHits);
  ScoreDoc sd[]=td.scoreDocs;
  for (int i=0; i < sd.length; i++) {
    float score=sd[i].score;
    String id=s.getIndexReader().document(sd[i].doc).get(ID_FIELD);
    log("-------- " + i + ". Explain doc "+ id);
    log(s.explain(q,sd[i].doc));
    float expectedScore=N_DOCS - i - 1;
    assertEquals("score of result " + i + " shuould be "+ expectedScore+ " != "+ score,expectedScore,score,TEST_SCORE_TOLERANCE_DELTA);
    String expectedId=inOrder ? id2String(N_DOCS - i) : id2String(i + 1);
    assertTrue("id of result " + i + " shuould be "+ expectedId+ " != "+ score,expectedId.equals(id));
  }
  r.close();
}
