{
  Query rewritten=query.rewrite(reader);
  if (rewritten.getClass() == getClass()) {
    if (getBoost() != rewritten.getBoost()) {
      rewritten=rewritten.clone();
      rewritten.setBoost(getBoost());
    }
    return rewritten;
  }
  if (rewritten != query) {
    rewritten=new ConstantScoreQuery(rewritten);
    rewritten.setBoost(this.getBoost());
    return rewritten;
  }
  return this;
}
