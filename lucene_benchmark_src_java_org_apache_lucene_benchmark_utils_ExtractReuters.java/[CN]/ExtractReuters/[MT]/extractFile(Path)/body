{
  try (BufferedReader reader=Files.newBufferedReader(sgmFile,StandardCharsets.UTF_8)){
    StringBuilder buffer=new StringBuilder(1024);
    StringBuilder outBuffer=new StringBuilder(1024);
    String line=null;
    int docNumber=0;
    while ((line=reader.readLine()) != null) {
      if (line.indexOf("</REUTERS") == -1) {
        buffer.append(line).append(' ');
      }
 else {
        Matcher matcher=EXTRACTION_PATTERN.matcher(buffer);
        while (matcher.find()) {
          for (int i=1; i <= matcher.groupCount(); i++) {
            if (matcher.group(i) != null) {
              outBuffer.append(matcher.group(i));
            }
          }
          outBuffer.append(System.lineSeparator()).append(System.lineSeparator());
        }
        String out=outBuffer.toString();
        for (int i=0; i < META_CHARS_SERIALIZATIONS.length; i++) {
          out=out.replaceAll(META_CHARS_SERIALIZATIONS[i],META_CHARS[i]);
        }
        Path outFile=outputDir.resolve(sgmFile.getFileName() + "-" + (docNumber++)+ ".txt");
        try (BufferedWriter writer=Files.newBufferedWriter(outFile,StandardCharsets.UTF_8)){
          writer.write(out);
        }
         outBuffer.setLength(0);
        buffer.setLength(0);
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
