{
  if (bindings == null)   throw new NullPointerException();
  if (expression == null)   throw new NullPointerException();
  this.expression=expression;
  variables=new ValueSource[expression.variables.length];
  boolean needsScores=false;
  for (int i=0; i < variables.length; i++) {
    ValueSource source=bindings.getValueSource(expression.variables[i]);
    if (source instanceof ScoreValueSource) {
      needsScores=true;
    }
 else     if (source instanceof ExpressionValueSource) {
      if (((ExpressionValueSource)source).needsScores()) {
        needsScores=true;
      }
    }
 else     if (source == null) {
      throw new RuntimeException("Internal error. Variable (" + expression.variables[i] + ") does not exist.");
    }
    variables[i]=source;
  }
  this.needsScores=needsScores;
}
