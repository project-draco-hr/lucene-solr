{
  ValueSource source;
  Map<String,FunctionValues> valuesCache=(Map<String,FunctionValues>)context.get("valuesCache");
  if (valuesCache == null) {
    throw new NullPointerException();
  }
  FunctionValues[] externalValues=new FunctionValues[expression.variables.length];
  for (int i=0; i < expression.variables.length; ++i) {
    String externalName=expression.variables[i];
    FunctionValues values=valuesCache.get(externalName);
    if (values == null) {
      source=bindings.getValueSource(externalName);
      values=source.getValues(context,readerContext);
      if (values == null) {
        throw new RuntimeException("Internal error. External (" + externalName + ") does not exist.");
      }
      valuesCache.put(externalName,values);
    }
    externalValues[i]=values;
  }
  return new ExpressionFunctionValues(expression,externalValues);
}
