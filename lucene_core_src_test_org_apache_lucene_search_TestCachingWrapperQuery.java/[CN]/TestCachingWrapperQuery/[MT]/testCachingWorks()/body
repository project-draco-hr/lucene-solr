{
  Directory dir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random(),dir);
  writer.close();
  IndexReader reader=SlowCompositeReaderWrapper.wrap(DirectoryReader.open(dir));
  IndexSearcher searcher=newSearcher(reader);
  LeafReaderContext context=(LeafReaderContext)reader.getContext();
  MockFilter filter=new MockFilter();
  CachingWrapperQuery cacher=new CachingWrapperQuery(filter,QueryCachingPolicy.ALWAYS_CACHE);
  cacher.createWeight(searcher,false).scorer(context,context.reader().getLiveDocs());
  assertTrue("first time",filter.wasCalled());
  cacher.createWeight(searcher,false).scorer(context,context.reader().getLiveDocs());
  filter.clear();
  cacher.createWeight(searcher,false).scorer(context,context.reader().getLiveDocs());
  assertFalse("second time",filter.wasCalled());
  reader.close();
  dir.close();
}
