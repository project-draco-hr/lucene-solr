{
  if (!writers.isEmpty()) {
    DocValuesFormat fmt=state.segmentInfo.getCodec().docValuesFormat();
    DocValuesConsumer dvConsumer=fmt.fieldsConsumer(state);
    boolean success=false;
    try {
      for (      DocValuesWriter writer : writers.values()) {
        writer.finish(state.segmentInfo.getDocCount());
        writer.flush(state,dvConsumer);
      }
      writers.clear();
      success=true;
    }
  finally {
      if (success) {
        IOUtils.close(dvConsumer);
      }
 else {
        IOUtils.closeWhileHandlingException(dvConsumer);
      }
    }
  }
}
