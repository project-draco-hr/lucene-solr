{
  if (!writers.isEmpty()) {
    DocValuesFormat fmt=state.segmentInfo.getCodec().docValuesFormat();
    if (fmt == null) {
      return;
    }
    DocValuesConsumer dvConsumer=fmt.fieldsConsumer(state);
    if (dvConsumer == null) {
      return;
    }
    for (    DocValuesWriter writer : writers.values()) {
      writer.finish(state.segmentInfo.getDocCount());
      writer.flush(state,dvConsumer);
    }
    writers.clear();
    dvConsumer.close();
  }
}
