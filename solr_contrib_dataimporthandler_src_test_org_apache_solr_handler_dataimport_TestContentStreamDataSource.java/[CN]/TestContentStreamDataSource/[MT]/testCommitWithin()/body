{
  DirectXmlRequest req=new DirectXmlRequest("/dataimport",xml);
  ModifiableSolrParams params=params("command","full-import","clean","false",UpdateParams.COMMIT,"false",UpdateParams.COMMIT_WITHIN,"1000");
  req.setParams(params);
  try (HttpSolrClient solrServer=new HttpSolrClient(buildUrl(jetty.getLocalPort(),"/solr/collection1"))){
    solrServer.request(req);
    Thread.sleep(100);
    ModifiableSolrParams queryAll=params("q","*");
    QueryResponse qres=solrServer.query(queryAll);
    SolrDocumentList results=qres.getResults();
    assertEquals(0,results.getNumFound());
    Thread.sleep(1000);
    for (int i=0; i < 10; i++) {
      qres=solrServer.query(queryAll);
      results=qres.getResults();
      if (2 == results.getNumFound()) {
        return;
      }
      Thread.sleep(500);
    }
  }
   fail("Commit should have occured but it did not");
}
