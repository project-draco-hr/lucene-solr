{
  ClusterState clusterState=req.getCore().getCoreDescriptor().getCoreContainer().getZkController().getClusterState();
  List<Node> urls=new ArrayList<Node>();
  Map<String,Slice> slices=clusterState.getSlices(collection);
  if (slices == null) {
    throw new ZooKeeperException(ErrorCode.BAD_REQUEST,"Could not find collection in zk: " + clusterState);
  }
  for (  Map.Entry<String,Slice> sliceEntry : slices.entrySet()) {
    Slice replicas=slices.get(sliceEntry.getKey());
    Map<String,ZkNodeProps> shardMap=replicas.getShards();
    for (    Entry<String,ZkNodeProps> entry : shardMap.entrySet()) {
      ZkCoreNodeProps nodeProps=new ZkCoreNodeProps(entry.getValue());
      if (clusterState.liveNodesContain(nodeProps.getNodeName()) && !entry.getKey().equals(shardZkNodeName)) {
        urls.add(new StdNode(nodeProps));
      }
    }
  }
  if (urls.size() == 0) {
    return null;
  }
  return urls;
}
