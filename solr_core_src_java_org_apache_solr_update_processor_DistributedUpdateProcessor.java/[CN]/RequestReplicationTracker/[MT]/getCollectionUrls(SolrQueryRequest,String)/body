{
  ClusterState clusterState=req.getCore().getCoreDescriptor().getCoreContainer().getZkController().getClusterState();
  Map<String,Slice> slices=clusterState.getSlicesMap(collection);
  if (slices == null) {
    throw new ZooKeeperException(ErrorCode.BAD_REQUEST,"Could not find collection in zk: " + clusterState);
  }
  final List<Node> urls=new ArrayList<>(slices.size());
  for (  Map.Entry<String,Slice> sliceEntry : slices.entrySet()) {
    Slice replicas=slices.get(sliceEntry.getKey());
    Map<String,Replica> shardMap=replicas.getReplicasMap();
    for (    Entry<String,Replica> entry : shardMap.entrySet()) {
      ZkCoreNodeProps nodeProps=new ZkCoreNodeProps(entry.getValue());
      if (clusterState.liveNodesContain(nodeProps.getNodeName())) {
        urls.add(new StdNode(nodeProps,collection,replicas.getName()));
      }
    }
  }
  if (urls.isEmpty()) {
    return null;
  }
  return urls;
}
