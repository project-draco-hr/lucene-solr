{
  Collection<Slice> allSlices=coll.getSlices();
  List<Node> nodes=null;
  for (  Slice aslice : allSlices) {
    final Slice.State state=aslice.getState();
    if (state == Slice.State.CONSTRUCTION || state == Slice.State.RECOVERY) {
      DocRouter.Range myRange=coll.getSlice(shardId).getRange();
      if (myRange == null)       myRange=new DocRouter.Range(Integer.MIN_VALUE,Integer.MAX_VALUE);
      boolean isSubset=aslice.getRange() != null && aslice.getRange().isSubsetOf(myRange);
      if (isSubset && (docId == null || (docId != null && coll.getRouter().isTargetSlice(docId,doc,req.getParams(),aslice.getName(),coll)))) {
        Replica sliceLeader=aslice.getLeader();
        if (sliceLeader != null && zkController.getClusterState().liveNodesContain(sliceLeader.getNodeName())) {
          if (nodes == null)           nodes=new ArrayList<>();
          ZkCoreNodeProps nodeProps=new ZkCoreNodeProps(sliceLeader);
          nodes.add(new StdNode(nodeProps,coll.getName(),shardId));
        }
      }
    }
  }
  return nodes;
}
