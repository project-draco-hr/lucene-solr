{
  if (!AtomicUpdateDocumentMerger.isAtomicUpdate(cmd))   return false;
  SolrInputDocument sdoc=cmd.getSolrInputDocument();
  BytesRef id=cmd.getIndexedId();
  SolrInputDocument oldDoc=RealTimeGetComponent.getInputDocument(cmd.getReq().getCore(),id);
  if (oldDoc == null) {
    if (versionOnUpdate <= 0) {
      oldDoc=new SolrInputDocument();
    }
 else {
      throw new SolrException(ErrorCode.CONFLICT,"Document not found for update.  id=" + cmd.getPrintableId());
    }
  }
 else {
    oldDoc.remove(VERSION_FIELD);
  }
  cmd.solrDoc=docMerger.merge(sdoc,oldDoc);
  return true;
}
