{
  if (req.getCore().getCoreDescriptor().getCoreContainer().isShutDown()) {
    throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"CoreContainer is shutting down.");
  }
  if ((updateCommand.getFlags() & (UpdateCommand.REPLAY | UpdateCommand.PEER_SYNC)) != 0) {
    return;
  }
  if (!zkController.getZkClient().getConnectionManager().isLikelyExpired()) {
    return;
  }
  throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"Cannot talk to ZooKeeper - Updates are disabled.");
}
