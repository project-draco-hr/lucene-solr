{
  Map<String,ZkNodeProps> shardNameToProps=new HashMap<String,ZkNodeProps>();
  if (zkClient.exists(shardsZkPath,null) == null) {
    throw new IllegalStateException("Cannot find zk shards node that should exist:" + shardsZkPath);
  }
  List<String> shardZkPaths=zkClient.getChildren(shardsZkPath,null);
  for (  String shardPath : shardZkPaths) {
    ZkNodeProps props;
    if (oldSlice != null && oldSlice.getShards().containsKey(shardPath)) {
      props=oldSlice.getShards().get(shardPath);
    }
 else {
      byte[] data=zkClient.getData(shardsZkPath + "/" + shardPath,null,null);
      props=new ZkNodeProps();
      props.load(data);
    }
    shardNameToProps.put(shardPath,props);
  }
  return Collections.unmodifiableMap(shardNameToProps);
}
