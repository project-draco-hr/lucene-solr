{
  Bits mappedLiveDocs=randomLiveDocs(sortedReader.maxDoc());
  TermsEnum termsEnum=sortedReader.terms(DOCS_ENUM_FIELD).iterator();
  assertEquals(SeekStatus.FOUND,termsEnum.seekCeil(new BytesRef(DOCS_ENUM_TERM)));
  PostingsEnum docs=termsEnum.postings(mappedLiveDocs,null);
  int doc;
  int prev=-1;
  while ((doc=docs.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    assertTrue("document " + doc + " marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(doc));
    assertEquals("incorrect value; doc " + doc,sortedValues[doc].intValue(),Integer.parseInt(sortedReader.document(doc).get(ID_FIELD)));
    while (++prev < doc) {
      assertFalse("document " + prev + " not marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(prev));
    }
  }
  while (++prev < sortedReader.maxDoc()) {
    assertFalse("document " + prev + " not marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(prev));
  }
  PostingsEnum reuse=docs;
  docs=termsEnum.postings(mappedLiveDocs,reuse);
  if (docs instanceof SortingDocsEnum) {
    assertTrue(((SortingDocsEnum)docs).reused(reuse));
  }
  doc=-1;
  prev=-1;
  while ((doc=docs.advance(doc + 1)) != DocIdSetIterator.NO_MORE_DOCS) {
    assertTrue("document " + doc + " marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(doc));
    assertEquals("incorrect value; doc " + doc,sortedValues[doc].intValue(),Integer.parseInt(sortedReader.document(doc).get(ID_FIELD)));
    while (++prev < doc) {
      assertFalse("document " + prev + " not marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(prev));
    }
  }
  while (++prev < sortedReader.maxDoc()) {
    assertFalse("document " + prev + " not marked as deleted",mappedLiveDocs == null || mappedLiveDocs.get(prev));
  }
}
