{
  TermsEnum termsEnum=sortedReader.terms(DOC_POSITIONS_FIELD).iterator(null);
  assertEquals(SeekStatus.FOUND,termsEnum.seekCeil(new BytesRef(DOC_POSITIONS_TERM)));
  DocsAndPositionsEnum sortedPositions=termsEnum.docsAndPositions(null,null);
  int doc;
  while ((doc=sortedPositions.nextDoc()) != DocIdSetIterator.NO_MORE_DOCS) {
    int freq=sortedPositions.freq();
    assertEquals("incorrect freq for doc=" + doc,sortedValues[doc].intValue() / 10 + 1,freq);
    for (int i=0; i < freq; i++) {
      assertEquals("incorrect position for doc=" + doc,i,sortedPositions.nextPosition());
      assertEquals("incorrect startOffset for doc=" + doc,i,sortedPositions.startOffset());
      assertEquals("incorrect endOffset for doc=" + doc,i,sortedPositions.endOffset());
      assertEquals("incorrect payload for doc=" + doc,freq - i,Integer.parseInt(sortedPositions.getPayload().utf8ToString()));
    }
  }
  final DocsAndPositionsEnum reuse=sortedPositions;
  sortedPositions=termsEnum.docsAndPositions(null,reuse);
  if (sortedPositions instanceof SortingDocsAndPositionsEnum) {
    assertTrue(((SortingDocsAndPositionsEnum)sortedPositions).reused(reuse));
  }
  doc=0;
  while ((doc=sortedPositions.advance(doc + TestUtil.nextInt(random(),1,5))) != DocIdSetIterator.NO_MORE_DOCS) {
    int freq=sortedPositions.freq();
    assertEquals("incorrect freq for doc=" + doc,sortedValues[doc].intValue() / 10 + 1,freq);
    for (int i=0; i < freq; i++) {
      assertEquals("incorrect position for doc=" + doc,i,sortedPositions.nextPosition());
      assertEquals("incorrect startOffset for doc=" + doc,i,sortedPositions.startOffset());
      assertEquals("incorrect endOffset for doc=" + doc,i,sortedPositions.endOffset());
      assertEquals("incorrect payload for doc=" + doc,freq - i,Integer.parseInt(sortedPositions.getPayload().utf8ToString()));
    }
  }
}
