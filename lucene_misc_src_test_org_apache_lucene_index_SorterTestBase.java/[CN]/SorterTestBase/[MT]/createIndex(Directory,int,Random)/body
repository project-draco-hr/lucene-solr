{
  List<Integer> ids=new ArrayList<>();
  for (int i=0; i < numDocs; i++) {
    ids.add(Integer.valueOf(i * 10));
  }
  Collections.shuffle(ids,random);
  if (VERBOSE) {
    System.out.println("Shuffled IDs for indexing: " + Arrays.toString(ids.toArray()));
  }
  PositionsTokenStream positions=new PositionsTokenStream();
  IndexWriterConfig conf=newIndexWriterConfig(new MockAnalyzer(random));
  conf.setMaxBufferedDocs(4);
  conf.setSimilarity(new NormsSimilarity(conf.getSimilarity()));
  RandomIndexWriter writer=new RandomIndexWriter(random,dir,conf);
  writer.setDoRandomForceMerge(false);
  for (  int id : ids) {
    writer.addDocument(doc(id,positions));
  }
  writer.commit();
  for (  Integer id : ids) {
    if (random.nextDouble() < 0.2) {
      if (VERBOSE) {
        System.out.println("delete doc_id " + id);
      }
      writer.deleteDocuments(new Term(ID_FIELD,id.toString()));
    }
  }
  writer.close();
}
