{
  RAMFile file=new RAMFile();
  IndexOutput output=new RAMOutputStream(file,true);
  CodecUtil.writeHeader(output,"FooBar",5);
  output.writeString("this is the data");
  output.writeInt(CodecUtil.FOOTER_MAGIC);
  output.writeInt(0);
  output.writeLong(1234567);
  output.close();
  ChecksumIndexInput input=new BufferedChecksumIndexInput(new RAMInputStream("file",file));
  CodecUtil.checkHeader(input,"FooBar",5,5);
  assertEquals("this is the data",input.readString());
  Exception mine=new RuntimeException("fake exception");
  try {
    CodecUtil.checkFooter(input,mine);
    fail("didn't get expected exception");
  }
 catch (  RuntimeException expected) {
    assertEquals("fake exception",expected.getMessage());
    Throwable suppressed[]=expected.getSuppressed();
    assertEquals(1,suppressed.length);
    assertTrue(suppressed[0].getMessage().contains("checksum failed"));
  }
  input.close();
}
