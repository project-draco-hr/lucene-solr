{
  in.reset();
  writeHeader();
  int pos=-1;
  int lastEndPos=-1;
  while (in.incrementToken()) {
    final boolean isFirst=pos == -1;
    int posInc=posIncAtt.getPositionIncrement();
    if (isFirst && posInc == 0) {
      System.err.println("WARNING: first posInc was 0; correcting to 1");
      posInc=1;
    }
    if (posInc > 0) {
      pos+=posInc;
      writeNode(pos,Integer.toString(pos));
    }
    if (posInc > 1) {
      writeArc(lastEndPos,pos,null,"dotted");
    }
    if (isFirst) {
      writeNode(-1,null);
      writeArc(-1,pos,null,null);
    }
    String arcLabel=termAtt.toString();
    if (offsetAtt != null) {
      final int startOffset=offsetAtt.startOffset();
      final int endOffset=offsetAtt.endOffset();
      if (inputText != null) {
        arcLabel+=" / " + inputText.substring(startOffset,endOffset);
      }
 else {
        arcLabel+=" / " + startOffset + "-"+ endOffset;
      }
    }
    writeArc(pos,pos + posLengthAtt.getPositionLength(),arcLabel,null);
    lastEndPos=pos + posLengthAtt.getPositionLength();
  }
  in.end();
  if (lastEndPos != -1) {
    writeNode(-2,null);
    writeArc(lastEndPos,-2,null,null);
  }
  writeTrailer();
}
