{
  String collectionName="delDeadColl";
  createCollection(collectionName,client);
  waitForRecoveriesToFinish(collectionName,false);
  boolean stopped=false;
  JettySolrRunner stoppedJetty=null;
  StringBuilder sb=new StringBuilder();
  Replica replica1=null;
  Slice shard1=null;
  DocCollection testcoll=getCommonCloudSolrServer().getZkStateReader().getClusterState().getCollection(collectionName);
  for (  JettySolrRunner jetty : jettys)   sb.append(jetty.getBaseUrl()).append(",");
  for (  Slice slice : testcoll.getActiveSlices()) {
    for (    Replica replica : slice.getReplicas())     for (    JettySolrRunner jetty : jettys) {
      URL baseUrl=null;
      try {
        baseUrl=jetty.getBaseUrl();
      }
 catch (      Exception e) {
        continue;
      }
      if (baseUrl.toString().startsWith(replica.getStr(ZkStateReader.BASE_URL_PROP))) {
        stoppedJetty=jetty;
        ChaosMonkey.stop(jetty);
        replica1=replica;
        shard1=slice;
        stopped=true;
        break;
      }
    }
  }
  if (!stopped) {
    fail("Could not find jetty to stop in collection " + testcoll + " jettys: "+ sb);
  }
  long endAt=System.currentTimeMillis() + 3000;
  boolean success=false;
  while (System.currentTimeMillis() < endAt) {
    testcoll=getCommonCloudSolrServer().getZkStateReader().getClusterState().getCollection(collectionName);
    if (!"active".equals(testcoll.getSlice(shard1.getName()).getReplica(replica1.getName()).getStr(Slice.STATE))) {
      success=true;
    }
    if (success)     break;
    Thread.sleep(100);
  }
  log.info("removed_replicas {}/{} ",shard1.getName(),replica1.getName());
  removeAndWaitForReplicaGone(collectionName,client,replica1,shard1.getName());
  ChaosMonkey.start(stoppedJetty);
  log.info("restarted jetty");
  Map m=makeMap("qt","/admin/cores","action","status");
  NamedList<Object> resp=new HttpSolrServer(replica1.getStr("base_url")).request(new QueryRequest(new MapSolrParams(m)));
  assertNull("The core is up and running again",((NamedList)resp.get("status")).get(replica1.getStr("core")));
}
