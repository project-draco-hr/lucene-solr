{
  Directory dir=newDirectory();
  RandomIndexWriter w=new RandomIndexWriter(random(),dir);
  final int numDocs=atLeast(100);
  for (int i=0; i < numDocs; ++i) {
    w.addDocument(new Document());
  }
  final IndexReader reader=w.getReader();
  for (  float minSizeRatio : new float[]{Float.MIN_VALUE,0.01f,0.1f,0.9f}) {
    final QueryCachingPolicy policy=new QueryCachingPolicy.CacheOnLargeSegments(0,minSizeRatio);
    for (    LeafReaderContext ctx : reader.leaves()) {
      final Query query=new TermQuery(new Term("field","value"));
      final boolean shouldCache=policy.shouldCache(query,ctx);
      final float sizeRatio=(float)ctx.reader().maxDoc() / reader.maxDoc();
      assertEquals(sizeRatio >= minSizeRatio,shouldCache);
      assertTrue(new QueryCachingPolicy.CacheOnLargeSegments(numDocs,Float.MIN_VALUE).shouldCache(query,ctx));
      assertFalse(new QueryCachingPolicy.CacheOnLargeSegments(numDocs + 1,Float.MIN_VALUE).shouldCache(query,ctx));
    }
  }
  reader.close();
  w.close();
  dir.close();
}
