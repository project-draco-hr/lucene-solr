{
  if (parentEncapsulation) {
    for (int i=0, n=documents.size(); i < n; i++) {
      Document d=(Document)documents.get(i);
      for (Enumeration e=d.fields(); e.hasMoreElements(); ) {
        Field f=(Field)e.nextElement();
        String fieldName=f.name();
        if (!fieldName.equals(IndexDataSource.CONTAINER_IDENTIFIER) && !fieldName.equals(IndexDataSource.OBJECT_CLASS) && !fieldName.equals(IndexDataSource.OBJECT_IDENTIFIER)) {
          doc.add(f);
        }
      }
    }
  }
  writer.addDocument(doc);
  for (int i=0, n=documents.size(); i < n; i++) {
    writer.addDocument((Document)documents.get(i));
  }
}
