{
  try {
    final String ct=responseWriter.getContentType(solrReq,solrRsp);
    if (null != ct)     response.setContentType(ct);
    if (solrRsp.getException() != null) {
      NamedList info=new SimpleOrderedMap();
      int code=ResponseUtils.getErrorInfo(solrRsp.getException(),info,log);
      solrRsp.add("error",info);
      ((HttpServletResponse)response).setStatus(code);
    }
    if (Method.HEAD != reqMethod) {
      QueryResponseWriterUtil.writeQueryResponse(response.getOutputStream(),responseWriter,solrReq,solrRsp,ct);
    }
  }
 catch (  EOFException e) {
    log.info("Unable to write response, client closed connection or we are shutting down",e);
  }
}
