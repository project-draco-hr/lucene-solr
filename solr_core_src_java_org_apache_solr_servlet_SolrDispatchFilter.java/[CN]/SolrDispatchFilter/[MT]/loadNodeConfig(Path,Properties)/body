{
  SolrResourceLoader loader=new SolrResourceLoader(solrHome,null,nodeProperties);
  if (!StringUtils.isEmpty(System.getProperty("solr.solrxml.location"))) {
    log.warn("Solr property solr.solrxml.location is no longer supported. " + "Will automatically load solr.xml from ZooKeeper if it exists");
  }
  String zkHost=System.getProperty("zkHost");
  if (!StringUtils.isEmpty(zkHost)) {
    try (SolrZkClient zkClient=new SolrZkClient(zkHost,30000)){
      if (zkClient.exists("/solr.xml",true)) {
        log.info("solr.xml found in ZooKeeper. Loading...");
        byte[] data=zkClient.getData("/solr.xml",null,null,true);
        return SolrXmlConfig.fromInputStream(loader,new ByteArrayInputStream(data));
      }
    }
 catch (    Exception e) {
      throw new SolrException(ErrorCode.SERVER_ERROR,"Error occurred while loading solr.xml from zookeeper",e);
    }
    log.info("Loading solr.xml from SolrHome (not found in ZooKeeper)");
  }
  return SolrXmlConfig.fromSolrHome(loader,loader.getInstancePath());
}
