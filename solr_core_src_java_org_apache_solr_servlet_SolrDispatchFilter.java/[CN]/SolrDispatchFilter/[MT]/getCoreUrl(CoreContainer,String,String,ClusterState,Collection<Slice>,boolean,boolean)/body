{
  String coreUrl;
  Set<String> liveNodes=clusterState.getLiveNodes();
  Iterator<Slice> it=slices.iterator();
  while (it.hasNext()) {
    Slice slice=it.next();
    Map<String,Replica> sliceShards=slice.getReplicasMap();
    for (    ZkNodeProps nodeProps : sliceShards.values()) {
      ZkCoreNodeProps coreNodeProps=new ZkCoreNodeProps(nodeProps);
      if (!activeReplicas || (liveNodes.contains(coreNodeProps.getNodeName()) && coreNodeProps.getState().equals(ZkStateReader.ACTIVE))) {
        if (byCoreName && !collectionName.equals(coreNodeProps.getCoreName())) {
          continue;
        }
        if (coreNodeProps.getBaseUrl().equals(cores.getZkController().getBaseUrl())) {
          continue;
        }
        if (origCorename != null) {
          coreUrl=coreNodeProps.getBaseUrl() + "/" + origCorename;
        }
 else {
          coreUrl=coreNodeProps.getCoreUrl();
          if (coreUrl.endsWith("/")) {
            coreUrl=coreUrl.substring(0,coreUrl.length() - 1);
          }
        }
        return coreUrl;
      }
    }
  }
  return null;
}
