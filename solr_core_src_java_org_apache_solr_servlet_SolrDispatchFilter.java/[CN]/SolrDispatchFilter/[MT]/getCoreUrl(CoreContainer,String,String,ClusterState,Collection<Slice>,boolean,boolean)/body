{
  String coreUrl;
  Set<String> liveNodes=clusterState.getLiveNodes();
  for (  Slice slice : slices) {
    Map<String,Replica> sliceShards=slice.getReplicasMap();
    for (    Replica replica : sliceShards.values()) {
      if (!activeReplicas || (liveNodes.contains(replica.getNodeName()) && replica.getState() == Replica.State.ACTIVE)) {
        if (byCoreName && !collectionName.equals(replica.getStr(ZkStateReader.CORE_NAME_PROP))) {
          continue;
        }
        if (replica.getStr(ZkStateReader.BASE_URL_PROP).equals(cores.getZkController().getBaseUrl())) {
          continue;
        }
        if (origCorename != null) {
          coreUrl=replica.getStr(ZkStateReader.BASE_URL_PROP) + "/" + origCorename;
        }
 else {
          coreUrl=replica.getCoreUrl();
          if (coreUrl.endsWith("/")) {
            coreUrl=coreUrl.substring(0,coreUrl.length() - 1);
          }
        }
        return coreUrl;
      }
    }
  }
  return null;
}
