{
  try {
    SolrQueryResponse solrResp=new SolrQueryResponse();
    if (ex instanceof Exception) {
      solrResp.setException((Exception)ex);
    }
 else {
      solrResp.setException(new RuntimeException(ex));
    }
    if (core == null) {
      core=cores.getCore("");
    }
    if (req == null) {
      final SolrParams solrParams;
      if (request instanceof HttpServletRequest) {
        solrParams=SolrRequestParsers.parseQueryString(((HttpServletRequest)request).getQueryString());
      }
 else {
        solrParams=new MapSolrParams(Collections.<String,String>emptyMap());
      }
      req=new SolrQueryRequestBase(core,solrParams){
      }
;
    }
    QueryResponseWriter writer=core.getQueryResponseWriter(req);
    writeResponse(solrResp,response,writer,req,Method.GET);
  }
 catch (  Throwable t) {
    SimpleOrderedMap info=new SimpleOrderedMap();
    int code=ResponseUtils.getErrorInfo(ex,info,log);
    response.sendError(code,info.toString());
  }
}
