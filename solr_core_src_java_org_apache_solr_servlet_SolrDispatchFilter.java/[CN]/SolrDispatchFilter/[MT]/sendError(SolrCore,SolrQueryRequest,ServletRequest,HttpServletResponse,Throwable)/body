{
  try {
    SolrQueryResponse solrResp=new SolrQueryResponse();
    if (ex instanceof Exception) {
      solrResp.setException((Exception)ex);
    }
 else {
      solrResp.setException(new RuntimeException(ex));
    }
    if (core == null) {
      core=cores.getCore("");
    }
    if (req == null) {
      req=new SolrQueryRequestBase(core,new ServletSolrParams(request)){
      }
;
    }
    QueryResponseWriter writer=core.getQueryResponseWriter(req);
    writeResponse(solrResp,response,writer,req,Method.GET);
  }
 catch (  Throwable t) {
    SimpleOrderedMap info=new SimpleOrderedMap();
    int code=getErrorInfo(ex,info);
    response.sendError(code,info.toString());
  }
}
