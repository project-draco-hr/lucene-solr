{
  String collection=solrReq.getParams().get("collection");
  if (collection != null) {
    collectionsList=StrUtils.splitSmart(collection,",",true);
  }
  if (collectionsList != null) {
    Set<String> newCollectionsList=new HashSet<String>(collectionsList.size());
    for (    String col : collectionsList) {
      String al=aliases.getCollectionAlias(col);
      if (al != null) {
        List<String> aliasList=StrUtils.splitSmart(al,",",true);
        newCollectionsList.addAll(aliasList);
      }
 else {
        newCollectionsList.add(col);
      }
    }
    if (newCollectionsList.size() > 0) {
      StringBuilder collectionString=new StringBuilder();
      Iterator<String> it=newCollectionsList.iterator();
      int sz=newCollectionsList.size();
      for (int i=0; i < sz; i++) {
        collectionString.append(it.next());
        if (i < newCollectionsList.size() - 1) {
          collectionString.append(",");
        }
      }
      ModifiableSolrParams params=new ModifiableSolrParams(solrReq.getParams());
      params.set("collection",collectionString.toString());
      solrReq.setParams(params);
    }
  }
}
