{
  boolean requestContinues=false;
  final AtomicBoolean isAuthenticated=new AtomicBoolean(false);
  AuthenticationPlugin authenticationPlugin=cores.getAuthenticationPlugin();
  if (authenticationPlugin == null || PKIAuthenticationPlugin.PATH.equals(((HttpServletRequest)request).getPathInfo())) {
    return true;
  }
 else {
    String header=((HttpServletRequest)request).getHeader(PKIAuthenticationPlugin.HEADER);
    if (header != null && cores.getPkiAuthenticationPlugin() != null)     authenticationPlugin=cores.getPkiAuthenticationPlugin();
    try {
      log.debug("Request to authenticate: {}, domain: {}, port: {}",request,request.getLocalName(),request.getLocalPort());
      requestContinues=authenticationPlugin.doAuthenticate(request,response,new FilterChain(){
        public void doFilter(        ServletRequest req,        ServletResponse rsp) throws IOException, ServletException {
          isAuthenticated.set(true);
          wrappedRequest.set(req);
        }
      }
);
    }
 catch (    Exception e) {
      e.printStackTrace();
      throw new SolrException(ErrorCode.SERVER_ERROR,"Error during request authentication, ",e);
    }
  }
  if (!requestContinues || !isAuthenticated.get()) {
    response.flushBuffer();
    return false;
  }
  return true;
}
