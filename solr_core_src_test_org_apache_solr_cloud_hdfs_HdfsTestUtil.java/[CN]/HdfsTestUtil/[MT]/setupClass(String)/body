{
  LuceneTestCase.assumeFalse("HDFS tests on Windows require Cygwin",Constants.WINDOWS);
  File dir=new File(dataDir);
  new File(dataDir).mkdirs();
  savedLocale=Locale.getDefault();
  Locale.setDefault(Locale.ENGLISH);
  int dataNodes=2;
  Configuration conf=new Configuration();
  conf.set("dfs.block.access.token.enable","false");
  conf.set("dfs.permissions.enabled","false");
  conf.set("hadoop.security.authentication","simple");
  conf.set("hdfs.minidfs.basedir",dir.getAbsolutePath() + File.separator + "hdfsBaseDir");
  conf.set("dfs.namenode.name.dir",dir.getAbsolutePath() + File.separator + "nameNodeNameDir");
  System.setProperty("test.build.data",dir.getAbsolutePath() + File.separator + "hdfs"+ File.separator+ "build");
  System.setProperty("test.cache.data",dir.getAbsolutePath() + File.separator + "hdfs"+ File.separator+ "cache");
  System.setProperty("solr.lock.type","hdfs");
  MiniDFSCluster dfsCluster=new MiniDFSCluster(conf,dataNodes,true,null);
  SolrTestCaseJ4.useFactory("org.apache.solr.core.HdfsDirectoryFactory");
  return dfsCluster;
}
