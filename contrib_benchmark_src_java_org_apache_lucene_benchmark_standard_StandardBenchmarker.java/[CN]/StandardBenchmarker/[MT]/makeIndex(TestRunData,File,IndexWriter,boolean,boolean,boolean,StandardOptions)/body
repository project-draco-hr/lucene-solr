{
  List files=new ArrayList();
  getAllFiles(srcDir,null,files);
  Document doc=null;
  long cnt=0L;
  TimeData td=new TimeData();
  td.name="addDocument";
  int scaleUp=options.getScaleUp();
  int logStep=options.getLogStep();
  int max=Math.min(files.size(),options.getMaximumDocumentsToIndex());
  for (int s=0; s < scaleUp; s++) {
    String[] tags=new String[]{srcDir.getName() + "/" + s};
    int i=0;
    for (Iterator iterator=files.iterator(); iterator.hasNext() && i < max; i++) {
      File file=(File)iterator.next();
      doc=makeDocument(file,tags,stored,tokenized,tfv);
      td.start();
      iw.addDocument(doc);
      td.stop();
      cnt++;
      if (cnt % logStep == 0) {
        System.err.println(" - processed " + cnt + ", run id="+ trd.getId());
        trd.addData(td);
        td.reset();
      }
    }
  }
  trd.addData(td);
}
