{
  System.out.println("Start Time: " + new Date());
  int runCount=options.getRunCount();
  for (int i=0; i < runCount; i++) {
    TestRunData trd=new TestRunData();
    trd.startRun();
    trd.setId(String.valueOf(i));
    IndexWriter iw=new IndexWriter(params.getDirectory(),params.getAnalyzer(),true,IndexWriter.MaxFieldLength.LIMITED);
    iw.setMergeFactor(params.getMergeFactor());
    iw.setMaxBufferedDocs(params.getMaxBufferedDocs());
    iw.setUseCompoundFile(params.isCompound());
    makeIndex(trd,params.getSource(),iw,true,true,false,options);
    if (params.isOptimize()) {
      TimeData td=new TimeData("optimize");
      trd.addData(td);
      td.start();
      iw.optimize();
      td.stop();
      trd.addData(td);
    }
    iw.close();
    QueryData[] queries=params.getQueries();
    if (queries != null) {
      IndexReader ir=null;
      IndexSearcher searcher=null;
      for (int k=0; k < queries.length; k++) {
        QueryData qd=queries[k];
        if (ir != null && qd.reopen) {
          searcher.close();
          ir.close();
          ir=null;
          searcher=null;
        }
        if (ir == null) {
          ir=IndexReader.open(params.getDirectory());
          searcher=new IndexSearcher(ir);
        }
        Document doc=null;
        if (qd.warmup) {
          TimeData td=new TimeData(qd.id + "-warm");
          for (int m=0; m < ir.maxDoc(); m++) {
            td.start();
            if (ir.isDeleted(m)) {
              td.stop();
              continue;
            }
            doc=ir.document(m);
            td.stop();
          }
          trd.addData(td);
        }
        TimeData td=new TimeData(qd.id + "-srch");
        td.start();
        Hits h=searcher.search(qd.q);
        td.stop();
        trd.addData(td);
        td=new TimeData(qd.id + "-trav");
        if (h != null && h.length() > 0) {
          for (int m=0; m < h.length(); m++) {
            td.start();
            int id=h.id(m);
            if (qd.retrieve) {
              doc=ir.document(id);
            }
            td.stop();
          }
        }
        trd.addData(td);
      }
      try {
        if (searcher != null) {
          searcher.close();
        }
      }
 catch (      Exception e) {
      }
      ;
      try {
        if (ir != null) {
          ir.close();
        }
      }
 catch (      Exception e) {
      }
      ;
    }
    trd.endRun();
    params.getRunData().add(trd);
  }
  System.out.println("End Time: " + new Date());
}
