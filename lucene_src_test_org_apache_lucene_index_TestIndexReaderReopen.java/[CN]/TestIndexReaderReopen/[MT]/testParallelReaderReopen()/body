{
  Random random=newRandom();
  final Directory dir1=new MockRAMDirectory();
  createIndex(random,dir1,true);
  final Directory dir2=new MockRAMDirectory();
  createIndex(random,dir2,true);
  performDefaultTests(new TestReopen(){
    @Override protected void modifyIndex(    int i) throws IOException {
      TestIndexReaderReopen.modifyIndex(i,dir1);
      TestIndexReaderReopen.modifyIndex(i,dir2);
    }
    @Override protected IndexReader openReader() throws IOException {
      ParallelReader pr=new ParallelReader();
      pr.add(IndexReader.open(dir1,false));
      pr.add(IndexReader.open(dir2,false));
      return pr;
    }
  }
);
  dir1.close();
  dir2.close();
  final Directory dir3=new MockRAMDirectory();
  createIndex(random,dir3,true);
  final Directory dir4=new MockRAMDirectory();
  createIndex(random,dir4,true);
  performTestsWithExceptionInReopen(new TestReopen(){
    @Override protected void modifyIndex(    int i) throws IOException {
      TestIndexReaderReopen.modifyIndex(i,dir3);
      TestIndexReaderReopen.modifyIndex(i,dir4);
    }
    @Override protected IndexReader openReader() throws IOException {
      ParallelReader pr=new ParallelReader();
      pr.add(IndexReader.open(dir3,false));
      pr.add(IndexReader.open(dir4,false));
      pr.add(new FilterIndexReader(IndexReader.open(dir3,false)));
      return pr;
    }
  }
);
  dir3.close();
  dir4.close();
}
