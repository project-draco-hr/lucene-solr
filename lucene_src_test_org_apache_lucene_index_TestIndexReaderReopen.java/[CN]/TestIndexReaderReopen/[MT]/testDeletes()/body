{
  Directory dir=newDirectory();
  createIndex(random,dir,false);
  modifyIndex(0,dir);
  modifyIndex(5,dir);
  IndexReader r1=IndexReader.open(dir,false);
  modifyIndex(5,dir);
  IndexReader r2=IndexReader.openIfChanged(r1);
  assertNotNull(r2);
  assertNull(IndexReader.openIfChanged(r2));
  assertTrue(r1 != r2);
  SegmentReader sr1=(SegmentReader)r1.getSequentialSubReaders()[0];
  SegmentReader sr2=(SegmentReader)r2.getSequentialSubReaders()[0];
  assertTrue(sr1.liveDocs == sr2.liveDocs);
  r2.deleteDocument(0);
  final Bits r1LiveDocs=MultiFields.getLiveDocs(r1);
  assertFalse(r1LiveDocs != null && !r1LiveDocs.get(0));
  assertTrue(sr1.liveDocs != sr2.liveDocs);
  r1.close();
  r2.close();
  dir.close();
}
