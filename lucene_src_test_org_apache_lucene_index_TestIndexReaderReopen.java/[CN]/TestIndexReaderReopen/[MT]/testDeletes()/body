{
  Random random=newRandom();
  Directory dir=newDirectory(random);
  createIndex(random,dir,false);
  modifyIndex(0,dir);
  modifyIndex(5,dir);
  IndexReader r1=IndexReader.open(dir,false);
  modifyIndex(5,dir);
  IndexReader r2=r1.reopen();
  assertTrue(r1 != r2);
  SegmentReader sr1=(SegmentReader)r1.getSequentialSubReaders()[0];
  SegmentReader sr2=(SegmentReader)r2.getSequentialSubReaders()[0];
  assertTrue(sr1.deletedDocs == sr2.deletedDocs);
  r2.deleteDocument(0);
  assertFalse(r1.isDeleted(0));
  assertTrue(sr1.deletedDocs != sr2.deletedDocs);
  r1.close();
  r2.close();
  dir.close();
}
