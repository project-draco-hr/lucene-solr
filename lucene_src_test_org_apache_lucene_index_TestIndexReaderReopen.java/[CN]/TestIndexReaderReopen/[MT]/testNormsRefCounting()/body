{
  Directory dir1=newDirectory();
  createIndex(random,dir1,false);
  IndexReader reader1=IndexReader.open(dir1,false);
  SegmentReader segmentReader1=getOnlySegmentReader(reader1);
  IndexReader modifier=IndexReader.open(dir1,false);
  modifier.deleteDocument(0);
  modifier.close();
  IndexReader reader2=reader1.reopen();
  modifier=IndexReader.open(dir1,false);
  SimilarityProvider sim=new DefaultSimilarity();
  modifier.setNorm(1,"field1",sim.get("field1").encodeNormValue(50f));
  modifier.setNorm(1,"field2",sim.get("field2").encodeNormValue(50f));
  modifier.close();
  IndexReader reader3=reader2.reopen();
  SegmentReader segmentReader3=getOnlySegmentReader(reader3);
  modifier=IndexReader.open(dir1,false);
  modifier.deleteDocument(2);
  modifier.close();
  IndexReader reader4=reader3.reopen();
  modifier=IndexReader.open(dir1,false);
  modifier.deleteDocument(3);
  modifier.close();
  IndexReader reader5=reader3.reopen();
  assertRefCountEquals(1,reader1);
  assertFalse(segmentReader1.normsClosed());
  reader1.close();
  assertRefCountEquals(0,reader1);
  assertFalse(segmentReader1.normsClosed());
  reader2.close();
  assertRefCountEquals(0,reader1);
  assertTrue(segmentReader1.normsClosed("field1"));
  assertTrue(segmentReader1.normsClosed("field2"));
  assertFalse(segmentReader1.normsClosed("field3"));
  assertFalse(segmentReader1.normsClosed("field4"));
  reader3.close();
  assertRefCountEquals(0,reader1);
  assertFalse(segmentReader3.normsClosed());
  reader5.close();
  assertRefCountEquals(0,reader1);
  assertFalse(segmentReader3.normsClosed());
  reader4.close();
  assertRefCountEquals(0,reader1);
  assertTrue(segmentReader1.normsClosed());
  assertTrue(segmentReader3.normsClosed());
  dir1.close();
}
