{
  final int NUM_ITER=12;
  final int NUM_COPY=3;
  CommitAndAddIndexes c=new CommitAndAddIndexes(NUM_COPY);
  c.launchThreads(NUM_ITER);
  for (int i=0; i < 100; i++)   addDoc(c.writer2);
  c.joinThreads();
  assertEquals(100 + NUM_COPY * (3 * NUM_ITER / 4) * c.NUM_THREADS* c.NUM_INIT_DOCS,c.writer2.numDocs());
  c.close(true);
  assertTrue(c.failures.size() == 0);
  _TestUtil.checkIndex(c.dir2);
  IndexReader reader=IndexReader.open(c.dir2,true);
  assertEquals(100 + NUM_COPY * (3 * NUM_ITER / 4) * c.NUM_THREADS* c.NUM_INIT_DOCS,reader.numDocs());
  reader.close();
  c.closeDir();
}
