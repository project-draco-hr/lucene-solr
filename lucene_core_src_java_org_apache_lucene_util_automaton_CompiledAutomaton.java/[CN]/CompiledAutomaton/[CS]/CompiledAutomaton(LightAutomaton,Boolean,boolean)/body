{
  if (simplify) {
    if (BasicOperations.isEmpty(automaton)) {
      type=AUTOMATON_TYPE.NONE;
      term=null;
      commonSuffixRef=null;
      runAutomaton=null;
      lightAutomaton=null;
      this.finite=null;
      return;
    }
 else     if (BasicOperations.isTotal(automaton)) {
      type=AUTOMATON_TYPE.ALL;
      term=null;
      commonSuffixRef=null;
      runAutomaton=null;
      lightAutomaton=null;
      this.finite=null;
      return;
    }
 else {
      automaton=BasicOperations.determinize(automaton);
      final String commonPrefix=SpecialOperations.getCommonPrefix(automaton);
      final String singleton;
      if (commonPrefix.length() > 0 && BasicOperations.sameLanguage(automaton,BasicAutomata.makeStringLight(commonPrefix))) {
        singleton=commonPrefix;
      }
 else {
        singleton=null;
      }
      if (singleton != null) {
        type=AUTOMATON_TYPE.SINGLE;
        term=new BytesRef(singleton);
        commonSuffixRef=null;
        runAutomaton=null;
        lightAutomaton=null;
        this.finite=null;
        return;
      }
 else       if (commonPrefix.length() > 0) {
        LightAutomaton other=BasicOperations.concatenateLight(BasicAutomata.makeStringLight(commonPrefix),BasicAutomata.makeAnyStringLight());
        other=BasicOperations.determinize(other);
        if (BasicOperations.sameLanguage(automaton,other)) {
          type=AUTOMATON_TYPE.PREFIX;
          term=new BytesRef(commonPrefix);
          commonSuffixRef=null;
          runAutomaton=null;
          lightAutomaton=null;
          this.finite=null;
          return;
        }
      }
    }
  }
  type=AUTOMATON_TYPE.NORMAL;
  term=null;
  if (finite == null) {
    this.finite=SpecialOperations.isFinite(automaton);
  }
 else {
    this.finite=finite;
  }
  LightAutomaton utf8=new UTF32ToUTF8Light().convert(automaton);
  if (this.finite) {
    commonSuffixRef=null;
  }
 else {
    commonSuffixRef=SpecialOperations.getCommonSuffixBytesRef(utf8);
  }
  runAutomaton=new ByteRunAutomaton(utf8,true);
  lightAutomaton=runAutomaton.a;
}
