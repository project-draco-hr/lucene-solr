{
  final boolean fixed=dv.isFixedLength();
  final int maxLength=dv.maxLength();
  boolean fixed2=true;
  int maxLength2=-1;
  BytesRef scratch=new BytesRef();
  for (int i=0; i < reader.maxDoc(); i++) {
    dv.get(i,scratch);
    if (maxLength2 == -1) {
      maxLength2=scratch.length;
    }
 else {
      fixed2&=scratch.length == maxLength2;
      maxLength2=Math.max(maxLength2,scratch.length);
    }
  }
  if (fixed != fixed2) {
    throw new RuntimeException("dv for field: " + fi.name + " reports fixed="+ fixed+ " but this is not the case!");
  }
  if (maxLength != maxLength2) {
    throw new RuntimeException("dv for field: " + fi.name + " reports maxLength="+ maxLength+ " but this is not the case: "+ maxLength2);
  }
}
