{
  final Status.StoredFieldStatus status=new Status.StoredFieldStatus();
  try {
    if (infoStream != null) {
      infoStream.print("    test: stored fields.......");
    }
    final Bits liveDocs=reader.getLiveDocs();
    for (int j=0; j < info.info.docCount; ++j) {
      Document doc=reader.document(j);
      if (liveDocs == null || liveDocs.get(j)) {
        status.docCount++;
        status.totFields+=doc.getFields().size();
      }
    }
    if (status.docCount != reader.numDocs()) {
      throw new RuntimeException("docCount=" + status.docCount + " but saw "+ status.docCount+ " undeleted docs");
    }
    msg("OK [" + status.totFields + " total field count; avg "+ format.format((((float)status.totFields) / status.docCount))+ " fields per doc]");
  }
 catch (  Throwable e) {
    msg("ERROR [" + String.valueOf(e.getMessage()) + "]");
    status.error=e;
    if (infoStream != null) {
      e.printStackTrace(infoStream);
    }
  }
  return status;
}
