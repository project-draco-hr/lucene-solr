{
  final Status.StoredFieldStatus status=new Status.StoredFieldStatus();
  try {
    if (infoStream != null) {
      infoStream.print("    test: stored fields.......");
    }
    final Bits liveDocs=reader.getLiveDocs();
    for (int j=0; j < reader.maxDoc(); ++j) {
      StoredDocument doc=reader.document(j);
      if (liveDocs == null || liveDocs.get(j)) {
        status.docCount++;
        status.totFields+=doc.getFields().size();
      }
    }
    if (status.docCount != reader.numDocs()) {
      throw new RuntimeException("docCount=" + status.docCount + " but saw "+ status.docCount+ " undeleted docs");
    }
    msg(infoStream,"OK [" + status.totFields + " total field count; avg "+ NumberFormat.getInstance(Locale.ROOT).format((((float)status.totFields) / status.docCount))+ " fields per doc]");
  }
 catch (  Throwable e) {
    if (failFast) {
      IOUtils.reThrow(e);
    }
    msg(infoStream,"ERROR [" + String.valueOf(e.getMessage()) + "]");
    status.error=e;
    if (infoStream != null) {
      e.printStackTrace(infoStream);
    }
  }
  return status;
}
