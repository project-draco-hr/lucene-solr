{
  Directory dir=new MockRAMDirectory();
  SnapshotDeletionPolicy sdp=getDeletionPolicy();
  IndexWriter writer=new IndexWriter(dir,getConfig(sdp));
  prepareIndexAndSnapshots(sdp,writer,1,"snapshot");
  writer.addDocument(new Document());
  writer.commit();
  String snapId="snapshot0";
  String segFileName=sdp.getSnapshot(snapId).getSegmentsFileName();
  sdp.release(snapId);
  try {
    sdp.getSnapshot(snapId);
    fail("should not have succeeded to get an unsnapshotted id");
  }
 catch (  IllegalStateException e) {
  }
  assertNull(sdp.getSnapshots().get(snapId));
  writer.deleteUnusedFiles();
  assertFalse("segments file should not be found in dirctory: " + segFileName,dir.fileExists(segFileName));
}
