{
  Random random=newRandom();
  Directory dir=new MockRAMDirectory();
  SnapshotDeletionPolicy sdp=getDeletionPolicy();
  IndexWriter writer=new IndexWriter(dir,getConfig(random,sdp));
  writer.addDocument(new Document());
  writer.commit();
  String s1="s1";
  String s2="s2";
  IndexCommit ic1=sdp.snapshot(s1);
  IndexCommit ic2=sdp.snapshot(s2);
  assertTrue(ic1 == ic2);
  writer.addDocument(new Document());
  writer.commit();
  sdp.release(s1);
  writer.deleteUnusedFiles();
  checkSnapshotExists(dir,ic2);
  writer.close();
}
