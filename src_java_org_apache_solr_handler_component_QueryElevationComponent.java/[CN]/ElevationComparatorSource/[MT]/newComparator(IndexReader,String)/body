{
  final FieldCache.StringIndex index=FieldCache.DEFAULT.getStringIndex(reader,fieldname);
  return new ScoreDocComparator(){
    public final int compare(    final ScoreDoc d0,    final ScoreDoc d1){
      final int f0=index.order[d0.doc];
      final int f1=index.order[d1.doc];
      final String id0=index.lookup[f0];
      final String id1=index.lookup[f1];
      final Integer b0=priority.get(id0);
      final Integer b1=priority.get(id1);
      final int v0=(b0 == null) ? -1 : b0.intValue();
      final int v1=(b1 == null) ? -1 : b1.intValue();
      return v1 - v0;
    }
    public Comparable sortValue(    final ScoreDoc d0){
      final int f0=index.order[d0.doc];
      final String id0=index.lookup[f0];
      final Integer b0=priority.get(id0);
      final int v0=(b0 == null) ? -1 : b0.intValue();
      return new Integer(v0);
    }
    public int sortType(){
      return SortField.CUSTOM;
    }
  }
;
}
