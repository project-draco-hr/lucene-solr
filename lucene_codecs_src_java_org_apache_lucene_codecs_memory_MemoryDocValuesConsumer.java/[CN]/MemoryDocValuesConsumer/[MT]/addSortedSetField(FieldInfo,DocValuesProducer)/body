{
  Iterable<BytesRef> values=LegacyDocValuesIterables.valuesIterable(valuesProducer.getSortedSet(field));
  Iterable<Number> docToOrdCount=LegacyDocValuesIterables.sortedSetOrdCountIterable(valuesProducer,field,maxDoc);
  Iterable<Number> ords=LegacyDocValuesIterables.sortedSetOrdsIterable(valuesProducer,field);
  meta.writeVInt(field.number);
  if (isSingleValued(docToOrdCount)) {
    meta.writeByte(SORTED_SET_SINGLETON);
    addSortedField(field,values,singletonView(docToOrdCount,ords,-1L));
  }
 else {
    meta.writeByte(SORTED_SET);
    addBinaryField(field,new Iterable<BytesRef>(){
      @Override public Iterator<BytesRef> iterator(){
        return new SortedSetIterator(docToOrdCount.iterator(),ords.iterator());
      }
    }
);
    writeFST(field,values);
  }
}
