{
  try {
    VariableResolver resolver=null;
    if (dataImporter != null && dataImporter.getCore() != null && dataImporter.getCore().getResourceLoader().getCoreProperties() != null) {
      resolver=new VariableResolver(dataImporter.getCore().getResourceLoader().getCoreProperties());
    }
 else {
      resolver=new VariableResolver();
    }
    resolver.setEvaluators(dataImporter.getEvaluators());
    Map<String,Object> indexerNamespace=new HashMap<String,Object>();
    if (persistedProperties.get(LAST_INDEX_TIME) != null) {
      indexerNamespace.put(LAST_INDEX_TIME,persistedProperties.get(LAST_INDEX_TIME));
    }
 else {
      indexerNamespace.put(LAST_INDEX_TIME,EPOCH);
    }
    indexerNamespace.put(INDEX_START_TIME,dataImporter.getIndexStartTime());
    indexerNamespace.put("request",new HashMap<String,Object>(reqParams.getRawParams()));
    for (    Entity entity : dataImporter.getConfig().getEntities()) {
      Map<String,Object> entityNamespace=new HashMap<String,Object>();
      String key=SolrWriter.LAST_INDEX_KEY;
      Object lastIndex=persistedProperties.get(entity.getName() + "." + key);
      if (lastIndex != null) {
        entityNamespace.put(SolrWriter.LAST_INDEX_KEY,lastIndex);
      }
 else {
        entityNamespace.put(SolrWriter.LAST_INDEX_KEY,EPOCH);
      }
      indexerNamespace.put(entity.getName(),entityNamespace);
    }
    resolver.addNamespace(ConfigNameConstants.IMPORTER_NS_SHORT,indexerNamespace);
    resolver.addNamespace(ConfigNameConstants.IMPORTER_NS,indexerNamespace);
    return resolver;
  }
 catch (  Exception e) {
    wrapAndThrow(SEVERE,e);
    return null;
  }
}
