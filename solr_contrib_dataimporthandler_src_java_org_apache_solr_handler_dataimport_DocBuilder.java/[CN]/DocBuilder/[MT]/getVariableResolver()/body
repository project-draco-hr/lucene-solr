{
  try {
    VariableResolverImpl resolver=null;
    if (dataImporter != null && dataImporter.getCore() != null && dataImporter.getCore().getResourceLoader().getCoreProperties() != null) {
      resolver=new VariableResolverImpl(dataImporter.getCore().getResourceLoader().getCoreProperties());
    }
 else     resolver=new VariableResolverImpl();
    Map<String,Object> indexerNamespace=new HashMap<String,Object>();
    if (persistedProperties.get(LAST_INDEX_TIME) != null) {
      indexerNamespace.put(LAST_INDEX_TIME,persistedProperties.get(LAST_INDEX_TIME));
    }
 else {
      indexerNamespace.put(LAST_INDEX_TIME,EPOCH);
    }
    indexerNamespace.put(INDEX_START_TIME,dataImporter.getIndexStartTime());
    indexerNamespace.put("request",reqParams.getRawParams());
    indexerNamespace.put("functions",functionsNamespace);
    for (    Entity entity : dataImporter.getConfig().getEntities()) {
      String key=entity.getName() + "." + SolrWriter.LAST_INDEX_KEY;
      Object lastIndex=persistedProperties.get(key);
      if (lastIndex != null && lastIndex instanceof Date) {
        indexerNamespace.put(key,lastIndex);
      }
 else {
        indexerNamespace.put(key,EPOCH);
      }
    }
    resolver.addNamespace(ConfigNameConstants.IMPORTER_NS_SHORT,indexerNamespace);
    resolver.addNamespace(ConfigNameConstants.IMPORTER_NS,indexerNamespace);
    return resolver;
  }
 catch (  Exception e) {
    wrapAndThrow(SEVERE,e);
    return null;
  }
}
