{
  addStatusMessage("Delta Dump started");
  VariableResolver resolver=getVariableResolver();
  if (config.getDeleteQuery() != null) {
    writer.deleteByQuery(config.getDeleteQuery());
  }
  addStatusMessage("Identifying Delta");
  LOG.info("Starting delta collection.");
  Set<Map<String,Object>> deletedKeys=new HashSet<Map<String,Object>>();
  Set<Map<String,Object>> allPks=collectDelta(currentEntityProcessorWrapper,resolver,deletedKeys);
  if (stop.get())   return;
  addStatusMessage("Deltas Obtained");
  addStatusMessage("Building documents");
  if (!deletedKeys.isEmpty()) {
    allPks.removeAll(deletedKeys);
    deleteAll(deletedKeys);
  }
  deletedKeys=null;
  writer.setDeltaKeys(allPks);
  statusMessages.put("Total Changed Documents",allPks.size());
  VariableResolver vri=getVariableResolver();
  Iterator<Map<String,Object>> pkIter=allPks.iterator();
  while (pkIter.hasNext()) {
    Map<String,Object> map=pkIter.next();
    vri.addNamespace(ConfigNameConstants.IMPORTER_NS_SHORT + ".delta",map);
    buildDocument(vri,null,map,currentEntityProcessorWrapper,true,null);
    pkIter.remove();
    if (stop.get())     break;
  }
  if (!stop.get()) {
    LOG.info("Delta Import completed successfully");
  }
}
