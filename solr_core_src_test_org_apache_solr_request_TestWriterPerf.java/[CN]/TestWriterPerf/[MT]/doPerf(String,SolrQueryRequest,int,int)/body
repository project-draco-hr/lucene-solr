{
  SolrQueryResponse rsp=getResponse(req);
  QueryResponseWriter w=h.getCore().getQueryResponseWriter(writerName);
  ByteArrayOutputStream out=null;
  System.gc();
  long start=System.currentTimeMillis();
  for (int i=0; i < encIter; i++) {
    if (w instanceof BinaryQueryResponseWriter) {
      BinaryQueryResponseWriter binWriter=(BinaryQueryResponseWriter)w;
      out=new ByteArrayOutputStream();
      binWriter.write(out,req,rsp);
      out.close();
    }
 else {
      out=new ByteArrayOutputStream();
      Writer writer=new OutputStreamWriter(out,"UTF-8");
      w.write(writer,req,rsp);
      writer.close();
    }
  }
  long encodeTime=Math.max(System.currentTimeMillis() - start,1);
  byte[] arr=out.toByteArray();
  start=System.currentTimeMillis();
  writerName=writerName.intern();
  for (int i=0; i < decIter; i++) {
    ResponseParser rp=null;
    if (writerName == "xml") {
      rp=new XMLResponseParser();
    }
 else     if (writerName == "javabin") {
      rp=new BinaryResponseParser();
    }
 else {
      break;
    }
    ByteArrayInputStream in=new ByteArrayInputStream(arr);
    rp.processResponse(in,"UTF-8");
  }
  long decodeTime=Math.max(System.currentTimeMillis() - start,1);
  log.info("writer " + writerName + ", size="+ out.size()+ ", encodeRate="+ (encodeTime == 1 ? "N/A" : "" + (encIter * 1000L / encodeTime))+ ", decodeRate="+ (decodeTime == 1 ? "N/A" : "" + (decIter * 1000L / decodeTime)));
  req.close();
}
