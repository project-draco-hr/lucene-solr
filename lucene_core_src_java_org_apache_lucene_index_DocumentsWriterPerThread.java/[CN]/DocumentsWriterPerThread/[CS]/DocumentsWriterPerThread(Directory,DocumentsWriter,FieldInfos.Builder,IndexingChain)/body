{
  this.directoryOrig=directory;
  this.directory=new TrackingDirectoryWrapper(directory);
  this.parent=parent;
  this.fieldInfos=fieldInfos;
  this.writer=parent.indexWriter;
  this.indexWriterConfig=parent.indexWriterConfig;
  this.infoStream=parent.infoStream;
  this.codec=parent.codec;
  this.docState=new DocState(this,infoStream);
  this.docState.similarity=parent.indexWriter.getConfig().getSimilarity();
  bytesUsed=Counter.newCounter();
  byteBlockAllocator=new DirectTrackingAllocator(bytesUsed);
  pendingDeletes=new BufferedDeletes();
  intBlockAllocator=new IntBlockAllocator(bytesUsed);
  initialize();
  consumer=indexingChain.getChain(this);
}
