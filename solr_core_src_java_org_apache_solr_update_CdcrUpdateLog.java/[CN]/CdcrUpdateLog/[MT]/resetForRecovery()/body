{
synchronized (this) {
    BufferedUpdates bufferedUpdates=new BufferedUpdates();
    if (state == State.BUFFERING && tlog != null) {
      bufferedUpdates.tlog=tlog.tlogFile;
      bufferedUpdates.offset=this.recoveryInfo.positionOfStart;
    }
    for (    CdcrLogReader reader : logPointers.keySet()) {
      reader.close();
    }
    logPointers.clear();
    doClose(prevTlog);
    doClose(tlog);
    for (    TransactionLog log : logs) {
      if (log == prevTlog || log == tlog)       continue;
      doClose(log);
    }
    logs.clear();
    newestLogsOnStartup.clear();
    tlog=prevTlog=null;
    prevMapLog=prevMapLog2=null;
    map.clear();
    if (prevMap != null)     prevMap.clear();
    if (prevMap2 != null)     prevMap2.clear();
    tlogFiles=null;
    numOldRecords=0;
    oldDeletes.clear();
    deleteByQueries.clear();
    return bufferedUpdates;
  }
}
