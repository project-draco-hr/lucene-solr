{
  int upto=ordinals.length;
  Iterator<CategoryPath> iter=categories.iterator();
  for (int i=0; i < upto; i++) {
    int ordinal=ordinals.ints[i];
    CategoryPath cp=iter.next();
    OrdinalPolicy op=clp.getOrdinalPolicy(cp.components[0]);
    if (op != OrdinalPolicy.NO_PARENTS) {
      int parent=taxoWriter.getParent(ordinal);
      if (parent > 0) {
        while (parent > 0) {
          ordinals.ints[ordinals.length++]=parent;
          parent=taxoWriter.getParent(parent);
        }
        if (op == OrdinalPolicy.ALL_BUT_DIMENSION) {
          ordinals.length--;
        }
      }
    }
  }
  return ordinalsEncoder.encode(ordinals);
}
