{
  if (encoded.hasArray()) {
    int numChars=encoded.limit() - encoded.arrayOffset() - 1;
    if (numChars <= 0) {
      return 0;
    }
 else {
      int numFullBytesInFinalChar=encoded.charAt(encoded.limit() - 1);
      int numEncodedChars=numChars - 1;
      return (numEncodedChars * 15 + 7) / 8 + numFullBytesInFinalChar;
    }
  }
 else {
    throw new IllegalArgumentException("encoded argument must have a backing array");
  }
}
