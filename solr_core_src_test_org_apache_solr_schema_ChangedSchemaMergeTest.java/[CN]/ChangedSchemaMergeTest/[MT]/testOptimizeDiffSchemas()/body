{
  CoreContainer cc=init();
  try (SolrCore changed=cc.getCore("changed")){
    addDoc(changed,"id","1","which","15","text","some stuff with which");
    addDoc(changed,"id","2","which","15","text","some stuff with which");
    addDoc(changed,"id","3","which","15","text","some stuff with which");
    addDoc(changed,"id","4","which","15","text","some stuff with which");
    SolrQueryRequest req=new LocalSolrQueryRequest(changed,new NamedList<>());
    changed.getUpdateHandler().commit(new CommitUpdateCommand(req,false));
    FileUtils.writeStringToFile(schemaFile,withoutWhich,Charsets.UTF_8.toString());
    IndexSchema iSchema=IndexSchemaFactory.buildIndexSchema("schema.xml",changed.getSolrConfig());
    changed.setLatestSchema(iSchema);
    addDoc(changed,"id","1","text","some stuff without which");
    addDoc(changed,"id","5","text","some stuff without which");
    changed.getUpdateHandler().commit(new CommitUpdateCommand(req,false));
    changed.getUpdateHandler().commit(new CommitUpdateCommand(req,true));
  }
  finally {
    if (cc != null)     cc.shutdown();
  }
}
