{
  String groupField=params.get(GroupParams.GROUP_FIELD);
  if (groupField == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Specify the group.field as parameter or local parameter");
  }
  TermAllGroupsCollector collector=new TermAllGroupsCollector(groupField);
  Filter mainQueryFilter=docs.getTopFilter();
  Query filteredFacetQuery=new BooleanQuery.Builder().add(facetQuery,Occur.MUST).add(mainQueryFilter,Occur.FILTER).build();
  searcher.search(filteredFacetQuery,collector);
  return collector.getGroupCount();
}
