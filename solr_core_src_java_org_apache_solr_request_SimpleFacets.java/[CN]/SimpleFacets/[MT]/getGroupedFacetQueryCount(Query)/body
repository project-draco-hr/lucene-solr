{
  GroupingSpecification groupingSpecification=rb.getGroupingSpec();
  String groupField=groupingSpecification != null ? groupingSpecification.getFields()[0] : null;
  if (groupField == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Specify the group.field as parameter or local parameter");
  }
  TermAllGroupsCollector collector=new TermAllGroupsCollector(groupField);
  Filter mainQueryFilter=docs.getTopFilter();
  searcher.search(facetQuery,mainQueryFilter,collector);
  return collector.getGroupCount();
}
