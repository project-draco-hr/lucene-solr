{
  String groupField=params.get(GroupParams.GROUP_FIELD);
  if (groupField == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Specify the group.field as parameter or local parameter");
  }
  TermAllGroupsCollector collector=new TermAllGroupsCollector(groupField);
  Filter mainQueryFilter=docs.getTopFilter();
  searcher.search(new FilteredQuery(facetQuery,mainQueryFilter),collector);
  return collector.getGroupCount();
}
