{
  if (deletedDocsDirty) {
    si.advanceDelGen();
    deletedDocs.write(directory(),si.getDelFileName());
    si.setDelCount(si.getDelCount() + pendingDeleteCount);
  }
  if (undeleteAll && si.hasDeletions()) {
    si.clearDelGen();
    si.setDelCount(0);
  }
  if (normsDirty) {
    si.setNumFields(fieldInfos.size());
    Iterator it=norms.values().iterator();
    while (it.hasNext()) {
      Norm norm=(Norm)it.next();
      if (norm.dirty) {
        norm.reWrite(si);
      }
    }
  }
  deletedDocsDirty=false;
  normsDirty=false;
  undeleteAll=false;
}
