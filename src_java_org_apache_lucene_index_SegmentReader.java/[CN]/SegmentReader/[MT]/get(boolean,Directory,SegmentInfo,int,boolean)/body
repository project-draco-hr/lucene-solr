{
  SegmentReader instance;
  try {
    if (readOnly)     instance=(SegmentReader)READONLY_IMPL.newInstance();
 else     instance=(SegmentReader)IMPL.newInstance();
  }
 catch (  Exception e) {
    throw new RuntimeException("cannot load SegmentReader class: " + e,e);
  }
  instance.readOnly=readOnly;
  instance.si=si;
  instance.readBufferSize=readBufferSize;
  boolean success=false;
  try {
    instance.core=new CoreReaders(dir,si,readBufferSize);
    if (doOpenStores) {
      instance.core.openDocStores(si);
    }
    instance.loadDeletedDocs();
    instance.openNorms(instance.core.cfsDir,readBufferSize);
    success=true;
  }
  finally {
    if (!success) {
      instance.doClose();
    }
  }
  return instance;
}
