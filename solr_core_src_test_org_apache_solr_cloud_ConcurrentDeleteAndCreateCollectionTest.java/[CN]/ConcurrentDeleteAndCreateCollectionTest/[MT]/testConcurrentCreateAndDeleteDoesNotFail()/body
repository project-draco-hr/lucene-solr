{
  final File configDir=getFile("solr").toPath().resolve("configsets/configset-2/conf").toFile();
  final AtomicReference<Exception> failure=new AtomicReference<>();
  final int timeToRunSec=30;
  final Thread[] threads=new Thread[10];
  for (int i=0; i < threads.length; i++) {
    final String collectionName="collection" + i;
    uploadConfig(configDir,collectionName);
    final String baseUrl=solrCluster.getJettySolrRunners().get(0).getBaseUrl().toString();
    final SolrClient solrClient=getHttpSolrClient(baseUrl);
    threads[i]=new CreateDeleteSearchCollectionThread("create-delete-search-" + i,collectionName,collectionName,timeToRunSec,solrClient,failure);
  }
  startAll(threads);
  joinAll(threads);
  assertNull("concurrent create and delete collection failed: " + failure.get(),failure.get());
}
