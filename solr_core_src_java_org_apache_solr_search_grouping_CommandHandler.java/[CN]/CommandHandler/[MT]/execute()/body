{
  final int nrOfCommands=commands.size();
  List<Collector> collectors=new ArrayList<Collector>(nrOfCommands);
  for (  Command command : commands) {
    collectors.addAll(command.create());
  }
  SolrIndexSearcher.ProcessedFilter pf=searcher.getProcessedFilter(queryCommand.getFilter(),queryCommand.getFilterList());
  Filter luceneFilter=pf.filter;
  Query query=QueryUtils.makeQueryable(queryCommand.getQuery());
  Collector wrappedCollectors;
  if (collectors.isEmpty()) {
    wrappedCollectors=null;
  }
 else {
    wrappedCollectors=MultiCollector.wrap(collectors.toArray(new Collector[nrOfCommands]));
  }
  if (wrappedCollectors == null && needDocset) {
    int maxDoc=searcher.maxDoc();
    DocSetCollector docSetCollector=new DocSetCollector(maxDoc >> 6,maxDoc);
    searcher.search(query,luceneFilter,docSetCollector);
    docSet=docSetCollector.getDocSet();
  }
 else   if (needDocset) {
    int maxDoc=searcher.maxDoc();
    DocSetCollector docSetCollector=new DocSetDelegateCollector(maxDoc >> 6,maxDoc,wrappedCollectors);
    searcher.search(query,luceneFilter,docSetCollector);
    docSet=docSetCollector.getDocSet();
  }
 else {
    searcher.search(query,luceneFilter,wrappedCollectors);
  }
}
