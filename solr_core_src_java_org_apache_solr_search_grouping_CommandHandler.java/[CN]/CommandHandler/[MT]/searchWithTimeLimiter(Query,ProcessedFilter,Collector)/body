{
  if (queryCommand.getTimeAllowed() > 0) {
    collector=new TimeLimitingCollector(collector,TimeLimitingCollector.getGlobalCounter(),queryCommand.getTimeAllowed());
  }
  TotalHitCountCollector hitCountCollector=new TotalHitCountCollector();
  if (includeHitCount) {
    collector=MultiCollector.wrap(collector,hitCountCollector);
  }
  Filter luceneFilter=filter.filter;
  if (filter.postFilter != null) {
    filter.postFilter.setLastDelegate(collector);
    collector=filter.postFilter;
  }
  try {
    searcher.search(query,luceneFilter,collector);
  }
 catch (  TimeLimitingCollector.TimeExceededException x) {
    partialResults=true;
    logger.warn("Query: " + query + "; "+ x.getMessage());
  }
catch (  ExitableDirectoryReader.ExitingReaderException e) {
    partialResults=true;
    logger.warn("Query: " + query + "; "+ e.getMessage());
  }
  if (includeHitCount) {
    totalHitCount=hitCountCollector.getTotalHits();
  }
}
