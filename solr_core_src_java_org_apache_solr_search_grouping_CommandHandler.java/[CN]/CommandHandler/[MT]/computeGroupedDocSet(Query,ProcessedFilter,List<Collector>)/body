{
  Command firstCommand=commands.get(0);
  AbstractAllGroupHeadsCollector termAllGroupHeadsCollector=TermAllGroupHeadsCollector.create(firstCommand.getKey(),firstCommand.getSortWithinGroup());
  if (collectors.isEmpty()) {
    searchWithTimeLimiter(query,filter,termAllGroupHeadsCollector);
  }
 else {
    collectors.add(termAllGroupHeadsCollector);
    searchWithTimeLimiter(query,filter,MultiCollector.wrap(collectors.toArray(new Collector[collectors.size()])));
  }
  return new BitDocSet(termAllGroupHeadsCollector.retrieveGroupHeads(searcher.maxDoc()));
}
