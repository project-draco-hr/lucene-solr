{
  assertU(adoc("id",String.valueOf(1),"name","name" + String.valueOf(1)));
  File idxprops=new File(h.getCore().getDataDir() + "index.properties");
  Properties p=new Properties();
  File newDir=new File(h.getCore().getDataDir() + "index_temp");
  newDir.mkdirs();
  p.put("index",newDir.getName());
  FileOutputStream os=null;
  try {
    os=new FileOutputStream(idxprops);
    p.store(os,"index properties");
  }
 catch (  Exception e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unable to write index.properties",e);
  }
  Directory dir=FSDirectory.getDirectory(newDir);
  IndexWriter iw=new IndexWriter(dir,new StandardAnalyzer(),new MaxFieldLength(1000));
  Document doc=new Document();
  doc.add(new Field("id","2",Field.Store.YES,Field.Index.TOKENIZED));
  doc.add(new Field("name","name2",Field.Store.YES,Field.Index.TOKENIZED));
  iw.addDocument(doc);
  iw.commit();
  iw.close();
  assertU(commit());
  assertQ("return doc with id 2",req("id:2"),"*[count(//doc)=1]");
  newDir.delete();
}
