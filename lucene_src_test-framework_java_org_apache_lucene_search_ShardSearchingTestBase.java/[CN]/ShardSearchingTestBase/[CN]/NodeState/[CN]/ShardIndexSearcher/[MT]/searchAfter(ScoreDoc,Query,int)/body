{
  final TopDocs[] shardHits=new TopDocs[nodeVersions.length];
  ScoreDoc shardAfter=new ScoreDoc(after.doc,after.score);
  for (int nodeID=0; nodeID < nodeVersions.length; nodeID++) {
    if (nodeID < after.shardIndex) {
      shardAfter.doc=Integer.MAX_VALUE;
    }
 else     if (nodeID == after.shardIndex) {
      shardAfter.doc=after.doc;
    }
 else {
      shardAfter.doc=-1;
    }
    if (nodeID == myNodeID) {
      shardHits[nodeID]=localSearchAfter(shardAfter,query,numHits);
    }
 else {
      shardHits[nodeID]=searchNode(nodeID,nodeVersions,query,null,numHits,shardAfter);
    }
  }
  return TopDocs.merge(null,numHits,shardHits);
}
