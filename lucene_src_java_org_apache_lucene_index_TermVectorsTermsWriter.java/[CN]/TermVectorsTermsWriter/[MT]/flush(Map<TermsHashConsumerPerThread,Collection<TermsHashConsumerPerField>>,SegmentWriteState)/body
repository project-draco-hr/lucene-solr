{
  if (state.numDocsInStore > 0) {
    initTermVectorsWriter();
  }
  if (tvx != null) {
    if (state.numDocsInStore > 0)     fill(state.numDocsInStore - docWriter.getDocStoreOffset());
    tvx.flush();
    tvd.flush();
    tvf.flush();
  }
  for (  Map.Entry<TermsHashConsumerPerThread,Collection<TermsHashConsumerPerField>> entry : threadsAndFields.entrySet()) {
    for (    final TermsHashConsumerPerField field : entry.getValue()) {
      TermVectorsTermsWriterPerField perField=(TermVectorsTermsWriterPerField)field;
      perField.termsHashPerField.reset();
      perField.shrinkHash();
    }
    TermVectorsTermsWriterPerThread perThread=(TermVectorsTermsWriterPerThread)entry.getKey();
    perThread.termsHashPerThread.reset(true);
  }
}
