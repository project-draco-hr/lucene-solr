{
  while (true) {
    final Node<?> currentTail=this.tail;
    final Node<?> tailNext=currentTail.next;
    if (tail == currentTail) {
      if (tailNext != null) {
        tailUpdater.compareAndSet(this,currentTail,tailNext);
      }
 else {
        if (currentTail.casNext(null,newNode)) {
          tailUpdater.compareAndSet(this,currentTail,newNode);
          return seqNo.getAndIncrement();
        }
      }
    }
  }
}
