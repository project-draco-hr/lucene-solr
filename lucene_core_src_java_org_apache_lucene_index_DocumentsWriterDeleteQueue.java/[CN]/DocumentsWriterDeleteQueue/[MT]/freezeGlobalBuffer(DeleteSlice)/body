{
  globalBufferLock.lock();
  final Node<?> currentTail=tail;
  if (callerSlice != null) {
    callerSlice.sliceTail=currentTail;
  }
  try {
    if (globalSlice.sliceTail != currentTail) {
      globalSlice.sliceTail=currentTail;
      globalSlice.apply(globalBufferedUpdates,BufferedUpdates.MAX_INT);
    }
    final FrozenBufferedUpdates packet=new FrozenBufferedUpdates(globalBufferedUpdates,false);
    globalBufferedUpdates.clear();
    return packet;
  }
  finally {
    globalBufferLock.unlock();
  }
}
