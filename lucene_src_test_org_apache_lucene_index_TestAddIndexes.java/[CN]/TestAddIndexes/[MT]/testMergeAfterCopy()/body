{
  Directory dir=newDirectory(random);
  Directory aux=newDirectory(random);
  setUpDirs(dir,aux);
  IndexReader reader=IndexReader.open(aux,false);
  for (int i=0; i < 20; i++) {
    reader.deleteDocument(i);
  }
  assertEquals(10,reader.numDocs());
  reader.close();
  IndexWriter writer=newWriter(dir,newIndexWriterConfig(random,TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.APPEND).setMaxBufferedDocs(4));
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setMergeFactor(4);
  writer.addIndexes(new Directory[]{aux,new MockRAMDirectory(aux)});
  assertEquals(1060,writer.maxDoc());
  assertEquals(1000,writer.getDocCount(0));
  writer.close();
  dir.close();
  aux.close();
}
