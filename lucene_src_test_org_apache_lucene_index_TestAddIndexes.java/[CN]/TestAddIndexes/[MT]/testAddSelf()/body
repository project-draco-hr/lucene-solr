{
  Directory dir=newDirectory();
  Directory aux=newDirectory();
  IndexWriter writer=null;
  writer=newWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()));
  addDocs(writer,100);
  assertEquals(100,writer.maxDoc());
  writer.close();
  writer=newWriter(aux,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(1000));
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundFile(false);
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundDocStore(false);
  addDocs(writer,40);
  writer.close();
  writer=newWriter(aux,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.CREATE).setMaxBufferedDocs(1000));
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundFile(false);
  ((LogMergePolicy)writer.getConfig().getMergePolicy()).setUseCompoundDocStore(false);
  addDocs(writer,100);
  writer.close();
  writer=newWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.APPEND));
  try {
    writer.addIndexes(new Directory[]{aux,dir});
    assertTrue(false);
  }
 catch (  IllegalArgumentException e) {
    assertEquals(100,writer.maxDoc());
  }
  writer.close();
  verifyNumDocs(dir,100);
  dir.close();
  aux.close();
}
