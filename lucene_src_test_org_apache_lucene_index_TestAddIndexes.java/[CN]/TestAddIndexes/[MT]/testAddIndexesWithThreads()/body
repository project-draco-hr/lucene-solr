{
  final int NUM_ITER=15;
  final int NUM_COPY=3;
  CommitAndAddIndexes c=new CommitAndAddIndexes(NUM_COPY);
  c.writer2.setInfoStream(VERBOSE ? System.out : null);
  c.launchThreads(NUM_ITER);
  for (int i=0; i < 100; i++)   addDoc(c.writer2);
  c.joinThreads();
  int expectedNumDocs=100 + NUM_COPY * (4 * NUM_ITER / 5) * RunAddIndexesThreads.NUM_THREADS* RunAddIndexesThreads.NUM_INIT_DOCS;
  assertEquals("expected num docs don't match - failures: " + c.failures,expectedNumDocs,c.writer2.numDocs());
  c.close(true);
  assertTrue("found unexpected failures: " + c.failures,c.failures.isEmpty());
  _TestUtil.checkIndex(c.dir2);
  IndexReader reader=IndexReader.open(c.dir2,true);
  assertEquals(expectedNumDocs,reader.numDocs());
  reader.close();
  c.closeDir();
}
