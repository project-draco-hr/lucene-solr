{
  Directory[] dirs=new Directory[2];
  for (int i=0; i < dirs.length; i++) {
    dirs[i]=new RAMDirectory();
    IndexWriter w=new IndexWriter(dirs[i],new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
    Document d=new Document();
    d.add(new Field("c","v",Store.YES,Index.ANALYZED,TermVector.YES));
    w.addDocument(d);
    w.close();
  }
  IndexReader[] readers=new IndexReader[]{IndexReader.open(dirs[0]),IndexReader.open(dirs[1])};
  Directory dir=new RAMDirectory();
  IndexWriterConfig conf=new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMergePolicy(newLogMergePolicy());
  LogMergePolicy lmp=(LogMergePolicy)conf.getMergePolicy();
  lmp.setUseCompoundFile(true);
  lmp.setNoCFSRatio(1.0);
  IndexWriter w3=new IndexWriter(dir,conf);
  w3.addIndexes(readers);
  w3.close();
  assertEquals("Only one compound segment should exist",4,dir.listAll().length);
}
