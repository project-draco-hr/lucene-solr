{
  final GroupDocs[] groupDocsResult=new GroupDocs[groups.size()];
  int groupIDX=0;
  for (  SearchGroup group : groups) {
    final SearchGroupDocs groupDocs=groupMap.get(group.groupValue);
    final TopDocs topDocs=groupDocs.collector.topDocs(withinGroupOffset,maxDocsPerGroup);
    groupDocsResult[groupIDX++]=new GroupDocs(topDocs.getMaxScore(),topDocs.totalHits,topDocs.scoreDocs,groupDocs.groupValue,group.sortValues);
  }
  return new TopGroups(groupSort.getSort(),withinGroupSort == null ? null : withinGroupSort.getSort(),totalHitCount,totalGroupedHitCount,groupDocsResult);
}
