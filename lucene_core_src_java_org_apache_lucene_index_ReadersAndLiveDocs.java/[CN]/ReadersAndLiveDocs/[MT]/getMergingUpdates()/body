{
  copyUpdatesToMerging();
  if (mergingUpdates.isEmpty()) {
    return null;
  }
  Map<Integer,Map<String,Long>> updates=new HashMap<Integer,Map<String,Long>>();
  for (  Entry<String,Map<Integer,Long>> e : mergingUpdates.entrySet()) {
    String field=e.getKey();
    for (    Entry<Integer,Long> fieldUpdates : e.getValue().entrySet()) {
      Integer doc=fieldUpdates.getKey();
      Long value=fieldUpdates.getValue();
      Map<String,Long> docUpdates=updates.get(doc);
      if (docUpdates == null) {
        docUpdates=new HashMap<String,Long>();
        updates.put(doc,docUpdates);
      }
      docUpdates.put(field,value);
    }
  }
  mergingUpdates.clear();
  return updates;
}
