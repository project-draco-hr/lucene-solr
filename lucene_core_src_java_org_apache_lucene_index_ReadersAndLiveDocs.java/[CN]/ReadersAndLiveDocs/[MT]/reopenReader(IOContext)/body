{
  if (reader != null) {
    SegmentReader newReader=new SegmentReader(info,reader,liveDocs,info.info.getDocCount() - info.getDelCount() - pendingDeleteCount);
    boolean reopened=false;
    try {
      reader.decRef();
      reader=newReader;
      if (liveDocs == null) {
        liveDocs=reader.getLiveDocs();
      }
      reopened=true;
    }
  finally {
      if (!reopened) {
        newReader.decRef();
      }
    }
  }
}
