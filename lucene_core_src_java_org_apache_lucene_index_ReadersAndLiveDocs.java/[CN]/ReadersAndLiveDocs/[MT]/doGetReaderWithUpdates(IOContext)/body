{
  boolean checkpoint=false;
  try {
synchronized (this) {
      checkpoint=writeLiveDocs(info.info.dir);
      if (reader == null) {
        reader=new SegmentReader(info,context);
        if (liveDocs == null) {
          liveDocs=reader.getLiveDocs();
        }
      }
 else       if (checkpoint) {
        reopenReader(context);
      }
      reader.incRef();
      return reader;
    }
  }
  finally {
    if (checkpoint) {
      writer.checkpoint();
    }
  }
}
