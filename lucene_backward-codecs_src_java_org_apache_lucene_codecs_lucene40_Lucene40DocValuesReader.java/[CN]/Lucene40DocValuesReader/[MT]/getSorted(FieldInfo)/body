{
  SortedDocValues instance=sortedInstances.get(field.name);
  if (instance == null) {
    String dataName=IndexFileNames.segmentFileName(state.segmentInfo.name + "_" + Integer.toString(field.number),segmentSuffix,"dat");
    String indexName=IndexFileNames.segmentFileName(state.segmentInfo.name + "_" + Integer.toString(field.number),segmentSuffix,"idx");
    IndexInput data=null;
    IndexInput index=null;
    boolean success=false;
    try {
      data=dir.openInput(dataName,state.context);
      index=dir.openInput(indexName,state.context);
switch (LegacyDocValuesType.valueOf(field.getAttribute(legacyKey))) {
case BYTES_FIXED_SORTED:
        instance=loadBytesFixedSorted(field,data,index);
      break;
case BYTES_VAR_SORTED:
    instance=loadBytesVarSorted(field,data,index);
  break;
default :
throw new AssertionError();
}
CodecUtil.checkEOF(data);
CodecUtil.checkEOF(index);
success=true;
}
  finally {
if (success) {
IOUtils.close(data,index);
}
 else {
IOUtils.closeWhileHandlingException(data,index);
}
}
sortedInstances.put(field.name,instance);
}
return instance;
}
