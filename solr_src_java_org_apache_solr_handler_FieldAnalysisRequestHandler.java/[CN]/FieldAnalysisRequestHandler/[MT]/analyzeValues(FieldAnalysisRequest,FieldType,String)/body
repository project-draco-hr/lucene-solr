{
  Set<String> termsToMatch=new HashSet<String>();
  String queryValue=analysisRequest.getQuery();
  if (queryValue != null && analysisRequest.isShowMatch()) {
    List<Token> tokens=analyzeValue(queryValue,fieldType.getQueryAnalyzer());
    for (    Token token : tokens) {
      termsToMatch.add(token.term());
    }
  }
  NamedList<NamedList> analyzeResults=new SimpleOrderedMap<NamedList>();
  if (analysisRequest.getFieldValue() != null) {
    AnalysisContext context=new AnalysisContext(fieldName,fieldType,fieldType.getAnalyzer(),termsToMatch);
    NamedList analyzedTokens=analyzeValue(analysisRequest.getFieldValue(),context);
    analyzeResults.add("index",analyzedTokens);
  }
  if (analysisRequest.getQuery() != null) {
    AnalysisContext context=new AnalysisContext(fieldName,fieldType,fieldType.getQueryAnalyzer());
    NamedList analyzedTokens=analyzeValue(analysisRequest.getQuery(),context);
    analyzeResults.add("query",analyzedTokens);
  }
  return analyzeResults;
}
