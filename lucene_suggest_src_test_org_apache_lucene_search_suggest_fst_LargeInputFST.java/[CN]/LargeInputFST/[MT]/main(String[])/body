{
  Path input=Paths.get("/home/dweiss/tmp/shuffled.dict");
  int buckets=20;
  int shareMaxTail=10;
  ExternalRefSorter sorter=new ExternalRefSorter(new OfflineSorter());
  FSTCompletionBuilder builder=new FSTCompletionBuilder(buckets,sorter,shareMaxTail);
  BufferedReader reader=Files.newBufferedReader(input,StandardCharsets.UTF_8);
  BytesRefBuilder scratch=new BytesRefBuilder();
  String line;
  int count=0;
  while ((line=reader.readLine()) != null) {
    scratch.copyChars(line);
    builder.add(scratch.get(),count % buckets);
    if ((count++ % 100000) == 0) {
      System.err.println("Line: " + count);
    }
  }
  System.out.println("Building FSTCompletion.");
  FSTCompletion completion=builder.build();
  Path fstFile=Paths.get("completion.fst");
  System.out.println("Done. Writing automaton: " + fstFile.toAbsolutePath());
  completion.getFST().save(fstFile);
  sorter.close();
}
