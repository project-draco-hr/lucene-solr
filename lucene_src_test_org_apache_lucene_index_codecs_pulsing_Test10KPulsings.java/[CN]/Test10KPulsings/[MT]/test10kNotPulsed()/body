{
  CodecProvider cp=_TestUtil.alwaysCodec(new PulsingCodec(1));
  File f=_TestUtil.getTempDir("10kpulsings");
  MockDirectoryWrapper dir=newFSDirectory(f);
  dir.setCheckIndexOnClose(false);
  RandomIndexWriter iw=new RandomIndexWriter(random,dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setCodecProvider(cp));
  Document document=new Document();
  Field field=newField("field","",Field.Store.YES,Field.Index.ANALYZED);
switch (_TestUtil.nextInt(random,0,2)) {
case 0:
    field.setIndexOptions(IndexOptions.DOCS_ONLY);
  break;
case 1:
field.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
break;
default :
field.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS);
break;
}
document.add(field);
NumberFormat df=new DecimalFormat("00000",new DecimalFormatSymbols(Locale.ENGLISH));
Codec codec=cp.lookup(cp.getFieldCodec("field"));
assertTrue(codec instanceof PulsingCodec);
PulsingCodec pulsing=(PulsingCodec)codec;
final int freq=pulsing.getFreqCutoff() + 1;
for (int i=0; i < 10050; i++) {
StringBuilder sb=new StringBuilder();
for (int j=0; j < freq; j++) {
sb.append(df.format(i));
sb.append(' ');
}
field.setValue(sb.toString());
iw.addDocument(document);
}
IndexReader ir=iw.getReader();
iw.close();
TermsEnum te=MultiFields.getTerms(ir,"field").iterator();
DocsEnum de=null;
for (int i=0; i < 10050; i++) {
String expected=df.format(i);
assertEquals(expected,te.next().utf8ToString());
de=te.docs(null,de);
assertTrue(de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
assertEquals(DocIdSetIterator.NO_MORE_DOCS,de.nextDoc());
}
ir.close();
_TestUtil.checkIndex(dir);
dir.close();
}
