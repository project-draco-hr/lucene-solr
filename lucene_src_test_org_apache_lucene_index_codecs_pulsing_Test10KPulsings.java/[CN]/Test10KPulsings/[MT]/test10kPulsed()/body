{
  CodecProvider cp=_TestUtil.alwaysCodec(new PulsingCodec(1));
  File f=_TestUtil.getTempDir("10kpulsed");
  MockDirectoryWrapper dir=newFSDirectory(f);
  dir.setCheckIndexOnClose(false);
  RandomIndexWriter iw=new RandomIndexWriter(random,dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setCodecProvider(cp));
  Document document=new Document();
  Field field=newField("field","",Field.Store.YES,Field.Index.ANALYZED);
switch (_TestUtil.nextInt(random,0,2)) {
case 0:
    field.setIndexOptions(IndexOptions.DOCS_ONLY);
  break;
case 1:
field.setIndexOptions(IndexOptions.DOCS_AND_FREQS);
break;
default :
field.setIndexOptions(IndexOptions.DOCS_AND_FREQS_AND_POSITIONS);
break;
}
document.add(field);
NumberFormat df=new DecimalFormat("00000",new DecimalFormatSymbols(Locale.ENGLISH));
for (int i=0; i < 10050; i++) {
field.setValue(df.format(i));
iw.addDocument(document);
}
IndexReader ir=iw.getReader();
iw.close();
TermsEnum te=MultiFields.getTerms(ir,"field").iterator();
DocsEnum de=null;
for (int i=0; i < 10050; i++) {
String expected=df.format(i);
assertEquals(expected,te.next().utf8ToString());
de=te.docs(null,de);
assertTrue(de.nextDoc() != DocIdSetIterator.NO_MORE_DOCS);
assertEquals(DocIdSetIterator.NO_MORE_DOCS,de.nextDoc());
}
ir.close();
_TestUtil.checkIndex(dir);
dir.close();
}
