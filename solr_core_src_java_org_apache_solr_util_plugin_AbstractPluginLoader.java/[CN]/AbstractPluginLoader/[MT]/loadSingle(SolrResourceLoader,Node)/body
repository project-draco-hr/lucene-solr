{
  List<PluginInitInfo> info=new ArrayList<>();
  T plugin=null;
  try {
    String name=DOMUtil.getAttr(node,"name",requireName ? type : null);
    String className=DOMUtil.getAttr(node,"class",type);
    plugin=create(loader,name,className,node);
    log.debug("created " + name + ": "+ plugin.getClass().getName());
    if (preRegister) {
      info.add(new PluginInitInfo(plugin,node));
    }
 else {
      init(plugin,node);
    }
    T old=register(name,plugin);
    if (old != null && !(name == null && !requireName)) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Multiple " + type + " registered to the same name: "+ name+ " ignoring: "+ old);
    }
  }
 catch (  Exception ex) {
    SolrException e=new SolrException(ErrorCode.SERVER_ERROR,"Plugin init failure for " + type,ex);
    throw e;
  }
  for (  PluginInitInfo pinfo : info) {
    try {
      init(pinfo.plugin,pinfo.node);
    }
 catch (    Exception ex) {
      SolrException e=new SolrException(ErrorCode.SERVER_ERROR,"Plugin init failure for " + type,ex);
      throw e;
    }
  }
  return plugin;
}
