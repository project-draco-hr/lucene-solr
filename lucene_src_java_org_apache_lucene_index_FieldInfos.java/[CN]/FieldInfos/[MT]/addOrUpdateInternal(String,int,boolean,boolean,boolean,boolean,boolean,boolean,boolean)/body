{
  FieldInfo fi=fieldInfo(name);
  if (fi == null) {
    if (preferredFieldNumber == -1) {
      preferredFieldNumber=findNextAvailableFieldNumber(localFieldInfos.nextAvailableNumber,localFieldInfos.byNumber.keySet());
      localFieldInfos.nextAvailableNumber=preferredFieldNumber;
    }
    int fieldNumber=globalFieldNumbers.addOrGet(name,localFieldInfos,preferredFieldNumber);
    if (localFieldInfos.get(fieldNumber) != null) {
      fieldNumber=preferredFieldNumber;
    }
    return addInternal(name,fieldNumber,isIndexed,storeTermVector,storePositionWithTermVector,storeOffsetWithTermVector,omitNorms,storePayloads,omitTermFreqAndPositions);
  }
 else {
    fi.update(isIndexed,storeTermVector,storePositionWithTermVector,storeOffsetWithTermVector,omitNorms,storePayloads,omitTermFreqAndPositions);
  }
  return fi;
}
