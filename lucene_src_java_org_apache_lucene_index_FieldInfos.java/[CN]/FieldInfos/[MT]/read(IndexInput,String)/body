{
  format=input.readVInt();
  if (format > FORMAT_MINIMUM) {
    throw new IndexFormatTooOldException(fileName,format,FORMAT_MINIMUM,FORMAT_CURRENT);
  }
  if (format < FORMAT_CURRENT) {
    throw new IndexFormatTooNewException(fileName,format,FORMAT_MINIMUM,FORMAT_CURRENT);
  }
  final int size=input.readVInt();
  for (int i=0; i < size; i++) {
    String name=StringHelper.intern(input.readString());
    final int codecId=format <= FORMAT_PER_FIELD_CODEC ? input.readInt() : 0;
    byte bits=input.readByte();
    boolean isIndexed=(bits & IS_INDEXED) != 0;
    boolean storeTermVector=(bits & STORE_TERMVECTOR) != 0;
    boolean storePositionsWithTermVector=(bits & STORE_POSITIONS_WITH_TERMVECTOR) != 0;
    boolean storeOffsetWithTermVector=(bits & STORE_OFFSET_WITH_TERMVECTOR) != 0;
    boolean omitNorms=(bits & OMIT_NORMS) != 0;
    boolean storePayloads=(bits & STORE_PAYLOADS) != 0;
    boolean omitTermFreqAndPositions=(bits & OMIT_TERM_FREQ_AND_POSITIONS) != 0;
    final FieldInfo fi=addInternal(name,isIndexed,storeTermVector,storePositionsWithTermVector,storeOffsetWithTermVector,omitNorms,storePayloads,omitTermFreqAndPositions);
    if (format <= FORMAT_INDEX_VALUES) {
      final byte b=input.readByte();
switch (b) {
case 0:
        fi.docValues=null;
      break;
case 1:
    fi.docValues=Values.PACKED_INTS;
  break;
case 2:
fi.docValues=Values.SIMPLE_FLOAT_4BYTE;
break;
case 3:
fi.docValues=Values.SIMPLE_FLOAT_8BYTE;
break;
case 4:
fi.docValues=Values.BYTES_FIXED_STRAIGHT;
break;
case 5:
fi.docValues=Values.BYTES_FIXED_DEREF;
break;
case 6:
fi.docValues=Values.BYTES_FIXED_SORTED;
break;
case 7:
fi.docValues=Values.BYTES_VAR_STRAIGHT;
break;
case 8:
fi.docValues=Values.BYTES_VAR_DEREF;
break;
case 9:
fi.docValues=Values.BYTES_VAR_SORTED;
break;
default :
throw new IllegalStateException("unhandled indexValues type " + b);
}
}
fi.codecId=codecId;
}
if (input.getFilePointer() != input.length()) {
throw new CorruptIndexException("did not read all bytes from file \"" + fileName + "\": read "+ input.getFilePointer()+ " vs size "+ input.length());
}
}
