{
  if (globalFieldNumbers == null) {
    throw new IllegalStateException("FieldInfos are read-only, create a new instance with a global field map to make modifications to FieldInfos");
  }
  FieldInfo fi=fieldInfo(name);
  if (fi == null) {
    final int fieldNumber=nextFieldNumber(name,preferredFieldNumber);
    fi=addInternal(name,fieldNumber,isIndexed,storeTermVector,storePositionWithTermVector,storeOffsetWithTermVector,omitNorms,storePayloads,indexOptions,docValues);
  }
 else {
    fi.update(isIndexed,storeTermVector,storePositionWithTermVector,storeOffsetWithTermVector,omitNorms,storePayloads,indexOptions);
    fi.setDocValues(docValues);
  }
  version++;
  return fi;
}
