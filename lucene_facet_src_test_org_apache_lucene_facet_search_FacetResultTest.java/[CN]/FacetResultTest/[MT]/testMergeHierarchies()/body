{
  Directory indexDir=new RAMDirectory(), taxoDir=new RAMDirectory();
  initIndex(indexDir,taxoDir);
  DirectoryReader indexReader=DirectoryReader.open(indexDir);
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(taxoDir);
  IndexSearcher searcher=new IndexSearcher(indexReader);
  String[] exp=new String[]{"Date (0)\n  2010 (4)\n  2011 (3)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date"}},null);
  exp=new String[]{"A (0)\n  1 (5)\n  4 (2)\n","Date (0)\n  2010 (4)\n  2011 (3)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date"},new String[]{"A"}},null);
  exp=new String[]{"Date (-1)\n  2010 (4)\n    March (2)\n      23 (1)\n      12 (1)\n    May (1)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010/March","Date/2010/March/23"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n      23 (1)\n      12 (1)\n    May (1)\n"};
  searchIndex(taxoReader,searcher,true,exp,new String[][]{new String[]{"Date/2010/March","Date/2010/March/23"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n    May (1)\n  2011 (3)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010","Date/2010"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n    May (1)\n  2011 (3)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n    May (1)\n  2011 (3)\n    February (2)\n    January (1)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010","Date/2011"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n      23 (1)\n      12 (1)\n    May (1)\n  2011 (3)\n    February (2)\n    January (1)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010/March","Date/2011"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n      23 (1)\n      12 (1)\n    May (1)\n    April (1)\n      17 (1)\n  2011 (3)\n    February (2)\n    January (1)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2010/March","Date/2010/April","Date/2011"}},null);
  exp=new String[]{"Date (-1)\n  2010 (4)\n    March (2)\n    May (1)\n    April (1)\n      17 (1)\n  2011 (-1)\n    January (1)\n      1 (1)\n"};
  searchIndex(taxoReader,searcher,false,exp,new String[][]{new String[]{"Date/2011/January/1","Date/2010/April"}},null);
  exp=new String[]{"Date (0)\n  2010 (4)\n    March (2)\n    May (1)\n    April (1)\n      17 (1)\n  2011 (3)\n    January (1)\n      1 (1)\n"};
  searchIndex(taxoReader,searcher,true,exp,new String[][]{new String[]{"Date/2011/January/1","Date/2010/April"}},null);
  exp=new String[]{"A (0)\n  1 (5)\n  4 (2)\n  3 (2)\n"};
  searchIndex(taxoReader,searcher,INFOSTREAM,exp,new String[][]{new String[]{"A","A/3"}},null);
  exp=new String[]{"A (0)\n  1 (5)\n  4 (2)\n  3 (2)\n  2 (2)\n"};
  searchIndex(taxoReader,searcher,INFOSTREAM,exp,new String[][]{new String[]{"A","A"}},new int[]{2,4});
  IOUtils.close(indexReader,taxoReader);
  IOUtils.close(indexDir,taxoDir);
}
