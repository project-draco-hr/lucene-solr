{
  Directory directory=new MockRAMDirectory();
  runTest(directory,false,new SerialMergeScheduler());
  runTest(directory,true,new SerialMergeScheduler());
  runTest(directory,false,new ConcurrentMergeScheduler());
  runTest(directory,true,new ConcurrentMergeScheduler());
  directory.close();
  String tempDir=System.getProperty("tempDir");
  if (tempDir == null)   throw new IOException("tempDir undefined, cannot run test");
  String dirName=tempDir + "/luceneTestThreadedOptimize";
  directory=FSDirectory.getDirectory(dirName);
  runTest(directory,false,new SerialMergeScheduler());
  runTest(directory,true,new SerialMergeScheduler());
  runTest(directory,false,new ConcurrentMergeScheduler());
  runTest(directory,true,new ConcurrentMergeScheduler());
  directory.close();
  _TestUtil.rmDir(dirName);
}
