{
  if (doDocValues && doc instanceof Document) {
    randomPerDocFieldValues(r,(Document)doc);
  }
  if (r.nextInt(5) == 3) {
    w.addDocuments(new Iterable<Iterable<T>>(){
      @Override public Iterator<Iterable<T>> iterator(){
        return new Iterator<Iterable<T>>(){
          boolean done;
          @Override public boolean hasNext(){
            return !done;
          }
          @Override public void remove(){
            throw new UnsupportedOperationException();
          }
          @Override public Iterable<T> next(){
            if (done) {
              throw new IllegalStateException();
            }
            done=true;
            return doc;
          }
        }
;
      }
    }
,a);
  }
 else {
    w.addDocument(doc,a);
  }
  maybeCommit();
}
