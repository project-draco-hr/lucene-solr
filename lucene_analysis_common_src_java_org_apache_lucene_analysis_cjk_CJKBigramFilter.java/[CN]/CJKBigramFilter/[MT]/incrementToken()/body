{
  while (true) {
    if (hasBufferedBigram()) {
      if (outputUnigrams) {
        if (ngramState) {
          flushBigram();
        }
 else {
          flushUnigram();
          index--;
        }
        ngramState=!ngramState;
      }
 else {
        flushBigram();
      }
      return true;
    }
 else     if (doNext()) {
      String type=typeAtt.type();
      if (type == doHan || type == doHiragana || type == doKatakana || type == doHangul) {
        if (offsetAtt.startOffset() != lastEndOffset) {
          if (hasBufferedUnigram()) {
            loneState=captureState();
            flushUnigram();
            return true;
          }
          index=0;
          bufferLen=0;
        }
        refill();
      }
 else {
        if (hasBufferedUnigram()) {
          loneState=captureState();
          flushUnigram();
          return true;
        }
        return true;
      }
    }
 else {
      if (hasBufferedUnigram()) {
        flushUnigram();
        return true;
      }
      return false;
    }
  }
}
