{
  handle.clear();
  handle.put("QTime",SKIPVAL);
  handle.put("timestamp",SKIPVAL);
  indexThread=new StopableIndexingThread(0,true);
  indexThread.start();
  indexThread2=new StopableIndexingThread(10000,true);
  indexThread2.start();
  Thread.sleep(atLeast(2000));
  JettySolrRunner replica=chaosMonkey.stopShard("shard1",1).jetty;
  Thread.sleep(atLeast(2000));
  replica.start();
  Thread.sleep(1500);
  ZkStateReader zkStateReader=cloudClient.getZkStateReader();
  waitForRecoveriesToFinish(DEFAULT_COLLECTION,zkStateReader,false,true);
  indexThread.safeStop();
  indexThread2.safeStop();
  indexThread.join();
  indexThread2.join();
  Thread.sleep(500);
  waitForThingsToLevelOut(30);
  Thread.sleep(1000);
  waitForThingsToLevelOut(30);
  Thread.sleep(1000);
  waitForRecoveriesToFinish(DEFAULT_COLLECTION,zkStateReader,false,true);
  checkShardConsistency("shard1",false,false);
  SolrQuery query=new SolrQuery("*:*");
  query.setParam("distrib","false");
  long client1Docs=shardToJetty.get("shard1").get(0).client.solrClient.query(query).getResults().getNumFound();
  long client2Docs=shardToJetty.get("shard1").get(1).client.solrClient.query(query).getResults().getNumFound();
  assertTrue(client1Docs > 0);
  assertEquals(client1Docs,client2Docs);
}
