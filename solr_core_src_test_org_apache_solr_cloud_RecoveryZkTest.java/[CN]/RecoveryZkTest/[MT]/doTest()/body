{
  handle.clear();
  handle.put("QTime",SKIPVAL);
  handle.put("timestamp",SKIPVAL);
  int[] maxDocList=new int[]{300,700,1200,1350,5000,15000};
  int maxDoc=maxDocList[random().nextInt(maxDocList.length - 1)];
  indexThread=new StopableIndexingThread(0,true,maxDoc);
  indexThread.start();
  indexThread2=new StopableIndexingThread(10000,true,maxDoc);
  indexThread2.start();
  int[] waitTimes=new int[]{2000,3000,5000};
  Thread.sleep(waitTimes[random().nextInt(waitTimes.length - 1)]);
  JettySolrRunner replica=chaosMonkey.stopShard("shard1",1).jetty;
  Thread.sleep(waitTimes[random().nextInt(waitTimes.length - 1)]);
  replica.start();
  Thread.sleep(3000);
  ZkStateReader zkStateReader=cloudClient.getZkStateReader();
  Thread.sleep(5000);
  indexThread.safeStop();
  indexThread2.safeStop();
  indexThread.join();
  indexThread2.join();
  Thread.sleep(500);
  waitForThingsToLevelOut(30);
  Thread.sleep(2000);
  waitForThingsToLevelOut(30);
  waitForRecoveriesToFinish(DEFAULT_COLLECTION,zkStateReader,false,true);
  checkShardConsistency("shard1",false,false);
  SolrQuery query=new SolrQuery("*:*");
  query.setParam("distrib","false");
  long client1Docs=shardToJetty.get("shard1").get(0).client.solrClient.query(query).getResults().getNumFound();
  long client2Docs=shardToJetty.get("shard1").get(1).client.solrClient.query(query).getResults().getNumFound();
  assertTrue(client1Docs > 0);
  assertEquals(client1Docs,client2Docs);
}
