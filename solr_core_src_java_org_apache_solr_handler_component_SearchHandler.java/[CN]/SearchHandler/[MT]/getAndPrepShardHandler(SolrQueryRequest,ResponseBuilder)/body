{
  ShardHandler shardHandler=null;
  rb.isDistrib=req.getParams().getBool("distrib",req.getCore().getCoreDescriptor().getCoreContainer().isZooKeeperAware());
  if (!rb.isDistrib) {
    final String shards=req.getParams().get(ShardParams.SHARDS);
    rb.isDistrib=((shards != null) && (shards.indexOf('/') > 0));
  }
  if (rb.isDistrib) {
    shardHandler=shardHandlerFactory.getShardHandler();
    shardHandler.prepDistributed(rb);
    if (!rb.isDistrib) {
      shardHandler=null;
    }
  }
  return shardHandler;
}
