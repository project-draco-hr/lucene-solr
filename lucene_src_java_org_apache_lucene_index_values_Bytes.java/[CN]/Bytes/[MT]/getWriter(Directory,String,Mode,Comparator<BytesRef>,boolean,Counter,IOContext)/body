{
  if (comp == null) {
    comp=BytesRef.getUTF8SortedAsUnicodeComparator();
  }
  if (fixedSize) {
    if (mode == Mode.STRAIGHT) {
      return new FixedStraightBytesImpl.Writer(dir,id,bytesUsed,context);
    }
 else     if (mode == Mode.DEREF) {
      return new FixedDerefBytesImpl.Writer(dir,id,bytesUsed,context);
    }
 else     if (mode == Mode.SORTED) {
      return new FixedSortedBytesImpl.Writer(dir,id,comp,bytesUsed,context);
    }
  }
 else {
    if (mode == Mode.STRAIGHT) {
      return new VarStraightBytesImpl.Writer(dir,id,bytesUsed,context);
    }
 else     if (mode == Mode.DEREF) {
      return new VarDerefBytesImpl.Writer(dir,id,bytesUsed,context);
    }
 else     if (mode == Mode.SORTED) {
      return new VarSortedBytesImpl.Writer(dir,id,comp,bytesUsed,context);
    }
  }
  throw new IllegalArgumentException("");
}
