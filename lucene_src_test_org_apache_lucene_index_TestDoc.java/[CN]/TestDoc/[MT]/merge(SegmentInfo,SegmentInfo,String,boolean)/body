{
  SegmentReader r1=SegmentReader.get(true,si1,IndexReader.DEFAULT_TERMS_INDEX_DIVISOR);
  SegmentReader r2=SegmentReader.get(true,si2,IndexReader.DEFAULT_TERMS_INDEX_DIVISOR);
  SegmentMerger merger=new SegmentMerger(si1.dir,IndexWriterConfig.DEFAULT_TERM_INDEX_INTERVAL,merged,null,null,new FieldInfos());
  merger.add(r1);
  merger.add(r2);
  merger.merge();
  r1.close();
  r2.close();
  final FieldInfos fieldInfos=merger.fieldInfos();
  final SegmentInfo info=new SegmentInfo(merged,si1.docCount + si2.docCount,si1.dir,false,merger.getSegmentCodecs(),fieldInfos);
  if (useCompoundFile) {
    Collection<String> filesToDelete=merger.createCompoundFile(merged + ".cfs",info);
    info.setUseCompoundFile(true);
    for (    final String fileToDelete : filesToDelete)     si1.dir.deleteFile(fileToDelete);
  }
  return info;
}
