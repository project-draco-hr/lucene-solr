{
  LeafReader lr=SlowCompositeReaderWrapper.wrap(reader);
  LeafReaderContext lrContext=lr.getContext();
  SpanQuery rewrittenQuery=(SpanQuery)spanQuery.rewrite(lr);
  HashSet<Term> termSet=new HashSet<>();
  rewrittenQuery.extractTerms(termSet);
  Map<Term,TermContext> termContexts=new HashMap<>();
  for (  Term term : termSet) {
    TermContext termContext=TermContext.build(lrContext,term);
    termContexts.put(term,termContext);
  }
  Spans actSpans=spanQuery.getSpans(lrContext,new Bits.MatchAllBits(lr.numDocs()),termContexts);
  return actSpans;
}
