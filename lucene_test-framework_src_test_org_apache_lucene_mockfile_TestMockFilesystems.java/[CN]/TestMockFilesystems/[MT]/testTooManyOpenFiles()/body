{
  int n=60;
  Path dir=FilterPath.unwrap(createTempDir());
  FileSystem fs=new HandleLimitFS(dir.getFileSystem(),n).getFileSystem(URI.create("file:///"));
  dir=new FilterPath(dir,fs);
  List<Closeable> toClose=new ArrayList<>();
  for (int i=0; i < n; i++) {
    Path p=Files.createTempFile(dir,null,null);
    toClose.add(Files.newOutputStream(p));
  }
  try {
    Files.newOutputStream(Files.createTempFile(dir,null,null));
    fail("didn't hit exception");
  }
 catch (  IOException e) {
    assertTrue(e.getMessage().contains("Too many open files"));
  }
  IOUtils.close(toClose);
}
