{
  SolrRequestInfo info=SolrRequestInfo.getRequestInfo();
  CoreContainer container=info.getReq().getCore().getCoreDescriptor().getCoreContainer();
  final SolrCore fromCore=container.getCore(fromIndex);
  if (fromCore == null) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Cross-core join: no such core " + fromIndex);
  }
  RefCounted<SolrIndexSearcher> fromHolder=null;
  fromHolder=fromCore.getRegisteredSearcher();
  final Query joinQuery;
  try {
    joinQuery=JoinUtil.createJoinQuery(fromField,true,toField,fromQuery,fromHolder.get(),scoreMode);
  }
  finally {
    fromCore.close();
    fromHolder.decref();
  }
  joinQuery.setBoost(getBoost());
  return joinQuery.rewrite(reader);
}
