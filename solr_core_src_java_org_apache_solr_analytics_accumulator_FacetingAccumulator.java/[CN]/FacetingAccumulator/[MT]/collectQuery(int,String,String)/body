{
  Map<String,StatsCollector[]> map=queryFacetCollectors.get(facetName);
  StatsCollector[] statsCollectors=map.get(query);
  if (statsCollectors == null) {
    statsCollectors=statsCollectorArraySupplier.get();
    map.put(query,statsCollectors);
    queryFacetExpressions.get(facetName).put(query,makeExpressions(statsCollectors));
    for (    StatsCollector statsCollector : statsCollectors) {
      statsCollector.setNextReader(context);
    }
  }
  for (  StatsCollector statsCollector : statsCollectors) {
    statsCollector.collect(doc);
  }
}
