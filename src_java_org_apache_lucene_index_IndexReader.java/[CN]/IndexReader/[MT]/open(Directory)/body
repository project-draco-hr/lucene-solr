{
synchronized (directory) {
    return (IndexReader)new Lock.With(directory.makeLock(IndexWriter.COMMIT_LOCK_NAME),IndexWriter.COMMIT_LOCK_TIMEOUT){
      public Object doBody() throws IOException {
        SegmentInfos infos=new SegmentInfos();
        infos.read(directory);
        if (infos.size() == 1) {
          return new SegmentReader(infos,infos.info(0),true);
        }
 else {
          IndexReader[] readers=new IndexReader[infos.size()];
          for (int i=0; i < infos.size(); i++)           readers[i]=new SegmentReader(infos,infos.info(i),i == infos.size() - 1);
          return new MultiReader(directory,readers);
        }
      }
    }
.run();
  }
}
