{
synchronized (directory) {
    Lock commitLock=directory.makeLock(IndexWriter.COMMIT_LOCK_NAME);
    boolean locked=false;
    try {
      locked=commitLock.obtain(IndexWriter.COMMIT_LOCK_TIMEOUT);
      return SegmentInfos.readCurrentVersion(directory);
    }
  finally {
      if (locked) {
        commitLock.release();
      }
    }
  }
}
