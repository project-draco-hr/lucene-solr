{
  if (stale)   throw new IOException("IndexReader out of date and no longer valid for deletion");
  if (writeLock == null) {
    Lock writeLock=directory.makeLock(IndexWriter.WRITE_LOCK_NAME);
    if (!writeLock.obtain(IndexWriter.WRITE_LOCK_TIMEOUT))     throw new IOException("Index locked for write: " + writeLock);
    this.writeLock=writeLock;
    if (segmentInfos != null && SegmentInfos.readCurrentVersion(directory) > segmentInfos.getVersion()) {
      stale=true;
      this.writeLock.release();
      this.writeLock=null;
      throw new IOException("IndexReader out of date and no longer valid for deletion");
    }
  }
  doDelete(docNum);
}
