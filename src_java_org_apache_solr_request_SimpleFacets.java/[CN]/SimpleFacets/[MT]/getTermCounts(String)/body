{
  int offset=params.getFieldInt(field,params.FACET_OFFSET,0);
  int limit=params.getFieldInt(field,params.FACET_LIMIT,100);
  Integer mincount=params.getFieldInt(field,params.FACET_MINCOUNT);
  if (mincount == null) {
    Boolean zeros=params.getFieldBool(field,params.FACET_ZEROS);
    mincount=(zeros != null && !zeros) ? 1 : 0;
  }
  boolean missing=params.getFieldBool(field,params.FACET_MISSING,false);
  boolean sort=params.getFieldBool(field,params.FACET_SORT,limit > 0);
  NamedList counts;
  SchemaField sf=searcher.getSchema().getField(field);
  FieldType ft=sf.getType();
  if (sf.multiValued() || ft.isTokenized() || ft instanceof BoolField) {
    counts=getFacetTermEnumCounts(searcher,docs,field,offset,limit,mincount,missing,sort);
  }
 else {
    counts=getFieldCacheCounts(searcher,docs,field,offset,limit,mincount,missing,sort);
  }
  return counts;
}
