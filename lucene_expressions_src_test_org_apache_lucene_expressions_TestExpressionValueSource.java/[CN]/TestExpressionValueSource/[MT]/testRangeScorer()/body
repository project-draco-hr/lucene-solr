{
  Expression expr=JavascriptCompiler.compile("2*popularity");
  SimpleBindings bindings=new SimpleBindings();
  bindings.add(new SortField("popularity",SortField.Type.LONG));
  ValueSource vs=expr.getValueSource(bindings);
  assertEquals(1,reader.leaves().size());
  AtomicReaderContext leaf=reader.leaves().get(0);
  FunctionValues values=vs.getValues(new HashMap<String,Object>(),leaf);
  ValueSourceScorer scorer=values.getRangeScorer(leaf.reader(),"4","40",true,true);
  assertEquals(-1,scorer.docID());
  assertEquals(0,scorer.nextDoc());
  assertEquals(1,scorer.nextDoc());
  assertEquals(2,scorer.nextDoc());
  assertEquals(DocIdSetIterator.NO_MORE_DOCS,scorer.nextDoc());
  scorer=values.getRangeScorer(leaf.reader(),"4","40",false,false);
  assertEquals(-1,scorer.docID());
  assertEquals(0,scorer.nextDoc());
  assertEquals(DocIdSetIterator.NO_MORE_DOCS,scorer.nextDoc());
}
