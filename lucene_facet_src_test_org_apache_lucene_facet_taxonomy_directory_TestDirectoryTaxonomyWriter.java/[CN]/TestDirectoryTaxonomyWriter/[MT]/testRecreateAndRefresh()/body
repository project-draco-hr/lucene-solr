{
  Directory dir=newDirectory();
  DirectoryTaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE_OR_APPEND,NO_OP_CACHE);
  touchTaxo(taxoWriter,new CategoryPath("a"));
  TaxonomyReader taxoReader=new DirectoryTaxonomyReader(dir);
  touchTaxo(taxoWriter,new CategoryPath("b"));
  TaxonomyReader newtr=TaxonomyReader.openIfChanged(taxoReader);
  taxoReader.close();
  taxoReader=newtr;
  assertEquals(1,Integer.parseInt(taxoReader.getCommitUserData().get(DirectoryTaxonomyWriter.INDEX_EPOCH)));
  taxoWriter.close();
  taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE,NO_OP_CACHE);
  touchTaxo(taxoWriter,new CategoryPath("c"));
  taxoWriter.close();
  taxoWriter=new DirectoryTaxonomyWriter(dir,OpenMode.CREATE_OR_APPEND,NO_OP_CACHE);
  touchTaxo(taxoWriter,new CategoryPath("d"));
  taxoWriter.close();
  newtr=TaxonomyReader.openIfChanged(taxoReader);
  taxoReader.close();
  taxoReader=newtr;
  assertEquals(2,Integer.parseInt(taxoReader.getCommitUserData().get(DirectoryTaxonomyWriter.INDEX_EPOCH)));
  taxoReader.close();
  dir.close();
}
