{
  Directory input=newDirectory();
  DirectoryTaxonomyWriter taxoWriter=new DirectoryTaxonomyWriter(input);
  int ordA=taxoWriter.addCategory(new CategoryPath("a"));
  taxoWriter.close();
  Directory dir=newDirectory();
  taxoWriter=new DirectoryTaxonomyWriter(dir);
  int ordB=taxoWriter.addCategory(new CategoryPath("b"));
  taxoWriter.addCategory(new CategoryPath("c"));
  taxoWriter.commit();
  long origEpoch=getEpoch(dir);
  taxoWriter.replaceTaxonomy(input);
  taxoWriter.addTaxonomy(input,new MemoryOrdinalMap());
  assertEquals("no categories should have been added",2,taxoWriter.getSize());
  assertEquals("category 'a' received new ordinal?",ordA,taxoWriter.addCategory(new CategoryPath("a")));
  int newOrdB=taxoWriter.addCategory(new CategoryPath("b"));
  assertNotSame("new ordinal cannot be the original ordinal",ordB,newOrdB);
  assertEquals("ordinal should have been 2 since only one category was added by replaceTaxonomy",2,newOrdB);
  taxoWriter.close();
  long newEpoch=getEpoch(dir);
  assertTrue("index epoch should have been updated after replaceTaxonomy",origEpoch < newEpoch);
  dir.close();
  input.close();
}
