{
  boolean store=false;
  boolean index=false;
  boolean token=false;
  Document doc=new Document();
  int flags;
  addField(doc,"url",webDoc.getUrl().toExternalForm(),STORE | INDEX);
  addField(doc,"mimetype",webDoc.getMimeType(),STORE | INDEX);
  Set fields=webDoc.getFieldNames();
  for (Iterator it=fields.iterator(); it.hasNext(); ) {
    String fieldName=(String)it.next();
    Object field=webDoc.getField(fieldName);
    if (field instanceof char[]) {
      addField(doc,fieldName,new String((char[])field),STORE | INDEX);
    }
 else     if (field instanceof String) {
      addField(doc,fieldName,(String)field,STORE | INDEX);
    }
  }
  try {
    writer.addDocument(doc);
  }
 catch (  IOException e) {
    System.err.println("IOException occured when adding document to Lucene index");
    e.printStackTrace();
  }
  return webDoc;
}
