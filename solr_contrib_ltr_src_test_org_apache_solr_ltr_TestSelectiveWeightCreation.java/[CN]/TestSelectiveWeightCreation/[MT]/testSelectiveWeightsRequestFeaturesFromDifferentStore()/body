{
  final SolrQuery query=new SolrQuery();
  query.setQuery("*:*");
  query.add("fl","*,score");
  query.add("rows","4");
  query.add("rq","{!ltr reRankDocs=4 model=externalmodel efi.user_query=w3}");
  query.add("fl","fv:[fv]");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/id=='1'");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[1]/id=='3'");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[2]/id=='4'");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/fv=='matchedTitle:1.0;titlePhraseMatch:0.40254828'");
  query.remove("fl");
  query.remove("rq");
  query.add("fl","*,score");
  query.add("rq","{!ltr reRankDocs=4 model=externalmodel efi.user_query=w3}");
  query.add("fl","fv:[fv store=fstore4 efi.myPop=3]");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/id=='1'");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/score==0.999");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/fv=='popularity:3.0;originalScore:1.0'");
  query.remove("fl");
  query.remove("rq");
  query.add("fl","*,score");
  query.add("rq","{!ltr reRankDocs=4 model=externalmodelstore efi.user_query=w3 efi.myconf=0.8}");
  query.add("fl","fv:[fv store=fstore4 efi.myPop=3]");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/id=='1'");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/score==0.7992");
  assertJQ("/query" + query.toQueryString(),"/response/docs/[0]/fv=='popularity:3.0;originalScore:1.0'");
}
