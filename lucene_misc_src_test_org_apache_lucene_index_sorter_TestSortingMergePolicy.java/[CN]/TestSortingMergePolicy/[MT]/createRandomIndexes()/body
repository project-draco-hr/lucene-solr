{
  dir1=newDirectory();
  dir2=newDirectory();
  final int numDocs=atLeast(100);
  final IndexWriterConfig iwc1=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random()));
  final IndexWriterConfig iwc2=iwc1.clone();
  iwc2.setMergePolicy(new SortingMergePolicy(iwc2.getMergePolicy(),sorter));
  final IndexWriter iw1=new IndexWriter(dir1,iwc1);
  final IndexWriter iw2=new IndexWriter(dir2,iwc2);
  for (int i=0; i < numDocs; ++i) {
    final Document doc=randomDocument();
    iw1.addDocument(doc);
    iw2.addDocument(doc);
    if (i == numDocs / 2 || rarely()) {
      iw1.commit();
      iw2.commit();
    }
  }
  iw1.deleteDocuments(new Term("s",DELETE_TERM));
  iw2.deleteDocuments(new Term("s",DELETE_TERM));
  iw1.forceMerge(1);
  iw2.forceMerge(1);
  iw1.close();
  iw2.close();
  reader=DirectoryReader.open(dir1);
  sortedReader=DirectoryReader.open(dir2);
}
