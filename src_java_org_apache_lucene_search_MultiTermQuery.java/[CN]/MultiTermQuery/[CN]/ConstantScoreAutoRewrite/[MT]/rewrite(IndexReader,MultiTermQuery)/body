{
  final int docCountCutoff=(int)((docCountPercent / 100.) * reader.maxDoc());
  final int termCountLimit=Math.min(BooleanQuery.getMaxClauseCount(),termCountCutoff);
  final CutOffTermCollector col=new CutOffTermCollector(reader,docCountCutoff,termCountLimit);
  collectTerms(reader,query,col);
  if (col.hasCutOff) {
    return CONSTANT_SCORE_FILTER_REWRITE.rewrite(reader,query);
  }
 else {
    final Query result;
    if (col.pendingTerms.isEmpty()) {
      result=new BooleanQuery(true);
    }
 else {
      BooleanQuery bq=new BooleanQuery(true);
      for (      Term term : col.pendingTerms) {
        TermQuery tq=new TermQuery(term);
        bq.add(tq,BooleanClause.Occur.SHOULD);
      }
      result=new ConstantScoreQuery(new QueryWrapperFilter(bq));
      result.setBoost(query.getBoost());
    }
    query.incTotalNumberOfTerms(col.pendingTerms.size());
    return result;
  }
}
