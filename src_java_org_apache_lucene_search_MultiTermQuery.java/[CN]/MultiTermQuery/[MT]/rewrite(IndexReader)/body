{
  if (!constantScoreRewrite) {
    FilteredTermEnum enumerator=getEnum(reader);
    BooleanQuery query=new BooleanQuery(true);
    try {
      do {
        Term t=enumerator.term();
        if (t != null) {
          numberOfTerms++;
          TermQuery tq=new TermQuery(t);
          tq.setBoost(getBoost() * enumerator.difference());
          query.add(tq,BooleanClause.Occur.SHOULD);
        }
      }
 while (enumerator.next());
    }
  finally {
      enumerator.close();
    }
    return query;
  }
 else {
    Query query=new ConstantScoreQuery(getFilter());
    query.setBoost(getBoost());
    return query;
  }
}
