{
  while (true) {
    if (replacement != null && charPointer < replacement.length())     return replacement.charAt(charPointer++);
    int firstChar=nextChar();
    if (firstChar == -1)     return -1;
    NormalizeMap nm=normMap.submap != null ? normMap.submap.get((char)firstChar) : null;
    if (nm == null)     return firstChar;
    NormalizeMap result=match(nm);
    if (result == null)     return firstChar;
    replacement=result.normStr;
    charPointer=0;
    if (result.diff != 0) {
      int prevCumulativeDiff=pcmList.isEmpty() ? 0 : pcmList.get(pcmList.size() - 1).cumulativeDiff;
      if (result.diff < 0) {
        for (int i=0; i < -result.diff; i++)         pcmList.add(new PosCorrectMap(nextCharCounter + i - prevCumulativeDiff,prevCumulativeDiff - 1 - i));
      }
 else {
        pcmList.add(new PosCorrectMap(nextCharCounter - result.diff - prevCumulativeDiff,prevCumulativeDiff + result.diff));
      }
    }
  }
}
