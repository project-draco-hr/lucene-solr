{
  Objects.requireNonNull(name);
  log.info("Creating the snapshot named {} for core {} associated with index commit with generation {} in directory {}",name,solrCore.getName(),gen,indexDirPath);
  if (nameToDetailsMapping.containsKey(name)) {
    throw new SolrException(ErrorCode.BAD_REQUEST,"A snapshot with name " + name + " already exists");
  }
  SnapshotMetaData d=new SnapshotMetaData(name,indexDirPath,gen);
  nameToDetailsMapping.put(name,d);
  boolean success=false;
  try {
    persist();
    success=true;
  }
  finally {
    if (!success) {
      try {
        release(name);
      }
 catch (      Exception e) {
      }
    }
  }
}
