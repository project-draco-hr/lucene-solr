{
  if (!(freq.domain.toChildren || freq.domain.toParent))   return;
  String parentStr=freq.domain.parents;
  Query parentQuery;
  try {
    QParser parser=QParser.getParser(parentStr,null,fcontext.req);
    parentQuery=parser.getQuery();
  }
 catch (  SyntaxError err) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Error parsing block join parent specification: " + parentStr);
  }
  BitDocSet parents=fcontext.searcher.getDocSetBits(parentQuery);
  DocSet input=fcontext.base;
  DocSet result;
  if (freq.domain.toChildren) {
    DocSet filt=fcontext.searcher.getDocSetBits(new MatchAllDocsQuery());
    result=BlockJoin.toChildren(input,parents,filt,fcontext.qcontext);
  }
 else {
    result=BlockJoin.toParents(input,parents,fcontext.qcontext);
  }
  fcontext.base=result;
}
