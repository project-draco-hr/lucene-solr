{
  if (o == null)   return;
  if (o instanceof Map) {
    Map<String,Object> m=(Map<String,Object>)o;
    for (    Map.Entry<String,Object> entry : m.entrySet()) {
      String key=entry.getKey();
      Object value=entry.getValue();
      if ("processEmpty".equals(key)) {
        facet.processEmpty=getBoolean(m,"processEmpty",false);
        continue;
      }
      Object parsedValue=parseFacetOrStat(key,value);
      if (parsedValue instanceof FacetRequest) {
        facet.addSubFacet(key,(FacetRequest)parsedValue);
      }
 else       if (parsedValue instanceof AggValueSource) {
        facet.addStat(key,(AggValueSource)parsedValue);
      }
 else {
        throw err("Unknown facet type key=" + key + " class="+ (parsedValue == null ? "null" : parsedValue.getClass().getName()));
      }
    }
  }
 else {
    throw err("Expected map for facet/stat");
  }
}
