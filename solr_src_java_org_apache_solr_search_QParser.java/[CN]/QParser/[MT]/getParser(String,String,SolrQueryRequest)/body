{
  SolrParams localParams=QueryParsing.getLocalParams(qstr,req.getParams());
  String type;
  if (localParams == null) {
    type=defaultType;
  }
 else {
    String localType=localParams.get(QueryParsing.TYPE);
    type=localType == null ? defaultType : localType;
    qstr=localParams.get("v");
  }
  type=type == null ? QParserPlugin.DEFAULT_QTYPE : type;
  QParserPlugin qplug=req.getCore().getQueryPlugin(type);
  return qplug.createParser(qstr,localParams,req.getParams(),req);
}
