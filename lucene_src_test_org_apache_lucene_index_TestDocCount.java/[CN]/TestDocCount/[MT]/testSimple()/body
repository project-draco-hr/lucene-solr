{
  assumeFalse("PreFlex codec does not support docCount statistic!","PreFlex".equals(CodecProvider.getDefault().getDefaultFieldCodec()));
  Directory dir=newDirectory();
  RandomIndexWriter iw=new RandomIndexWriter(random,dir);
  int numDocs=atLeast(100);
  for (int i=0; i < numDocs; i++) {
    iw.addDocument(doc());
  }
  IndexReader ir=iw.getReader();
  verifyCount(ir);
  ir.close();
  iw.optimize();
  ir=iw.getReader();
  verifyCount(ir);
  ir.close();
  iw.close();
  dir.close();
}
