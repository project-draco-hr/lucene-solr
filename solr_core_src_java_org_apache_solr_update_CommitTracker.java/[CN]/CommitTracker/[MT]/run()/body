{
  long started=System.currentTimeMillis();
  SolrQueryRequest req=new LocalSolrQueryRequest(core,new ModifiableSolrParams());
  try {
    CommitUpdateCommand command=new CommitUpdateCommand(req,false);
    command.waitSearcher=waitSearcher;
    command.softCommit=softCommit;
    core.getUpdateHandler().commit(command);
    autoCommitCount.incrementAndGet();
  }
 catch (  Exception e) {
    log.error("auto commit error...");
    e.printStackTrace();
  }
 finally {
    pending=null;
    req.close();
  }
  if (lastAddedTime > started) {
    if (docsUpperBound > 0 && docsSinceCommit.get() > docsUpperBound) {
      pending=scheduler.schedule(this,100,TimeUnit.MILLISECONDS);
    }
 else     if (timeUpperBound > 0) {
      pending=scheduler.schedule(this,timeUpperBound,TimeUnit.MILLISECONDS);
    }
  }
}
