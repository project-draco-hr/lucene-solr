{
  Lock lock=lockFactory.makeLock(directoryName + ".lock");
  snapShotDir=new File(snapDir,directoryName);
  if (lock.isLocked()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to acquire lock for snapshot directory: " + snapShotDir.getAbsolutePath());
  }
  if (snapShotDir.exists()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Snapshot directory already exists: " + snapShotDir.getAbsolutePath());
  }
  if (!snapShotDir.mkdirs()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to create snapshot directory: " + snapShotDir.getAbsolutePath());
  }
}
