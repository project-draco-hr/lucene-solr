{
  final File snapShotFile=new File(snapDir,directoryName);
  if (snapShotFile.exists()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Snapshot directory already exists: " + snapShotFile.getAbsolutePath());
  }
  if (!snapShotFile.mkdirs()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to create snapshot directory: " + snapShotFile.getAbsolutePath());
  }
  snapShotDir=new SimpleFSDirectory(snapShotFile.toPath(),SimpleFSLockFactory.INSTANCE);
  Lock lock=snapShotDir.makeLock("write.lock");
  if (lock.isLocked()) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Unable to acquire lock for snapshot directory: " + snapShotFile.getAbsolutePath());
  }
}
