{
  IndexSearcher searcher=null;
  try {
    if (fieldTypeName != null && schema.getFieldTypeNoEx(fieldTypeName) != null) {
      FieldType fieldType=schema.getFieldTypes().get(fieldTypeName);
      RAMDirectory ramDir=new RAMDirectory();
      IndexWriter writer=new IndexWriter(ramDir,fieldType.getAnalyzer(),true,IndexWriter.MaxFieldLength.UNLIMITED);
      writer.setMergeFactor(300);
      writer.setMaxBufferedDocs(150);
      List<String> lines=loader.getLines(sourceLocation,characterEncoding);
      for (      String s : lines) {
        Document d=new Document();
        d.add(new Field(WORD_FIELD_NAME,s,Field.Store.NO,Field.Index.TOKENIZED));
        writer.addDocument(d);
      }
      writer.optimize();
      writer.close();
      dictionary=new HighFrequencyDictionary(IndexReader.open(ramDir),WORD_FIELD_NAME,0.0f);
      analyzer=fieldType.getQueryAnalyzer();
    }
 else {
      log.warning("No fieldType: " + fieldTypeName + " found for dictionary: "+ name);
      analyzer=new WhitespaceAnalyzer();
      if (characterEncoding == null) {
        dictionary=new PlainTextDictionary(loader.openResource(sourceLocation));
      }
 else {
        dictionary=new PlainTextDictionary(new InputStreamReader(loader.openResource(sourceLocation),characterEncoding));
      }
    }
  }
 catch (  IOException e) {
    log.log(Level.SEVERE,"Unable to load spellings",e);
  }
 finally {
    try {
      if (searcher != null)       searcher.close();
    }
 catch (    IOException e) {
    }
  }
}
