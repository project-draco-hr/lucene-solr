{
  HttpSolrClient solr=new HttpSolrClient(coreUrl);
  int remoteVersion=-1;
  try {
    while (remoteVersion == -1 || remoteVersion < expectedZkVersion) {
      try {
        HttpSolrClient.HttpUriRequestResponse mrr=solr.httpUriRequest(this);
        NamedList<Object> zkversionResp=mrr.future.get();
        if (zkversionResp != null)         remoteVersion=(Integer)zkversionResp.get("zkversion");
        if (remoteVersion < expectedZkVersion) {
          log.error("Replica " + coreUrl + " returned schema version "+ remoteVersion+ " and has not applied schema version "+ expectedZkVersion);
        }
      }
 catch (      Exception e) {
        if (e instanceof InterruptedException) {
          break;
        }
 else {
          log.warn("Failed to get /schema/zkversion from " + coreUrl + " due to: "+ e);
        }
      }
    }
  }
  finally {
    solr.shutdown();
  }
  return remoteVersion;
}
