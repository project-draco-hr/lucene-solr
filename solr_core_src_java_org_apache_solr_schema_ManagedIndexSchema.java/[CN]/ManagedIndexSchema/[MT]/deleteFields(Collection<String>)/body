{
  ManagedIndexSchema newSchema;
  if (isMutable) {
    newSchema=shallowCopy(true);
    for (    String name : names) {
      SchemaField field=getFieldOrNull(name);
      if (null != field) {
        if (copyFieldsMap.containsKey(name) || isCopyFieldTarget(field)) {
          throw new SolrException(ErrorCode.BAD_REQUEST,"Can't delete '" + name + "' because it's referred to by at least one copy field directive.");
        }
        newSchema.fields.remove(name);
        newSchema.fieldsWithDefaultValue.remove(field);
        newSchema.requiredFields.remove(field);
      }
 else {
        String msg="The field '" + name + "' is not present in this schema, and so cannot be deleted.";
        throw new SolrException(ErrorCode.BAD_REQUEST,msg);
      }
    }
    for (    SchemaAware aware : newSchema.schemaAware) {
      aware.inform(newSchema);
    }
    newSchema.refreshAnalyzers();
  }
 else {
    String msg="This ManagedIndexSchema is not mutable.";
    log.error(msg);
    throw new SolrException(ErrorCode.SERVER_ERROR,msg);
  }
  return newSchema;
}
