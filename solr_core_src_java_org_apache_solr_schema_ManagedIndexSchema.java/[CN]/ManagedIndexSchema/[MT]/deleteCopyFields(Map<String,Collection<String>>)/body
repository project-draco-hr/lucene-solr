{
  ManagedIndexSchema newSchema;
  if (isMutable) {
    newSchema=shallowCopy(true);
    newSchema.copyFieldsMap=cloneCopyFieldsMap(copyFieldsMap);
    newSchema.copyFieldTargetCounts=(Map<SchemaField,Integer>)((HashMap<SchemaField,Integer>)copyFieldTargetCounts).clone();
    newSchema.dynamicCopyFields=new DynamicCopy[dynamicCopyFields.length];
    System.arraycopy(dynamicCopyFields,0,newSchema.dynamicCopyFields,0,dynamicCopyFields.length);
    for (    Map.Entry<String,Collection<String>> entry : copyFields.entrySet()) {
      for (      String destination : entry.getValue()) {
        newSchema.deleteCopyField(entry.getKey(),destination);
      }
    }
    for (    SchemaAware aware : newSchema.schemaAware) {
      aware.inform(newSchema);
    }
    newSchema.refreshAnalyzers();
  }
 else {
    String msg="This ManagedIndexSchema is not mutable.";
    log.error(msg);
    throw new SolrException(ErrorCode.SERVER_ERROR,msg);
  }
  return newSchema;
}
