{
  ManagedIndexSchema newSchema;
  try {
    newSchema=shallowCopy(false);
    Config schemaConf=new Config(loader,SCHEMA,inputSource,SLASH + SCHEMA + SLASH);
    Document document=schemaConf.getDocument();
    final XPath xpath=schemaConf.getXPath();
    newSchema.mergeFieldTypesFromZk(document,xpath);
    newSchema.loadFields(document,xpath);
    newSchema.copyFieldsMap=new HashMap<>();
    newSchema.dynamicCopyFields=new DynamicCopy[]{};
    newSchema.copyFieldTargetCounts=new HashMap<>();
    newSchema.loadCopyFields(document,xpath);
    if (null != uniqueKeyField) {
      newSchema.requiredFields.add(uniqueKeyField);
    }
    for (    SchemaAware aware : newSchema.schemaAware) {
      aware.inform(newSchema);
    }
    for (    FieldType fieldType : newSchema.fieldTypes.values())     informResourceLoaderAwareObjectsForFieldType(fieldType);
    newSchema.refreshAnalyzers();
    newSchema.schemaZkVersion=schemaZkVersion;
  }
 catch (  SolrException e) {
    throw e;
  }
catch (  Exception e) {
    throw new SolrException(ErrorCode.SERVER_ERROR,"Schema Parsing Failed: " + e.getMessage(),e);
  }
  return newSchema;
}
