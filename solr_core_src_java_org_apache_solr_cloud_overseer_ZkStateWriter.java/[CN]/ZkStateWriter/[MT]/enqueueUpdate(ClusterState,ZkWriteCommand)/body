{
  if (cmd == NO_OP)   return prevState;
  if (cmd.collection == null) {
    isClusterStateModified=true;
    clusterState=prevState.copyWith(singletonMap(cmd.name,(DocCollection)null));
    updates.put(cmd.name,null);
  }
 else {
    if (cmd.collection.getStateFormat() > 1) {
      updates.put(cmd.name,cmd.collection);
    }
 else {
      isClusterStateModified=true;
    }
    clusterState=prevState.copyWith(singletonMap(cmd.name,cmd.collection));
  }
  return clusterState;
}
