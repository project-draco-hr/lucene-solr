{
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMergePolicy(newLogMergePolicy());
  RandomIndexWriter riw=new RandomIndexWriter(random,dir,iwc);
  Document d=new Document();
  d.add(f1);
  riw.addDocument(d);
  d=new Document();
  d.add(f2);
  riw.addDocument(d);
  int numExtraDocs=_TestUtil.nextInt(random,1,1000);
  for (int i=0; i < numExtraDocs; i++) {
    d=new Document();
    d.add(random.nextBoolean() ? f1 : f2);
    riw.addDocument(d);
  }
  IndexReader ir1=riw.getReader();
  byte[] norms1=MultiNorms.norms(ir1,field);
  riw.optimize();
  IndexReader ir2=riw.getReader();
  byte[] norms2=ir2.getSequentialSubReaders()[0].norms(field);
  assertArrayEquals(norms1,norms2);
  ir1.close();
  ir2.close();
  riw.close();
  dir.close();
  return norms1;
}
