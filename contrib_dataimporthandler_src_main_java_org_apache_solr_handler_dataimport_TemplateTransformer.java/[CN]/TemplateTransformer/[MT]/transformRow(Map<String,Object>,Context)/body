{
  String entityName=context.getEntityAttribute(DataImporter.NAME);
  VariableResolverImpl resolver=(VariableResolverImpl)context.getVariableResolver();
  Map<String,Object> resolverMap=(Map<String,Object>)resolver.resolve(entityName);
  Map<String,Object> resolverMapCopy=new HashMap<String,Object>();
  if (resolverMap != null) {
    for (    Map.Entry<String,Object> entry : resolverMap.entrySet())     resolverMapCopy.put(entry.getKey(),entry.getValue());
  }
  for (  Map.Entry<String,Object> entry : row.entrySet())   resolverMapCopy.put(entry.getKey(),entry.getValue());
  resolver.addNamespace(entityName,resolverMapCopy);
  for (  Map<String,String> map : context.getAllEntityFields()) {
    String expr=map.get(TEMPLATE);
    if (expr == null)     continue;
    String column=map.get(DataImporter.COLUMN);
    boolean resolvable=true;
    List<String> variables=TemplateString.getVariables(expr);
    for (    String v : variables) {
      if (resolver.resolve(v) == null) {
        LOG.warning("Unable to resolve variable: " + v + " while parsing expression: "+ expr);
        resolvable=false;
      }
    }
    if (!resolvable)     continue;
    row.put(column,resolver.replaceTokens(expr));
  }
  resolver.addNamespace(entityName,resolverMap);
  return row;
}
