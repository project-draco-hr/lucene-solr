{
  Directory dir=newDirectory();
  IndexWriter writer=new IndexWriter(dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setMergePolicy(newLogMergePolicy()));
  Term ta=new Term("content","aaa");
  for (int i=0; i < 10; i++)   addDoc(writer,"aaa aaa aaa aaa");
  Term tb=new Term("content","bbb");
  for (int i=0; i < 16; i++)   addDoc(writer,"bbb bbb bbb bbb");
  Term tc=new Term("content","ccc");
  for (int i=0; i < 50; i++)   addDoc(writer,"ccc ccc ccc ccc");
  writer.optimize();
  writer.close();
  IndexReader reader=IndexReader.open(dir,null,true,indexDivisor);
  DocsEnum tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),ta.field(),new BytesRef(ta.text()));
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(0,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(1,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.advance(0) != DocsEnum.NO_MORE_DOCS);
  assertEquals(2,tdocs.docID());
  assertTrue(tdocs.advance(4) != DocsEnum.NO_MORE_DOCS);
  assertEquals(4,tdocs.docID());
  assertTrue(tdocs.advance(9) != DocsEnum.NO_MORE_DOCS);
  assertEquals(9,tdocs.docID());
  assertFalse(tdocs.advance(10) != DocsEnum.NO_MORE_DOCS);
  tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),ta.field(),new BytesRef(ta.text()));
  assertTrue(tdocs.advance(0) != DocsEnum.NO_MORE_DOCS);
  assertEquals(0,tdocs.docID());
  assertTrue(tdocs.advance(4) != DocsEnum.NO_MORE_DOCS);
  assertEquals(4,tdocs.docID());
  assertTrue(tdocs.advance(9) != DocsEnum.NO_MORE_DOCS);
  assertEquals(9,tdocs.docID());
  assertFalse(tdocs.advance(10) != DocsEnum.NO_MORE_DOCS);
  tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),tb.field(),new BytesRef(tb.text()));
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(10,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(11,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.advance(5) != DocsEnum.NO_MORE_DOCS);
  assertEquals(12,tdocs.docID());
  assertTrue(tdocs.advance(15) != DocsEnum.NO_MORE_DOCS);
  assertEquals(15,tdocs.docID());
  assertTrue(tdocs.advance(24) != DocsEnum.NO_MORE_DOCS);
  assertEquals(24,tdocs.docID());
  assertTrue(tdocs.advance(25) != DocsEnum.NO_MORE_DOCS);
  assertEquals(25,tdocs.docID());
  assertFalse(tdocs.advance(26) != DocsEnum.NO_MORE_DOCS);
  tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),tb.field(),new BytesRef(tb.text()));
  assertTrue(tdocs.advance(5) != DocsEnum.NO_MORE_DOCS);
  assertEquals(10,tdocs.docID());
  assertTrue(tdocs.advance(15) != DocsEnum.NO_MORE_DOCS);
  assertEquals(15,tdocs.docID());
  assertTrue(tdocs.advance(24) != DocsEnum.NO_MORE_DOCS);
  assertEquals(24,tdocs.docID());
  assertTrue(tdocs.advance(25) != DocsEnum.NO_MORE_DOCS);
  assertEquals(25,tdocs.docID());
  assertFalse(tdocs.advance(26) != DocsEnum.NO_MORE_DOCS);
  tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),tc.field(),new BytesRef(tc.text()));
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(26,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.nextDoc() != DocsEnum.NO_MORE_DOCS);
  assertEquals(27,tdocs.docID());
  assertEquals(4,tdocs.freq());
  assertTrue(tdocs.advance(5) != DocsEnum.NO_MORE_DOCS);
  assertEquals(28,tdocs.docID());
  assertTrue(tdocs.advance(40) != DocsEnum.NO_MORE_DOCS);
  assertEquals(40,tdocs.docID());
  assertTrue(tdocs.advance(57) != DocsEnum.NO_MORE_DOCS);
  assertEquals(57,tdocs.docID());
  assertTrue(tdocs.advance(74) != DocsEnum.NO_MORE_DOCS);
  assertEquals(74,tdocs.docID());
  assertTrue(tdocs.advance(75) != DocsEnum.NO_MORE_DOCS);
  assertEquals(75,tdocs.docID());
  assertFalse(tdocs.advance(76) != DocsEnum.NO_MORE_DOCS);
  tdocs=MultiFields.getTermDocsEnum(reader,MultiFields.getDeletedDocs(reader),tc.field(),new BytesRef(tc.text()));
  assertTrue(tdocs.advance(5) != DocsEnum.NO_MORE_DOCS);
  assertEquals(26,tdocs.docID());
  assertTrue(tdocs.advance(40) != DocsEnum.NO_MORE_DOCS);
  assertEquals(40,tdocs.docID());
  assertTrue(tdocs.advance(57) != DocsEnum.NO_MORE_DOCS);
  assertEquals(57,tdocs.docID());
  assertTrue(tdocs.advance(74) != DocsEnum.NO_MORE_DOCS);
  assertEquals(74,tdocs.docID());
  assertTrue(tdocs.advance(75) != DocsEnum.NO_MORE_DOCS);
  assertEquals(75,tdocs.docID());
  assertFalse(tdocs.advance(76) != DocsEnum.NO_MORE_DOCS);
  reader.close();
  dir.close();
}
