{
  DocumentsWriterStallControl ctrl=new DocumentsWriterStallControl();
  ctrl.updateStalled(false);
  Thread[] waitThreads=waitThreads(atLeast(1),ctrl);
  start(waitThreads);
  assertFalse(ctrl.hasBlocked());
  assertFalse(ctrl.anyStalledThreads());
  join(waitThreads,10);
  ctrl.updateStalled(true);
  waitThreads=waitThreads(atLeast(1),ctrl);
  start(waitThreads);
  awaitState(100,Thread.State.WAITING,waitThreads);
  assertTrue(ctrl.hasBlocked());
  assertTrue(ctrl.anyStalledThreads());
  ctrl.updateStalled(false);
  assertFalse(ctrl.anyStalledThreads());
  join(waitThreads,500);
}
