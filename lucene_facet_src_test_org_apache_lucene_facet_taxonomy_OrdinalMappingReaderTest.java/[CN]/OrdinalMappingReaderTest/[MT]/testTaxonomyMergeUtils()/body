{
  Directory dir=newDirectory();
  Directory taxDir=newDirectory();
  buildIndexWithFacets(dir,taxDir,true);
  Directory dir1=newDirectory();
  Directory taxDir1=newDirectory();
  buildIndexWithFacets(dir1,taxDir1,false);
  IndexWriter destIndexWriter=new IndexWriter(dir1,new IndexWriterConfig(TEST_VERSION_CURRENT,null));
  DirectoryTaxonomyWriter destTaxWriter=new DirectoryTaxonomyWriter(taxDir1);
  try {
    TaxonomyMergeUtils.merge(dir,taxDir,new MemoryOrdinalMap(),destIndexWriter,destTaxWriter);
  }
  finally {
    IOUtils.close(destIndexWriter,destTaxWriter);
  }
  verifyResults(dir1,taxDir1);
  dir1.close();
  taxDir1.close();
  dir.close();
  taxDir.close();
}
