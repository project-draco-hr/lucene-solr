{
  Directory dir=newDirectory();
  Codec codec=getCodec();
  byte id[]=StringHelper.randomId();
  Map<String,String> diagnostics=new HashMap<>();
  diagnostics.put("key1","value1");
  diagnostics.put("key2","value2");
  SegmentInfo info=new SegmentInfo(dir,getVersions()[0],"_123",1,false,codec,diagnostics,id,new HashMap<>());
  info.setFiles(Collections.<String>emptySet());
  codec.segmentInfoFormat().write(dir,info,IOContext.DEFAULT);
  SegmentInfo info2=codec.segmentInfoFormat().read(dir,"_123",id,IOContext.DEFAULT);
  assertEquals(diagnostics,info2.getDiagnostics());
  try {
    info2.getDiagnostics().put("bogus","bogus");
    fail("diagnostics map should be immutable");
  }
 catch (  UnsupportedOperationException expected) {
  }
  dir.close();
}
