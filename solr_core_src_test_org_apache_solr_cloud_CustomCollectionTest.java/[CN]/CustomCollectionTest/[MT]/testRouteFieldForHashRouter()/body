{
  String collectionName="routeFieldColl";
  int numShards=4;
  int replicationFactor=2;
  int maxShardsPerNode=((numShards * replicationFactor) / NODE_COUNT) + 1;
  String shard_fld="shard_s";
  CollectionAdminRequest.createCollection(collectionName,"conf",numShards,replicationFactor).setMaxShardsPerNode(maxShardsPerNode).setRouterField(shard_fld).process(cluster.getSolrClient());
  new UpdateRequest().add("id","6",shard_fld,"a").add("id","7",shard_fld,"a").add("id","8",shard_fld,"b").commit(cluster.getSolrClient(),collectionName);
  assertEquals(3,cluster.getSolrClient().query(collectionName,new SolrQuery("*:*")).getResults().getNumFound());
  assertEquals(2,cluster.getSolrClient().query(collectionName,new SolrQuery("*:*").setParam(_ROUTE_,"a")).getResults().getNumFound());
  assertEquals(1,cluster.getSolrClient().query(collectionName,new SolrQuery("*:*").setParam(_ROUTE_,"b")).getResults().getNumFound());
  assertEquals(0,cluster.getSolrClient().query(collectionName,new SolrQuery("*:*").setParam(_ROUTE_,"c")).getResults().getNumFound());
  cluster.getSolrClient().deleteByQuery(collectionName,"*:*");
  cluster.getSolrClient().commit(collectionName);
  cluster.getSolrClient().add(collectionName,new SolrInputDocument("id","100",shard_fld,"c!doc1"));
  cluster.getSolrClient().commit(collectionName);
  assertEquals(1,cluster.getSolrClient().query(collectionName,new SolrQuery("*:*").setParam(_ROUTE_,"c!")).getResults().getNumFound());
}
