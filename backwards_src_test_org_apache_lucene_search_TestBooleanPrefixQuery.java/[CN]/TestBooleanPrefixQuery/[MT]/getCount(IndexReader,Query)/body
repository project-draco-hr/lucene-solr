{
  if (q instanceof BooleanQuery) {
    return ((BooleanQuery)q).getClauses().length;
  }
 else   if (q instanceof ConstantScoreQuery) {
    DocIdSetIterator iter=((ConstantScoreQuery)q).getFilter().getDocIdSet(r).iterator();
    int count=0;
    while (iter.nextDoc() != DocIdSetIterator.NO_MORE_DOCS) {
      count++;
    }
    return count;
  }
 else {
    throw new RuntimeException("unepxected query " + q);
  }
}
