{
  zkStateReader.updateCloudState(true);
  CloudState cloudState=zkStateReader.getCloudState();
  Map<String,Slice> slices=cloudState.getSlices(collection);
  if (slices == null) {
    throw new IllegalArgumentException("Cannot find collection:" + collection);
  }
  for (  Map.Entry<String,Slice> entry : slices.entrySet()) {
    Map<String,ZkNodeProps> shards=entry.getValue().getShards();
    for (    Map.Entry<String,ZkNodeProps> shard : shards.entrySet()) {
      String state=shard.getValue().get(ZkStateReader.STATE_PROP);
      if (!state.equals(ZkStateReader.ACTIVE)) {
        fail("Not all shards are ACTIVE");
      }
    }
  }
}
