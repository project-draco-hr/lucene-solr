{
  Map<String,Document> docs=new HashMap<String,Document>();
  for (int iter=0; iter < 3; iter++) {
    IndexWriter w=new MockIndexWriter(dir,newIndexWriterConfig(r,TEST_VERSION_CURRENT,new MockAnalyzer()).setOpenMode(OpenMode.CREATE).setRAMBufferSizeMB(0.1).setMaxBufferedDocs(maxBufferedDocs).setMaxThreadStates(maxThreadStates).setReaderPooling(doReaderPooling));
    LogMergePolicy lmp=(LogMergePolicy)w.getConfig().getMergePolicy();
    lmp.setUseCompoundFile(false);
    lmp.setUseCompoundDocStore(false);
    lmp.setMergeFactor(mergeFactor);
    threads=new IndexingThread[nThreads];
    for (int i=0; i < threads.length; i++) {
      IndexingThread th=new IndexingThread();
      th.w=w;
      th.base=1000000 * i;
      th.range=range;
      th.iterations=iterations;
      threads[i]=th;
    }
    for (int i=0; i < threads.length; i++) {
      threads[i].start();
    }
    for (int i=0; i < threads.length; i++) {
      threads[i].join();
    }
    w.close();
    for (int i=0; i < threads.length; i++) {
      IndexingThread th=threads[i];
synchronized (th) {
        docs.putAll(th.docs);
      }
    }
  }
  _TestUtil.checkIndex(dir);
  return docs;
}
