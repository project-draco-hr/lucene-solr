{
  r=newRandom();
  Directory dir1=newDirectory(r);
  Directory dir2=newDirectory(r);
  int maxThreadStates=1 + r.nextInt(10);
  boolean doReaderPooling=r.nextBoolean();
  Map<String,Document> docs=indexRandom(5,3,100,dir1,maxThreadStates,doReaderPooling);
  indexSerial(r,docs,dir2);
  verifyEquals(dir1,dir2,"id");
  dir1.close();
  dir2.close();
}
