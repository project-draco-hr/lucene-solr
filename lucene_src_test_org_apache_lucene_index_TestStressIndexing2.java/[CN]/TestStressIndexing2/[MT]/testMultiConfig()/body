{
  r=newRandom();
  for (int i=0; i < 3; i++) {
    sameFieldOrder=r.nextBoolean();
    mergeFactor=r.nextInt(3) + 2;
    maxBufferedDocs=r.nextInt(3) + 2;
    int maxThreadStates=1 + r.nextInt(10);
    boolean doReaderPooling=r.nextBoolean();
    seed++;
    int nThreads=r.nextInt(5) + 1;
    int iter=r.nextInt(5) + 1;
    int range=r.nextInt(20) + 1;
    Directory dir1=new MockRAMDirectory();
    Directory dir2=new MockRAMDirectory();
    Map<String,Document> docs=indexRandom(nThreads,iter,range,dir1,maxThreadStates,doReaderPooling);
    indexSerial(docs,dir2);
    verifyEquals(dir1,dir2,"id");
    FlexTestUtil.verifyFlexVsPreFlex(r,dir1);
    FlexTestUtil.verifyFlexVsPreFlex(r,dir2);
  }
}
