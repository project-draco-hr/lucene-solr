{
  Directory dir=newDirectory();
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)));
  addDocument(iw,"Hello, world!");
  addDocument(iw,"All work and no play makes jack a dull boy");
  iw.close();
  iw=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setOpenMode(OpenMode.APPEND));
  addDocument(iw,"Hello, tellus!");
  addDocument(iw,"All work and no play makes danny a dull boy");
  iw.close();
  iw=new IndexWriter(dir,new IndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer(random)).setOpenMode(OpenMode.APPEND));
  addDocument(iw,"Hello, earth!");
  addDocument(iw,"All work and no play makes wendy a dull girl");
  iw.close();
  IndexReader unoptimizedReader=IndexReader.open(dir,false);
  unoptimizedReader.deleteDocument(2);
  try {
    new InstantiatedIndex(unoptimizedReader);
  }
 catch (  Exception e) {
    e.printStackTrace(System.out);
    fail("No exceptions when loading an unoptimized reader!");
  }
  unoptimizedReader.close();
  dir.close();
}
