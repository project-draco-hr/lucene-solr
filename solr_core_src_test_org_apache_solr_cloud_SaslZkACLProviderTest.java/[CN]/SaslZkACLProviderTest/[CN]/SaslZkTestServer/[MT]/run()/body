{
  try {
    System.setProperty("zookeeper.kerberos.removeRealmFromPrincipal","true");
    System.setProperty("zookeeper.kerberos.removeHostFromPrincipal","true");
    File keytabFile=new File(kdcDir,"keytabs");
    String zkClientPrincipal="solr";
    String zkServerPrincipal="zookeeper/127.0.0.1";
    kerberosTestServices=KerberosTestServices.builder().withKdc(new File(kdcDir)).withJaasConfiguration(zkClientPrincipal,keytabFile,zkServerPrincipal,keytabFile).build();
    kerberosTestServices.start();
    kerberosTestServices.getKdc().createPrincipal(keytabFile,zkClientPrincipal,zkServerPrincipal);
  }
 catch (  Exception ex) {
    throw new RuntimeException(ex);
  }
  super.run();
}
