{
  try {
    kdc=KerberosTestUtil.getKdc(new File(kdcDir));
    System.setProperty("zookeeper.kerberos.removeRealmFromPrincipal","true");
    System.setProperty("zookeeper.kerberos.removeHostFromPrincipal","true");
    File keytabFile=new File(kdcDir,"keytabs");
    String zkClientPrincipal="solr";
    String zkServerPrincipal="zookeeper/127.0.0.1";
    kdc.start();
    kdc.createPrincipal(keytabFile,zkClientPrincipal,zkServerPrincipal);
    KerberosTestUtil.JaasConfiguration jaas=new KerberosTestUtil.JaasConfiguration(zkClientPrincipal,keytabFile,zkServerPrincipal,keytabFile);
    Configuration.setConfiguration(jaas);
  }
 catch (  Exception ex) {
    throw new RuntimeException(ex);
  }
  super.run();
}
