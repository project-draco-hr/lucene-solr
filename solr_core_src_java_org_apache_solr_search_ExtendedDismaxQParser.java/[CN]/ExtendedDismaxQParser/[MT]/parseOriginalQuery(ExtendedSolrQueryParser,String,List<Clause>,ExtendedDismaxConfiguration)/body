{
  Query query=null;
  try {
    up.setRemoveStopFilter(!config.stopwords);
    up.exceptions=true;
    query=up.parse(mainUserQuery);
    if (shouldRemoveStopFilter(config,query)) {
      up.setRemoveStopFilter(true);
      query=up.parse(mainUserQuery);
    }
  }
 catch (  Exception e) {
    up.exceptions=false;
  }
  if (query == null) {
    return null;
  }
  if (query instanceof BooleanQuery) {
    query=SolrPluginUtils.setMinShouldMatch((BooleanQuery)query,config.minShouldMatch,config.mmAutoRelax);
  }
  return query;
}
