{
  Query query=up.parse(escapedUserQuery);
  if (query instanceof BooleanQuery) {
    BooleanQuery t=new BooleanQuery();
    SolrPluginUtils.flattenBooleanQuery(t,(BooleanQuery)query);
    SolrPluginUtils.setMinShouldMatch(t,config.minShouldMatch);
    query=t;
  }
  return query;
}
