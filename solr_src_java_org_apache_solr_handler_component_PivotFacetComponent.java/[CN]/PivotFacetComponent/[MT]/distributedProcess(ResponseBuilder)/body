{
  if (!rb.doFacets) {
    return ResponseBuilder.STAGE_DONE;
  }
  if (rb.stage == ResponseBuilder.STAGE_GET_FIELDS) {
    SolrParams params=rb.req.getParams();
    String[] pivots=params.getParams(FacetParams.FACET_PIVOT);
    for (    ShardRequest sreq : rb.outgoing) {
      if ((sreq.purpose & ShardRequest.PURPOSE_GET_FIELDS) != 0 && sreq.shards != null && sreq.shards.length == 1) {
        sreq.params.set(FacetParams.FACET,"true");
        sreq.params.set(FacetParams.FACET_PIVOT,pivots);
        sreq.params.set(FacetParams.FACET_PIVOT_MINCOUNT,1);
      }
    }
  }
  return ResponseBuilder.STAGE_DONE;
}
