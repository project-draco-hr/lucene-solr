{
  ValueSource vs=getValueSource(name);
  if (vs == null) {
    throw new IllegalArgumentException("Invalid reference '" + name + "'");
  }
  if (vs instanceof ExpressionValueSource) {
    Expression expr=((ExpressionValueSource)vs).expression;
    for (    String external : expr.variables) {
      if (chain.contains(external)) {
        throw new IllegalArgumentException("Recursion Error: Cycle detected originating in (" + external + ")");
      }
      if (!marked.contains(external)) {
        chain.add(external);
        validate(external,marked,chain);
        chain.remove(external);
      }
    }
  }
  marked.add(name);
}
