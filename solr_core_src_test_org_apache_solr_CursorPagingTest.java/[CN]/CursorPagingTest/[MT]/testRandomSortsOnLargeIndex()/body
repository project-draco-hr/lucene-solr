{
  final Collection<String> allFieldNames=getAllFieldNames();
  final int initialDocs=_TestUtil.nextInt(random(),100,200);
  final int totalDocs=atLeast(5000);
  for (int i=1; i <= initialDocs; i++) {
    SolrInputDocument doc=buildRandomDocument(i);
    assertU(adoc(doc));
  }
  assertU(commit());
  for (  String f : allFieldNames) {
    for (    String order : new String[]{" asc"," desc"}) {
      String sort=f + order + ("id".equals(f) ? "" : ", id" + order);
      String rows="" + _TestUtil.nextInt(random(),13,50);
      SentinelIntSet ids=assertFullWalkNoDups(totalDocs,params("q","*:*","fl","id","rows",rows,"sort",sort));
      assertEquals(initialDocs,ids.size());
    }
  }
  for (int i=initialDocs + 1; i <= totalDocs; i++) {
    SolrInputDocument doc=buildRandomDocument(i);
    assertU(adoc(doc));
  }
  assertU(commit());
  final int numRandomSorts=atLeast(5);
  for (int i=0; i < numRandomSorts; i++) {
    final String sort=buildRandomSort(allFieldNames);
    final String rows="" + _TestUtil.nextInt(random(),63,113);
    final String fl=random().nextBoolean() ? "id" : "id,score";
    final boolean matchAll=random().nextBoolean();
    final String q=matchAll ? "*:*" : buildRandomQuery();
    SentinelIntSet ids=assertFullWalkNoDups(totalDocs,params("q",q,"fl",fl,"rows",rows,"sort",sort));
    if (matchAll) {
      assertEquals(totalDocs,ids.size());
    }
  }
}
