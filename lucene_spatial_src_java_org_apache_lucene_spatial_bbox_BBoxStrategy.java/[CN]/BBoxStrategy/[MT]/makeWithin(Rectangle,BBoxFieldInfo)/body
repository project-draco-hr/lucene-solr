{
  Query qMinY=NumericRangeQuery.newDoubleRange(fieldInfo.minY,finfo.precisionStep,bbox.getMinY(),null,true,false);
  Query qMaxY=NumericRangeQuery.newDoubleRange(fieldInfo.maxY,finfo.precisionStep,null,bbox.getMaxY(),false,true);
  Query yConditions=this.makeQuery(new Query[]{qMinY,qMaxY},BooleanClause.Occur.MUST);
  Query xConditions=null;
  Query qXDLLeft=NumericRangeQuery.newDoubleRange(fieldInfo.minX,finfo.precisionStep,bbox.getMinX(),null,true,false);
  Query qXDLRight=NumericRangeQuery.newDoubleRange(fieldInfo.maxX,finfo.precisionStep,null,bbox.getMaxX(),false,true);
  Query qXDLLeftRight=this.makeQuery(new Query[]{qXDLLeft,qXDLRight},BooleanClause.Occur.MUST);
  Query qXDL=this.makeXDL(true,qXDLLeftRight,fieldInfo);
  if (!bbox.getCrossesDateLine()) {
    Query qMinX=NumericRangeQuery.newDoubleRange(fieldInfo.minX,finfo.precisionStep,bbox.getMinX(),null,true,false);
    Query qMaxX=NumericRangeQuery.newDoubleRange(fieldInfo.maxX,finfo.precisionStep,null,bbox.getMaxX(),false,true);
    Query qMinMax=this.makeQuery(new Query[]{qMinX,qMaxX},BooleanClause.Occur.MUST);
    Query qNonXDL=this.makeXDL(false,qMinMax,fieldInfo);
    if ((bbox.getMinX() <= -180.0) && bbox.getMaxX() >= 180.0) {
      xConditions=this.makeQuery(new Query[]{qNonXDL,qXDL},BooleanClause.Occur.SHOULD);
    }
 else {
      xConditions=qNonXDL;
    }
  }
 else {
    Query qMinXLeft=NumericRangeQuery.newDoubleRange(fieldInfo.minX,finfo.precisionStep,bbox.getMinX(),null,true,false);
    Query qMaxXLeft=NumericRangeQuery.newDoubleRange(fieldInfo.maxX,finfo.precisionStep,null,180.0,false,true);
    Query qLeft=this.makeQuery(new Query[]{qMinXLeft,qMaxXLeft},BooleanClause.Occur.MUST);
    Query qMinXRight=NumericRangeQuery.newDoubleRange(fieldInfo.minX,finfo.precisionStep,-180.0,null,true,false);
    Query qMaxXRight=NumericRangeQuery.newDoubleRange(fieldInfo.maxX,finfo.precisionStep,null,bbox.getMaxX(),false,true);
    Query qRight=this.makeQuery(new Query[]{qMinXRight,qMaxXRight},BooleanClause.Occur.MUST);
    Query qLeftRight=this.makeQuery(new Query[]{qLeft,qRight},BooleanClause.Occur.SHOULD);
    Query qNonXDL=this.makeXDL(false,qLeftRight,fieldInfo);
    xConditions=this.makeQuery(new Query[]{qNonXDL,qXDL},BooleanClause.Occur.SHOULD);
  }
  return this.makeQuery(new Query[]{xConditions,yConditions},BooleanClause.Occur.MUST);
}
