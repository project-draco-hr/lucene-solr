{
  Set<Entry<String,Map<String,Slice>>> collections=collectionStates.entrySet();
  for (  Entry<String,Map<String,Slice>> collection : collections) {
    Map<String,Slice> state=collection.getValue();
    Set<Entry<String,Slice>> slices=state.entrySet();
    for (    Entry<String,Slice> sliceEntry : slices) {
      Slice slice=sliceEntry.getValue();
      Map<String,Replica> shards=slice.getReplicasMap();
      Set<Entry<String,Replica>> shardsEntries=shards.entrySet();
      for (      Entry<String,Replica> shardEntry : shardsEntries) {
        ZkNodeProps props=shardEntry.getValue();
        if (props.containsKey(ZkStateReader.LEADER_PROP)) {
          Map<String,ZkNodeProps> leadersForCollection=leaders.get(collection.getKey());
          if (leadersForCollection == null) {
            leadersForCollection=new HashMap<String,ZkNodeProps>();
            leaders.put(collection.getKey(),leadersForCollection);
          }
          leadersForCollection.put(sliceEntry.getKey(),props);
          break;
        }
      }
    }
  }
}
