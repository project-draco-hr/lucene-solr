{
  int[] docStates=new int[docs];
  for (int i=0; i < docs; i++) {
    Document doc=new Document();
    if (random().nextBoolean()) {
      docStates[i]=1;
      doc.add(newTextField("some","value",Field.Store.YES));
      doc.add(new SortedDocValuesField("some",new BytesRef("value")));
    }
    doc.add(newTextField("all","test",Field.Store.NO));
    doc.add(new SortedDocValuesField("all",new BytesRef("test")));
    doc.add(newTextField("id","" + i,Field.Store.YES));
    doc.add(new SortedDocValuesField("id",new BytesRef("" + i)));
    writer.addDocument(doc);
  }
  writer.commit();
  int numDeletes=random().nextInt(docs);
  for (int i=0; i < numDeletes; i++) {
    int docID=random().nextInt(docs);
    writer.deleteDocuments(new Term("id","" + docID));
    docStates[docID]=2;
  }
  writer.shutdown();
  return docStates;
}
