{
  try {
    if (size == -1) {
      datOut.writeInt(size);
    }
    final int count=1 + hash.size();
    idxOut.writeInt(count - 1);
    final PackedInts.Writer w=PackedInts.getWriter(idxOut,docCount,PackedInts.bitsRequired(count - 1));
    final int limit=docCount > docToID.length ? docToID.length : docCount;
    for (int i=0; i < limit; i++) {
      w.add(docToID[i]);
    }
    for (int i=limit; i < docCount; i++) {
      w.add(0);
    }
    w.finish();
  }
  finally {
    hash.close();
    super.finish(docCount);
    bytesUsed.addAndGet((-docToID.length) * RamUsageEstimator.NUM_BYTES_INT);
    docToID=null;
  }
}
