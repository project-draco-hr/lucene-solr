{
  Directory dir=newDirectory();
  IndexWriterConfig cfg=newIndexWriterConfig(new MockAnalyzer(random()));
  cfg.setMergePolicy(newLogMergePolicy());
  RandomIndexWriter iw=new RandomIndexWriter(random(),dir,cfg);
  Document doc=new Document();
  IntPoint field=new IntPoint("f",0);
  doc.add(field);
  final int[] values=new int[TestUtil.nextInt(random(),1,10)];
  for (int i=0; i < values.length; ++i) {
    final int v;
switch (random().nextInt(10)) {
case 0:
      v=Integer.MIN_VALUE;
    break;
case 1:
  v=0;
break;
case 2:
v=Integer.MAX_VALUE;
break;
default :
v=TestUtil.nextInt(random(),-10,10);
break;
}
values[i]=v;
if (v == 0 && random().nextBoolean()) {
iw.addDocument(new Document());
}
 else {
field.setIntValue(v);
iw.addDocument(doc);
}
}
iw.forceMerge(1);
final DirectoryReader reader=iw.getReader();
final NumericDocValues ints=FieldCache.DEFAULT.getNumerics(getOnlyLeafReader(reader),"f",FieldCache.INT_POINT_PARSER,false);
for (int i=0; i < values.length; ++i) {
assertEquals(values[i],ints.get(i));
}
reader.close();
iw.close();
dir.close();
}
