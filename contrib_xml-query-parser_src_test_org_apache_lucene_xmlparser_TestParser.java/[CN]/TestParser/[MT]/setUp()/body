{
  super.setUp();
  builder=new CorePlusExtensionsParser(analyzer,new QueryParser("contents",analyzer));
  if (dir == null) {
    BufferedReader d=new BufferedReader(new InputStreamReader(TestParser.class.getResourceAsStream("reuters21578.txt")));
    dir=new RAMDirectory();
    IndexWriter writer=new IndexWriter(dir,analyzer,true);
    String line=d.readLine();
    while (line != null) {
      int endOfDate=line.indexOf('\t');
      String date=line.substring(0,endOfDate).trim();
      String content=line.substring(endOfDate).trim();
      org.apache.lucene.document.Document doc=new org.apache.lucene.document.Document();
      doc.add(new Field("date",date,Field.Store.YES,Field.Index.TOKENIZED));
      doc.add(new Field("contents",content,Field.Store.YES,Field.Index.TOKENIZED));
      writer.addDocument(doc);
      line=d.readLine();
    }
    d.close();
    writer.close();
  }
  reader=IndexReader.open(dir);
  searcher=new IndexSearcher(reader);
}
