{
  Directory dir=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,dir,newIndexWriterConfig(TEST_VERSION_CURRENT,new MockAnalyzer()).setMergePolicy(newInOrderLogMergePolicy()));
  for (int i=0; i < 500; i++) {
    Document document=new Document();
    document.add(newField("field",English.intToEnglish(i) + " equals " + English.intToEnglish(i),Field.Store.NO,Field.Index.ANALYZED));
    writer.addDocument(document);
  }
  final int number=10;
  IndexReader reader=writer.getReader();
  writer.close();
  AtomicReaderContext[] leaves=ReaderUtil.leaves(reader.getTopReaderContext());
  int subIndex=ReaderUtil.subIndex(number,leaves);
  SpanTermQuery query=new SpanTermQuery(new Term("field",English.intToEnglish(number).trim()));
  SpanQueryFilter filter=new SpanQueryFilter(query);
  SpanFilterResult result=filter.bitSpans(leaves[subIndex]);
  DocIdSet docIdSet=result.getDocIdSet();
  assertTrue("docIdSet is null and it shouldn't be",docIdSet != null);
  assertContainsDocId("docIdSet doesn't contain docId 10",docIdSet,number);
  List<SpanFilterResult.PositionInfo> spans=result.getPositions();
  assertTrue("spans is null and it shouldn't be",spans != null);
  int size=getDocIdSetSize(docIdSet);
  assertTrue("spans Size: " + spans.size() + " is not: "+ size,spans.size() == size);
  for (  final SpanFilterResult.PositionInfo info : spans) {
    assertTrue("info is null and it shouldn't be",info != null);
    assertContainsDocId("docIdSet doesn't contain docId " + info.getDoc(),docIdSet,info.getDoc());
    assertTrue("info.getPositions() Size: " + info.getPositions().size() + " is not: "+ 2,info.getPositions().size() == 2);
  }
  reader.close();
  dir.close();
}
