{
  String fileName=IndexFileNames.segmentFileName(state.segmentInfo.name + "_" + Integer.toString(field.number),segmentSuffix,"dat");
  IndexInput input=dir.openInput(fileName,state.context);
  boolean success=false;
  try {
    CodecUtil.checkHeader(input,Lucene40DocValuesFormat.BYTES_FIXED_STRAIGHT_CODEC_NAME,Lucene40DocValuesFormat.BYTES_FIXED_STRAIGHT_VERSION_START,Lucene40DocValuesFormat.BYTES_FIXED_STRAIGHT_VERSION_CURRENT);
    final int fixedLength=input.readInt();
    final byte bytes[]=new byte[state.segmentInfo.getDocCount() * fixedLength];
    input.readBytes(bytes,0,bytes.length);
    if (input.getFilePointer() != input.length()) {
      throw new CorruptIndexException("did not read all bytes from file \"" + fileName + "\": read "+ input.getFilePointer()+ " vs size "+ input.length()+ " (resource: "+ input+ ")");
    }
    success=true;
    return new BinaryDocValues(){
      @Override public void get(      int docID,      BytesRef result){
        result.bytes=bytes;
        result.offset=docID * fixedLength;
        result.length=fixedLength;
      }
    }
;
  }
  finally {
    if (success) {
      IOUtils.close(input);
    }
 else {
      IOUtils.closeWhileHandlingException(input);
    }
  }
}
