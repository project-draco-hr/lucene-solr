{
  CodecUtil.checkHeader(data,Lucene40DocValuesFormat.BYTES_VAR_SORTED_CODEC_NAME_DAT,Lucene40DocValuesFormat.BYTES_VAR_SORTED_VERSION_START,Lucene40DocValuesFormat.BYTES_VAR_SORTED_VERSION_CURRENT);
  CodecUtil.checkHeader(index,Lucene40DocValuesFormat.BYTES_VAR_SORTED_CODEC_NAME_IDX,Lucene40DocValuesFormat.BYTES_VAR_SORTED_VERSION_START,Lucene40DocValuesFormat.BYTES_VAR_SORTED_VERSION_CURRENT);
  long maxAddress=index.readLong();
  final byte[] bytes=new byte[(int)maxAddress];
  data.readBytes(bytes,0,bytes.length);
  final PackedInts.Reader addressReader=PackedInts.getReader(index);
  final PackedInts.Reader ordsReader=PackedInts.getReader(index);
  final int valueCount=addressReader.size() - 1;
  return correctBuggyOrds(new SortedDocValues(){
    @Override public int getOrd(    int docID){
      return (int)ordsReader.get(docID);
    }
    @Override public void lookupOrd(    int ord,    BytesRef result){
      long startAddress=addressReader.get(ord);
      long endAddress=addressReader.get(ord + 1);
      result.bytes=bytes;
      result.offset=(int)startAddress;
      result.length=(int)(endAddress - startAddress);
    }
    @Override public int getValueCount(){
      return valueCount;
    }
  }
);
}
