{
  super(PhraseQuery.this);
  final int[] positions=PhraseQuery.this.getPositions();
  if (positions.length < 2) {
    throw new IllegalStateException("PhraseWeight does not support less than 2 terms, call rewrite first");
  }
 else   if (positions[0] != 0) {
    throw new IllegalStateException("PhraseWeight requires that the first position is 0, call rewrite first");
  }
  this.needsScores=needsScores;
  this.similarity=searcher.getSimilarity(needsScores);
  final IndexReaderContext context=searcher.getTopReaderContext();
  states=new TermContext[terms.size()];
  TermStatistics termStats[]=new TermStatistics[terms.size()];
  for (int i=0; i < terms.size(); i++) {
    final Term term=terms.get(i);
    states[i]=TermContext.build(context,term);
    termStats[i]=searcher.termStatistics(term,states[i]);
  }
  stats=similarity.computeWeight(getBoost(),searcher.collectionStatistics(field),termStats);
}
