{
  deleteByQueryCommands.incrementAndGet();
  deleteByQueryCommandsCumulative.incrementAndGet();
  boolean madeIt=false;
  try {
    Query q;
    try {
      QParser parser=QParser.getParser(cmd.query,"lucene",cmd.req);
      q=parser.getQuery();
    }
 catch (    ParseException e) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,e);
    }
    boolean delAll=MatchAllDocsQuery.class == q.getClass();
    commitTracker.deletedDocument(cmd.commitWithin);
    if (delAll) {
      deleteAll();
    }
 else {
      solrCoreState.getIndexWriter(core).deleteDocuments(q);
    }
    ulog.deleteByQuery(cmd);
    madeIt=true;
    if (commitTracker.getTimeUpperBound() > 0) {
      commitTracker.scheduleCommitWithin(commitTracker.getTimeUpperBound());
    }
    if (softCommitTracker.getTimeUpperBound() > 0) {
      softCommitTracker.scheduleCommitWithin(softCommitTracker.getTimeUpperBound());
    }
  }
  finally {
    if (!madeIt) {
      numErrors.incrementAndGet();
      numErrorsCumulative.incrementAndGet();
    }
  }
}
