{
  if (core.getCoreDescriptor().getCoreContainer().isZooKeeperAware()) {
    throw new UnsupportedOperationException("Rollback is currently not supported in SolrCloud mode. (SOLR-4895)");
  }
  rollbackCommands.increment();
  boolean error=true;
  try {
    log.info("start " + cmd);
    rollbackWriter();
    commitTracker.didRollback();
    softCommitTracker.didRollback();
    log.info("end_rollback");
    error=false;
  }
  finally {
    addCommandsCumulative.add(-addCommands.sumThenReset());
    deleteByIdCommandsCumulative.add(-deleteByIdCommands.sumThenReset());
    deleteByQueryCommandsCumulative.add(-deleteByQueryCommands.sumThenReset());
    if (error)     numErrors.increment();
  }
}
