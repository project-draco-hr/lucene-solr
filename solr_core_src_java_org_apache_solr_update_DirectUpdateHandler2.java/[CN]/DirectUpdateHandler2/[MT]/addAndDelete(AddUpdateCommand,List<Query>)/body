{
  Document luceneDocument=cmd.getLuceneDocument();
  Term idTerm=new Term(idField.getName(),cmd.getIndexedId());
synchronized (solrCoreState.getUpdateLock()) {
    RefCounted<IndexWriter> iw=solrCoreState.getIndexWriter(core);
    try {
      IndexWriter writer=iw.get();
      writer.updateDocument(idTerm,luceneDocument);
      for (      Query q : dbqList) {
        writer.deleteDocuments(new DeleteByQueryWrapper(q,core.getLatestSchema()));
      }
    }
  finally {
      iw.decref();
    }
    if (ulog != null)     ulog.add(cmd,true);
  }
}
