{
  RefCounted<IndexWriter> iw=solrCoreState.getIndexWriter(core);
  try {
    IndexWriter writer=iw.get();
    if (cmd.isBlock()) {
      writer.addDocuments(cmd);
    }
 else {
      writer.addDocument(cmd.getLuceneDocument());
    }
  }
  finally {
    iw.decref();
  }
synchronized (solrCoreState.getUpdateLock()) {
    if (ulog != null)     ulog.add(cmd);
  }
}
