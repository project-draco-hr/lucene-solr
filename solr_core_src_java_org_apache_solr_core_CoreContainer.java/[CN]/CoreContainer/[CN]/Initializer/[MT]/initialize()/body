{
  CoreContainer cores=null;
  String solrHome=SolrResourceLoader.locateSolrHome();
  File fconf=new File(solrHome,solrConfigFilename == null ? "solr.xml" : solrConfigFilename);
  log.info("looking for solr.xml: " + fconf.getAbsolutePath());
  cores=new CoreContainer();
  if (fconf.exists()) {
    cores.load(solrHome,fconf);
  }
 else {
    log.info("no solr.xml file found - using default");
    cores.load(solrHome,new InputSource(new ByteArrayInputStream(DEF_SOLR_XML.getBytes("UTF-8"))));
    cores.configFile=fconf;
  }
  solrConfigFilename=cores.getConfigFile().getName();
  if (cores.cores.isEmpty()) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"No cores were created, please check the logs for errors");
  }
  return cores;
}
