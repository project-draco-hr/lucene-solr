{
  if (isShutDown) {
    throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE,"Solr has shutdown.");
  }
  final String name=dcore.getName();
  try {
    File idir=new File(dcore.getInstanceDir());
    String instanceDir=idir.getPath();
    log.info("Creating SolrCore '{}' using instanceDir: {}",dcore.getName(),instanceDir);
    SolrCore created=null;
    if (zkSys.getZkController() != null) {
      created=zkSys.createFromZk(instanceDir,dcore,loader);
    }
 else {
      created=createFromLocal(instanceDir,dcore);
    }
    solrCores.addCreated(created);
    return created;
  }
 catch (  Exception ex) {
    throw recordAndThrow(name,"Unable to create core: " + name,ex);
  }
}
