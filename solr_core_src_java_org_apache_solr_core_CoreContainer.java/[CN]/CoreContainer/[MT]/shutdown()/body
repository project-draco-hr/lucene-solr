{
  log.info("Shutting down CoreContainer instance=" + System.identityHashCode(this));
  isShutDown=true;
  if (cmdDistribExecutor != null) {
    try {
      ExecutorUtil.shutdownAndAwaitTermination(cmdDistribExecutor);
    }
 catch (    Throwable e) {
      SolrException.log(log,e);
    }
  }
  if (isZooKeeperAware()) {
    cancelCoreRecoveries();
  }
synchronized (cores) {
    try {
      for (      SolrCore core : cores.values()) {
        try {
          core.close();
        }
 catch (        Throwable t) {
          SolrException.log(log,"Error shutting down core",t);
        }
      }
      cores.clear();
    }
  finally {
      if (shardHandlerFactory != null) {
        shardHandlerFactory.close();
      }
      if (zkController != null) {
        zkController.close();
      }
      if (zkServer != null) {
        zkServer.stop();
      }
    }
  }
}
