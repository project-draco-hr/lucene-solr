{
  log.info("Shutting down CoreContainer instance=" + System.identityHashCode(this));
  isShutDown=true;
  ExecutorUtil.shutdownAndAwaitTermination(coreContainerWorkExecutor);
  if (isZooKeeperAware()) {
    cancelCoreRecoveries();
    zkSys.publishCoresAsDown(solrCores.getCores());
  }
  try {
    if (coreAdminHandler != null)     coreAdminHandler.shutdown();
  }
 catch (  Exception e) {
    log.warn("Error shutting down CoreAdminHandler. Continuing to close CoreContainer.",e);
  }
  try {
synchronized (solrCores.getModifyLock()) {
      solrCores.getModifyLock().notifyAll();
    }
    if (backgroundCloser != null) {
      try {
        backgroundCloser.join();
      }
 catch (      InterruptedException e) {
        Thread.currentThread().interrupt();
        if (log.isDebugEnabled()) {
          log.debug("backgroundCloser thread was interrupted before finishing");
        }
      }
    }
    solrCores.close();
synchronized (solrCores.getModifyLock()) {
      solrCores.getModifyLock().notifyAll();
    }
  }
  finally {
    try {
      if (shardHandlerFactory != null) {
        shardHandlerFactory.close();
      }
    }
  finally {
      try {
        if (updateShardHandler != null) {
          updateShardHandler.close();
        }
      }
  finally {
        zkSys.close();
      }
    }
  }
  try {
    if (authorizationPlugin != null) {
      authorizationPlugin.close();
    }
  }
 catch (  IOException e) {
    log.warn("Exception while closing authorization plugin.",e);
  }
  try {
    if (authenticationPlugin != null) {
      authenticationPlugin.close();
      authenticationPlugin=null;
    }
  }
 catch (  Exception e) {
    log.warn("Exception while closing authentication plugin.",e);
  }
  org.apache.lucene.util.IOUtils.closeWhileHandlingException(loader);
}
