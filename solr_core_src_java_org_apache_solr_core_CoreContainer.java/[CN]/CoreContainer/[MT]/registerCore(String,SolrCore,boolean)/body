{
  if (core == null) {
    throw new RuntimeException("Can not register a null core.");
  }
  CoreDescriptor cd=core.getCoreDescriptor();
  if ((cd.isTransient() || !cd.isLoadOnStartup()) && solrCores.getDynamicDescriptor(name) == null) {
    solrCores.putDynamicDescriptor(name,cd);
  }
  SolrCore old;
  if (isShutDown) {
    core.close();
    throw new IllegalStateException("This CoreContainer has been closed");
  }
  if (cd.isTransient()) {
    old=solrCores.putTransientCore(cfg,name,core,loader);
  }
 else {
    old=solrCores.putCore(name,core);
  }
  core.setName(name);
  coreInitFailures.remove(name);
  if (old == null || old == core) {
    log.debug("registering core: " + name);
    if (registerInZk) {
      zkSys.registerInZk(core,false);
    }
    return null;
  }
 else {
    log.debug("replacing core: " + name);
    old.close();
    if (registerInZk) {
      zkSys.registerInZk(core,false);
    }
    return old;
  }
}
