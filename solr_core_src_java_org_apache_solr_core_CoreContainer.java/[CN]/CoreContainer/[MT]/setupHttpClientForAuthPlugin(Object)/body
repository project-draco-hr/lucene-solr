{
  if (authcPlugin instanceof HttpClientBuilderPlugin) {
    SolrHttpClientBuilder builder=((HttpClientBuilderPlugin)authcPlugin).getHttpClientBuilder(HttpClientUtil.getHttpClientBuilder());
    log.debug("Reconfiguring HttpClient settings.");
    SolrHttpClientContextBuilder httpClientBuilder=new SolrHttpClientContextBuilder();
    if (builder.getCredentialsProviderProvider() != null) {
      httpClientBuilder.setDefaultCredentialsProvider(new CredentialsProviderProvider(){
        @Override public CredentialsProvider getCredentialsProvider(){
          return builder.getCredentialsProviderProvider().getCredentialsProvider();
        }
      }
);
    }
    if (builder.getAuthSchemeRegistryProvider() != null) {
      httpClientBuilder.setAuthSchemeRegistryProvider(new AuthSchemeRegistryProvider(){
        @Override public Lookup<AuthSchemeProvider> getAuthSchemeRegistry(){
          return builder.getAuthSchemeRegistryProvider().getAuthSchemeRegistry();
        }
      }
);
    }
    HttpClientUtil.setHttpClientRequestContextBuilder(httpClientBuilder);
  }
 else {
    if (pkiAuthenticationPlugin != null) {
      if (pkiAuthenticationPlugin.isInterceptorRegistered())       return;
      log.info("PKIAuthenticationPlugin is managing internode requests");
      setupHttpClientForAuthPlugin(pkiAuthenticationPlugin);
      pkiAuthenticationPlugin.setInterceptorRegistered();
    }
  }
}
