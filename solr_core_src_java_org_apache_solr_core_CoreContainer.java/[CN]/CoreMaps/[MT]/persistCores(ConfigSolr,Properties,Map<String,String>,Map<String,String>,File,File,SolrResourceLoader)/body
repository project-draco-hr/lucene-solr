{
synchronized (locker) {
    if (cfg == null) {
      ConfigSolrXml.initPersistStatic();
      persistCores(cfg,cores,loader);
      persistCores(cfg,transientCores,loader);
      for (      Map.Entry<String,CoreDescriptor> ent : dynamicDescriptors.entrySet()) {
        if (!cores.containsKey(ent.getKey()) && !transientCores.containsKey(ent.getKey())) {
          addPersistOneCore(cfg,loader,ent.getValue(),null);
        }
      }
      for (      Map.Entry<String,SolrCore> ent : createdCores.entrySet()) {
        if (!cores.containsKey(ent.getKey()) && !transientCores.containsKey(ent.getKey()) && !dynamicDescriptors.containsKey(ent.getKey())) {
          addPersistOneCore(cfg,loader,ent.getValue().getCoreDescriptor(),null);
        }
      }
      ConfigSolrXml.addPersistAllCoresStatic(containerProperties,rootSolrAttribs,coresAttribs,(file == null ? configFile : file));
    }
 else {
      cfg.initPersist();
      persistCores(cfg,cores,loader);
      persistCores(cfg,transientCores,loader);
      for (      Map.Entry<String,CoreDescriptor> ent : dynamicDescriptors.entrySet()) {
        if (!cores.containsKey(ent.getKey()) && !transientCores.containsKey(ent.getKey())) {
          addPersistOneCore(cfg,loader,ent.getValue(),null);
        }
      }
      for (      Map.Entry<String,SolrCore> ent : createdCores.entrySet()) {
        if (!cores.containsKey(ent.getKey()) && !transientCores.containsKey(ent.getKey()) && !dynamicDescriptors.containsKey(ent.getKey())) {
          addPersistOneCore(cfg,loader,ent.getValue().getCoreDescriptor(),null);
        }
      }
      cfg.addPersistAllCores(containerProperties,rootSolrAttribs,coresAttribs,(file == null ? configFile : file));
    }
  }
}
