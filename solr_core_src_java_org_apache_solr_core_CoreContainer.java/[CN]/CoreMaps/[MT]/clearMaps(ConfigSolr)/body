{
  List<String> coreNames;
  List<String> transientNames;
  List<SolrCore> pendingClosers;
synchronized (locker) {
    coreNames=new ArrayList(cores.keySet());
    transientNames=new ArrayList(transientCores.keySet());
    pendingClosers=new ArrayList(pendingDynamicCloses);
  }
  for (  String coreName : coreNames) {
    SolrCore core=cores.get(coreName);
    if (core != null) {
      try {
        addPersistOneCore(cfg,core,container.loader);
        core.close();
      }
 catch (      Throwable t) {
        SolrException.log(CoreContainer.log,"Error shutting down core",t);
      }
    }
  }
  cores.clear();
  for (  String coreName : transientNames) {
    SolrCore core=transientCores.get(coreName);
    if (core != null) {
      try {
        core.close();
      }
 catch (      Throwable t) {
        SolrException.log(CoreContainer.log,"Error shutting down core",t);
      }
    }
  }
  transientCores.clear();
  for (  SolrCore core : pendingClosers) {
    core.close();
  }
}
