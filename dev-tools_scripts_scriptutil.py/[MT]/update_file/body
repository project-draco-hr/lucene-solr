def update_file(filename, line_re, edit):
    infile = open(filename, 'r')
    buffer = []
    changed = False
    for line in infile:
        if (not changed):
            match = line_re.search(line)
            if match:
                changed = edit(buffer, match, line)
                if (changed is None):
                    return False
                continue
        buffer.append(line)
    if (not changed):
        raise Exception(('Could not find %s in %s' % (line_re, filename)))
    with open(filename, 'w') as f:
        f.write(''.join(buffer))
    return True
