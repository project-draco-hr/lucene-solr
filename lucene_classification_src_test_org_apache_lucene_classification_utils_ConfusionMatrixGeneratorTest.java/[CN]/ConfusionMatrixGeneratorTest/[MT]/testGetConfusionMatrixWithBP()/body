{
  LeafReader reader=null;
  try {
    MockAnalyzer analyzer=new MockAnalyzer(random());
    reader=getSampleIndex(analyzer);
    Classifier<Boolean> classifier=new BooleanPerceptronClassifier(reader,analyzer,null,1,null,booleanFieldName,textFieldName);
    ConfusionMatrixGenerator.ConfusionMatrix confusionMatrix=ConfusionMatrixGenerator.getConfusionMatrix(reader,classifier,booleanFieldName,textFieldName);
    assertNotNull(confusionMatrix);
    assertNotNull(confusionMatrix.getLinearizedMatrix());
    assertEquals(7,confusionMatrix.getNumberOfEvaluatedDocs());
    assertTrue(confusionMatrix.getAvgClassificationTime() >= 0d);
    assertTrue(confusionMatrix.getAccuracy() > 0d);
    assertTrue(confusionMatrix.getPrecision("true") > 0d);
    assertTrue(confusionMatrix.getPrecision("false") > 0d);
    assertTrue(confusionMatrix.getRecall("true") > 0d);
    assertTrue(confusionMatrix.getRecall("false") > 0d);
    assertTrue(confusionMatrix.getF1Measure("true") > 0d);
    assertTrue(confusionMatrix.getF1Measure("false") > 0d);
  }
  finally {
    if (reader != null) {
      reader.close();
    }
  }
}
