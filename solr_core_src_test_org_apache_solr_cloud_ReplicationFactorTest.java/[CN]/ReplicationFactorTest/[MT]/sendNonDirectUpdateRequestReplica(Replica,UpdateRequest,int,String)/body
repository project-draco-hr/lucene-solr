{
  HttpSolrClient solrServer=null;
  try {
    ZkCoreNodeProps zkProps=new ZkCoreNodeProps(replica);
    String url=zkProps.getBaseUrl() + "/" + collection;
    solrServer=new HttpSolrClient(url);
    NamedList resp=solrServer.request(up);
    NamedList hdr=(NamedList)resp.get("responseHeader");
    Integer batchRf=(Integer)hdr.get(UpdateRequest.REPFACT);
    assertTrue("Expected rf=" + expectedRf + " for batch but got "+ batchRf+ "; clusterState: "+ printClusterStateInfo(),batchRf == expectedRf);
  }
  finally {
    if (solrServer != null)     solrServer.shutdown();
  }
}
