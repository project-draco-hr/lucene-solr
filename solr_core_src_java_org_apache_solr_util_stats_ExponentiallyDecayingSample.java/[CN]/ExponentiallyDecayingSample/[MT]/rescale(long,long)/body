{
  if (nextScaleTime.compareAndSet(next,now + RESCALE_THRESHOLD)) {
    lockForRescale();
    try {
      final long oldStartTime=startTime;
      this.startTime=currentTimeInSeconds();
      final ArrayList<Double> keys=new ArrayList<Double>(values.keySet());
      for (      Double key : keys) {
        final Long value=values.remove(key);
        values.put(key * exp(-alpha * (startTime - oldStartTime)),value);
      }
      count.set(values.size());
    }
  finally {
      unlockForRescale();
    }
  }
}
