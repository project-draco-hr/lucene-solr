{
  BitSet a0=null;
  FixedBitSet b0=null;
  for (int i=0; i < iter; i++) {
    int sz=_TestUtil.nextInt(random,2,maxSize);
    BitSet a=new BitSet(sz);
    FixedBitSet b=new FixedBitSet(sz);
    if (sz > 0) {
      int nOper=random.nextInt(sz);
      for (int j=0; j < nOper; j++) {
        int idx;
        idx=random.nextInt(sz);
        a.set(idx);
        b.set(idx);
        idx=random.nextInt(sz);
        a.clear(idx);
        b.clear(idx);
        idx=random.nextInt(sz);
        a.flip(idx);
        b.flip(idx,idx + 1);
        idx=random.nextInt(sz);
        a.flip(idx);
        b.flip(idx,idx + 1);
        boolean val2=b.get(idx);
        boolean val=b.getAndSet(idx);
        assertTrue(val2 == val);
        assertTrue(b.get(idx));
        if (!val)         b.clear(idx);
        assertTrue(b.get(idx) == val);
      }
    }
    doGet(a,b);
    int fromIndex, toIndex;
    fromIndex=random.nextInt(sz / 2);
    toIndex=fromIndex + random.nextInt(sz - fromIndex);
    BitSet aa=(BitSet)a.clone();
    aa.flip(fromIndex,toIndex);
    FixedBitSet bb=(FixedBitSet)b.clone();
    bb.flip(fromIndex,toIndex);
    doIterate(aa,bb,mode);
    fromIndex=random.nextInt(sz / 2);
    toIndex=fromIndex + random.nextInt(sz - fromIndex);
    aa=(BitSet)a.clone();
    aa.clear(fromIndex,toIndex);
    bb=(FixedBitSet)b.clone();
    bb.clear(fromIndex,toIndex);
    doNextSetBit(aa,bb);
    doPrevSetBit(aa,bb);
    fromIndex=random.nextInt(sz / 2);
    toIndex=fromIndex + random.nextInt(sz - fromIndex);
    aa=(BitSet)a.clone();
    aa.set(fromIndex,toIndex);
    bb=(FixedBitSet)b.clone();
    bb.set(fromIndex,toIndex);
    doNextSetBit(aa,bb);
    doPrevSetBit(aa,bb);
    if (b0 != null && b0.length() <= b.length()) {
      assertEquals(a.cardinality(),b.cardinality());
      BitSet a_or=(BitSet)a.clone();
      a_or.or(a0);
      FixedBitSet b_or=(FixedBitSet)b.clone();
      b_or.or(b0);
      assertEquals(a0.cardinality(),b0.cardinality());
      assertEquals(a_or.cardinality(),b_or.cardinality());
      doIterate(a_or,b_or,mode);
    }
    a0=a;
    b0=b;
  }
}
