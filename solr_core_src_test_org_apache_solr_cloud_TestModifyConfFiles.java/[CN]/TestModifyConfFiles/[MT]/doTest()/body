{
  int which=r.nextInt(clients.size());
  HttpSolrServer client=(HttpSolrServer)clients.get(which);
  ModifiableSolrParams params=new ModifiableSolrParams();
  params.set("op","write");
  params.set("file","schema.xml");
  QueryRequest request=new QueryRequest(params);
  request.setPath("/admin/fileedit");
  try {
    client.request(request);
    fail("Should have caught exception");
  }
 catch (  Exception e) {
    assertThat(e.getMessage(),containsString("Input stream list was null for admin file write operation."));
  }
  params.remove("file");
  params.set("stream.body","Testing rewrite of schema.xml file.");
  params.set("op","test");
  request=new QueryRequest(params);
  request.setPath("/admin/fileedit");
  try {
    client.request(request);
    fail("Should have caught exception");
  }
 catch (  Exception e) {
    assertEquals(e.getMessage(),"No file name specified for write operation.");
  }
  params.set("op","write");
  params.set("file","bogus.txt");
  request=new QueryRequest(params);
  request.setPath("/admin/fileedit");
  try {
    client.request(request);
    fail("Should have caught exception");
  }
 catch (  Exception e) {
    assertEquals(e.getMessage(),"Can not access: bogus.txt");
  }
  try {
    params.set("file","schema.xml");
    request=new QueryRequest(params);
    request.setPath("/admin/fileedit");
    client.request(request);
    fail("Should have caught exception since it's mal-formed XML");
  }
 catch (  Exception e) {
    assertTrue("Should have a sax parser exception here!",e.getMessage().contains("Invalid XML file: org.xml.sax.SAXParseException"));
  }
  String top=SolrTestCaseJ4.TEST_HOME() + "/collection1/conf";
  params.set("stream.body",FileUtils.readFileToString(new File(top,"schema-tiny.xml"),"UTF-8"));
  params.set("file","schema.xml");
  request=new QueryRequest(params);
  request.setPath("/admin/fileedit");
  client.request(request);
  SolrZkClient zkClient=cloudClient.getZkStateReader().getZkClient();
  String contents=new String(zkClient.getData("/configs/conf1/schema.xml",null,null,true),StandardCharsets.UTF_8);
  assertTrue("Schema contents should have changed!",contents.contains("<schema name=\"tiny\" version=\"1.1\">"));
  zkClient.makePath("/configs/conf1/velocity/test.vm",false,true);
  params.set("stream.body","Some bogus stuff for a test.");
  params.set("file","velocity/test.vm");
  request=new QueryRequest(params);
  request.setPath("/admin/fileedit");
  client.request(request);
  contents=new String(zkClient.getData("/configs/conf1/velocity/test.vm",null,null,true),StandardCharsets.UTF_8);
  assertTrue("Should have found new content in a velocity/test.vm.",contents.indexOf("Some bogus stuff for a test.") != -1);
  params=new ModifiableSolrParams();
  request=new QueryRequest(params);
  request.setPath("/admin/file");
  NamedList<Object> res=client.request(request);
  NamedList files=(NamedList)res.get("files");
  assertNotNull("Should have gotten files back",files);
  SimpleOrderedMap schema=(SimpleOrderedMap)files.get("schema.xml");
  assertNotNull("Should have a schema returned",schema);
  assertNull("Schema.xml should not be a directory",schema.get("directory"));
  SimpleOrderedMap velocity=(SimpleOrderedMap)files.get("velocity");
  assertNotNull("Should have velocity dir returned",velocity);
  assertTrue("Velocity should be a directory",(boolean)velocity.get("directory"));
}
