{
  ZkStateReader zkStateReader=cloudClient.getZkStateReader();
  ZkNodeProps props=zkStateReader.getLeaderRetry(DEFAULT_COLLECTION,"shard1");
  chaosMonkey.stopShard("shard1");
  Thread.sleep(1000);
  String leaderPath=ZkStateReader.getShardLeadersPath(DEFAULT_COLLECTION,"shard1");
  SolrZkClient zkClient=new SolrZkClient(zkServer.getZkAddress(),10000);
  int fails=0;
  try {
    zkClient.makePath(leaderPath,Utils.toJSON(props),CreateMode.EPHEMERAL,true);
    for (int i=0; i < 200; i++) {
      try {
        index_specific(shardToJetty.get("shard2").get(0).client.solrClient,id,docId++);
      }
 catch (      SolrException e) {
        fails++;
        break;
      }
catch (      SolrServerException e) {
        fails++;
        break;
      }
    }
  }
  finally {
    zkClient.close();
  }
  assertTrue("A whole shard is down - some of these should fail",fails > 0);
  return docId;
}
