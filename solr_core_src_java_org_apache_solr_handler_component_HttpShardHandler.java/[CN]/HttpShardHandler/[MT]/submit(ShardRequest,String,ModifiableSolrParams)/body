{
  final List<String> urls=getURLs(sreq,shard);
  Callable<ShardResponse> task=new Callable<ShardResponse>(){
    @Override public ShardResponse call() throws Exception {
      ShardResponse srsp=new ShardResponse();
      if (sreq.nodeName != null) {
        srsp.setNodeName(sreq.nodeName);
      }
      srsp.setShardRequest(sreq);
      srsp.setShard(shard);
      SimpleSolrResponse ssr=new SimpleSolrResponse();
      srsp.setSolrResponse(ssr);
      long startTime=System.nanoTime();
      try {
        params.remove(CommonParams.WT);
        params.remove(CommonParams.VERSION);
        QueryRequest req=makeQueryRequest(sreq,params,shard);
        req.setMethod(SolrRequest.METHOD.POST);
        if (urls.size() == 0) {
          throw new SolrException(SolrException.ErrorCode.SERVICE_UNAVAILABLE,"no servers hosting shard: " + shard);
        }
        if (urls.size() <= 1) {
          String url=urls.get(0);
          srsp.setShardAddress(url);
          try (SolrClient client=new HttpSolrClient(url,httpClient)){
            ssr.nl=client.request(req);
          }
         }
 else {
          LBHttpSolrClient.Rsp rsp=httpShardHandlerFactory.makeLoadBalancedRequest(req,urls);
          ssr.nl=rsp.getResponse();
          srsp.setShardAddress(rsp.getServer());
        }
      }
 catch (      ConnectException cex) {
        srsp.setException(cex);
      }
catch (      Exception th) {
        srsp.setException(th);
        if (th instanceof SolrException) {
          srsp.setResponseCode(((SolrException)th).code());
        }
 else {
          srsp.setResponseCode(-1);
        }
      }
      ssr.elapsedTime=TimeUnit.MILLISECONDS.convert(System.nanoTime() - startTime,TimeUnit.NANOSECONDS);
      return transfomResponse(sreq,srsp,shard);
    }
  }
;
  pending.add(completionService.submit(task));
}
