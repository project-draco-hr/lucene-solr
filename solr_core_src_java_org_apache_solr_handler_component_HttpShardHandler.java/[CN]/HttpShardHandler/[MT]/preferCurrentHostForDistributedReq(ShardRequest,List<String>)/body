{
  if (sreq == null || sreq.rb == null || sreq.rb.req == null || urls == null || urls.size() <= 1)   return;
  SolrQueryRequest req=sreq.rb.req;
  if (!req.getOriginalParams().getBool(CommonParams.PREFER_LOCAL_SHARDS,false))   return;
  SolrCore core=req.getCore();
  ZkController zkController=(core != null) ? core.getCoreDescriptor().getCoreContainer().getZkController() : null;
  String currentHostAddress=(zkController != null) ? zkController.getBaseUrl() : null;
  if (currentHostAddress == null) {
    log.debug("Couldn't determine current host address to prefer local shards " + "because either core is null? {} or there is no ZkController? {}",Boolean.valueOf(core == null),Boolean.valueOf(zkController == null));
    return;
  }
  if (log.isDebugEnabled())   log.debug("Trying to prefer local shard on {} among the urls: {}",currentHostAddress,Arrays.toString(urls.toArray()));
  ListIterator<String> itr=urls.listIterator();
  while (itr.hasNext()) {
    String url=itr.next();
    if (url.startsWith(currentHostAddress)) {
      itr.remove();
      urls.add(0,url);
      if (log.isDebugEnabled())       log.debug("Applied local shard preference for urls: {}",Arrays.toString(urls.toArray()));
      break;
    }
  }
}
