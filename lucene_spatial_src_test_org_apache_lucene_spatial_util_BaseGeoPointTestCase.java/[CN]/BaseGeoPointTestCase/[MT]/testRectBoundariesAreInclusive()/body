{
  GeoRect rect=randomRect(random().nextBoolean(),false);
  Query query=newRectQuery(FIELD_NAME,rect);
  Directory dir=newDirectory();
  IndexWriterConfig iwc=newIndexWriterConfig();
  RandomIndexWriter w=new RandomIndexWriter(random(),dir,iwc);
  for (int x=0; x < 3; x++) {
    double lat;
    if (x == 0) {
      lat=rect.minLat;
    }
 else     if (x == 1) {
      lat=quantizeLat((rect.minLat + rect.maxLat) / 2.0);
    }
 else {
      lat=rect.maxLat;
    }
    for (int y=0; y < 3; y++) {
      double lon;
      if (y == 0) {
        lon=rect.minLon;
      }
 else       if (y == 1) {
        if (x == 1) {
          continue;
        }
        lon=quantizeLon((rect.minLon + rect.maxLon) / 2.0);
      }
 else {
        lon=rect.maxLon;
      }
      Document doc=new Document();
      addPointToDoc(FIELD_NAME,doc,lat,lon);
      w.addDocument(doc);
    }
  }
  IndexReader r=w.getReader();
  IndexSearcher s=newSearcher(r,false);
  assertEquals(8,s.count(newRectQuery(FIELD_NAME,rect)));
  r.close();
  w.close();
  dir.close();
}
