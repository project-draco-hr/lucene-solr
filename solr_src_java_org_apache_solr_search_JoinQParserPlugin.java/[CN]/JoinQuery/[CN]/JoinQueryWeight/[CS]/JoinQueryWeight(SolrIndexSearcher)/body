{
  this.fromSearcher=searcher;
  SolrRequestInfo info=SolrRequestInfo.getRequestInfo();
  if (info != null) {
    rb=info.getResponseBuilder();
  }
  if (fromIndex == null) {
    this.fromSearcher=searcher;
  }
 else {
    if (info == null) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Cross-core join must have SolrRequestInfo");
    }
    CoreContainer container=searcher.getCore().getCoreDescriptor().getCoreContainer();
    final SolrCore fromCore=container.getCore(fromIndex);
    if (fromCore == null) {
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,"Cross-core join: no such core ");
    }
    if (info.getReq().getCore() == fromCore) {
      fromSearcher=searcher;
    }
 else {
      fromRef=fromCore.getSearcher(false,true,null);
      fromSearcher=fromRef.get();
    }
    if (fromRef != null) {
      final RefCounted<SolrIndexSearcher> ref=fromRef;
      info.addCloseHook(new Closeable(){
        @Override public void close() throws IOException {
          ref.decref();
        }
      }
);
    }
    info.addCloseHook(new Closeable(){
      @Override public void close() throws IOException {
        fromCore.close();
      }
    }
);
  }
  this.toSearcher=searcher;
}
