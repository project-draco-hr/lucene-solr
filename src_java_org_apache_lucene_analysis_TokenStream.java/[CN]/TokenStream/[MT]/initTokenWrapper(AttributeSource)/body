{
  if (onlyUseNewAPI) {
    return null;
  }
 else {
    if (input instanceof TokenStream && ((TokenStream)input).tokenWrapper != null) {
      return ((TokenStream)input).tokenWrapper;
    }
    final AttributeImpl att=addAttribute(TermAttribute.class);
    if (att instanceof TokenWrapper && addAttribute(TypeAttribute.class) == att && addAttribute(PositionIncrementAttribute.class) == att && addAttribute(FlagsAttribute.class) == att && addAttribute(OffsetAttribute.class) == att && addAttribute(PayloadAttribute.class) == att) {
      return (TokenWrapper)att;
    }
 else {
      throw new UnsupportedOperationException("If onlyUseNewAPI is disabled, all basic Attributes must be implemented by the internal class " + "TokenWrapper. Please make sure, that all TokenStreams/TokenFilters in this chain have been " + "instantiated with this flag disabled and do not add any custom instances for the basic Attributes!");
    }
  }
}
