{
  if (readOnly)   throw new UnsupportedOperationException("this SegmentReader is read only");
  hasChanges=true;
  if (liveDocs == null) {
    liveDocs=new BitVector(maxDoc());
    liveDocs.setAll();
    liveDocsRef=new AtomicInteger(1);
  }
  if (liveDocsRef.get() > 1) {
    AtomicInteger oldRef=liveDocsRef;
    liveDocs=cloneDeletedDocs(liveDocs);
    liveDocsRef=new AtomicInteger(1);
    oldRef.decrementAndGet();
  }
  combinedCoreAndDeletesKey=new Object();
  if (liveDocs.getAndClear(docNum)) {
    pendingDeleteCount++;
  }
}
