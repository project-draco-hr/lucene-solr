{
  SchemaField sf=fcontext.searcher.getSchema().getField(field);
  FieldType ft=sf.getType();
  boolean multiToken=sf.multiValued() || ft.multiValuedFieldCache();
  if (method == FacetMethod.ENUM && sf.indexed()) {
    throw new UnsupportedOperationException();
  }
 else   if (method == FacetMethod.STREAM && sf.indexed()) {
    return new FacetFieldProcessorByEnumTermsStream(fcontext,this,sf);
  }
  LegacyNumericType ntype=ft.getNumericType();
  if (!multiToken) {
    if (ntype != null) {
      return new FacetFieldProcessorByHashNumeric(fcontext,this,sf);
    }
 else {
      return new FacetFieldProcessorByArrayDV(fcontext,this,sf);
    }
  }
  if (sf.hasDocValues() || method == FacetMethod.DV) {
    return new FacetFieldProcessorByArrayDV(fcontext,this,sf);
  }
  return new FacetFieldProcessorByArrayUIF(fcontext,this,sf);
}
