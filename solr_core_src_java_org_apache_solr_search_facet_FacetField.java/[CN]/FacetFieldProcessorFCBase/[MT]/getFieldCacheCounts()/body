{
  String prefix=freq.prefix;
  if (prefix == null || prefix.length() == 0) {
    prefixRef=null;
  }
 else {
    prefixRef=new BytesRefBuilder();
    prefixRef.copyChars(prefix);
  }
  findStartAndEndOrds();
  maxSlots=(freq.missing && startTermIndex != -1) ? nTerms + 1 : nTerms;
  if (freq.allBuckets) {
    allBucketsSlot=maxSlots;
    maxSlots++;
  }
 else {
    allBucketsSlot=-1;
  }
  createAccs(nDocs,maxSlots);
  setSortAcc(maxSlots);
  prepareForCollection();
  collectDocs();
  return findTopSlots();
}
