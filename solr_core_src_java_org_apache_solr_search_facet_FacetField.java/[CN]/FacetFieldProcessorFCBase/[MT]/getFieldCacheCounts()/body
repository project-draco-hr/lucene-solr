{
  String prefix=freq.prefix;
  if (prefix == null || prefix.length() == 0) {
    prefixRef=null;
  }
 else {
    prefixRef=new BytesRefBuilder();
    prefixRef.copyChars(prefix);
  }
  findStartAndEndOrds();
  maxSlots=nTerms;
  if (freq.allBuckets) {
    allBucketsSlot=maxSlots++;
  }
  if (freq.missing) {
    missingSlot=maxSlots++;
  }
  createCollectAcc(nDocs,maxSlots);
  if (freq.allBuckets) {
    allBucketsAcc=new SpecialSlotAcc(fcontext,collectAcc,allBucketsSlot,otherAccs,0);
  }
  if (freq.missing) {
    missingAcc=new SpecialSlotAcc(fcontext,collectAcc,missingSlot,otherAccs,1);
  }
  collectDocs();
  return findTopSlots();
}
