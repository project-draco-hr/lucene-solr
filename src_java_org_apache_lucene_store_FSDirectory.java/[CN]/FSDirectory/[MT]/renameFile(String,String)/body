{
  File old=new File(directory,from);
  File nu=new File(directory,to);
  if (nu.exists())   if (!nu.delete())   throw new IOException("couldn't delete " + to);
  if (!old.renameTo(nu)) {
    java.io.InputStream in=null;
    java.io.OutputStream out=null;
    try {
      in=new FileInputStream(old);
      out=new FileOutputStream(nu);
      if (buffer == null) {
        buffer=new byte[1024];
      }
      int len;
      while ((len=in.read(buffer)) >= 0) {
        out.write(buffer,0,len);
      }
      old.delete();
    }
 catch (    IOException ioe) {
      throw new IOException("couldn't rename " + from + " to "+ to);
    }
 finally {
      if (in != null) {
        try {
          in.close();
        }
 catch (        IOException e) {
          throw new RuntimeException("could not close input stream: " + e.getMessage());
        }
      }
      if (out != null) {
        try {
          out.close();
        }
 catch (        IOException e) {
          throw new RuntimeException("could not close output stream: " + e.getMessage());
        }
      }
    }
  }
}
