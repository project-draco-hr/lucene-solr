{
  directory=path;
  if (directory.exists() && !directory.isDirectory())   throw new NoSuchDirectoryException("file '" + directory + "' exists but is not a directory");
  if (lockFactory == null) {
    if (disableLocks) {
      lockFactory=NoLockFactory.getNoLockFactory();
    }
 else {
      String lockClassName=System.getProperty("org.apache.lucene.store.FSDirectoryLockFactoryClass");
      if (lockClassName != null && !lockClassName.equals("")) {
        Class c;
        try {
          c=Class.forName(lockClassName);
        }
 catch (        ClassNotFoundException e) {
          throw new IOException("unable to find LockClass " + lockClassName);
        }
        try {
          lockFactory=(LockFactory)c.newInstance();
        }
 catch (        IllegalAccessException e) {
          throw new IOException("IllegalAccessException when instantiating LockClass " + lockClassName);
        }
catch (        InstantiationException e) {
          throw new IOException("InstantiationException when instantiating LockClass " + lockClassName);
        }
catch (        ClassCastException e) {
          throw new IOException("unable to cast LockClass " + lockClassName + " instance to a LockFactory");
        }
      }
 else {
        lockFactory=new SimpleFSLockFactory();
      }
    }
  }
  setLockFactory(lockFactory);
  if (lockFactory instanceof FSLockFactory) {
    final FSLockFactory lf=(FSLockFactory)lockFactory;
    final File dir=lf.getLockDir();
    if (dir == null) {
      lf.setLockDir(this.directory);
      lf.setLockPrefix(null);
    }
 else     if (dir.getCanonicalPath().equals(this.directory.getCanonicalPath())) {
      lf.setLockPrefix(null);
    }
  }
}
