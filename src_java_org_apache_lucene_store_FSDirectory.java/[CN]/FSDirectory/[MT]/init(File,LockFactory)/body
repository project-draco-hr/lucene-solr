{
  directory=path;
  boolean doClearLockID=false;
  if (lockFactory == null) {
    if (disableLocks) {
      lockFactory=NoLockFactory.getNoLockFactory();
    }
 else {
      String lockClassName=System.getProperty("org.apache.lucene.store.FSDirectoryLockFactoryClass");
      if (lockClassName != null && !lockClassName.equals("")) {
        Class c;
        try {
          c=Class.forName(lockClassName);
        }
 catch (        ClassNotFoundException e) {
          throw new IOException("unable to find LockClass " + lockClassName);
        }
        try {
          lockFactory=(LockFactory)c.newInstance();
        }
 catch (        IllegalAccessException e) {
          throw new IOException("IllegalAccessException when instantiating LockClass " + lockClassName);
        }
catch (        InstantiationException e) {
          throw new IOException("InstantiationException when instantiating LockClass " + lockClassName);
        }
catch (        ClassCastException e) {
          throw new IOException("unable to cast LockClass " + lockClassName + " instance to a LockFactory");
        }
        if (lockFactory instanceof NativeFSLockFactory) {
          ((NativeFSLockFactory)lockFactory).setLockDir(path);
        }
 else         if (lockFactory instanceof SimpleFSLockFactory) {
          ((SimpleFSLockFactory)lockFactory).setLockDir(path);
        }
      }
 else {
        lockFactory=new SimpleFSLockFactory(path);
        doClearLockID=true;
      }
    }
  }
  setLockFactory(lockFactory);
  if (doClearLockID) {
    lockFactory.setLockPrefix(null);
  }
}
