{
  if (!directory.exists())   if (!directory.mkdirs())   throw new IOException("Cannot create directory: " + directory);
  if (!directory.isDirectory())   throw new IOException(directory + " not a directory");
  String[] files=directory.list(new IndexFileNameFilter());
  if (files == null)   throw new IOException("Cannot read directory " + directory.getAbsolutePath());
  for (int i=0; i < files.length; i++) {
    File file=new File(directory,files[i]);
    if (!file.delete())     throw new IOException("Cannot delete " + file);
  }
  String lockPrefix=getLockPrefix().toString();
  files=lockDir.list();
  if (files == null)   throw new IOException("Cannot read lock directory " + lockDir.getAbsolutePath());
  for (int i=0; i < files.length; i++) {
    if (!files[i].startsWith(lockPrefix))     continue;
    File lockFile=new File(lockDir,files[i]);
    if (!lockFile.delete())     throw new IOException("Cannot delete " + lockFile);
  }
}
