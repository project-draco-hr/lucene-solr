{
  if (field.multiValued() && field.hasDocValues() && !field.indexed()) {
    return super.getRangeQuery(parser,field,min,max,minInclusive,maxInclusive);
  }
  int ps=precisionStep;
  Query query;
  final boolean matchOnly=field.hasDocValues() && !field.indexed();
switch (type) {
case INTEGER:
    if (matchOnly) {
      query=DocValuesRangeQuery.newLongRange(field.getName(),min == null ? null : (long)Integer.parseInt(min),max == null ? null : (long)Integer.parseInt(max),minInclusive,maxInclusive);
    }
 else {
      query=NumericRangeQuery.newIntRange(field.getName(),ps,min == null ? null : Integer.parseInt(min),max == null ? null : Integer.parseInt(max),minInclusive,maxInclusive);
    }
  break;
case FLOAT:
if (matchOnly) {
  query=DocValuesRangeQuery.newLongRange(field.getName(),min == null ? null : (long)NumericUtils.floatToSortableInt(Float.parseFloat(min)),max == null ? null : (long)NumericUtils.floatToSortableInt(Float.parseFloat(max)),minInclusive,maxInclusive);
}
 else {
  query=NumericRangeQuery.newFloatRange(field.getName(),ps,min == null ? null : Float.parseFloat(min),max == null ? null : Float.parseFloat(max),minInclusive,maxInclusive);
}
break;
case LONG:
if (matchOnly) {
query=DocValuesRangeQuery.newLongRange(field.getName(),min == null ? null : Long.parseLong(min),max == null ? null : Long.parseLong(max),minInclusive,maxInclusive);
}
 else {
query=NumericRangeQuery.newLongRange(field.getName(),ps,min == null ? null : Long.parseLong(min),max == null ? null : Long.parseLong(max),minInclusive,maxInclusive);
}
break;
case DOUBLE:
if (matchOnly) {
query=DocValuesRangeQuery.newLongRange(field.getName(),min == null ? null : NumericUtils.doubleToSortableLong(Double.parseDouble(min)),max == null ? null : NumericUtils.doubleToSortableLong(Double.parseDouble(max)),minInclusive,maxInclusive);
}
 else {
query=NumericRangeQuery.newDoubleRange(field.getName(),ps,min == null ? null : Double.parseDouble(min),max == null ? null : Double.parseDouble(max),minInclusive,maxInclusive);
}
break;
case DATE:
if (matchOnly) {
query=DocValuesRangeQuery.newLongRange(field.getName(),min == null ? null : DateFormatUtil.parseMath(null,min).getTime(),max == null ? null : DateFormatUtil.parseMath(null,max).getTime(),minInclusive,maxInclusive);
}
 else {
query=NumericRangeQuery.newLongRange(field.getName(),ps,min == null ? null : DateFormatUtil.parseMath(null,min).getTime(),max == null ? null : DateFormatUtil.parseMath(null,max).getTime(),minInclusive,maxInclusive);
}
break;
default :
throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unknown type for trie field");
}
return query;
}
