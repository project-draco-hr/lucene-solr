{
  final BytesRef bytes=new BytesRef(NumericUtils.BUF_SIZE_LONG);
  if (f instanceof NumericField) {
    final Number val=((NumericField)f).getNumericValue();
    if (val == null)     throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Invalid field contents: " + f.name());
switch (type) {
case INTEGER:
      NumericUtils.intToPrefixCoded(val.intValue(),0,bytes);
    break;
case FLOAT:
  NumericUtils.intToPrefixCoded(NumericUtils.floatToSortableInt(val.floatValue()),0,bytes);
break;
case LONG:
case DATE:
NumericUtils.longToPrefixCoded(val.longValue(),0,bytes);
break;
case DOUBLE:
NumericUtils.longToPrefixCoded(NumericUtils.doubleToSortableLong(val.doubleValue()),0,bytes);
break;
default :
throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unknown type for trie field: " + f.name());
}
}
 else {
final byte[] arr=f.getBinaryValue();
if (arr == null) throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Invalid field contents: " + f.name());
switch (type) {
case INTEGER:
NumericUtils.intToPrefixCoded(toInt(arr),0,bytes);
break;
case FLOAT:
{
int v=toInt(arr);
if (v < 0) v^=0x7fffffff;
NumericUtils.intToPrefixCoded(v,0,bytes);
break;
}
case LONG:
case DATE:
NumericUtils.longToPrefixCoded(toLong(arr),0,bytes);
break;
case DOUBLE:
{
long v=toLong(arr);
if (v < 0) v^=0x7fffffffffffffffL;
NumericUtils.longToPrefixCoded(v,0,bytes);
break;
}
default :
throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unknown type for trie field: " + f.name());
}
}
return bytes.utf8ToString();
}
