{
  _TestUtil.syncConcurrentMerges(writer);
  int maxBufferedDocs=writer.getMaxBufferedDocs();
  int mergeFactor=writer.getMergeFactor();
  int maxMergeDocs=writer.getMaxMergeDocs();
  int ramSegmentCount=writer.getNumBufferedDocuments();
  assertTrue(ramSegmentCount < maxBufferedDocs);
  int lowerBound=-1;
  int upperBound=maxBufferedDocs;
  int numSegments=0;
  int segmentCount=writer.getSegmentCount();
  for (int i=segmentCount - 1; i >= 0; i--) {
    int docCount=writer.getDocCount(i);
    assertTrue(docCount > lowerBound);
    if (docCount <= upperBound) {
      numSegments++;
    }
 else {
      if (upperBound * mergeFactor <= maxMergeDocs) {
        assertTrue("maxMergeDocs=" + maxMergeDocs + "; numSegments="+ numSegments+ "; upperBound="+ upperBound+ "; mergeFactor="+ mergeFactor+ "; segs="+ writer.segString(),numSegments < mergeFactor);
      }
      do {
        lowerBound=upperBound;
        upperBound*=mergeFactor;
      }
 while (docCount > upperBound);
      numSegments=1;
    }
  }
  if (upperBound * mergeFactor <= maxMergeDocs) {
    assertTrue(numSegments < mergeFactor);
  }
  String[] files=writer.getDirectory().listAll();
  int segmentCfsCount=0;
  for (int i=0; i < files.length; i++) {
    if (files[i].endsWith(".cfs")) {
      segmentCfsCount++;
    }
  }
  assertEquals(segmentCount,segmentCfsCount);
}
