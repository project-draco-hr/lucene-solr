{
  int maxBufferedDocs=writer.getMaxBufferedDocs();
  int mergeFactor=writer.getMergeFactor();
  int maxMergeDocs=writer.getMaxMergeDocs();
  int ramSegmentCount=writer.getRAMSegmentCount();
  assertTrue(ramSegmentCount < maxBufferedDocs);
  int lowerBound=0;
  int upperBound=maxBufferedDocs;
  int numSegments=0;
  int segmentCount=writer.getSegmentCount();
  for (int i=segmentCount - 1; i >= 0; i--) {
    int docCount=writer.getDocCount(i);
    assertTrue(docCount > lowerBound || docCount == 0);
    if (docCount <= upperBound) {
      numSegments++;
    }
 else {
      if (upperBound * mergeFactor <= maxMergeDocs) {
        assertTrue(numSegments < mergeFactor);
      }
      lowerBound=upperBound;
      upperBound*=mergeFactor;
      numSegments=1;
    }
  }
  if (upperBound * mergeFactor <= maxMergeDocs) {
    assertTrue(numSegments < mergeFactor);
  }
  String[] files=writer.getDirectory().list();
  int segmentCfsCount=0;
  for (int i=0; i < files.length; i++) {
    if (files[i].endsWith(".cfs")) {
      segmentCfsCount++;
    }
  }
  assertEquals(segmentCount,segmentCfsCount);
}
