{
  int maxBufferedDocs=writer.getMaxBufferedDocs();
  int mergeFactor=writer.getMergeFactor();
  int maxMergeDocs=writer.getMaxMergeDocs();
  int ramSegmentCount=writer.getRAMSegmentCount();
  assertTrue(ramSegmentCount < maxBufferedDocs);
  int lowerBound=0;
  int upperBound=maxBufferedDocs;
  int numSegments=0;
  int segmentCount=writer.getSegmentCount();
  for (int i=segmentCount - 1; i >= 0; i--) {
    int docCount=writer.getDocCount(i);
    assertTrue(docCount > lowerBound);
    if (docCount <= upperBound) {
      segmentCount++;
    }
 else {
      if (upperBound * mergeFactor <= maxMergeDocs) {
        assertTrue(numSegments < mergeFactor);
      }
      lowerBound=upperBound;
      upperBound*=mergeFactor;
      segmentCount=1;
    }
  }
  if (upperBound * mergeFactor <= maxMergeDocs) {
    assertTrue(numSegments < mergeFactor);
  }
}
