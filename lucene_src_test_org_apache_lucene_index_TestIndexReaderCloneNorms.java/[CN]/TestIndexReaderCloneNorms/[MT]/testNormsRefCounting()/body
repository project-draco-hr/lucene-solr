{
  Directory dir1=newDirectory();
  TestIndexReaderReopen.createIndex(random,dir1,false);
  IndexReader reader1=IndexReader.open(dir1,false);
  IndexReader reader2C=(IndexReader)reader1.clone();
  SegmentReader segmentReader2C=getOnlySegmentReader(reader2C);
  segmentReader2C.norms("field1");
  SegmentNorms reader2CNorm=segmentReader2C.norms.get("field1");
  assertTrue("reader2CNorm.bytesRef()=" + reader2CNorm.bytesRef(),reader2CNorm.bytesRef().get() == 2);
  IndexReader reader3C=(IndexReader)reader2C.clone();
  SegmentReader segmentReader3C=getOnlySegmentReader(reader3C);
  SegmentNorms reader3CCNorm=segmentReader3C.norms.get("field1");
  assertEquals(3,reader3CCNorm.bytesRef().get());
  IndexReader reader4C=(IndexReader)reader3C.clone();
  SegmentReader segmentReader4C=getOnlySegmentReader(reader4C);
  assertEquals(4,reader3CCNorm.bytesRef().get());
  DefaultSimilarity sim=new DefaultSimilarity();
  reader4C.setNorm(5,"field1",sim.encodeNormValue(0.33f));
  try {
    reader3C.setNorm(1,"field1",sim.encodeNormValue(0.99f));
    fail("did not hit expected exception");
  }
 catch (  Exception ex) {
  }
  assertTrue(sim.decodeNormValue(segmentReader3C.norms("field1")[5]) != sim.decodeNormValue(segmentReader4C.norms("field1")[5]));
  SegmentNorms reader4CCNorm=segmentReader4C.norms.get("field1");
  assertEquals(3,reader3CCNorm.bytesRef().get());
  assertEquals(1,reader4CCNorm.bytesRef().get());
  IndexReader reader5C=(IndexReader)reader4C.clone();
  SegmentReader segmentReader5C=getOnlySegmentReader(reader5C);
  SegmentNorms reader5CCNorm=segmentReader5C.norms.get("field1");
  reader5C.setNorm(5,"field1",sim.encodeNormValue(0.7f));
  assertEquals(1,reader5CCNorm.bytesRef().get());
  reader5C.close();
  reader4C.close();
  reader3C.close();
  reader2C.close();
  reader1.close();
  dir1.close();
}
