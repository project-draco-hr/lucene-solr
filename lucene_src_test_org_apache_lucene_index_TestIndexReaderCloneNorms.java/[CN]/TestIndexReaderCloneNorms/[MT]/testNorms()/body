{
  Directory dir1=newDirectory();
  IndexWriter.unlock(dir1);
  norms=new ArrayList<Float>();
  modifiedNorms=new ArrayList<Float>();
  createIndex(random,dir1);
  doTestNorms(random,dir1);
  ArrayList<Float> norms1=norms;
  ArrayList<Float> modifiedNorms1=modifiedNorms;
  int numDocNorms1=numDocNorms;
  norms=new ArrayList<Float>();
  modifiedNorms=new ArrayList<Float>();
  numDocNorms=0;
  Directory dir2=newDirectory();
  createIndex(random,dir2);
  doTestNorms(random,dir2);
  Directory dir3=newDirectory();
  createIndex(random,dir3);
  if (VERBOSE) {
    System.out.println("TEST: now addIndexes/optimize");
  }
  IndexWriter iw=new IndexWriter(dir3,newIndexWriterConfig(TEST_VERSION_CURRENT,anlzr).setOpenMode(OpenMode.APPEND).setMaxBufferedDocs(5).setMergePolicy(newLogMergePolicy(3)));
  iw.setInfoStream(VERBOSE ? System.out : null);
  iw.addIndexes(dir1,dir2);
  iw.optimize();
  iw.close();
  norms1.addAll(norms);
  norms=norms1;
  modifiedNorms1.addAll(modifiedNorms);
  modifiedNorms=modifiedNorms1;
  numDocNorms+=numDocNorms1;
  verifyIndex(dir3);
  doTestNorms(random,dir3);
  iw=new IndexWriter(dir3,newIndexWriterConfig(TEST_VERSION_CURRENT,anlzr).setOpenMode(OpenMode.APPEND).setMaxBufferedDocs(5).setMergePolicy(newLogMergePolicy(3)));
  iw.optimize();
  iw.close();
  verifyIndex(dir3);
  dir1.close();
  dir2.close();
  dir3.close();
}
