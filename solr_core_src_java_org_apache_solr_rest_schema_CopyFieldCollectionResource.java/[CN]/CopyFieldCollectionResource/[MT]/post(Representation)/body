{
  try {
    if (!getSchema().isMutable()) {
      final String message="This IndexSchema is not mutable.";
      throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message);
    }
 else {
      if (!entity.getMediaType().equals(MediaType.APPLICATION_JSON,true)) {
        String message="Only media type " + MediaType.APPLICATION_JSON.toString() + " is accepted."+ "  Request has media type "+ entity.getMediaType().toString()+ ".";
        log.error(message);
        throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message);
      }
 else {
        Object object=ObjectBuilder.fromJSON(entity.getText());
        if (!(object instanceof List)) {
          String message="Invalid JSON type " + object.getClass().getName() + ", expected List of the form"+ " (ignore the backslashes): [{\"source\":\"foo\",\"dest\":\"comma-separated list of targets\"}, {...}, ...]";
          log.error(message);
          throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message);
        }
 else {
          List<Map<String,Object>> list=(List<Map<String,Object>>)object;
          Map<String,Collection<String>> fieldsToCopy=new HashMap<>();
          ManagedIndexSchema oldSchema=(ManagedIndexSchema)getSchema();
          Set<String> malformed=new HashSet<>();
          for (          Map<String,Object> map : list) {
            String fieldName=(String)map.get(IndexSchema.SOURCE);
            if (null == fieldName) {
              String message="Missing '" + IndexSchema.SOURCE + "' mapping.";
              log.error(message);
              throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message);
            }
            String destinations=(String)map.get(IndexSchema.DESTINATION);
            if (destinations == null) {
              String message="Missing '" + IndexSchema.DESTINATION + "' mapping.";
              log.error(message);
              throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message);
            }
            String[] splits=destinations.split(",");
            Set<String> destinationSet=new HashSet<>();
            if (splits != null && splits.length > 0) {
              for (int i=0; i < splits.length; i++) {
                destinationSet.add(splits[i].trim());
              }
              fieldsToCopy.put(fieldName,destinationSet);
            }
 else {
              malformed.add(fieldName);
            }
          }
          if (malformed.size() > 0) {
            StringBuilder message=new StringBuilder("Malformed destination(s) for: ");
            for (            String s : malformed) {
              message.append(s).append(", ");
            }
            if (message.length() > 2) {
              message.setLength(message.length() - 2);
            }
            log.error(message.toString().trim());
            throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,message.toString().trim());
          }
          IndexSchema newSchema=oldSchema.addCopyFields(fieldsToCopy);
          if (newSchema != null) {
            getSolrCore().setLatestSchema(newSchema);
          }
        }
      }
    }
  }
 catch (  Exception e) {
    getSolrResponse().setException(e);
  }
  handlePostExecution(log);
  return new SolrOutputRepresentation();
}
