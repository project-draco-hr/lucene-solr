{
  ReaderContext topLevelContext=reader.getTopReaderContext();
  OpenBitSet bs=getRandomSet(reader.maxDoc(),rand.nextInt(reader.maxDoc() + 1));
  DocSet a=new BitDocSet(bs);
  DocSet b=getIntDocSet(bs);
  Filter fa=a.getTopFilter();
  Filter fb=b.getTopFilter();
  DocIdSet da=fa.getDocIdSet(topLevelContext);
  DocIdSet db=fb.getDocIdSet(topLevelContext);
  doTestIteratorEqual(da,db);
  for (  ReaderContext readerInfo : topLevelContext.leaves()) {
    da=fa.getDocIdSet(readerInfo);
    db=fb.getDocIdSet(readerInfo);
    doTestIteratorEqual(da,db);
  }
  int nReaders=topLevelContext.leaves().length;
  for (int i=0; i < nReaders; i++) {
    ReaderContext readerInfo=topLevelContext.leaves()[rand.nextInt(nReaders)];
    da=fa.getDocIdSet(readerInfo);
    db=fb.getDocIdSet(readerInfo);
    doTestIteratorEqual(da,db);
  }
}
