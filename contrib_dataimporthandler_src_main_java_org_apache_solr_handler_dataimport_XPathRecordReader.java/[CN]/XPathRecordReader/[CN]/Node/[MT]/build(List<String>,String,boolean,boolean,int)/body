{
  String name=paths.remove(0);
  if (paths.isEmpty() && name.startsWith("@")) {
    if (attributes == null) {
      attributes=new ArrayList<Node>();
    }
    name=name.substring(1);
    attributes.add(new Node(name,fieldName,multiValued));
  }
 else {
    if (childNodes == null)     childNodes=new ArrayList<Node>();
    Node n=getOrAddChildNode(name);
    if (paths.isEmpty()) {
      if (record) {
        n.isRecord=true;
        n.forEachPath=fieldName;
      }
 else {
        n.hasText=true;
        n.fieldName=fieldName;
        n.multiValued=multiValued;
        n.flatten=flags == FLATTEN;
      }
    }
 else {
      n.build(paths,fieldName,multiValued,record,flags);
    }
  }
}
