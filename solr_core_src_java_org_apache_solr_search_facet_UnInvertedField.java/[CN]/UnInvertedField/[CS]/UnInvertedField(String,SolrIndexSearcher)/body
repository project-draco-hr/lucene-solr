{
  super(field,searcher.maxDoc() / 20 + 2,DEFAULT_INDEX_INTERVAL_BITS);
  final String prefix=TrieField.getMainValuePrefix(searcher.getSchema().getFieldType(field));
  this.searcher=searcher;
  try {
    LeafReader r=SlowCompositeReaderWrapper.wrap(searcher.getRawReader());
    uninvert(r,r.getLiveDocs(),prefix == null ? null : new BytesRef(prefix));
  }
 catch (  IllegalStateException ise) {
    throw new SolrException(SolrException.ErrorCode.BAD_REQUEST,ise);
  }
  if (tnums != null) {
    for (    byte[] target : tnums) {
      if (target != null && target.length > (1 << 24) * .9) {
        log.warn("Approaching too many values for UnInvertedField faceting on field '" + field + "' : bucket size="+ target.length);
      }
    }
  }
  if ((maxTermCounts.length - numTermsInField) > 1024) {
    int[] newMaxTermCounts=new int[numTermsInField];
    System.arraycopy(maxTermCounts,0,newMaxTermCounts,0,numTermsInField);
    maxTermCounts=newMaxTermCounts;
  }
  log.info("UnInverted multi-valued field " + toString());
}
