{
  assertU(adoc("id",String.valueOf(1),"name","name" + String.valueOf(1)));
  File idxprops=new File(h.getCore().getDataDir() + SnapPuller.INDEX_PROPERTIES);
  Properties p=new Properties();
  File newDir=new File(h.getCore().getDataDir() + "index_temp");
  newDir.mkdirs();
  p.put("index",newDir.getName());
  Writer os=null;
  try {
    os=new OutputStreamWriter(new FileOutputStream(idxprops),IOUtils.CHARSET_UTF_8);
    p.store(os,"index properties");
  }
 catch (  Exception e) {
    throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,"Unable to write " + SnapPuller.INDEX_PROPERTIES,e);
  }
 finally {
    IOUtils.closeWhileHandlingException(os);
  }
  Directory dir=newFSDirectory(newDir);
  IndexWriter iw=new IndexWriter(dir,new IndexWriterConfig(Version.LUCENE_40,new StandardAnalyzer(Version.LUCENE_40)));
  Document doc=new Document();
  doc.add(new TextField("id","2",Field.Store.YES));
  doc.add(new TextField("name","name2",Field.Store.YES));
  iw.addDocument(doc);
  iw.commit();
  iw.close();
  assertU(commit());
  assertQ("return doc with id 2",req("id:2"),"*[count(//doc)=1]");
  dir.close();
  newDir.delete();
}
