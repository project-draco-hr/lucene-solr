{
  if (node == null) {
    return null;
  }
 else {
    SimilarityFactory similarityFactory;
    final String classArg=((Element)node).getAttribute(SimilarityFactory.CLASS_NAME);
    final Object obj=loader.newInstance(classArg,Object.class,"search.similarities.");
    if (obj instanceof SimilarityFactory) {
      final NamedList<Object> namedList=DOMUtil.childNodesToNamedList(node);
      namedList.add(SimilarityFactory.CLASS_NAME,classArg);
      SolrParams params=SolrParams.toSolrParams(namedList);
      similarityFactory=(SimilarityFactory)obj;
      similarityFactory.init(params);
    }
 else {
      similarityFactory=new SimilarityFactory(){
        @Override public Similarity getSimilarity(){
          return (Similarity)obj;
        }
      }
;
    }
    return similarityFactory;
  }
}
