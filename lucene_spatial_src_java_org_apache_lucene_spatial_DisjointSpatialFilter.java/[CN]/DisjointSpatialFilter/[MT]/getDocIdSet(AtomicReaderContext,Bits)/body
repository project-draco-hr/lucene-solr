{
  Bits docsWithField;
  if (field == null) {
    docsWithField=null;
  }
 else {
    docsWithField=DocValues.getDocsWithField(context.reader(),field);
    final int maxDoc=context.reader().maxDoc();
    if (docsWithField.length() != maxDoc)     throw new IllegalStateException("Bits length should be maxDoc (" + maxDoc + ") but wasn't: "+ docsWithField);
    if (docsWithField instanceof Bits.MatchNoBits) {
      return null;
    }
 else     if (docsWithField instanceof Bits.MatchAllBits) {
      docsWithField=null;
    }
  }
  DocIdSet docIdSet=new ChainedFilter(new Filter[]{intersectsFilter},ChainedFilter.ANDNOT).getDocIdSet(context,acceptDocs);
  return BitsFilteredDocIdSet.wrap(docIdSet,docsWithField);
}
