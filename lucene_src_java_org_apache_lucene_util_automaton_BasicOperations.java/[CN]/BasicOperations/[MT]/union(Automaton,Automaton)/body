{
  if ((a1.isSingleton() && a2.isSingleton() && a1.singleton.equals(a2.singleton)) || a1 == a2)   return a1.cloneIfRequired();
  if (a1 == a2) {
    a1=a1.cloneExpanded();
    a2=a2.cloneExpanded();
  }
 else {
    a1=a1.cloneExpandedIfRequired();
    a2=a2.cloneExpandedIfRequired();
  }
  State s=new State();
  s.addEpsilon(a1.initial);
  s.addEpsilon(a2.initial);
  a1.initial=s;
  a1.deterministic=false;
  a1.clearNumberedStates();
  a1.checkMinimizeAlways();
  return a1;
}
