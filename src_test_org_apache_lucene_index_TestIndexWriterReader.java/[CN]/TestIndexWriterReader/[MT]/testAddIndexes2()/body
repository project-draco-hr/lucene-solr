{
  boolean optimize=false;
  Directory dir1=new MockRAMDirectory();
  IndexWriter writer=new IndexWriter(dir1,new WhitespaceAnalyzer(TEST_VERSION_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  writer.setInfoStream(infoStream);
  Directory dir2=new MockRAMDirectory();
  IndexWriter writer2=new IndexWriter(dir2,new WhitespaceAnalyzer(TEST_VERSION_CURRENT),IndexWriter.MaxFieldLength.LIMITED);
  writer2.setInfoStream(infoStream);
  createIndexNoClose(!optimize,"index2",writer2);
  writer2.close();
  writer.addIndexesNoOptimize(new Directory[]{dir2});
  writer.addIndexesNoOptimize(new Directory[]{dir2});
  writer.addIndexesNoOptimize(new Directory[]{dir2});
  writer.addIndexesNoOptimize(new Directory[]{dir2});
  writer.addIndexesNoOptimize(new Directory[]{dir2});
  IndexReader r1=writer.getReader();
  assertEquals(500,r1.maxDoc());
  r1.close();
  writer.close();
  dir1.close();
}
