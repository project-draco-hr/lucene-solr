{
  final ResourceLoader loader=new SolrResourceLoader(SolrTestCaseJ4.TEST_HOME,this.getClass().getClassLoader());
  final SystemIdResolver resolver=new SystemIdResolver(loader);
  final String fileUri=new File(SolrTestCaseJ4.TEST_HOME + "/crazy-path-to-config.xml").toURI().toASCIIString();
  assertEquals("solrres:/test.xml",SystemIdResolver.createSystemIdFromResourceName("test.xml"));
  assertEquals("solrres://@/usr/local/etc/test.xml",SystemIdResolver.createSystemIdFromResourceName("/usr/local/etc/test.xml"));
  assertEquals("solrres://@/test.xml",SystemIdResolver.createSystemIdFromResourceName(File.separatorChar + "test.xml"));
  assertEquals("solrres:/test.xml",resolver.resolveRelativeURI("solrres:/base.xml","test.xml").toASCIIString());
  assertEquals("solrres://@/etc/test.xml",resolver.resolveRelativeURI("solrres://@/usr/local/etc/base.xml","../../../etc/test.xml").toASCIIString());
  assertEquals("solrres://@/a/test.xml",resolver.resolveRelativeURI("solrres:/base.xml","/a/test.xml").toASCIIString());
  assertEquals(fileUri,resolver.resolveRelativeURI("solrres:/base.xml",fileUri).toASCIIString());
  assertEquals("solrres:/base.xml",resolver.resolveRelativeURI(fileUri,"solrres:/base.xml").toASCIIString());
  assertEntityResolving(resolver,"solrres:/schema.xml","solrres:/solrconfig.xml","schema.xml");
  assertEntityResolving(resolver,"solrres:/org/apache/solr/common/util/TestSystemIdResolver.class","solrres:/org/apache/solr/common/ResourceLoader.class","util/TestSystemIdResolver.class");
  assertEntityResolving(resolver,SystemIdResolver.createSystemIdFromResourceName(SolrTestCaseJ4.TEST_HOME + "/conf/schema.xml"),SystemIdResolver.createSystemIdFromResourceName(SolrTestCaseJ4.TEST_HOME + "/conf/solrconfig.xml"),"schema.xml");
  assertEntityResolving(resolver,SystemIdResolver.createSystemIdFromResourceName(SolrTestCaseJ4.TEST_HOME + "/crazy-path-to-schema.xml"),SystemIdResolver.createSystemIdFromResourceName(SolrTestCaseJ4.TEST_HOME + "/crazy-path-to-config.xml"),"crazy-path-to-schema.xml");
  assertNull(resolver.resolveEntity(null,null,"solrres:/solrconfig.xml",fileUri));
}
