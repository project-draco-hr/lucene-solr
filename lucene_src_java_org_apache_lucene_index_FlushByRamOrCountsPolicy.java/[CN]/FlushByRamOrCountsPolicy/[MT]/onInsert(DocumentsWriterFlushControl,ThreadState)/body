{
  if (flushOnDocCount() && state.perThread.getNumDocsInRAM() >= indexWriterConfig.getMaxBufferedDocs()) {
    control.setFlushPending(state);
  }
 else {
    if (flushOnRAM()) {
      final double ramBufferSizeMB=indexWriterConfig.getRAMBufferSizeMB();
      final long totalRam=control.activeBytes();
      final long limit=(long)(ramBufferSizeMB * 1024.d * 1024.d);
      if (totalRam >= limit) {
        markLargestWriterPending(control,state,totalRam);
      }
    }
  }
}
