{
  if (flushOnDocCount() && state.perThread.getNumDocsInRAM() >= indexWriterConfig.getMaxBufferedDocs()) {
    control.setFlushPending(state);
  }
 else   if (flushOnRAM()) {
    final long limit=(long)(indexWriterConfig.getRAMBufferSizeMB() * 1024.d * 1024.d);
    final long totalRam=control.activeBytes();
    if (totalRam >= limit) {
      markLargestWriterPending(control,state,totalRam);
    }
  }
}
