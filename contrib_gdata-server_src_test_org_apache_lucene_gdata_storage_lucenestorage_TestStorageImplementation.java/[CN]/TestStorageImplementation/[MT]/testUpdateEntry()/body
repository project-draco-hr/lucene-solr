{
  Object monitor=new Object();
  AtomicBoolean reached=new AtomicBoolean(false);
  MultiThreadEntryStub concuEntry=new MultiThreadEntryStub();
  concuEntry.setId(System.currentTimeMillis() + "");
  ProvidedService conf=new ProvidedServiceStub();
  concuEntry.setServiceConfig(conf);
  concuEntry.setUpdated(DateTime.now());
  concuEntry.setFeedId("feed");
  this.storage.storeEntry(concuEntry);
  storage.close();
  concuEntry.acceptGetEntryVisitor(getMonitorVisitor(monitor,reached));
  Thread t1=getUpdThread(storage,concuEntry,false);
  Thread t2=getUpdThread(storage,concuEntry,true);
  t1.start();
  while (true) {
synchronized (monitor) {
      if (reached.get())       break;
      monitor.wait(10);
    }
  }
  t2.start();
  t2.join(800);
  while (true) {
synchronized (monitor) {
      if (!reached.get())       break;
      monitor.notifyAll();
    }
  }
  t1.join(300);
  if (fail)   fail("thread failed -- see stacktrace");
}
