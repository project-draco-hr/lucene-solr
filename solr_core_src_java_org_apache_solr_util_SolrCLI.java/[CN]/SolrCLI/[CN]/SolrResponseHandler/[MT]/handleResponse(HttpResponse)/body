{
  HttpEntity entity=response.getEntity();
  if (entity != null) {
    Object resp=ObjectBuilder.getVal(new JSONParser(EntityUtils.toString(entity)));
    if (resp != null && resp instanceof Map) {
      return (Map<String,Object>)resp;
    }
 else {
      throw new ClientProtocolException("Expected JSON object in response but received " + resp);
    }
  }
 else {
    StatusLine statusLine=response.getStatusLine();
    throw new HttpResponseException(statusLine.getStatusCode(),statusLine.getReasonPhrase());
  }
}
