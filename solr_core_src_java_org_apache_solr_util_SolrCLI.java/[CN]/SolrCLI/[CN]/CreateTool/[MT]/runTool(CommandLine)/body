{
  String solrUrl=cli.getOptionValue("solrUrl",DEFAULT_SOLR_URL);
  if (!solrUrl.endsWith("/"))   solrUrl+="/";
  String systemInfoUrl=solrUrl + "admin/info/system";
  CloseableHttpClient httpClient=getHttpClient();
  int result=-1;
  Tool tool=null;
  try {
    Map<String,Object> systemInfo=getJson(httpClient,systemInfoUrl,2);
    if ("solrcloud".equals(systemInfo.get("mode"))) {
      tool=new CreateCollectionTool();
    }
 else {
      tool=new CreateCoreTool();
    }
    result=tool.runTool(cli);
  }
 catch (  Exception exc) {
    System.err.println("ERROR: create failed due to: " + exc.getMessage());
    System.err.println();
    result=1;
  }
 finally {
    closeHttpClient(httpClient);
  }
  return result;
}
