{
  Directory dir=newDirectory();
  Codec codec=getCodec();
  SegmentInfo segmentInfo=newSegmentInfo(dir,"_123");
  FieldInfos.Builder builder=new FieldInfos.Builder();
  FieldInfo fi=builder.getOrAdd("field");
  fi.setIndexOptions(TextField.TYPE_STORED.indexOptions());
  addAttributes(fi);
  fi.putAttribute("foo","bar");
  fi.putAttribute("bar","baz");
  FieldInfos infos=builder.finish();
  codec.fieldInfosFormat().write(dir,segmentInfo,"",infos,IOContext.DEFAULT);
  FieldInfos infos2=codec.fieldInfosFormat().read(dir,segmentInfo,"",IOContext.DEFAULT);
  assertEquals(1,infos2.size());
  assertNotNull(infos2.fieldInfo("field"));
  Map<String,String> attributes=infos2.fieldInfo("field").attributes();
  try {
    attributes.put("bogus","bogus");
    fail("shouldn't be able to modify attributes");
  }
 catch (  UnsupportedOperationException expected) {
  }
  dir.close();
}
