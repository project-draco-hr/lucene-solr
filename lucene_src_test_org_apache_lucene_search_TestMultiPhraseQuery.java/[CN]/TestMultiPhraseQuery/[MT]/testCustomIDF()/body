{
  Directory indexStore=newDirectory();
  RandomIndexWriter writer=new RandomIndexWriter(random,indexStore);
  add("This is a test","object",writer);
  add("a note","note",writer);
  IndexReader reader=writer.getReader();
  IndexSearcher searcher=newSearcher(reader);
  searcher.setSimilarityProvider(new DefaultSimilarityProvider(){
    @Override public Similarity get(    String field){
      return new DefaultSimilarity(){
        @Override public IDFExplanation idfExplain(        Collection<Term> terms,        IndexSearcher searcher) throws IOException {
          return new IDFExplanation(){
            @Override public float getIdf(){
              return 10f;
            }
            @Override public String explain(){
              return "just a test";
            }
          }
;
        }
      }
;
    }
  }
);
  MultiPhraseQuery query=new MultiPhraseQuery();
  query.add(new Term[]{new Term("body","this"),new Term("body","that")});
  query.add(new Term("body","is"));
  Weight weight=query.createWeight(searcher);
  assertEquals(10f * 10f,weight.sumOfSquaredWeights(),0.001f);
  writer.close();
  searcher.close();
  reader.close();
  indexStore.close();
}
