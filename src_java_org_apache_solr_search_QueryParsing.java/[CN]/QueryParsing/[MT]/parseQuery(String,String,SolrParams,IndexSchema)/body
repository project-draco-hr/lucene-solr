{
  try {
    String opParam=params.get(OP,schema.getQueryParserDefaultOperator());
    QueryParser.Operator defaultOperator="AND".equals(opParam) ? QueryParser.Operator.AND : QueryParser.Operator.OR;
    SolrQueryParser parser=new SolrQueryParser(schema,defaultField);
    parser.setDefaultOperator(defaultOperator);
    Query query=parser.parse(qs);
    if (SolrCore.log.isLoggable(Level.FINEST)) {
      SolrCore.log.finest("After QueryParser:" + query);
    }
    return query;
  }
 catch (  ParseException e) {
    SolrCore.log(e);
    throw new SolrException(400,"Error parsing Lucene query",e);
  }
}
