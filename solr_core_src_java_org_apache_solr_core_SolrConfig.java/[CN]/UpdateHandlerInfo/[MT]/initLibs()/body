{
  NodeList nodes=(NodeList)evaluate("lib",XPathConstants.NODESET);
  if (nodes == null || nodes.getLength() == 0)   return;
  log.info("Adding specified lib dirs to ClassLoader");
  SolrResourceLoader loader=getResourceLoader();
  try {
    for (int i=0; i < nodes.getLength(); i++) {
      Node node=nodes.item(i);
      String baseDir=DOMUtil.getAttr(node,"dir");
      String path=DOMUtil.getAttr(node,PATH);
      if (null != baseDir) {
        String regex=DOMUtil.getAttr(node,"regex");
        FileFilter filter=(null == regex) ? null : new RegexFileFilter(regex);
        loader.addToClassLoader(baseDir,filter,false);
      }
 else       if (null != path) {
        final File file=FileUtils.resolvePath(new File(loader.getInstanceDir()),path);
        loader.addToClassLoader(file.getParent(),new FileFilter(){
          @Override public boolean accept(          File pathname){
            return pathname.equals(file);
          }
        }
,false);
      }
 else {
        throw new RuntimeException("lib: missing mandatory attributes: 'dir' or 'path'");
      }
    }
  }
  finally {
    loader.reloadLuceneSPI();
  }
}
