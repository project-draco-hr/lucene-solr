{
  final IndexReader r=ref.searcher.getIndexReader();
  final IndexReader newReader=DirectoryReader.openIfChanged((DirectoryReader)r);
  if (newReader == null) {
    return null;
  }
 else {
    DirectoryTaxonomyReader tr=TaxonomyReader.openIfChanged(ref.taxonomyReader);
    if (tr == null) {
      ref.taxonomyReader.incRef();
      tr=ref.taxonomyReader;
    }
 else     if (taxoWriter != null && taxoWriter.getTaxonomyEpoch() != taxoEpoch) {
      IOUtils.close(newReader,tr);
      throw new IllegalStateException("DirectoryTaxonomyWriter.replaceTaxonomy was called, which is not allowed when using SearcherTaxonomyManager");
    }
    return new SearcherAndTaxonomy(SearcherManager.getSearcher(searcherFactory,newReader,r),tr);
  }
}
